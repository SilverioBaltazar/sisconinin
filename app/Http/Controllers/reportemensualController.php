<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

use App\Http\Requests\reportemensualfiltroRequest;
use App\Http\Requests\reportemensualfiltro2Request;

use App\regBitacoraModel;
use App\regdepenModel;
use App\regUmedidaModel;
use App\regPeriodosModel;
use App\regMesesModel;
use App\regDiasModel;
use App\regAniosModel;
use App\regTipometaModel;
use App\regEPprogramaModel;
use App\regEPproyectoModel;
use App\regProgeAnualModel;
use App\regProgdAnualModel;

// Exportar a excel 
use Maatwebsite\Excel\Facades\Excel;
use App\Exports\ExcelExportMensualcon;
use App\Exports\ExcelExportMensualdet;
use App\Exports\ExcelExportMensualbddet;
use App\Exports\ExcelExportMensualcon_v2;
use App\Exports\ExcelExportMensualdet_v2;
use App\Exports\ExcelExportMensualbddet_v2;

use App\Exports\BladeExport;
// Exportar a pdf
use PDF;
//use Options;

class reportemensualController extends Controller
{

    /***********************************************************************************/
    /*** Filtro para generar reporte mensual                                      ******/
    /***********************************************************************************/
    public function actionReporteMensualFiltro_v2(){
        $nombre       = session()->get('userlog');
        $pass         = session()->get('passlog');
        if($nombre == NULL AND $pass == NULL){
            return view('sicinar.login.expirada');
        }
        $usuario      = session()->get('usuario');
        $rango        = session()->get('rango');
        $ip           = session()->get('ip');
        $arbol_id     = session()->get('arbol_id');        
        $depen_id     = session()->get('depen_id');     

        $regperiodos  = regPeriodosModel::select('PERIODO_ID', 'PERIODO_DESC')
                        ->get();         
        $regmeses     = regMesesModel::select('MES_ID','MES_DESC')
                        ->get();   
        $regtipometa  = regTipometaModel::select('TACCION_ID','TACCION_DESC')
                        ->orderBy('TACCION_ID','asc')
                        ->get();                               
        //********* Validar rol de usuario **********************/
        if(session()->get('rango') !== '0'){  
            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                              'SIEVAD_EPA.DEPEN_ID2')
                                             ->join('SIEVAD_DPA','SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                           ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->selectRaw('COUNT(*) AS NACTIV')
                           ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID'             ,'ASC')
                           ->orderBy(  'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC','ASC')
                           ->get();
        }else{                     
            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                              'SIEVAD_EPA.DEPEN_ID2')
                                             ->join('SIEVAD_DPA','SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                           ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->selectRaw('COUNT(*) AS NACTIV')                           
                           ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->where(    'SIEVAD_EPA.DEPEN_ID2'              ,$depen_id)            
                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID'             ,'ASC')
                           ->orderBy(  'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC','ASC')
                           ->get();     
        }                        
        if($regprogeanual->count() <= 0){
            toastr()->error('No existen programas anuales.','Lo siento!',['positionClass' => 'toast-bottom-right']);
        }
        return view('sicinar.reportes.reporteMensual_v2',compact('nombre','usuario','regperiodos','regmeses','regprogeanual','regtipometa')); 
    }

    /***********************************************************************************/
    /*** Generar reporte mensual                                               ******/
    /***********************************************************************************/
    public function actionVerReporteMensual_v2(reportemensualfiltro2Request $request){
        $nombre       = session()->get('userlog');
        $pass         = session()->get('passlog');
        if($nombre == NULL AND $pass == NULL){
            return view('sicinar.login.expirada');
        }
        $usuario      = session()->get('usuario');
        $rango        = session()->get('rango');
        $ip           = session()->get('ip');
        $arbol_id     = session()->get('arbol_id');        
        $depen_id     = session()->get('depen_id');     

     
        $regmeses     = regMesesModel::select('MES_ID','MES_DESC')
                        ->get();      
        $regepprog    = regEPprogramaModel::select('EPPROG_ID','EPPROG_DESC')
                        ->orderBy('EPPROG_ID','asc')
                        ->get();                         
        $regepproy    = regEPproyectoModel::select('EPPROy_ID','EPPROy_DESC')
                        ->orderBy('EPPROy_ID','asc')
                        ->get();   
       $regdepen      = regdepenModel::select('DEPEN_ID', 'DEPEN_DESC')
                        ->orderBy('DEPEN_DESC'  ,'ASC')
                        ->get();                                  
        $regumedida   = regUmedidaModel::select('UMED_ID','UMED_DESC')
                        ->orderBy('UMED_DESC','asc')
                        ->get();                           
        //**************************************************************//
        // ***** busqueda https://github.com/rimorsoft/Search-simple ***//
        // ***** video https://www.youtube.com/watch?v=bmtD9GUaszw   ***//                            
        //**************************************************************//
        $periodo_id= $request->get('periodo_id'); //Periodo
        $mes_id    = $request->get('mes_id');     // Mes
        //$depen_id= $request->get('depen_id');   // Dependencia ejecutora
        $tipo      = $request->get('tipo');       // P-antalla, E-xcel, D-PDF 
        $folio     = $request->get('folio');     
        $clase     = $request->get('clase');      //clase de reporte C-concentrado, D-Detallado, S-sabana
        $trim      = $request->get('trim');       // Trimestre
        
        //$depen_id  = $request->input('depen_id');
        $op        = $request->input('op');
        $depen_id  =[];
        //$i         = 0;
        $cont      = 0;
        //$checked_arr = array();
        //if(!empty($_POST['op'])) {
        //    $opci        = "'".implode("','",$_POST['op'])."'";
        //    $checked_arr = "'".implode("','",$_POST['op'])."'";
        //}
        //echo "opci:";        
        //echo $opci;
        //echo "<br><br>";        

        //echo "checked:";
        //echo $checked_arr;
        //echo "<br><br>";           
        //$depen_id   = "'".implode("','",$op)."'";
        //$depen_id   = implode(",",$op);

        $cont       = count($op);
        //$depen_id   = "'".implode("','",$op)."'";
        if($cont = 0)
            //toastr()->error('Error No selecciono ninguna Unidad ejecutora. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
            return back()->withErrors([' Error No selecciono ninguna Unidad Ejecutora.']);
        else{  
            //$cadena   =str_replace(",", "", $cadena);     #Importe total quita ,
            // $hora    = Trim(substr($aDatos[1] ,0, 30));          
        }

        //if($request->clase == 'C'){
        switch ($request->clase) {
        //*******************************************************************************//
        //******** Reportes concentrados  ***********************************************//
        //*******************************************************************************//
        case 'C':    //Concentrados

            //**************************************************************************//
            // Generar reportes concentrados                                            //
            //**************************************************************************//
            switch ($request->tipo) {
            case 'P':    //Por pantalla concentrado
                if($request->taccion_id == '0' ){   
                    //*********** 2 ********************
                    $dataAsociative = array();
                    $dataPoints     = array();
                    $i =0;
                    foreach($op as $key => $val) {
                        ///print "$key = $val <br>";
                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID',
                                                                                      '=','SIEVAD_EPA.DEPEN_ID2')
                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO','=',
                                                                                          'SIEVAD_EPA.FOLIO')
                           ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')

                           ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')                           

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')          
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_01)  AS GTAP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_02)  AS GTAP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_01)  AS GTAC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_02)  AS GTAC_02')
                           ->selectRaw('COUNT(*) AS NACTIV')
                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                           ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')
                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                           ->get();
                           //->whereRaw( 'SIEVAD_DPA.DEPEN_ID2' ,[$depen_id] )
                           // OK ->where(    TRIM('SIEVAD_DPA.DEPEN_ID2') ,'=','211C0201000002S' )
                           //->WhereIn(  TRIM('SIEVAD_DPA.DEPEN_ID2') ,[$depen_id] )
                           //->whereIn(  'SIEVAD_DPA.DEPEN_ID2', array($depen_id) )
                           //->whereIn(  'SIEVAD_DPA.DEPEN_ID2', collect([$depen_id]) )
                           //->where(    TRIM('SIEVAD_DPA.DEPEN_ID2'), 'LIKE', "%$depen_id[$i]%")
                           //->WhereIn(  TRIM('SIEVAD_DPA.DEPEN_ID2') ,[$opci] )
                           //->WhereIn(  TRIM('SIEVAD_DPA.DEPEN_ID2') ,array($opci) )
                           //->WhereIn(  TRIM('SIEVAD_DPA.DEPEN_ID2') ,collect([$opci]) )
                           //->WhereIn(  TRIM('SIEVAD_DPA.DEPEN_ID2') ,[$checked_arr] )
                           //->WhereIn(  TRIM('SIEVAD_DPA.DEPEN_ID2') ,array($checked_arr) )
                           //->WhereIn(  TRIM('SIEVAD_DPA.DEPEN_ID2') ,collect([$checked_arr]) )                           
                           if($regprogeanual->count() > 0){
                                //$array1[] = (array) $regprogdanual;
                                //$array2[$i] = get_object_vars($regprogdanual);
                                //$array3[$i] = json_decode(json_encode($regprogdanual), true);                            
                                //echo $regprogdanual->count();
                                //echo "<br>";
                                //echo $regprogdanual;
                                //echo "<br>";
                                $i++;
                                //Data asociative         
                                $dataAsociative[]=array(
                                                   'periodo_id'   => $regprogeanual[0]->periodo_id,
                                                   'depen_id'     => $regprogeanual[0]->depen_id2,
                                                   'depen_desc'   => $regprogeanual[0]->depen_desc,
                                                   'GMP_01'       => $regprogeanual[0]->gmp_01,
                                                   'GMP_02'       => $regprogeanual[0]->gmp_02,
                                                   'GMP_03'       => $regprogeanual[0]->gmp_03,
                                                   'GMP_04'       => $regprogeanual[0]->gmp_04,
                                                   'GMP_05'       => $regprogeanual[0]->gmp_05,
                                                   'GMP_06'       => $regprogeanual[0]->gmp_06,
                                                   'GMP_07'       => $regprogeanual[0]->gmp_07,
                                                   'GMP_08'       => $regprogeanual[0]->gmp_08,
                                                   'GMP_09'       => $regprogeanual[0]->gmp_09,
                                                   'GMP_10'       => $regprogeanual[0]->gmp_10,
                                                   'GMP_11'       => $regprogeanual[0]->gmp_11,
                                                   'GMP_12'       => $regprogeanual[0]->gmp_12,
                                                   'GMC_01'       => $regprogeanual[0]->gmc_01,
                                                   'GMC_02'       => $regprogeanual[0]->gmc_02,
                                                   'GMC_03'       => $regprogeanual[0]->gmc_03,
                                                   'GMC_04'       => $regprogeanual[0]->gmc_04,
                                                   'GMC_05'       => $regprogeanual[0]->gmc_05,
                                                   'GMC_06'       => $regprogeanual[0]->gmc_06,
                                                   'GMC_07'       => $regprogeanual[0]->gmc_07,
                                                   'GMC_08'       => $regprogeanual[0]->gmc_08,
                                                   'GMC_09'       => $regprogeanual[0]->gmc_09,
                                                   'GMC_10'       => $regprogeanual[0]->gmc_10,
                                                   'GMC_11'       => $regprogeanual[0]->gmc_11,
                                                   'GMC_12'       => $regprogeanual[0]->gmc_12,
                                                   'GACUMP_01'    => $regprogeanual[0]->gacump_01,
                                                   'GACUMP_02'    => $regprogeanual[0]->gacump_02,
                                                   'GACUMP_03'    => $regprogeanual[0]->gacump_03,
                                                   'GACUMP_04'    => $regprogeanual[0]->gacump_04,
                                                   'GACUMP_05'    => $regprogeanual[0]->gacump_05,
                                                   'GACUMP_06'    => $regprogeanual[0]->gacump_06,
                                                   'GACUMP_07'    => $regprogeanual[0]->gacump_07,
                                                   'GACUMP_08'    => $regprogeanual[0]->gacump_08,
                                                   'GACUMP_09'    => $regprogeanual[0]->gacump_09,
                                                   'GACUMP_10'    => $regprogeanual[0]->gacump_10,
                                                   'GACUMP_11'    => $regprogeanual[0]->gacump_11,
                                                   'GACUMP_12'    => $regprogeanual[0]->gacump_12,
                                                   'GACUMC_01'    => $regprogeanual[0]->gacumc_01,
                                                   'GACUMC_02'    => $regprogeanual[0]->gacumc_02,
                                                   'GACUMC_03'    => $regprogeanual[0]->gacumc_03,
                                                   'GACUMC_04'    => $regprogeanual[0]->gacumc_04,
                                                   'GACUMC_05'    => $regprogeanual[0]->gacumc_05,
                                                   'GACUMC_06'    => $regprogeanual[0]->gacumc_06,
                                                   'GACUMC_07'    => $regprogeanual[0]->gacumc_07,
                                                   'GACUMC_08'    => $regprogeanual[0]->gacumc_08,
                                                   'GACUMC_09'    => $regprogeanual[0]->gacumc_09,
                                                   'GACUMC_10'    => $regprogeanual[0]->gacumc_10,
                                                   'GACUMC_11'    => $regprogeanual[0]->gacumc_11,
                                                   'GACUMC_12'    => $regprogeanual[0]->gacumc_12,
                                                   'GTAP_01'      => $regprogeanual[0]->gtap_01,
                                                   'GTAP_02'      => $regprogeanual[0]->gtap_02,
                                                   'GTAC_01'      => $regprogeanual[0]->gtac_01,
                                                   'GTAC_02'      => $regprogeanual[0]->gtac_02,
                                                   'NACTIV'       => $regprogeanual[0]->nactiv
                                                  );            
                                $dataPoints[$i]=array(//$regfactura[0]->efactura_montosubsidio;
                                                   $regprogeanual[0]->periodo_id,
                                                   $regprogeanual[0]->depen_id2,
                                                   $regprogeanual[0]->depen_desc,
                                                   $regprogeanual[0]->gmp_01,
                                                   $regprogeanual[0]->gmp_02,
                                                   $regprogeanual[0]->gmp_03,
                                                   $regprogeanual[0]->gmp_04,
                                                   $regprogeanual[0]->gmp_05,
                                                   $regprogeanual[0]->gmp_06,
                                                   $regprogeanual[0]->gmp_07,
                                                   $regprogeanual[0]->gmp_08,
                                                   $regprogeanual[0]->gmp_09,
                                                   $regprogeanual[0]->gmp_10,
                                                   $regprogeanual[0]->gmp_11,
                                                   $regprogeanual[0]->gmp_12,
                                                   $regprogeanual[0]->gmc_01,
                                                   $regprogeanual[0]->gmc_02,
                                                   $regprogeanual[0]->gmc_03,
                                                   $regprogeanual[0]->gmc_04,
                                                   $regprogeanual[0]->gmc_05,
                                                   $regprogeanual[0]->gmc_06,
                                                   $regprogeanual[0]->gmc_07,
                                                   $regprogeanual[0]->gmc_08,
                                                   $regprogeanual[0]->gmc_09,
                                                   $regprogeanual[0]->gmc_10,
                                                   $regprogeanual[0]->gmc_11,
                                                   $regprogeanual[0]->gmc_12,
                                                   $regprogeanual[0]->gacump_01,
                                                   $regprogeanual[0]->gacump_02,
                                                   $regprogeanual[0]->gacump_03,
                                                   $regprogeanual[0]->gacump_04,
                                                   $regprogeanual[0]->gacump_05,
                                                   $regprogeanual[0]->gacump_06,
                                                   $regprogeanual[0]->gacump_07,
                                                   $regprogeanual[0]->gacump_08,
                                                   $regprogeanual[0]->gacump_09,
                                                   $regprogeanual[0]->gacump_10,
                                                   $regprogeanual[0]->gacump_11,
                                                   $regprogeanual[0]->gacump_12,
                                                   $regprogeanual[0]->gacumc_01,
                                                   $regprogeanual[0]->gacumc_02,
                                                   $regprogeanual[0]->gacumc_03,
                                                   $regprogeanual[0]->gacumc_04,
                                                   $regprogeanual[0]->gacumc_05,
                                                   $regprogeanual[0]->gacumc_06,
                                                   $regprogeanual[0]->gacumc_07,
                                                   $regprogeanual[0]->gacumc_08,
                                                   $regprogeanual[0]->gacumc_09,
                                                   $regprogeanual[0]->gacumc_10,
                                                   $regprogeanual[0]->gacumc_11,
                                                   $regprogeanual[0]->gacumc_12,
                                                   $regprogeanual[0]->gtap_01,
                                                   $regprogeanual[0]->gtap_02,
                                                   $regprogeanual[0]->gtac_01,
                                                   $regprogeanual[0]->gtac_02,
                                                   $regprogeanual[0]->nactiv
                                                  );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;
                                    $data[$i][3] =$regprogeanual[0]->gmp_01;
                                    $data[$i][4] =$regprogeanual[0]->gmp_02;
                                    $data[$i][5] =$regprogeanual[0]->gmp_03;
                                    $data[$i][6] =$regprogeanual[0]->gmp_04;
                                    $data[$i][7] =$regprogeanual[0]->gmp_05;
                                    $data[$i][8] =$regprogeanual[0]->gmp_06;
                                    $data[$i][9] =$regprogeanual[0]->gmp_07;
                                    $data[$i][10]=$regprogeanual[0]->gmp_08;
                                    $data[$i][11]=$regprogeanual[0]->gmp_09;
                                    $data[$i][12]=$regprogeanual[0]->gmp_10;
                                    $data[$i][13]=$regprogeanual[0]->gmp_11;
                                    $data[$i][14]=$regprogeanual[0]->gmp_12; 
                                    $data[$i][15]=$regprogeanual[0]->gmc_01;
                                    $data[$i][16]=$regprogeanual[0]->gmc_02;
                                    $data[$i][17]=$regprogeanual[0]->gmc_03;
                                    $data[$i][18]=$regprogeanual[0]->gmc_04;
                                    $data[$i][19]=$regprogeanual[0]->gmc_05;
                                    $data[$i][20]=$regprogeanual[0]->gmc_06;
                                    $data[$i][21]=$regprogeanual[0]->gmc_07;
                                    $data[$i][22]=$regprogeanual[0]->gmc_08;
                                    $data[$i][23]=$regprogeanual[0]->gmc_09;
                                    $data[$i][24]=$regprogeanual[0]->gmc_10;
                                    $data[$i][25]=$regprogeanual[0]->gmc_11;
                                    $data[$i][26]=$regprogeanual[0]->gmc_12;  
                                    $data[$i][27]=$regprogeanual[0]->gacump_01; 
                                    $data[$i][28]=$regprogeanual[0]->gacump_02; 
                                    $data[$i][29]=$regprogeanual[0]->gacump_03; 
                                    $data[$i][30]=$regprogeanual[0]->gacump_04; 
                                    $data[$i][31]=$regprogeanual[0]->gacump_05; 
                                    $data[$i][32]=$regprogeanual[0]->gacump_06; 
                                    $data[$i][33]=$regprogeanual[0]->gacump_07; 
                                    $data[$i][34]=$regprogeanual[0]->gacump_08; 
                                    $data[$i][35]=$regprogeanual[0]->gacump_09; 
                                    $data[$i][36]=$regprogeanual[0]->gacump_10; 
                                    $data[$i][37]=$regprogeanual[0]->gacump_11; 
                                    $data[$i][38]=$regprogeanual[0]->gacump_12; 
                                    $data[$i][39]=$regprogeanual[0]->gacumc_01; 
                                    $data[$i][40]=$regprogeanual[0]->gacumc_02; 
                                    $data[$i][41]=$regprogeanual[0]->gacumc_03; 
                                    $data[$i][42]=$regprogeanual[0]->gacumc_04; 
                                    $data[$i][43]=$regprogeanual[0]->gacumc_05; 
                                    $data[$i][44]=$regprogeanual[0]->gacumc_06; 
                                    $data[$i][45]=$regprogeanual[0]->gacumc_07; 
                                    $data[$i][46]=$regprogeanual[0]->gacumc_08; 
                                    $data[$i][47]=$regprogeanual[0]->gacumc_09; 
                                    $data[$i][48]=$regprogeanual[0]->gacumc_10; 
                                    $data[$i][49]=$regprogeanual[0]->gacumc_11; 
                                    $data[$i][50]=$regprogeanual[0]->gacumc_12;                                     
                                    $data[$i][51]=$regprogeanual[0]->gtap_01; 
                                    $data[$i][52]=$regprogeanual[0]->gtap_02;
                                    $data[$i][53]=$regprogeanual[0]->gtac_01; 
                                    $data[$i][54]=$regprogeanual[0]->gtac_02;
                                    $data[$i][55]=$regprogeanual[0]->nactiv;
                                //} //foreach 

                                //print_r($dataAsociative);
                                //echo "<br>";
                                // no foreach ($dataAsociative as $key => $row) {
                                //   echo $row['PERIODO_ID'].' '.$row['DEPEN_DESC'].'<br/>';
                                //}
                                //print_r($dataPoints);
                                //echo "<br>";
                                //no foreach ($dataPoints as $key => $roww) {
                                //   echo $roww[$key].' '.$roww[2].'<br/>';
                                //}      
                                //ok foreach (array_keys($dataAsociative[0]) as $v) {
                                //    echo $v.'<br>';
                                //}
                                //ok foreach (array_keys($dataPoints) as $vv) {
                                //    echo $vv.'<br>';
                                //}                                
                                //foreach ($dataPoints as $vv) {
                                //    echo $vv.'<br>';
                                //}       
                                //$arrlength2 = count($dataPoints);
                                //echo "Tamaño2.....:$arrlength2<br>";
                                //for($x = 0; $x < $arrlength2; $x++) {
                                //    echo $dataPoints[$x];
                                //    echo "<br>";
                                //}              

                                //return View('reporteMaterias',compact('dataPoints'));  
                            }   //if()                             
                    }  //foreach }

                    //$arrlength = count($data);
                    //echo "Tamaño1.....:$arrlength<br>";                    
                    //$arrlength2 = count($dataPoints);
                    //echo "Tamaño2.....:$arrlength2<br>";
                    //for ($row = 1; $row <= $i; $row ++)
                    //{
                    //    echo '|'.$row.$dataPoints[$row][0].$dataPoints[$row][1].$dataPoints[$row][2].'|<br />';
                    //    echo '|'.$row.$data[$row][0].$data[$row][1].$data[$row][2].'|<br />';
                    //}
                    //echo "<BR><BR>";

                    //Data asociative
                    //print_r($dataAsociative);
                    //foreach ($dataAsociative as $key => $row) {
                    //    echo $row['PERIODO_ID'].' '.$row['DEPEN_DESC'].'<br/>';  
                    //}
                    //Data asociative
                    //foreach($dataAsociative as $x => $x_value) {
                    //   echo "Key=" . $x . ", Value=" . $x_value;
                    //   echo "<br>";
                    //}   
                    //Multidimensional
                    //for ($row = 0; $row < $i; $row++) {
                    //  echo "<p><b>Renglon numero $row</b></p>";
                    //  echo "<ul>";
                    //  for ($col = 0; $col < 3; $col++) {
                    //    echo "<li>".$data[$row][$col]."</li>";
                    //  }
                    //  echo "</ul>";
                    //}    
                    //print_r($data);                
                    //dd("contador i.....:".$i);
                }else{
                    if($request->taccion_id <> '0' ){   
                        //*********** 3 ********************
                        $dataAsociative = array();
                        $dataPoints     = array();
                        $i =0;
                        foreach($op as $key => $val) {
                            ///print "$key = $val <br>";
                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID',
                                                                                          '=','SIEVAD_EPA.DEPEN_ID2')
                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO','=',
                                                                                              'SIEVAD_EPA.FOLIO')
                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                               
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')

                               ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')                           

                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')          
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12') 

                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12') 

                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_01)  AS GTAP_01')
                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02)  AS GTAP_02')
                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_01)  AS GTAC_01')
                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02)  AS GTAC_02')
                               ->selectRaw('COUNT(*) AS NACTIV')
                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                               ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')
                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                               ->get();
                            if($regprogeanual->count() > 0){
                                $i++;
                                $dataPoints[$i]=array(
                                                   $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                   $regprogeanual[0]->gmp_01,    $regprogeanual[0]->gmp_02,   $regprogeanual[0]->gmp_03,
                                                   $regprogeanual[0]->gmp_04,    $regprogeanual[0]->gmp_05,   $regprogeanual[0]->gmp_06,
                                                   $regprogeanual[0]->gmp_07,    $regprogeanual[0]->gmp_08,   $regprogeanual[0]->gmp_09,
                                                   $regprogeanual[0]->gmp_10,    $regprogeanual[0]->gmp_11,   $regprogeanual[0]->gmp_12,
                                                   $regprogeanual[0]->gmc_01,    $regprogeanual[0]->gmc_02,   $regprogeanual[0]->gmc_03,
                                                   $regprogeanual[0]->gmc_04,    $regprogeanual[0]->gmc_05,   $regprogeanual[0]->gmc_06,
                                                   $regprogeanual[0]->gmc_07,    $regprogeanual[0]->gmc_08,   $regprogeanual[0]->gmc_09,
                                                   $regprogeanual[0]->gmc_10,    $regprogeanual[0]->gmc_11,   $regprogeanual[0]->gmc_12,
                                                   $regprogeanual[0]->gacump_01, $regprogeanual[0]->gacump_02,$regprogeanual[0]->gacump_03,
                                                   $regprogeanual[0]->gacump_04, $regprogeanual[0]->gacump_05,$regprogeanual[0]->gacump_06,
                                                   $regprogeanual[0]->gacump_07, $regprogeanual[0]->gacump_08,$regprogeanual[0]->gacump_09,
                                                   $regprogeanual[0]->gacump_10, $regprogeanual[0]->gacump_11,$regprogeanual[0]->gacump_12,
                                                   $regprogeanual[0]->gacumc_01,
                                                   $regprogeanual[0]->gacumc_02,
                                                   $regprogeanual[0]->gacumc_03,
                                                   $regprogeanual[0]->gacumc_04,
                                                   $regprogeanual[0]->gacumc_05,
                                                   $regprogeanual[0]->gacumc_06,
                                                   $regprogeanual[0]->gacumc_07,
                                                   $regprogeanual[0]->gacumc_08,
                                                   $regprogeanual[0]->gacumc_09,
                                                   $regprogeanual[0]->gacumc_10,
                                                   $regprogeanual[0]->gacumc_11,
                                                   $regprogeanual[0]->gacumc_12,
                                                   $regprogeanual[0]->gtap_01,
                                                   $regprogeanual[0]->gtap_02,
                                                   $regprogeanual[0]->gtac_01,
                                                   $regprogeanual[0]->gtac_02,
                                                   $regprogeanual[0]->nactiv
                                                  );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;
                                    $data[$i][3] =$regprogeanual[0]->gmp_01;
                                    $data[$i][4] =$regprogeanual[0]->gmp_02;
                                    $data[$i][5] =$regprogeanual[0]->gmp_03;
                                    $data[$i][6] =$regprogeanual[0]->gmp_04;
                                    $data[$i][7] =$regprogeanual[0]->gmp_05;
                                    $data[$i][8] =$regprogeanual[0]->gmp_06;
                                    $data[$i][9] =$regprogeanual[0]->gmp_07;
                                    $data[$i][10]=$regprogeanual[0]->gmp_08;
                                    $data[$i][11]=$regprogeanual[0]->gmp_09;
                                    $data[$i][12]=$regprogeanual[0]->gmp_10;
                                    $data[$i][13]=$regprogeanual[0]->gmp_11;
                                    $data[$i][14]=$regprogeanual[0]->gmp_12; 
                                    $data[$i][15]=$regprogeanual[0]->gmc_01;
                                    $data[$i][16]=$regprogeanual[0]->gmc_02;
                                    $data[$i][17]=$regprogeanual[0]->gmc_03;
                                    $data[$i][18]=$regprogeanual[0]->gmc_04;
                                    $data[$i][19]=$regprogeanual[0]->gmc_05;
                                    $data[$i][20]=$regprogeanual[0]->gmc_06;
                                    $data[$i][21]=$regprogeanual[0]->gmc_07;
                                    $data[$i][22]=$regprogeanual[0]->gmc_08;
                                    $data[$i][23]=$regprogeanual[0]->gmc_09;
                                    $data[$i][24]=$regprogeanual[0]->gmc_10;
                                    $data[$i][25]=$regprogeanual[0]->gmc_11;
                                    $data[$i][26]=$regprogeanual[0]->gmc_12;  
                                    $data[$i][27]=$regprogeanual[0]->gacump_01; 
                                    $data[$i][28]=$regprogeanual[0]->gacump_02; 
                                    $data[$i][29]=$regprogeanual[0]->gacump_03; 
                                    $data[$i][30]=$regprogeanual[0]->gacump_04; 
                                    $data[$i][31]=$regprogeanual[0]->gacump_05; 
                                    $data[$i][32]=$regprogeanual[0]->gacump_06; 
                                    $data[$i][33]=$regprogeanual[0]->gacump_07; 
                                    $data[$i][34]=$regprogeanual[0]->gacump_08; 
                                    $data[$i][35]=$regprogeanual[0]->gacump_09; 
                                    $data[$i][36]=$regprogeanual[0]->gacump_10; 
                                    $data[$i][37]=$regprogeanual[0]->gacump_11; 
                                    $data[$i][38]=$regprogeanual[0]->gacump_12; 
                                    $data[$i][39]=$regprogeanual[0]->gacumc_01; 
                                    $data[$i][40]=$regprogeanual[0]->gacumc_02; 
                                    $data[$i][41]=$regprogeanual[0]->gacumc_03; 
                                    $data[$i][42]=$regprogeanual[0]->gacumc_04; 
                                    $data[$i][43]=$regprogeanual[0]->gacumc_05; 
                                    $data[$i][44]=$regprogeanual[0]->gacumc_06; 
                                    $data[$i][45]=$regprogeanual[0]->gacumc_07; 
                                    $data[$i][46]=$regprogeanual[0]->gacumc_08; 
                                    $data[$i][47]=$regprogeanual[0]->gacumc_09; 
                                    $data[$i][48]=$regprogeanual[0]->gacumc_10; 
                                    $data[$i][49]=$regprogeanual[0]->gacumc_11; 
                                    $data[$i][50]=$regprogeanual[0]->gacumc_12;                                     
                                    $data[$i][51]=$regprogeanual[0]->gtap_01; 
                                    $data[$i][52]=$regprogeanual[0]->gtap_02;
                                    $data[$i][53]=$regprogeanual[0]->gtac_01; 
                                    $data[$i][54]=$regprogeanual[0]->gtac_02;
                                    $data[$i][55]=$regprogeanual[0]->nactiv;
                            }   //if($regprogeanual->count() > 0)          
                        }  // foreach 
                    }      // taccion_id  <> 0
                }          // taccion_id  == 0  
                //dd('reg.'.$regprogdanual->count() );
                /************ Bitacora inicia *************************************/ 
                setlocale(LC_TIME, "spanish");        
                $xip          = session()->get('ip');
                $xperiodo_id  = (int)date('Y');
                $xprograma_id = 1;
                $xmes_id      = (int)date('m');
                $xproceso_id  =         3;
                $xfuncion_id  =      3001;
                $xtrx_id      =         2;    //Reportes        
                $id           =         0;
                $regbitacora = regBitacoraModel::select('PERIODO_ID','PROGRAMA_ID','MES_ID','PROCESO_ID','FUNCION_ID', 
                                                        'TRX_ID','FOLIO','NO_VECES','FECHA_REG','IP','LOGIN',
                                                        'FECHA_M','IP_M', 'LOGIN_M')
                               ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                        'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO'      => $id])
                               ->get();
                if($regbitacora->count() <= 0){              // Alta
                    $nuevoregBitacora = new regBitacoraModel();              
                    $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                    $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                    $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                    $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                    $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                    $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                    $nuevoregBitacora->FOLIO      = $id;             // Folio    
                    $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                    $nuevoregBitacora->IP         = $ip;             // IP
                    $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                    $nuevoregBitacora->save();
                    if($nuevoregBitacora->save() == true)
                        toastr()->success('Trx de reporte registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                    else
                        toastr()->error('Error de trx de reporte. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                }else{                   
                    //*********** Obtine el no. de veces *****************************
                    $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID'=> $xprograma_id,
                                                          'MES_ID'     => $xmes_id,    'PROCESO_ID' => $xproceso_id, 
                                                          'FUNCION_ID' => $xfuncion_id,'TRX_ID'     => $xtrx_id,
                                                          'FOLIO'      => $id])
                                 ->max('NO_VECES');
                    $xno_veces = $xno_veces+1;                        
                    //*********** Termina de obtener el no de veces *****************************         
                    $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID'=> $xprograma_id,'MES_ID' => $xmes_id,
                                            'PROCESO_ID' => $xproceso_id,'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id,
                                            'FOLIO'      => $id])
                                       ->update([
                                                 'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                                 'IP_M'     => $regbitacora->IP       = $ip,
                                                 'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                                 'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]);
                    toastr()->success('Trx de reporte actualizada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                }   /************ Bitacora termina *************************************/         
                //************** Genera reporte concentrado en pantalla ******************/

                return view('sicinar.reportes.verReportemensualcon_v2',compact('nombre','usuario','regprogdanual','regtotal','regmeses','periodo_id','mes_id','depen_id','dataPoints','data','i'));
                break;

            case 'E':    //Formato excel concentrado     
                $data  = array();
                $dataAsociative = array();
                $dataPoints     = array();                
                $i     = 0;
                switch($request->mes_id){
                    case '1':
                        if($request->taccion_id == '0' ){   
                            $i = 0;
                            foreach($op as $key => $val) {
                                $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                  END
                                                ELSE NULL 
                                             END AS GANUAL_S") 

                                               ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                                               ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.MESP_01) > 0 And SUM(SIEVAD_DPA.MESC_01) > 0 THEN (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 ELSE 0 END AS GMES_P01')  
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.MESP_01) > 0 And SUM(SIEVAD_DPA.MESC_01) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 <  50 THEN 'ROJO'
                                                END
                                              ELSE NULL 
                                            END AS GMES_S01")  

                                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')
                                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.ACUMP_01) > 0 And SUM(SIEVAD_DPA.ACUMC_01) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 ELSE 0 END AS GACUM_P01')  
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.ACUMP_01) > 0 And SUM(SIEVAD_DPA.ACUMC_01) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 <  50 THEN 'ROJO'
                                                END
                                              ELSE NULL 
                                            END AS GACUM_S01") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->get();     
                                if($regprogeanual->count() > 0){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                          $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                          $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                          $regprogeanual[0]->gmp_01,    $regprogeanual[0]->gmc_01,   $regprogeanual[0]->gmes_p01 ,$regprogeanual[0]->gmes_s01,
                                                          $regprogeanual[0]->gacump_01, $regprogeanual[0]->gacumc_01,$regprogeanual[0]->gacum_p01,$regprogeanual[0]->gacum_s01,
                                                         );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;

                                    $data[$i][3] =$regprogeanual[0]->gtap_02;
                                    $data[$i][4] =$regprogeanual[0]->gtac_02;
                                    $data[$i][5] =$regprogeanual[0]->ganual_p;
                                    $data[$i][6] =$regprogeanual[0]->ganual_s;

                                    $data[$i][7] =$regprogeanual[0]->gmp_01;
                                    $data[$i][8] =$regprogeanual[0]->gmc_01;
                                    $data[$i][9] =$regprogeanual[0]->gmes_p01;
                                    $data[$i][10]=$regprogeanual[0]->gmes_s01;

                                    $data[$i][11]=$regprogeanual[0]->gacump_01; 
                                    $data[$i][12]=$regprogeanual[0]->gacumc_01; 
                                    $data[$i][13]=$regprogeanual[0]->gacum_p01; 
                                    $data[$i][14]=$regprogeanual[0]->gacum_s01; 
                                }   //if()                             
                            }  //foreach }                                     
                        }else{
                            if($request->taccion_id <> '0' ){ 
                                $i =0;
                                foreach($op as $key => $val) {
                                    ///print "$key = $val <br>";
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                                   ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                      END
                                                    ELSE NULL 
                                                 END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                                                   ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_01) > 0 And SUM(SIEVAD_DPA.MESC_01) > 0 THEN (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 ELSE 0 END AS GMES_P01')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_01) > 0 And SUM(SIEVAD_DPA.MESC_01) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_01)/SUM(SIEVAD_DPA.MESP_01))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S01")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')
                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_01) > 0 And SUM(SIEVAD_DPA.ACUMC_01) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 ELSE 0 END AS GACUM_P01')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_01) > 0 And SUM(SIEVAD_DPA.ACUMC_01) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_01)/SUM(SIEVAD_DPA.ACUMP_01))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S01") 

                                                   ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                                   ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                                   ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                                   ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                                   ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                                   ->get();     
                                    if($regprogeanual->count() > 0){
                                        $i++;
                                        $dataPoints[$i]=array(
                                                              $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                              $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                              $regprogeanual[0]->gmp_01,    $regprogeanual[0]->gmc_01,   $regprogeanual[0]->gmes_p01 ,$regprogeanual[0]->gmes_s01,
                                                              $regprogeanual[0]->gacump_01, $regprogeanual[0]->gacumc_01,$regprogeanual[0]->gacum_p01,$regprogeanual[0]->gacum_s01,
                                                             );       
                                        //Array multidimencional
                                        //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                        //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                        $data[$i][0] =$regprogeanual[0]->periodo_id;
                                        $data[$i][1] =$regprogeanual[0]->depen_id2;
                                        $data[$i][2] =$regprogeanual[0]->depen_desc;

                                        $data[$i][3] =$regprogeanual[0]->gtap_02;
                                        $data[$i][4] =$regprogeanual[0]->gtac_02;
                                        $data[$i][5] =$regprogeanual[0]->ganual_p;
                                        $data[$i][6] =$regprogeanual[0]->ganual_s;

                                        $data[$i][7] =$regprogeanual[0]->gmp_01;
                                        $data[$i][8] =$regprogeanual[0]->gmc_01;
                                        $data[$i][9] =$regprogeanual[0]->gmes_p01;
                                        $data[$i][10]=$regprogeanual[0]->gmes_s01;

                                        $data[$i][11]=$regprogeanual[0]->gacump_01; 
                                        $data[$i][12]=$regprogeanual[0]->gacumc_01; 
                                        $data[$i][13]=$regprogeanual[0]->gacum_p01; 
                                        $data[$i][14]=$regprogeanual[0]->gacum_s01; 
                                    }   //if($regprogeanual->count() > 0)                             
                                }       //foreach }                          
                            }   //if($request->taccion_id <> '0' )
                        }       //if($request->taccion_id == '0' )
                        break;
                    case '2':
                        if($request->taccion_id == '0' ){   
                            $i = 0;
                            foreach($op as $key => $val) {
                                $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                  END
                                                ELSE NULL 
                                             END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_02) > 0 And SUM(SIEVAD_DPA.MESC_02) > 0 THEN (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 ELSE 0 END AS GMES_P02')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_02) > 0 And SUM(SIEVAD_DPA.MESC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S02")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_02) > 0 And SUM(SIEVAD_DPA.ACUMC_02) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 ELSE 0 END AS GACUM_P02')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_02) > 0 And SUM(SIEVAD_DPA.ACUMC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S02") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->get();     
                                if($regprogeanual->count() > 0){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                          $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                          $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                          $regprogeanual[0]->gmp_02,    $regprogeanual[0]->gmc_02,   $regprogeanual[0]->gmes_p02 ,$regprogeanual[0]->gmes_s02,
                                                          $regprogeanual[0]->gacump_02, $regprogeanual[0]->gacumc_02,$regprogeanual[0]->gacum_p02,$regprogeanual[0]->gacum_s02,
                                                         );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;

                                    $data[$i][3] =$regprogeanual[0]->gtap_02;
                                    $data[$i][4] =$regprogeanual[0]->gtac_02;
                                    $data[$i][5] =$regprogeanual[0]->ganual_p;
                                    $data[$i][6] =$regprogeanual[0]->ganual_s;

                                    $data[$i][7] =$regprogeanual[0]->gmp_02;
                                    $data[$i][8] =$regprogeanual[0]->gmc_02;
                                    $data[$i][9] =$regprogeanual[0]->gmes_p02;
                                    $data[$i][10]=$regprogeanual[0]->gmes_s02;

                                    $data[$i][11]=$regprogeanual[0]->gacump_02; 
                                    $data[$i][12]=$regprogeanual[0]->gacumc_02; 
                                    $data[$i][13]=$regprogeanual[0]->gacum_p02; 
                                    $data[$i][14]=$regprogeanual[0]->gacum_s02; 
                                }   //if()                             
                            }  //foreach }                                     
                        }else{
                            if($request->taccion_id <> '0' ){ 
                                $i =0;
                                foreach($op as $key => $val) {
                                    ///print "$key = $val <br>";
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                                   ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                      END
                                                    ELSE NULL 
                                                 END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_02) > 0 And SUM(SIEVAD_DPA.MESC_02) > 0 THEN (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 ELSE 0 END AS GMES_P02')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_02) > 0 And SUM(SIEVAD_DPA.MESC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_02)/SUM(SIEVAD_DPA.MESP_02))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S02")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_02) > 0 And SUM(SIEVAD_DPA.ACUMC_02) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 ELSE 0 END AS GACUM_P02')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_02) > 0 And SUM(SIEVAD_DPA.ACUMC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_02)/SUM(SIEVAD_DPA.ACUMP_02))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S02") 

                                                   ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                                   ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                                   ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                                   ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                                   ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                                   ->get();     
                                    if($regprogeanual->count() > 0){
                                        $i++;
                                        $dataPoints[$i]=array(
                                                              $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                              $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                              $regprogeanual[0]->gmp_02,    $regprogeanual[0]->gmc_02,   $regprogeanual[0]->gmes_p02 ,$regprogeanual[0]->gmes_s02,
                                                              $regprogeanual[0]->gacump_02, $regprogeanual[0]->gacumc_02,$regprogeanual[0]->gacum_p02,$regprogeanual[0]->gacum_s02,
                                                             );       
                                        //Array multidimencional
                                        //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                        //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                        $data[$i][0] =$regprogeanual[0]->periodo_id;
                                        $data[$i][1] =$regprogeanual[0]->depen_id2;
                                        $data[$i][2] =$regprogeanual[0]->depen_desc;

                                        $data[$i][3] =$regprogeanual[0]->gtap_02;
                                        $data[$i][4] =$regprogeanual[0]->gtac_02;
                                        $data[$i][5] =$regprogeanual[0]->ganual_p;
                                        $data[$i][6] =$regprogeanual[0]->ganual_s;

                                        $data[$i][7] =$regprogeanual[0]->gmp_02;
                                        $data[$i][8] =$regprogeanual[0]->gmc_02;
                                        $data[$i][9] =$regprogeanual[0]->gmes_p02;
                                        $data[$i][10]=$regprogeanual[0]->gmes_s02;

                                        $data[$i][11]=$regprogeanual[0]->gacump_02; 
                                        $data[$i][12]=$regprogeanual[0]->gacumc_02; 
                                        $data[$i][13]=$regprogeanual[0]->gacum_p02; 
                                        $data[$i][14]=$regprogeanual[0]->gacum_s02; 
                                    }   //if($regprogeanual->count() > 0)                             
                                }       //foreach }                          
                            }   //if($request->taccion_id <> '0' )
                        }       //if($request->taccion_id == '0' )
                        break;
                    case '3':
                        if($request->taccion_id == '0' ){   
                            $i = 0;
                            foreach($op as $key => $val) {
                                $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                  END
                                                ELSE NULL 
                                             END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_03) > 0 And SUM(SIEVAD_DPA.MESC_03) > 0 THEN (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 ELSE 0 END AS GMES_P03')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_03) > 0 And SUM(SIEVAD_DPA.MESC_03) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S03")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_03) > 0 And SUM(SIEVAD_DPA.ACUMC_03) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 ELSE 0 END AS GACUM_P03')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_03) > 0 And SUM(SIEVAD_DPA.ACUMC_03) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S03") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->get();     
                                if($regprogeanual->count() > 0){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                          $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                          $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                          $regprogeanual[0]->gmp_03,    $regprogeanual[0]->gmc_03,   $regprogeanual[0]->gmes_p03 ,$regprogeanual[0]->gmes_s03,
                                                          $regprogeanual[0]->gacump_03, $regprogeanual[0]->gacumc_03,$regprogeanual[0]->gacum_p03,$regprogeanual[0]->gacum_s03,
                                                         );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;

                                    $data[$i][3] =$regprogeanual[0]->gtap_02;
                                    $data[$i][4] =$regprogeanual[0]->gtac_02;
                                    $data[$i][5] =$regprogeanual[0]->ganual_p;
                                    $data[$i][6] =$regprogeanual[0]->ganual_s;

                                    $data[$i][7] =$regprogeanual[0]->gmp_03;
                                    $data[$i][8] =$regprogeanual[0]->gmc_03;
                                    $data[$i][9] =$regprogeanual[0]->gmes_p03;
                                    $data[$i][10]=$regprogeanual[0]->gmes_s03;

                                    $data[$i][11]=$regprogeanual[0]->gacump_03; 
                                    $data[$i][12]=$regprogeanual[0]->gacumc_03; 
                                    $data[$i][13]=$regprogeanual[0]->gacum_p03; 
                                    $data[$i][14]=$regprogeanual[0]->gacum_s03; 
                                }   //if()                             
                            }  //foreach }                                     
                        }else{
                            if($request->taccion_id <> '0' ){ 
                                $i =0;
                                foreach($op as $key => $val) {
                                    ///print "$key = $val <br>";
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                                   ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                      END
                                                    ELSE NULL 
                                                 END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_03) > 0 And SUM(SIEVAD_DPA.MESC_03) > 0 THEN (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 ELSE 0 END AS GMES_P03')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_03) > 0 And SUM(SIEVAD_DPA.MESC_03) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_03)/SUM(SIEVAD_DPA.MESP_03))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S03")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_03) > 0 And SUM(SIEVAD_DPA.ACUMC_03) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 ELSE 0 END AS GACUM_P03')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_03) > 0 And SUM(SIEVAD_DPA.ACUMC_03) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_03)/SUM(SIEVAD_DPA.ACUMP_03))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S03") 

                                                   ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                                   ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                                   ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                                   ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                                   ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                                   ->get();     
                                    if($regprogeanual->count() > 0){
                                        $i++;
                                        $dataPoints[$i]=array(
                                                              $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                              $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                              $regprogeanual[0]->gmp_03,    $regprogeanual[0]->gmc_03,   $regprogeanual[0]->gmes_p03 ,$regprogeanual[0]->gmes_s03,
                                                              $regprogeanual[0]->gacump_03, $regprogeanual[0]->gacumc_03,$regprogeanual[0]->gacum_p03,$regprogeanual[0]->gacum_s03,
                                                             );       
                                        //Array multidimencional
                                        //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                        //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                        $data[$i][0] =$regprogeanual[0]->periodo_id;
                                        $data[$i][1] =$regprogeanual[0]->depen_id2;
                                        $data[$i][2] =$regprogeanual[0]->depen_desc;

                                        $data[$i][3] =$regprogeanual[0]->gtap_02;
                                        $data[$i][4] =$regprogeanual[0]->gtac_02;
                                        $data[$i][5] =$regprogeanual[0]->ganual_p;
                                        $data[$i][6] =$regprogeanual[0]->ganual_s;

                                        $data[$i][7] =$regprogeanual[0]->gmp_03;
                                        $data[$i][8] =$regprogeanual[0]->gmc_03;
                                        $data[$i][9] =$regprogeanual[0]->gmes_p03;
                                        $data[$i][10]=$regprogeanual[0]->gmes_s03;

                                        $data[$i][11]=$regprogeanual[0]->gacump_03; 
                                        $data[$i][12]=$regprogeanual[0]->gacumc_03; 
                                        $data[$i][13]=$regprogeanual[0]->gacum_p03; 
                                        $data[$i][14]=$regprogeanual[0]->gacum_s03; 
                                    }   //if($regprogeanual->count() > 0)                             
                                }       //foreach }                          
                            }   //if($request->taccion_id <> '0' )
                        }       //if($request->taccion_id == '0' )
                        break;
                    case '4':
                        if($request->taccion_id == '0' ){   
                            $i = 0;
                            foreach($op as $key => $val) {
                                $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                  END
                                                ELSE NULL 
                                             END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_04) > 0 And SUM(SIEVAD_DPA.MESC_04) > 0 THEN (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 ELSE 0 END AS GMES_P04')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_04) > 0 And SUM(SIEVAD_DPA.MESC_04) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S04")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_04) > 0 And SUM(SIEVAD_DPA.ACUMC_04) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 ELSE 0 END AS GACUM_P04')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_04) > 0 And SUM(SIEVAD_DPA.ACUMC_04) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S04") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->get();     
                                if($regprogeanual->count() > 0){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                          $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                          $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                          $regprogeanual[0]->gmp_04,    $regprogeanual[0]->gmc_04,   $regprogeanual[0]->gmes_p04 ,$regprogeanual[0]->gmes_s04,
                                                          $regprogeanual[0]->gacump_04, $regprogeanual[0]->gacumc_04,$regprogeanual[0]->gacum_p04,$regprogeanual[0]->gacum_s04,
                                                         );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;

                                    $data[$i][3] =$regprogeanual[0]->gtap_02;
                                    $data[$i][4] =$regprogeanual[0]->gtac_02;
                                    $data[$i][5] =$regprogeanual[0]->ganual_p;
                                    $data[$i][6] =$regprogeanual[0]->ganual_s;

                                    $data[$i][7] =$regprogeanual[0]->gmp_04;
                                    $data[$i][8] =$regprogeanual[0]->gmc_04;
                                    $data[$i][9] =$regprogeanual[0]->gmes_p04;
                                    $data[$i][10]=$regprogeanual[0]->gmes_s04;

                                    $data[$i][11]=$regprogeanual[0]->gacump_04; 
                                    $data[$i][12]=$regprogeanual[0]->gacumc_04; 
                                    $data[$i][13]=$regprogeanual[0]->gacum_p04; 
                                    $data[$i][14]=$regprogeanual[0]->gacum_s04; 
                                }   //if()                             
                            }  //foreach }                                     
                        }else{
                            if($request->taccion_id <> '0' ){ 
                                $i =0;
                                foreach($op as $key => $val) {
                                    ///print "$key = $val <br>";
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                                   ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                      END
                                                    ELSE NULL 
                                                 END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_04) > 0 And SUM(SIEVAD_DPA.MESC_04) > 0 THEN (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 ELSE 0 END AS GMES_P04')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_04) > 0 And SUM(SIEVAD_DPA.MESC_04) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_04)/SUM(SIEVAD_DPA.MESP_04))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S04")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_04) > 0 And SUM(SIEVAD_DPA.ACUMC_04) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 ELSE 0 END AS GACUM_P04')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_04) > 0 And SUM(SIEVAD_DPA.ACUMC_04) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_04)/SUM(SIEVAD_DPA.ACUMP_04))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S04") 

                                                   ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                                   ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                                   ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                                   ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                                   ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                                   ->get();     
                                    if($regprogeanual->count() > 0){
                                        $i++;
                                        $dataPoints[$i]=array(
                                                              $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                              $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                              $regprogeanual[0]->gmp_04,    $regprogeanual[0]->gmc_04,   $regprogeanual[0]->gmes_p04 ,$regprogeanual[0]->gmes_s04,
                                                              $regprogeanual[0]->gacump_04, $regprogeanual[0]->gacumc_04,$regprogeanual[0]->gacum_p04,$regprogeanual[0]->gacum_s04,
                                                             );       
                                        //Array multidimencional
                                        //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                        //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                        $data[$i][0] =$regprogeanual[0]->periodo_id;
                                        $data[$i][1] =$regprogeanual[0]->depen_id2;
                                        $data[$i][2] =$regprogeanual[0]->depen_desc;

                                        $data[$i][3] =$regprogeanual[0]->gtap_02;
                                        $data[$i][4] =$regprogeanual[0]->gtac_02;
                                        $data[$i][5] =$regprogeanual[0]->ganual_p;
                                        $data[$i][6] =$regprogeanual[0]->ganual_s;

                                        $data[$i][7] =$regprogeanual[0]->gmp_04;
                                        $data[$i][8] =$regprogeanual[0]->gmc_04;
                                        $data[$i][9] =$regprogeanual[0]->gmes_p04;
                                        $data[$i][10]=$regprogeanual[0]->gmes_s04;

                                        $data[$i][11]=$regprogeanual[0]->gacump_04; 
                                        $data[$i][12]=$regprogeanual[0]->gacumc_04; 
                                        $data[$i][13]=$regprogeanual[0]->gacum_p04; 
                                        $data[$i][14]=$regprogeanual[0]->gacum_s04; 
                                    }   //if($regprogeanual->count() > 0)                             
                                }       //foreach }                          
                            }   //if($request->taccion_id <> '0' )
                        }       //if($request->taccion_id == '0' )
                        break;
                    case '5':
                        if($request->taccion_id == '0' ){   
                            $i = 0;
                            foreach($op as $key => $val) {
                                $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                END
                                                ELSE NULL 
                                             END AS GANUAL_S") 

                                               ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_05) > 0 And SUM(SIEVAD_DPA.MESC_05) > 0 THEN (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 ELSE 0 END AS GMES_P05')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_05) > 0 And SUM(SIEVAD_DPA.MESC_05) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 <  50 THEN 'ROJO'
                                                    END
                                                    ELSE NULL 
                                                 END AS GMES_S05")  

                                                 ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_05) > 0 And SUM(SIEVAD_DPA.ACUMC_05) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 ELSE 0 END AS GACUM_P05')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_05) > 0 And SUM(SIEVAD_DPA.ACUMC_05) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 <  50 THEN 'ROJO'
                                                    END
                                                    ELSE NULL 
                                                 END AS GACUM_S05") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->get();     
                                if($regprogeanual->count() > 0){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                          $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                          $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                          $regprogeanual[0]->gmp_05,    $regprogeanual[0]->gmc_05,   $regprogeanual[0]->gmes_p05 ,$regprogeanual[0]->gmes_s05,
                                                          $regprogeanual[0]->gacump_05, $regprogeanual[0]->gacumc_05,$regprogeanual[0]->gacum_p05,$regprogeanual[0]->gacum_s05,
                                                         );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;

                                    $data[$i][3] =$regprogeanual[0]->gtap_02;
                                    $data[$i][4] =$regprogeanual[0]->gtac_02;
                                    $data[$i][5] =$regprogeanual[0]->ganual_p;
                                    $data[$i][6] =$regprogeanual[0]->ganual_s;

                                    $data[$i][7] =$regprogeanual[0]->gmp_05;
                                    $data[$i][8] =$regprogeanual[0]->gmc_05;
                                    $data[$i][9] =$regprogeanual[0]->gmes_p05;
                                    $data[$i][10]=$regprogeanual[0]->gmes_s05;

                                    $data[$i][11]=$regprogeanual[0]->gacump_05; 
                                    $data[$i][12]=$regprogeanual[0]->gacumc_05; 
                                    $data[$i][13]=$regprogeanual[0]->gacum_p05; 
                                    $data[$i][14]=$regprogeanual[0]->gacum_s05; 
                                }   //if()                             
                            }  //foreach }                                     
                        }else{
                            if($request->taccion_id <> '0' ){ 
                                $i =0;
                                foreach($op as $key => $val) {
                                    ///print "$key = $val <br>";
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                                   ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                      END
                                                    ELSE NULL 
                                                 END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_05) > 0 And SUM(SIEVAD_DPA.MESC_05) > 0 THEN (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 ELSE 0 END AS GMES_P05')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_05) > 0 And SUM(SIEVAD_DPA.MESC_05) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_05)/SUM(SIEVAD_DPA.MESP_05))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S05")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_05) > 0 And SUM(SIEVAD_DPA.ACUMC_05) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 ELSE 0 END AS GACUM_P05')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_05) > 0 And SUM(SIEVAD_DPA.ACUMC_05) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_05)/SUM(SIEVAD_DPA.ACUMP_05))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S05") 

                                                   ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                                   ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                                   ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                                   ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                                   ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                                   ->get();     
                                    if($regprogeanual->count() > 0){
                                        $i++;
                                        $dataPoints[$i]=array(
                                                              $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                              $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                              $regprogeanual[0]->gmp_05,    $regprogeanual[0]->gmc_05,   $regprogeanual[0]->gmes_p05 ,$regprogeanual[0]->gmes_s05,
                                                              $regprogeanual[0]->gacump_05, $regprogeanual[0]->gacumc_05,$regprogeanual[0]->gacum_p05,$regprogeanual[0]->gacum_s05,
                                                             );       
                                        //Array multidimencional
                                        //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                        //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                        $data[$i][0] =$regprogeanual[0]->periodo_id;
                                        $data[$i][1] =$regprogeanual[0]->depen_id2;
                                        $data[$i][2] =$regprogeanual[0]->depen_desc;

                                        $data[$i][3] =$regprogeanual[0]->gtap_02;
                                        $data[$i][4] =$regprogeanual[0]->gtac_02;
                                        $data[$i][5] =$regprogeanual[0]->ganual_p;
                                        $data[$i][6] =$regprogeanual[0]->ganual_s;

                                        $data[$i][7] =$regprogeanual[0]->gmp_05;
                                        $data[$i][8] =$regprogeanual[0]->gmc_05;
                                        $data[$i][9] =$regprogeanual[0]->gmes_p05;
                                        $data[$i][10]=$regprogeanual[0]->gmes_s05;

                                        $data[$i][11]=$regprogeanual[0]->gacump_05; 
                                        $data[$i][12]=$regprogeanual[0]->gacumc_05; 
                                        $data[$i][13]=$regprogeanual[0]->gacum_p05; 
                                        $data[$i][14]=$regprogeanual[0]->gacum_s05; 
                                    }   //if($regprogeanual->count() > 0)                             
                                }       //foreach }                          
                            }   //if($request->taccion_id <> '0' )
                        }       //if($request->taccion_id == '0' )
                        break;
                    case '6':
                        if($request->taccion_id == '0' ){   
                            $i = 0;
                            foreach($op as $key => $val) {
                                $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                  END
                                                ELSE NULL 
                                             END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_06) > 0 And SUM(SIEVAD_DPA.MESC_06) > 0 THEN (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 ELSE 0 END AS GMES_P06')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_06) > 0 And SUM(SIEVAD_DPA.MESC_06) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S06")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_06) > 0 And SUM(SIEVAD_DPA.ACUMC_06) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 ELSE 0 END AS GACUM_P06')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_06) > 0 And SUM(SIEVAD_DPA.ACUMC_06) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S06") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->get();     
                                if($regprogeanual->count() > 0){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                          $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                          $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                          $regprogeanual[0]->gmp_06,    $regprogeanual[0]->gmc_06,   $regprogeanual[0]->gmes_p06 ,$regprogeanual[0]->gmes_s06,
                                                          $regprogeanual[0]->gacump_06, $regprogeanual[0]->gacumc_06,$regprogeanual[0]->gacum_p06,$regprogeanual[0]->gacum_s06,
                                                         );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;

                                    $data[$i][3] =$regprogeanual[0]->gtap_02;
                                    $data[$i][4] =$regprogeanual[0]->gtac_02;
                                    $data[$i][5] =$regprogeanual[0]->ganual_p;
                                    $data[$i][6] =$regprogeanual[0]->ganual_s;

                                    $data[$i][7] =$regprogeanual[0]->gmp_06;
                                    $data[$i][8] =$regprogeanual[0]->gmc_06;
                                    $data[$i][9] =$regprogeanual[0]->gmes_p06;
                                    $data[$i][10]=$regprogeanual[0]->gmes_s06;

                                    $data[$i][11]=$regprogeanual[0]->gacump_06; 
                                    $data[$i][12]=$regprogeanual[0]->gacumc_06; 
                                    $data[$i][13]=$regprogeanual[0]->gacum_p06; 
                                    $data[$i][14]=$regprogeanual[0]->gacum_s06; 
                                }   //if()                             
                            }  //foreach }                                     
                        }else{
                            if($request->taccion_id <> '0' ){ 
                                $i =0;
                                foreach($op as $key => $val) {
                                    ///print "$key = $val <br>";
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                                   ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                      END
                                                    ELSE NULL 
                                                 END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_06) > 0 And SUM(SIEVAD_DPA.MESC_06) > 0 THEN (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 ELSE 0 END AS GMES_P06')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_06) > 0 And SUM(SIEVAD_DPA.MESC_06) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_06)/SUM(SIEVAD_DPA.MESP_06))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S06")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_06) > 0 And SUM(SIEVAD_DPA.ACUMC_06) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 ELSE 0 END AS GACUM_P06')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_06) > 0 And SUM(SIEVAD_DPA.ACUMC_06) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_06)/SUM(SIEVAD_DPA.ACUMP_06))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S06") 

                                                   ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                                   ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                                   ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                                   ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                                   ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                                   ->get();     
                                    if($regprogeanual->count() > 0){
                                        $i++;
                                        $dataPoints[$i]=array(
                                                              $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                              $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                              $regprogeanual[0]->gmp_06,    $regprogeanual[0]->gmc_06,   $regprogeanual[0]->gmes_p06 ,$regprogeanual[0]->gmes_s06,
                                                              $regprogeanual[0]->gacump_06, $regprogeanual[0]->gacumc_06,$regprogeanual[0]->gacum_p06,$regprogeanual[0]->gacum_s06,
                                                             );       
                                        //Array multidimencional
                                        //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                        //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                        $data[$i][0] =$regprogeanual[0]->periodo_id;
                                        $data[$i][1] =$regprogeanual[0]->depen_id2;
                                        $data[$i][2] =$regprogeanual[0]->depen_desc;

                                        $data[$i][3] =$regprogeanual[0]->gtap_02;
                                        $data[$i][4] =$regprogeanual[0]->gtac_02;
                                        $data[$i][5] =$regprogeanual[0]->ganual_p;
                                        $data[$i][6] =$regprogeanual[0]->ganual_s;

                                        $data[$i][7] =$regprogeanual[0]->gmp_06;
                                        $data[$i][8] =$regprogeanual[0]->gmc_06;
                                        $data[$i][9] =$regprogeanual[0]->gmes_p06;
                                        $data[$i][10]=$regprogeanual[0]->gmes_s06;

                                        $data[$i][11]=$regprogeanual[0]->gacump_06; 
                                        $data[$i][12]=$regprogeanual[0]->gacumc_06; 
                                        $data[$i][13]=$regprogeanual[0]->gacum_p06; 
                                        $data[$i][14]=$regprogeanual[0]->gacum_s06; 
                                    }   //if($regprogeanual->count() > 0)                             
                                }       //foreach }                          
                            }   //if($request->taccion_id <> '0' )
                        }       //if($request->taccion_id == '0' )
                        break; 

                    case '7':
                        if($request->taccion_id == '0' ){   
                            $i = 0;
                            foreach($op as $key => $val) {
                                $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                  END
                                                ELSE NULL 
                                             END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_07) > 0 And SUM(SIEVAD_DPA.MESC_07) > 0 THEN (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 ELSE 0 END AS GMES_P07')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_07) > 0 And SUM(SIEVAD_DPA.MESC_07) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S07")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_07) > 0 And SUM(SIEVAD_DPA.ACUMC_07) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 ELSE 0 END AS GACUM_P07')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_07) > 0 And SUM(SIEVAD_DPA.ACUMC_07) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S07") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->get();     
                                if($regprogeanual->count() > 0){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                          $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                          $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                          $regprogeanual[0]->gmp_07,    $regprogeanual[0]->gmc_07,   $regprogeanual[0]->gmes_p07 ,$regprogeanual[0]->gmes_s07,
                                                          $regprogeanual[0]->gacump_07, $regprogeanual[0]->gacumc_07,$regprogeanual[0]->gacum_p07,$regprogeanual[0]->gacum_s07,
                                                         );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;

                                    $data[$i][3] =$regprogeanual[0]->gtap_02;
                                    $data[$i][4] =$regprogeanual[0]->gtac_02;
                                    $data[$i][5] =$regprogeanual[0]->ganual_p;
                                    $data[$i][6] =$regprogeanual[0]->ganual_s;

                                    $data[$i][7] =$regprogeanual[0]->gmp_07;
                                    $data[$i][8] =$regprogeanual[0]->gmc_07;
                                    $data[$i][9] =$regprogeanual[0]->gmes_p07;
                                    $data[$i][10]=$regprogeanual[0]->gmes_s07;

                                    $data[$i][11]=$regprogeanual[0]->gacump_07; 
                                    $data[$i][12]=$regprogeanual[0]->gacumc_07; 
                                    $data[$i][13]=$regprogeanual[0]->gacum_p07; 
                                    $data[$i][14]=$regprogeanual[0]->gacum_s07; 
                                }   //if()                             
                            }  //foreach }                                     
                        }else{
                            if($request->taccion_id <> '0' ){ 
                                $i =0;
                                foreach($op as $key => $val) {
                                    ///print "$key = $val <br>";
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                                   ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                      END
                                                    ELSE NULL 
                                                 END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_07) > 0 And SUM(SIEVAD_DPA.MESC_07) > 0 THEN (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 ELSE 0 END AS GMES_P07')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_07) > 0 And SUM(SIEVAD_DPA.MESC_07) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_07)/SUM(SIEVAD_DPA.MESP_07))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S07")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_07) > 0 And SUM(SIEVAD_DPA.ACUMC_07) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 ELSE 0 END AS GACUM_P07')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_07) > 0 And SUM(SIEVAD_DPA.ACUMC_07) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_07)/SUM(SIEVAD_DPA.ACUMP_07))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S07") 

                                                   ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                                   ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                                   ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                                   ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                                   ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                                   ->get();     
                                    if($regprogeanual->count() > 0){
                                        $i++;
                                        $dataPoints[$i]=array(
                                                              $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                              $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                              $regprogeanual[0]->gmp_07,    $regprogeanual[0]->gmc_07,   $regprogeanual[0]->gmes_p07 ,$regprogeanual[0]->gmes_s07,
                                                              $regprogeanual[0]->gacump_07, $regprogeanual[0]->gacumc_07,$regprogeanual[0]->gacum_p07,$regprogeanual[0]->gacum_s07,
                                                             );       
                                        //Array multidimencional
                                        //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                        //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                        $data[$i][0] =$regprogeanual[0]->periodo_id;
                                        $data[$i][1] =$regprogeanual[0]->depen_id2;
                                        $data[$i][2] =$regprogeanual[0]->depen_desc;

                                        $data[$i][3] =$regprogeanual[0]->gtap_02;
                                        $data[$i][4] =$regprogeanual[0]->gtac_02;
                                        $data[$i][5] =$regprogeanual[0]->ganual_p;
                                        $data[$i][6] =$regprogeanual[0]->ganual_s;

                                        $data[$i][7] =$regprogeanual[0]->gmp_07;
                                        $data[$i][8] =$regprogeanual[0]->gmc_07;
                                        $data[$i][9] =$regprogeanual[0]->gmes_p07;
                                        $data[$i][10]=$regprogeanual[0]->gmes_s07;

                                        $data[$i][11]=$regprogeanual[0]->gacump_07; 
                                        $data[$i][12]=$regprogeanual[0]->gacumc_07; 
                                        $data[$i][13]=$regprogeanual[0]->gacum_p07; 
                                        $data[$i][14]=$regprogeanual[0]->gacum_s07; 
                                    }   //if($regprogeanual->count() > 0)                             
                                }       //foreach }                          
                            }   //if($request->taccion_id <> '0' )
                        }       //if($request->taccion_id == '0' )
                        break;
                    case '8':
                        if($request->taccion_id == '0' ){   
                            $i = 0;
                            foreach($op as $key => $val) {
                                $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                  END
                                                ELSE NULL 
                                             END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_08) > 0 And SUM(SIEVAD_DPA.MESC_08) > 0 THEN (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 ELSE 0 END AS GMES_P08')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_08) > 0 And SUM(SIEVAD_DPA.MESC_08) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S08")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_08) > 0 And SUM(SIEVAD_DPA.ACUMC_08) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 ELSE 0 END AS GACUM_P08')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_08) > 0 And SUM(SIEVAD_DPA.ACUMC_08) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S08") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->get();     
                                if($regprogeanual->count() > 0){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                          $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                          $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                          $regprogeanual[0]->gmp_08,    $regprogeanual[0]->gmc_08,   $regprogeanual[0]->gmes_p08 ,$regprogeanual[0]->gmes_s08,
                                                          $regprogeanual[0]->gacump_08, $regprogeanual[0]->gacumc_08,$regprogeanual[0]->gacum_p08,$regprogeanual[0]->gacum_s08,
                                                         );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;

                                    $data[$i][3] =$regprogeanual[0]->gtap_02;
                                    $data[$i][4] =$regprogeanual[0]->gtac_02;
                                    $data[$i][5] =$regprogeanual[0]->ganual_p;
                                    $data[$i][6] =$regprogeanual[0]->ganual_s;

                                    $data[$i][7] =$regprogeanual[0]->gmp_08;
                                    $data[$i][8] =$regprogeanual[0]->gmc_08;
                                    $data[$i][9] =$regprogeanual[0]->gmes_p08;
                                    $data[$i][10]=$regprogeanual[0]->gmes_s08;

                                    $data[$i][11]=$regprogeanual[0]->gacump_08; 
                                    $data[$i][12]=$regprogeanual[0]->gacumc_08; 
                                    $data[$i][13]=$regprogeanual[0]->gacum_p08; 
                                    $data[$i][14]=$regprogeanual[0]->gacum_s08; 
                                }   //if()                             
                            }  //foreach }                                     
                        }else{
                            if($request->taccion_id <> '0' ){ 
                                $i =0;
                                foreach($op as $key => $val) {
                                    ///print "$key = $val <br>";
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                                   ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                      END
                                                    ELSE NULL 
                                                 END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_08) > 0 And SUM(SIEVAD_DPA.MESC_08) > 0 THEN (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 ELSE 0 END AS GMES_P08')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_08) > 0 And SUM(SIEVAD_DPA.MESC_08) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_08)/SUM(SIEVAD_DPA.MESP_08))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S08")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_08) > 0 And SUM(SIEVAD_DPA.ACUMC_08) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 ELSE 0 END AS GACUM_P08')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_08) > 0 And SUM(SIEVAD_DPA.ACUMC_08) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_08)/SUM(SIEVAD_DPA.ACUMP_08))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S08") 

                                                   ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                                   ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                                   ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                                   ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                                   ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                                   ->get();     
                                    if($regprogeanual->count() > 0){
                                        $i++;
                                        $dataPoints[$i]=array(
                                                              $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                              $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                              $regprogeanual[0]->gmp_08,    $regprogeanual[0]->gmc_08,   $regprogeanual[0]->gmes_p08 ,$regprogeanual[0]->gmes_s08,
                                                              $regprogeanual[0]->gacump_08, $regprogeanual[0]->gacumc_08,$regprogeanual[0]->gacum_p08,$regprogeanual[0]->gacum_s08,
                                                             );       
                                        //Array multidimencional
                                        //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                        //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                        $data[$i][0] =$regprogeanual[0]->periodo_id;
                                        $data[$i][1] =$regprogeanual[0]->depen_id2;
                                        $data[$i][2] =$regprogeanual[0]->depen_desc;

                                        $data[$i][3] =$regprogeanual[0]->gtap_02;
                                        $data[$i][4] =$regprogeanual[0]->gtac_02;
                                        $data[$i][5] =$regprogeanual[0]->ganual_p;
                                        $data[$i][6] =$regprogeanual[0]->ganual_s;

                                        $data[$i][7] =$regprogeanual[0]->gmp_08;
                                        $data[$i][8] =$regprogeanual[0]->gmc_08;
                                        $data[$i][9] =$regprogeanual[0]->gmes_p08;
                                        $data[$i][10]=$regprogeanual[0]->gmes_s08;

                                        $data[$i][11]=$regprogeanual[0]->gacump_08; 
                                        $data[$i][12]=$regprogeanual[0]->gacumc_08; 
                                        $data[$i][13]=$regprogeanual[0]->gacum_p08; 
                                        $data[$i][14]=$regprogeanual[0]->gacum_s08; 
                                    }   //if($regprogeanual->count() > 0)                             
                                }       //foreach }                          
                            }   //if($request->taccion_id <> '0' )
                        }       //if($request->taccion_id == '0' )
                        break;
                    case '9':
                        if($request->taccion_id == '0' ){   
                            $i = 0;
                            foreach($op as $key => $val) {
                                $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                  END
                                                ELSE NULL 
                                             END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_09) > 0 And SUM(SIEVAD_DPA.MESC_09) > 0 THEN (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 ELSE 0 END AS GMES_P09')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_09) > 0 And SUM(SIEVAD_DPA.MESC_09) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S09")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_09) > 0 And SUM(SIEVAD_DPA.ACUMC_09) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 ELSE 0 END AS GACUM_P09')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_09) > 0 And SUM(SIEVAD_DPA.ACUMC_09) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S09") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->get();     
                                if($regprogeanual->count() > 0){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                          $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                          $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                          $regprogeanual[0]->gmp_09,    $regprogeanual[0]->gmc_09,   $regprogeanual[0]->gmes_p09 ,$regprogeanual[0]->gmes_s09,
                                                          $regprogeanual[0]->gacump_09, $regprogeanual[0]->gacumc_09,$regprogeanual[0]->gacum_p09,$regprogeanual[0]->gacum_s09,
                                                         );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;

                                    $data[$i][3] =$regprogeanual[0]->gtap_02;
                                    $data[$i][4] =$regprogeanual[0]->gtac_02;
                                    $data[$i][5] =$regprogeanual[0]->ganual_p;
                                    $data[$i][6] =$regprogeanual[0]->ganual_s;

                                    $data[$i][7] =$regprogeanual[0]->gmp_09;
                                    $data[$i][8] =$regprogeanual[0]->gmc_09;
                                    $data[$i][9] =$regprogeanual[0]->gmes_p09;
                                    $data[$i][10]=$regprogeanual[0]->gmes_s09;

                                    $data[$i][11]=$regprogeanual[0]->gacump_09; 
                                    $data[$i][12]=$regprogeanual[0]->gacumc_09; 
                                    $data[$i][13]=$regprogeanual[0]->gacum_p09; 
                                    $data[$i][14]=$regprogeanual[0]->gacum_s09; 
                                }   //if()                             
                            }  //foreach }                                     
                        }else{
                            if($request->taccion_id <> '0' ){ 
                                $i =0;
                                foreach($op as $key => $val) {
                                    ///print "$key = $val <br>";
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                                   ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                      END
                                                    ELSE NULL 
                                                 END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_09) > 0 And SUM(SIEVAD_DPA.MESC_09) > 0 THEN (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 ELSE 0 END AS GMES_P09')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_09) > 0 And SUM(SIEVAD_DPA.MESC_09) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_09)/SUM(SIEVAD_DPA.MESP_09))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S09")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_09) > 0 And SUM(SIEVAD_DPA.ACUMC_09) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 ELSE 0 END AS GACUM_P09')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_09) > 0 And SUM(SIEVAD_DPA.ACUMC_09) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_09)/SUM(SIEVAD_DPA.ACUMP_09))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S09") 

                                                   ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                                   ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                                   ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                                   ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                                   ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                                   ->get();     
                                    if($regprogeanual->count() > 0){
                                        $i++;
                                        $dataPoints[$i]=array(
                                                              $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                              $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                              $regprogeanual[0]->gmp_09,    $regprogeanual[0]->gmc_09,   $regprogeanual[0]->gmes_p09 ,$regprogeanual[0]->gmes_s09,
                                                              $regprogeanual[0]->gacump_09, $regprogeanual[0]->gacumc_09,$regprogeanual[0]->gacum_p09,$regprogeanual[0]->gacum_s09,
                                                             );       
                                        //Array multidimencional
                                        //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                        //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                        $data[$i][0] =$regprogeanual[0]->periodo_id;
                                        $data[$i][1] =$regprogeanual[0]->depen_id2;
                                        $data[$i][2] =$regprogeanual[0]->depen_desc;

                                        $data[$i][3] =$regprogeanual[0]->gtap_02;
                                        $data[$i][4] =$regprogeanual[0]->gtac_02;
                                        $data[$i][5] =$regprogeanual[0]->ganual_p;
                                        $data[$i][6] =$regprogeanual[0]->ganual_s;

                                        $data[$i][7] =$regprogeanual[0]->gmp_09;
                                        $data[$i][8] =$regprogeanual[0]->gmc_09;
                                        $data[$i][9] =$regprogeanual[0]->gmes_p09;
                                        $data[$i][10]=$regprogeanual[0]->gmes_s09;

                                        $data[$i][11]=$regprogeanual[0]->gacump_09; 
                                        $data[$i][12]=$regprogeanual[0]->gacumc_09; 
                                        $data[$i][13]=$regprogeanual[0]->gacum_p09; 
                                        $data[$i][14]=$regprogeanual[0]->gacum_s09; 
                                    }   //if($regprogeanual->count() > 0)                             
                                }       //foreach }                          
                            }   //if($request->taccion_id <> '0' )
                        }       //if($request->taccion_id == '0' )
                        break;
                    case '10':
                        if($request->taccion_id == '0' ){   
                            $i = 0;
                            foreach($op as $key => $val) {
                                $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                  END
                                                ELSE NULL 
                                             END AS GANUAL_S") 

                                               ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_10) > 0 And SUM(SIEVAD_DPA.MESC_10) > 0 THEN (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 ELSE 0 END AS GMES_P10')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_10) > 0 And SUM(SIEVAD_DPA.MESC_10) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S10")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_10) > 0 And SUM(SIEVAD_DPA.ACUMC_10) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 ELSE 0 END AS GACUM_P10')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_10) > 0 And SUM(SIEVAD_DPA.ACUMC_10) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S10") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->get();     
                                if($regprogeanual->count() > 0){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                          $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                          $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                          $regprogeanual[0]->gmp_10,    $regprogeanual[0]->gmc_10,   $regprogeanual[0]->gmes_p10 ,$regprogeanual[0]->gmes_s10,
                                                          $regprogeanual[0]->gacump_10, $regprogeanual[0]->gacumc_10,$regprogeanual[0]->gacum_p10,$regprogeanual[0]->gacum_s10,
                                                         );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;

                                    $data[$i][3] =$regprogeanual[0]->gtap_02;
                                    $data[$i][4] =$regprogeanual[0]->gtac_02;
                                    $data[$i][5] =$regprogeanual[0]->ganual_p;
                                    $data[$i][6] =$regprogeanual[0]->ganual_s;

                                    $data[$i][7] =$regprogeanual[0]->gmp_10;
                                    $data[$i][8] =$regprogeanual[0]->gmc_10;
                                    $data[$i][9] =$regprogeanual[0]->gmes_p10;
                                    $data[$i][10]=$regprogeanual[0]->gmes_s10;

                                    $data[$i][11]=$regprogeanual[0]->gacump_10; 
                                    $data[$i][12]=$regprogeanual[0]->gacumc_10; 
                                    $data[$i][13]=$regprogeanual[0]->gacum_p10; 
                                    $data[$i][14]=$regprogeanual[0]->gacum_s10; 
                                }   //if()                             
                            }  //foreach }                                     
                        }else{
                            if($request->taccion_id <> '0' ){ 
                                $i =0;
                                foreach($op as $key => $val) {
                                    ///print "$key = $val <br>";
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                                   ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                      END
                                                    ELSE NULL 
                                                 END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_10) > 0 And SUM(SIEVAD_DPA.MESC_10) > 0 THEN (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 ELSE 0 END AS GMES_P10')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_10) > 0 And SUM(SIEVAD_DPA.MESC_10) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_10)/SUM(SIEVAD_DPA.MESP_10))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S10")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_10) > 0 And SUM(SIEVAD_DPA.ACUMC_10) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 ELSE 0 END AS GACUM_P10')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_10) > 0 And SUM(SIEVAD_DPA.ACUMC_10) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_10)/SUM(SIEVAD_DPA.ACUMP_10))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S10") 

                                                   ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                                   ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                                   ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                                   ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                                   ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                                   ->get();     
                                    if($regprogeanual->count() > 0){
                                        $i++;
                                        $dataPoints[$i]=array(
                                                              $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                              $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                              $regprogeanual[0]->gmp_10,    $regprogeanual[0]->gmc_10,   $regprogeanual[0]->gmes_p10 ,$regprogeanual[0]->gmes_s10,
                                                              $regprogeanual[0]->gacump_10, $regprogeanual[0]->gacumc_10,$regprogeanual[0]->gacum_p10,$regprogeanual[0]->gacum_s10,
                                                             );       
                                        //Array multidimencional
                                        //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                        //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                        $data[$i][0] =$regprogeanual[0]->periodo_id;
                                        $data[$i][1] =$regprogeanual[0]->depen_id2;
                                        $data[$i][2] =$regprogeanual[0]->depen_desc;

                                        $data[$i][3] =$regprogeanual[0]->gtap_02;
                                        $data[$i][4] =$regprogeanual[0]->gtac_02;
                                        $data[$i][5] =$regprogeanual[0]->ganual_p;
                                        $data[$i][6] =$regprogeanual[0]->ganual_s;

                                        $data[$i][7] =$regprogeanual[0]->gmp_10;
                                        $data[$i][8] =$regprogeanual[0]->gmc_10;
                                        $data[$i][9] =$regprogeanual[0]->gmes_p10;
                                        $data[$i][10]=$regprogeanual[0]->gmes_s10;

                                        $data[$i][11]=$regprogeanual[0]->gacump_10; 
                                        $data[$i][12]=$regprogeanual[0]->gacumc_10; 
                                        $data[$i][13]=$regprogeanual[0]->gacum_p10; 
                                        $data[$i][14]=$regprogeanual[0]->gacum_s10; 
                                    }   //if($regprogeanual->count() > 0)                             
                                }       //foreach }                          
                            }   //if($request->taccion_id <> '0' )
                        }       //if($request->taccion_id == '0' )
                        break;
                    case '11':
                        if($request->taccion_id == '0' ){   
                            $i = 0;
                            foreach($op as $key => $val) {
                                $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                  END
                                                ELSE NULL 
                                             END AS GANUAL_S") 

                                               ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_11) > 0 And SUM(SIEVAD_DPA.MESC_11) > 0 THEN (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 ELSE 0 END AS GMES_P11')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_11) > 0 And SUM(SIEVAD_DPA.MESC_11) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S11")  

                                                 ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_11) > 0 And SUM(SIEVAD_DPA.ACUMC_11) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 ELSE 0 END AS GACUM_P11')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_11) > 0 And SUM(SIEVAD_DPA.ACUMC_11) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S11") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->get();     
                                if($regprogeanual->count() > 0){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                          $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                          $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                          $regprogeanual[0]->gmp_11,    $regprogeanual[0]->gmc_11,   $regprogeanual[0]->gmes_p11 ,$regprogeanual[0]->gmes_s11,
                                                          $regprogeanual[0]->gacump_11, $regprogeanual[0]->gacumc_11,$regprogeanual[0]->gacum_p11,$regprogeanual[0]->gacum_s11,
                                                         );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;

                                    $data[$i][3] =$regprogeanual[0]->gtap_02;
                                    $data[$i][4] =$regprogeanual[0]->gtac_02;
                                    $data[$i][5] =$regprogeanual[0]->ganual_p;
                                    $data[$i][6] =$regprogeanual[0]->ganual_s;

                                    $data[$i][7] =$regprogeanual[0]->gmp_11;
                                    $data[$i][8] =$regprogeanual[0]->gmc_11;
                                    $data[$i][9] =$regprogeanual[0]->gmes_p11;
                                    $data[$i][10]=$regprogeanual[0]->gmes_s11;

                                    $data[$i][11]=$regprogeanual[0]->gacump_11; 
                                    $data[$i][12]=$regprogeanual[0]->gacumc_11; 
                                    $data[$i][13]=$regprogeanual[0]->gacum_p11; 
                                    $data[$i][14]=$regprogeanual[0]->gacum_s11; 
                                }   //if()                             
                            }  //foreach }                                     
                        }else{
                            if($request->taccion_id <> '0' ){ 
                                $i =0;
                                foreach($op as $key => $val) {
                                    ///print "$key = $val <br>";
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                                   ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                      END
                                                    ELSE NULL 
                                                 END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_11) > 0 And SUM(SIEVAD_DPA.MESC_11) > 0 THEN (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 ELSE 0 END AS GMES_P11')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_11) > 0 And SUM(SIEVAD_DPA.MESC_11) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_11)/SUM(SIEVAD_DPA.MESP_11))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S11")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_11) > 0 And SUM(SIEVAD_DPA.ACUMC_11) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 ELSE 0 END AS GACUM_P11')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_11) > 0 And SUM(SIEVAD_DPA.ACUMC_11) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_11)/SUM(SIEVAD_DPA.ACUMP_11))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S11") 

                                                   ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                                   ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                                   ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                                   ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                                   ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                                   ->get();     
                                    if($regprogeanual->count() > 0){
                                        $i++;
                                        $dataPoints[$i]=array(
                                                              $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                              $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                              $regprogeanual[0]->gmp_11,    $regprogeanual[0]->gmc_11,   $regprogeanual[0]->gmes_p01 ,$regprogeanual[0]->gmes_s11,
                                                              $regprogeanual[0]->gacump_11, $regprogeanual[0]->gacumc_11,$regprogeanual[0]->gacum_p01,$regprogeanual[0]->gacum_s11,
                                                             );       
                                        //Array multidimencional
                                        //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                        //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                        $data[$i][0] =$regprogeanual[0]->periodo_id;
                                        $data[$i][1] =$regprogeanual[0]->depen_id2;
                                        $data[$i][2] =$regprogeanual[0]->depen_desc;

                                        $data[$i][3] =$regprogeanual[0]->gtap_02;
                                        $data[$i][4] =$regprogeanual[0]->gtac_02;
                                        $data[$i][5] =$regprogeanual[0]->ganual_p;
                                        $data[$i][6] =$regprogeanual[0]->ganual_s;

                                        $data[$i][7] =$regprogeanual[0]->gmp_11;
                                        $data[$i][8] =$regprogeanual[0]->gmc_11;
                                        $data[$i][9] =$regprogeanual[0]->gmes_p11;
                                        $data[$i][10]=$regprogeanual[0]->gmes_s11;

                                        $data[$i][11]=$regprogeanual[0]->gacump_11; 
                                        $data[$i][12]=$regprogeanual[0]->gacumc_11; 
                                        $data[$i][13]=$regprogeanual[0]->gacum_p11; 
                                        $data[$i][14]=$regprogeanual[0]->gacum_s11; 
                                    }   //if($regprogeanual->count() > 0)                             
                                }       //foreach }                          
                            }   //if($request->taccion_id <> '0' )
                        }       //if($request->taccion_id == '0' )
                        break;
                    case '12':
                        if($request->taccion_id == '0' ){   
                            $i = 0;
                            foreach($op as $key => $val) {
                                $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                  END
                                                ELSE NULL 
                                             END AS GANUAL_S") 

                                               ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')
                                      ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.MESP_12) > 0 And SUM(SIEVAD_DPA.MESC_12) > 0 THEN (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 ELSE 0 END AS GMES_P12')  
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.MESP_12) > 0 And SUM(SIEVAD_DPA.MESC_12) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 <  50 THEN 'ROJO'
                                                END
                                              ELSE NULL 
                                            END AS GMES_S12")  

                                                 ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12')
                                      ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12')
                                      ->selectRaw('CASE 
                                             WHEN SUM(SIEVAD_DPA.ACUMP_12) > 0 And SUM(SIEVAD_DPA.ACUMC_12) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 ELSE 0 END AS GACUM_P12')  
                                      ->selectRaw("CASE 
                                             WHEN SUM(SIEVAD_DPA.ACUMP_12) > 0 And SUM(SIEVAD_DPA.ACUMC_12) > 0 THEN 
                                                CASE
                                                  WHEN (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 > 110 THEN 'MORADO' 
                                                  WHEN (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 < 110 THEN 'VERDE'
                                                  WHEN (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 <  90 THEN 'AMARILLO'
                                                  WHEN (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 <  70 THEN 'NARANJA'
                                                  WHEN (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 <  50 THEN 'ROJO'
                                                END
                                              ELSE NULL 
                                            END AS GACUM_S12") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->get();     
                                if($regprogeanual->count() > 0){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                          $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                          $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                          $regprogeanual[0]->gmp_12,    $regprogeanual[0]->gmc_12,   $regprogeanual[0]->gmes_p12 ,$regprogeanual[0]->gmes_s12,
                                                          $regprogeanual[0]->gacump_12, $regprogeanual[0]->gacumc_12,$regprogeanual[0]->gacum_p12,$regprogeanual[0]->gacum_s12,
                                                         );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;

                                    $data[$i][3] =$regprogeanual[0]->gtap_02;
                                    $data[$i][4] =$regprogeanual[0]->gtac_02;
                                    $data[$i][5] =$regprogeanual[0]->ganual_p;
                                    $data[$i][6] =$regprogeanual[0]->ganual_s;

                                    $data[$i][7] =$regprogeanual[0]->gmp_12;
                                    $data[$i][8] =$regprogeanual[0]->gmc_12;
                                    $data[$i][9] =$regprogeanual[0]->gmes_p12;
                                    $data[$i][10]=$regprogeanual[0]->gmes_s12;

                                    $data[$i][11]=$regprogeanual[0]->gacump_12; 
                                    $data[$i][12]=$regprogeanual[0]->gacumc_12; 
                                    $data[$i][13]=$regprogeanual[0]->gacum_p12; 
                                    $data[$i][14]=$regprogeanual[0]->gacum_s12; 
                                }   //if()                             
                            }  //foreach }                                     
                        }else{
                            if($request->taccion_id <> '0' ){ 
                                $i =0;
                                foreach($op as $key => $val) {
                                    ///print "$key = $val <br>";
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_DPA'             ,'SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                                                   ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC') 

                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTP_02) AS GTAP_02')
                                                   ->selectRaw('SUM(SIEVAD_DPA.TOTC_02) AS GTAC_02')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 ELSE 0 END AS GANUAL_P')
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.TOTP_02) > 0 And SUM(SIEVAD_DPA.TOTC_02) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=90 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=70 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >=50 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 >  0 AND (SUM(SIEVAD_DPA.TOTC_02)/SUM(SIEVAD_DPA.TOTP_02))*100 <  50 THEN 'ROJO'
                                                      END
                                                    ELSE NULL 
                                                 END AS GANUAL_S") 

                                                   ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')
                                          ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_12) > 0 And SUM(SIEVAD_DPA.MESC_12) > 0 THEN (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 ELSE 0 END AS GMES_P12')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.MESP_12) > 0 And SUM(SIEVAD_DPA.MESC_12) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 >=90 AND (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 >=70 AND (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 >=50 AND (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 <  70 THEN 'NARANJA'
                                                          WHEN (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 >  0 AND (SUM(SIEVAD_DPA.MESC_12)/SUM(SIEVAD_DPA.MESP_12))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GMES_S12")  

                                                   ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12')
                                          ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12')
                                          ->selectRaw('CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_12) > 0 And SUM(SIEVAD_DPA.ACUMC_12) > 0 THEN (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 ELSE 0 END AS GACUM_P12')  
                                          ->selectRaw("CASE 
                                                 WHEN SUM(SIEVAD_DPA.ACUMP_12) > 0 And SUM(SIEVAD_DPA.ACUMC_12) > 0 THEN 
                                                    CASE
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 > 110 THEN 'MORADO' 
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 >=90 AND (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 < 110 THEN 'VERDE'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 >=70 AND (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 <  90 THEN 'AMARILLO'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 >=50 AND (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 <  70 THEN 'NARANJA'
                                                      WHEN (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 >  0 AND (SUM(SIEVAD_DPA.ACUMC_12)/SUM(SIEVAD_DPA.ACUMP_12))*100 <  50 THEN 'ROJO'
                                                    END
                                                  ELSE NULL 
                                                END AS GACUM_S12") 


                                                   ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                                   ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                                   ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                                                   ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                                   ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                                   ->get();     
                                    if($regprogeanual->count() > 0){
                                        $i++;
                                        $dataPoints[$i]=array(
                                                              $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                              $regprogeanual[0]->gtap_02,   $regprogeanual[0]->gtac_02,  $regprogeanual[0]->ganual_p ,$regprogeanual[0]->ganual_s,
                                                              $regprogeanual[0]->gmp_12,    $regprogeanual[0]->gmc_12,   $regprogeanual[0]->gmes_p12 ,$regprogeanual[0]->gmes_s12,
                                                              $regprogeanual[0]->gacump_12, $regprogeanual[0]->gacumc_12,$regprogeanual[0]->gacum_p12,$regprogeanual[0]->gacum_s12,
                                                             );       
                                        //Array multidimencional
                                        //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                        //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                        $data[$i][0] =$regprogeanual[0]->periodo_id;
                                        $data[$i][1] =$regprogeanual[0]->depen_id2;
                                        $data[$i][2] =$regprogeanual[0]->depen_desc;

                                        $data[$i][3] =$regprogeanual[0]->gtap_02;
                                        $data[$i][4] =$regprogeanual[0]->gtac_02;
                                        $data[$i][5] =$regprogeanual[0]->ganual_p;
                                        $data[$i][6] =$regprogeanual[0]->ganual_s;

                                        $data[$i][7] =$regprogeanual[0]->gmp_12;
                                        $data[$i][8] =$regprogeanual[0]->gmc_12;
                                        $data[$i][9] =$regprogeanual[0]->gmes_p12;
                                        $data[$i][10]=$regprogeanual[0]->gmes_s12;

                                        $data[$i][11]=$regprogeanual[0]->gacump_12; 
                                        $data[$i][12]=$regprogeanual[0]->gacumc_12; 
                                        $data[$i][13]=$regprogeanual[0]->gacum_p12; 
                                        $data[$i][14]=$regprogeanual[0]->gacum_s12; 
                                    }   //if($regprogeanual->count() > 0)                             
                                }       //foreach }                          
                            }   //if($request->taccion_id <> '0' )
                        }       //if($request->taccion_id == '0' )
                        break;                                                
                } //swith

                /************ Bitacora inicia *************************************/ 
                setlocale(LC_TIME, "spanish");        
                $xip          = session()->get('ip');
                $xperiodo_id  = (int)date('Y');
                $xprograma_id = 1;
                $xmes_id      = (int)date('m');
                $xproceso_id  =         3;
                $xfuncion_id  =      3001;
                $xtrx_id      =         2;    //Reportes        
                $id           =         0;
                $regbitacora = regBitacoraModel::select('PERIODO_ID', 'PROGRAMA_ID', 'MES_ID', 'PROCESO_ID', 'FUNCION_ID', 'TRX_ID', 'FOLIO', 'NO_VECES', 'FECHA_REG', 'IP', 'LOGIN', 'FECHA_M', 'IP_M', 'LOGIN_M')
                               ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                        'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO'      => $id])
                               ->get();
                if($regbitacora->count() <= 0){              // Alta
                        $nuevoregBitacora = new regBitacoraModel();              
                        $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                        $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                        $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                        $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                        $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                        $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                        $nuevoregBitacora->FOLIO      = $id;             // Folio    
                        $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                        $nuevoregBitacora->IP         = $ip;             // IP
                        $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                        $nuevoregBitacora->save();
                        if($nuevoregBitacora->save() == true)
                            toastr()->success('Trx de reporte Excel registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                        else
                            toastr()->error('Error de trx de reporte Excel. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                }else{                   
                    //*********** Obtine el no. de veces *****************************
                    $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id, 'PROGRAMA_ID' => $xprograma_id, 
                                                      'MES_ID' => $xmes_id, 'PROCESO_ID' => $xproceso_id, 
                                                      'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id,'FOLIO' => $id])
                                 ->max('NO_VECES');
                    $xno_veces = $xno_veces+1;                        
                    //*********** Termina de obtener el no de veces *****************************         
                    $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id,
                                            'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id,
                                            'FOLIO'      => $id])
                                   ->update([
                                             'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                             'IP_M'     => $regbitacora->IP       = $ip,
                                             'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                             'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]);
                    toastr()->success('Trx de reporte Excel actualizada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                }   /************ Bitacora termina *************************************/         

                //*********** Genera reporte a formato excel con parámetros ***********/ 
                return Excel::download(new ExcelExportMensualcon_v2($request->periodo_id,$request->mes_id,$request->depen_id,$request->taccion_id,$data,$i),'Reporte_Mensual_Concentrado'.date('d-m-Y').'.xlsx');
                break;

            case 'D':    //Formato PDF
                $dataAsociative = array();
                $dataPoints     = array();
                $data           = array();
                $i =0;

                if($request->taccion_id == '0' ){   
                    //*********** 2 ********************
                    $i =0;
                    foreach($op as $key => $val) {
                        ///print "$key = $val <br>";
                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID',
                                                                                      '=','SIEVAD_EPA.DEPEN_ID2')
                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO','=',
                                                                                          'SIEVAD_EPA.FOLIO')
                           ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')

                           ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')                           

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')          
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_01)  AS GTAP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_02)  AS GTAP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_01)  AS GTAC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_02)  AS GTAC_02')
                           ->selectRaw('COUNT(*) AS NACTIV')
                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                           ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')
                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                           ->get();
                           if($regprogeanual->count() > 0){
                                $i++;       
                                $dataPoints[$i]=array(
                                                   $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                   $regprogeanual[0]->gmp_01,   $regprogeanual[0]->gmp_02,$regprogeanual[0]->gmp_03,
                                                   $regprogeanual[0]->gmp_04,   $regprogeanual[0]->gmp_05,$regprogeanual[0]->gmp_06,
                                                   $regprogeanual[0]->gmp_07,   $regprogeanual[0]->gmp_08,$regprogeanual[0]->gmp_09,
                                                   $regprogeanual[0]->gmp_10,   $regprogeanual[0]->gmp_11,$regprogeanual[0]->gmp_12,
                                                   $regprogeanual[0]->gmc_01,   $regprogeanual[0]->gmc_02,$regprogeanual[0]->gmc_03,
                                                   $regprogeanual[0]->gmc_04,   $regprogeanual[0]->gmc_05,$regprogeanual[0]->gmc_06,
                                                   $regprogeanual[0]->gmc_07,   $regprogeanual[0]->gmc_08,$regprogeanual[0]->gmc_09,
                                                   $regprogeanual[0]->gmc_10,   $regprogeanual[0]->gmc_11,$regprogeanual[0]->gmc_12,
                                                   $regprogeanual[0]->gacump_01,$regprogeanual[0]->gacump_02,$regprogeanual[0]->gacump_03,
                                                   $regprogeanual[0]->gacump_04,$regprogeanual[0]->gacump_05,$regprogeanual[0]->gacump_06,
                                                   $regprogeanual[0]->gacump_07,$regprogeanual[0]->gacump_08,$regprogeanual[0]->gacump_09,
                                                   $regprogeanual[0]->gacump_10,$regprogeanual[0]->gacump_11,$regprogeanual[0]->gacump_12,
                                                   $regprogeanual[0]->gacumc_01,$regprogeanual[0]->gacumc_02,$regprogeanual[0]->gacumc_03,
                                                   $regprogeanual[0]->gacumc_04,$regprogeanual[0]->gacumc_05,$regprogeanual[0]->gacumc_06,
                                                   $regprogeanual[0]->gacumc_07,$regprogeanual[0]->gacumc_08,$regprogeanual[0]->gacumc_09,
                                                   $regprogeanual[0]->gacumc_10,$regprogeanual[0]->gacumc_11,$regprogeanual[0]->gacumc_12,
                                                   $regprogeanual[0]->gtap_01,  $regprogeanual[0]->gtap_02,
                                                   $regprogeanual[0]->gtac_01,  $regprogeanual[0]->gtac_02,
                                                   $regprogeanual[0]->nactiv
                                                  );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;
                                    $data[$i][3] =$regprogeanual[0]->gmp_01;
                                    $data[$i][4] =$regprogeanual[0]->gmp_02;
                                    $data[$i][5] =$regprogeanual[0]->gmp_03;
                                    $data[$i][6] =$regprogeanual[0]->gmp_04;
                                    $data[$i][7] =$regprogeanual[0]->gmp_05;
                                    $data[$i][8] =$regprogeanual[0]->gmp_06;
                                    $data[$i][9] =$regprogeanual[0]->gmp_07;
                                    $data[$i][10]=$regprogeanual[0]->gmp_08;
                                    $data[$i][11]=$regprogeanual[0]->gmp_09;
                                    $data[$i][12]=$regprogeanual[0]->gmp_10;
                                    $data[$i][13]=$regprogeanual[0]->gmp_11;
                                    $data[$i][14]=$regprogeanual[0]->gmp_12; 
                                    $data[$i][15]=$regprogeanual[0]->gmc_01;
                                    $data[$i][16]=$regprogeanual[0]->gmc_02;
                                    $data[$i][17]=$regprogeanual[0]->gmc_03;
                                    $data[$i][18]=$regprogeanual[0]->gmc_04;
                                    $data[$i][19]=$regprogeanual[0]->gmc_05;
                                    $data[$i][20]=$regprogeanual[0]->gmc_06;
                                    $data[$i][21]=$regprogeanual[0]->gmc_07;
                                    $data[$i][22]=$regprogeanual[0]->gmc_08;
                                    $data[$i][23]=$regprogeanual[0]->gmc_09;
                                    $data[$i][24]=$regprogeanual[0]->gmc_10;
                                    $data[$i][25]=$regprogeanual[0]->gmc_11;
                                    $data[$i][26]=$regprogeanual[0]->gmc_12;  
                                    $data[$i][27]=$regprogeanual[0]->gacump_01; 
                                    $data[$i][28]=$regprogeanual[0]->gacump_02; 
                                    $data[$i][29]=$regprogeanual[0]->gacump_03; 
                                    $data[$i][30]=$regprogeanual[0]->gacump_04; 
                                    $data[$i][31]=$regprogeanual[0]->gacump_05; 
                                    $data[$i][32]=$regprogeanual[0]->gacump_06; 
                                    $data[$i][33]=$regprogeanual[0]->gacump_07; 
                                    $data[$i][34]=$regprogeanual[0]->gacump_08; 
                                    $data[$i][35]=$regprogeanual[0]->gacump_09; 
                                    $data[$i][36]=$regprogeanual[0]->gacump_10; 
                                    $data[$i][37]=$regprogeanual[0]->gacump_11; 
                                    $data[$i][38]=$regprogeanual[0]->gacump_12; 
                                    $data[$i][39]=$regprogeanual[0]->gacumc_01; 
                                    $data[$i][40]=$regprogeanual[0]->gacumc_02; 
                                    $data[$i][41]=$regprogeanual[0]->gacumc_03; 
                                    $data[$i][42]=$regprogeanual[0]->gacumc_04; 
                                    $data[$i][43]=$regprogeanual[0]->gacumc_05; 
                                    $data[$i][44]=$regprogeanual[0]->gacumc_06; 
                                    $data[$i][45]=$regprogeanual[0]->gacumc_07; 
                                    $data[$i][46]=$regprogeanual[0]->gacumc_08; 
                                    $data[$i][47]=$regprogeanual[0]->gacumc_09; 
                                    $data[$i][48]=$regprogeanual[0]->gacumc_10; 
                                    $data[$i][49]=$regprogeanual[0]->gacumc_11; 
                                    $data[$i][50]=$regprogeanual[0]->gacumc_12;                                     
                                    $data[$i][51]=$regprogeanual[0]->gtap_01; 
                                    $data[$i][52]=$regprogeanual[0]->gtap_02;
                                    $data[$i][53]=$regprogeanual[0]->gtac_01; 
                                    $data[$i][54]=$regprogeanual[0]->gtac_02;
                                    $data[$i][55]=$regprogeanual[0]->nactiv;
                            }   //if()                             
                    }  //foreach }

                }else{
                    if($request->taccion_id <> '0' ){   
                        //*********** 3 ********************
                        $i =0;
                        foreach($op as $key => $val) {
                            ///print "$key = $val <br>";
                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID',
                                                                                          '=','SIEVAD_EPA.DEPEN_ID2')
                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO','=',
                                                                                              'SIEVAD_EPA.FOLIO')
                               ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                               
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')

                               ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')                           

                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')          
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12') 

                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12') 

                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_01)  AS GTAP_01')
                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02)  AS GTAP_02')
                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_01)  AS GTAC_01')
                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02)  AS GTAC_02')
                               ->selectRaw('COUNT(*) AS NACTIV')
                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=',$request->periodo_id)
                               ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                               ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')
                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                               ->get();
                            if($regprogeanual->count() > 0){
                                $i++;
                                $dataPoints[$i]=array(
                                                   $regprogeanual[0]->periodo_id,$regprogeanual[0]->depen_id2,$regprogeanual[0]->depen_desc,
                                                   $regprogeanual[0]->gmp_01,   $regprogeanual[0]->gmp_02,$regprogeanual[0]->gmp_03,
                                                   $regprogeanual[0]->gmp_04,   $regprogeanual[0]->gmp_05,$regprogeanual[0]->gmp_06,
                                                   $regprogeanual[0]->gmp_07,   $regprogeanual[0]->gmp_08,$regprogeanual[0]->gmp_09,
                                                   $regprogeanual[0]->gmp_10,   $regprogeanual[0]->gmp_11,$regprogeanual[0]->gmp_12,
                                                   $regprogeanual[0]->gmc_01,   $regprogeanual[0]->gmc_02,$regprogeanual[0]->gmc_03,
                                                   $regprogeanual[0]->gmc_04,   $regprogeanual[0]->gmc_05,$regprogeanual[0]->gmc_06,
                                                   $regprogeanual[0]->gmc_07,   $regprogeanual[0]->gmc_08,$regprogeanual[0]->gmc_09,
                                                   $regprogeanual[0]->gmc_10,   $regprogeanual[0]->gmc_11,$regprogeanual[0]->gmc_12,
                                                   $regprogeanual[0]->gacump_01,$regprogeanual[0]->gacump_02,$regprogeanual[0]->gacump_03,
                                                   $regprogeanual[0]->gacump_04,$regprogeanual[0]->gacump_05,$regprogeanual[0]->gacump_06,
                                                   $regprogeanual[0]->gacump_07,$regprogeanual[0]->gacump_08,$regprogeanual[0]->gacump_09,
                                                   $regprogeanual[0]->gacump_10,$regprogeanual[0]->gacump_11,$regprogeanual[0]->gacump_12,
                                                   $regprogeanual[0]->gacumc_01,$regprogeanual[0]->gacumc_02,$regprogeanual[0]->gacumc_03,
                                                   $regprogeanual[0]->gacumc_04,$regprogeanual[0]->gacumc_05,$regprogeanual[0]->gacumc_06,
                                                   $regprogeanual[0]->gacumc_07,$regprogeanual[0]->gacumc_08,$regprogeanual[0]->gacumc_09,
                                                   $regprogeanual[0]->gacumc_10,$regprogeanual[0]->gacumc_11,$regprogeanual[0]->gacumc_12,
                                                   $regprogeanual[0]->gtap_01,  $regprogeanual[0]->gtap_02,
                                                   $regprogeanual[0]->gtac_01,  $regprogeanual[0]->gtac_02,
                                                   $regprogeanual[0]->nactiv
                                                  );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regprogeanual[0]->periodo_id;
                                    $data[$i][1] =$regprogeanual[0]->depen_id2;
                                    $data[$i][2] =$regprogeanual[0]->depen_desc;
                                    $data[$i][3] =$regprogeanual[0]->gmp_01;
                                    $data[$i][4] =$regprogeanual[0]->gmp_02;
                                    $data[$i][5] =$regprogeanual[0]->gmp_03;
                                    $data[$i][6] =$regprogeanual[0]->gmp_04;
                                    $data[$i][7] =$regprogeanual[0]->gmp_05;
                                    $data[$i][8] =$regprogeanual[0]->gmp_06;
                                    $data[$i][9] =$regprogeanual[0]->gmp_07;
                                    $data[$i][10]=$regprogeanual[0]->gmp_08;
                                    $data[$i][11]=$regprogeanual[0]->gmp_09;
                                    $data[$i][12]=$regprogeanual[0]->gmp_10;
                                    $data[$i][13]=$regprogeanual[0]->gmp_11;
                                    $data[$i][14]=$regprogeanual[0]->gmp_12; 
                                    $data[$i][15]=$regprogeanual[0]->gmc_01;
                                    $data[$i][16]=$regprogeanual[0]->gmc_02;
                                    $data[$i][17]=$regprogeanual[0]->gmc_03;
                                    $data[$i][18]=$regprogeanual[0]->gmc_04;
                                    $data[$i][19]=$regprogeanual[0]->gmc_05;
                                    $data[$i][20]=$regprogeanual[0]->gmc_06;
                                    $data[$i][21]=$regprogeanual[0]->gmc_07;
                                    $data[$i][22]=$regprogeanual[0]->gmc_08;
                                    $data[$i][23]=$regprogeanual[0]->gmc_09;
                                    $data[$i][24]=$regprogeanual[0]->gmc_10;
                                    $data[$i][25]=$regprogeanual[0]->gmc_11;
                                    $data[$i][26]=$regprogeanual[0]->gmc_12;  
                                    $data[$i][27]=$regprogeanual[0]->gacump_01; 
                                    $data[$i][28]=$regprogeanual[0]->gacump_02; 
                                    $data[$i][29]=$regprogeanual[0]->gacump_03; 
                                    $data[$i][30]=$regprogeanual[0]->gacump_04; 
                                    $data[$i][31]=$regprogeanual[0]->gacump_05; 
                                    $data[$i][32]=$regprogeanual[0]->gacump_06; 
                                    $data[$i][33]=$regprogeanual[0]->gacump_07; 
                                    $data[$i][34]=$regprogeanual[0]->gacump_08; 
                                    $data[$i][35]=$regprogeanual[0]->gacump_09; 
                                    $data[$i][36]=$regprogeanual[0]->gacump_10; 
                                    $data[$i][37]=$regprogeanual[0]->gacump_11; 
                                    $data[$i][38]=$regprogeanual[0]->gacump_12; 
                                    $data[$i][39]=$regprogeanual[0]->gacumc_01; 
                                    $data[$i][40]=$regprogeanual[0]->gacumc_02; 
                                    $data[$i][41]=$regprogeanual[0]->gacumc_03; 
                                    $data[$i][42]=$regprogeanual[0]->gacumc_04; 
                                    $data[$i][43]=$regprogeanual[0]->gacumc_05; 
                                    $data[$i][44]=$regprogeanual[0]->gacumc_06; 
                                    $data[$i][45]=$regprogeanual[0]->gacumc_07; 
                                    $data[$i][46]=$regprogeanual[0]->gacumc_08; 
                                    $data[$i][47]=$regprogeanual[0]->gacumc_09; 
                                    $data[$i][48]=$regprogeanual[0]->gacumc_10; 
                                    $data[$i][49]=$regprogeanual[0]->gacumc_11; 
                                    $data[$i][50]=$regprogeanual[0]->gacumc_12;                                     
                                    $data[$i][51]=$regprogeanual[0]->gtap_01; 
                                    $data[$i][52]=$regprogeanual[0]->gtap_02;
                                    $data[$i][53]=$regprogeanual[0]->gtac_01; 
                                    $data[$i][54]=$regprogeanual[0]->gtac_02;
                                    $data[$i][55]=$regprogeanual[0]->nactiv;
                            }   //if($regprogeanual->count() > 0)          
                        }  // foreach 
                    }      // taccion_id  <> 0
                }          // taccion_id  == 0  

                /************ Bitacora inicia *************************************/ 
                setlocale(LC_TIME, "spanish");        
                $xip          = session()->get('ip');
                $xperiodo_id  = (int)date('Y');
                $xprograma_id = 1;
                $xmes_id      = (int)date('m');
                $xproceso_id  =         3;
                $xfuncion_id  =      3001;
                $xtrx_id      =         2;    //Reportes        
                $id           =         0;
                $regbitacora = regBitacoraModel::select('PERIODO_ID','PROGRAMA_ID','MES_ID','PROCESO_ID','FUNCION_ID', 
                               'TRX_ID', 'FOLIO', 'NO_VECES', 'FECHA_REG', 'IP', 'LOGIN', 'FECHA_M', 'IP_M', 'LOGIN_M')
                               ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                        'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO'      => $id])
                               ->get();
                if($regbitacora->count() <= 0){              // Alta
                    $nuevoregBitacora = new regBitacoraModel();              
                    $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                    $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                    $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                    $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                    $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                    $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                    $nuevoregBitacora->FOLIO      = $id;             // Folio    
                    $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                    $nuevoregBitacora->IP         = $ip;             // IP
                    $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                    $nuevoregBitacora->save();
                    if($nuevoregBitacora->save() == true)
                        toastr()->success('Trx de reporte PDF registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                    else
                        toastr()->error('Error de trx de reporte PDF. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                }else{                   
                    //*********** Obtine el no. de veces *****************************
                    $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id, 
                                                          'MES_ID'     => $xmes_id,    'PROCESO_ID'  => $xproceso_id, 
                                                          'FUNCION_ID' => $xfuncion_id,'TRX_ID'      => $xtrx_id,
                                                          'FOLIO'      => $id])
                                ->max('NO_VECES');
                    $xno_veces = $xno_veces+1;                        
                    //*********** Termina de obtener el no de veces *****************************         
                    $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id,
                                            'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id,
                                            'FOLIO'      => $id])
                                       ->update([
                                                 'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                                 'IP_M'     => $regbitacora->IP       = $ip,
                                                 'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                                 'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]);
                    toastr()->success('Trx de reporte PDF actualizada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                }   /************ Bitacora termina *************************************/         


                //************** Genera reporte pdf ******************/
                //Parámetro 0 significa que no se impondrá límite de tiempo 
                //(según el manual), el script puede ejecutarse hasta su finalización  
                //dd($data);      
                set_time_limit(0);
                ini_set("memory_limit",-1);
                ini_set('max_execution_time', 0);            
                $pdf = PDF::loadView('sicinar.pdf.reporteMensualconPDF_v2',compact('nombre','usuario','regmeses','periodo_id','mes_id','data','i'));
                //$options = new Options();
                //$options->set('defaultFont', 'Courier');
                //$pdf->set_option('defaultFont', 'Courier');
                //$pdf->set('defaultFont', 'Courier');
                //$pdf->set_options('isPhpEnabled', true);
                //$pdf->setOptions(['isPhpEnabled' => true]);                
                //******** Horizontal ***********************//
                $pdf->setPaper('A4', 'landscape');      
                //******** vertical *************************//
                //$pdf->setPaper('A4','portrait');
                //*** Output the generated PDF to Browser ***//
                return $pdf->stream('Reporte_Mensual_Concentrado');

                break;                              
            }   // switch ($request->tipo) --- Termina tipo de reporte pantalla, excel o PDF   
            break;
        
        /********************************************************************************/
        /********************** Reportes detallados   ***********************************/
        /********************************************************************************/
        case 'D':  //****** Reportes detallados
            //**************************************************************************//
            // Generar reporte detallado                                            ****//
            //**************************************************************************//
            $dataAsociative = array();
            $dataPoints     = array();
            $data           = array();
            $i =0;        
            switch ($request->tipo) {
            case 'P':    //Por pantalla detallado
                if($request->taccion_id == '0' ){   
                    $i =0;
                    foreach($op as $key => $val) {
                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                       ->select( 
                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2', 'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                           'SIEVAD_EPA.FOLIO',     'SIEVAD_DPA.PARTIDA',   'SIEVAD_DPA.ACTIVIDAD_DESC',
                                           'SIEVAD_DPA.UMED_ID',   'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                           'SIEVAD_EPA.EPPROY_ID','SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',
                                           'SIEVAD_DPA.MESP_01','SIEVAD_DPA.MESP_02','SIEVAD_DPA.MESP_03','SIEVAD_DPA.MESP_04','SIEVAD_DPA.MESP_05','SIEVAD_DPA.MESP_06',
                                           'SIEVAD_DPA.MESP_07','SIEVAD_DPA.MESP_08','SIEVAD_DPA.MESP_09','SIEVAD_DPA.MESP_10','SIEVAD_DPA.MESP_11','SIEVAD_DPA.MESP_12',

                                           'SIEVAD_DPA.MESC_01','SIEVAD_DPA.MESC_02','SIEVAD_DPA.MESC_03','SIEVAD_DPA.MESC_04','SIEVAD_DPA.MESC_05','SIEVAD_DPA.MESC_06',
                                           'SIEVAD_DPA.MESC_07','SIEVAD_DPA.MESC_08','SIEVAD_DPA.MESC_09','SIEVAD_DPA.MESC_10','SIEVAD_DPA.MESC_11','SIEVAD_DPA.MESC_12',

                                           'SIEVAD_DPA.MES_P01','SIEVAD_DPA.MES_P02','SIEVAD_DPA.MES_P03','SIEVAD_DPA.MES_P04','SIEVAD_DPA.MES_P05','SIEVAD_DPA.MES_P06',
                                           'SIEVAD_DPA.MES_P07','SIEVAD_DPA.MES_P08','SIEVAD_DPA.MES_P09','SIEVAD_DPA.MES_P10','SIEVAD_DPA.MES_P11','SIEVAD_DPA.MES_P12',

                                           'SIEVAD_DPA.SEMAF_01','SIEVAD_DPA.SEMAF_02','SIEVAD_DPA.SEMAF_03','SIEVAD_DPA.SEMAF_04','SIEVAD_DPA.SEMAF_05','SIEVAD_DPA.SEMAF_06', 
                                           'SIEVAD_DPA.SEMAF_07','SIEVAD_DPA.SEMAF_08','SIEVAD_DPA.SEMAF_08','SIEVAD_DPA.SEMAF_10','SIEVAD_DPA.SEMAF_11','SIEVAD_DPA.SEMAF_12', 

                                           'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMP_04',

                                           'SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIMC_04',

                                           'SIEVAD_DPA.TSEMP_01','SIEVAD_DPA.TSEMP_02','SIEVAD_DPA.TSEMC_01','SIEVAD_DPA.TSEMC_02',

                                           'SIEVAD_DPA.TOTP_01','SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_01','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01', 

                                           'SIEVAD_DPA.SEMAFA_01',

                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMP_06',
                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMP_12',

                                           'SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUMC_06',
                                           'SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUMC_12',                                           

                                           'SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.ACUM_P06',
                                           'SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.ACUM_P12',

                                           'SIEVAD_DPA.ACUM_S01','SIEVAD_DPA.ACUM_S02','SIEVAD_DPA.ACUM_S03','SIEVAD_DPA.ACUM_S04','SIEVAD_DPA.ACUM_S05','SIEVAD_DPA.ACUM_S06',
                                           'SIEVAD_DPA.ACUM_S07','SIEVAD_DPA.ACUM_S08','SIEVAD_DPA.ACUM_S09','SIEVAD_DPA.ACUM_S10','SIEVAD_DPA.ACUM_S11','SIEVAD_DPA.ACUM_S12',

                                           'SIEVAD_DPA.OBS_01','SIEVAD_DPA.OBS_02','SIEVAD_DPA.OBS_03','SIEVAD_DPA.OBS_04','SIEVAD_DPA.OBS_05','SIEVAD_DPA.OBS_06',
                                           'SIEVAD_DPA.OBS_07','SIEVAD_DPA.OBS_08','SIEVAD_DPA.OBS_09','SIEVAD_DPA.OBS_10','SIEVAD_DPA.OBS_11','SIEVAD_DPA.OBS_12' 
                                            )
 
                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                               ->get();
                        if($regprogeanual->count() > 0){
                            foreach($regprogeanual as $regproganual){
                                $i++;
                                $dataPoints[$i]=array(
                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                   $regproganual->umed_id   ,$regproganual->umed_desc,
                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                   $regproganual->mesp_01,   $regproganual->mesp_02,  $regproganual->mesp_03,
                                                   $regproganual->mesp_04,   $regproganual->mesp_05,  $regproganual->mesp_06,
                                                   $regproganual->mesp_07,   $regproganual->mesp_08,  $regproganual->mesp_09,
                                                   $regproganual->mesp_10,   $regproganual->mesp_11,  $regproganual->mesp_12,
                                                   $regproganual->mesc_01,   $regproganual->mesc_02,  $regproganual->mesc_03,
                                                   $regproganual->mesc_04,   $regproganual->mesc_05,  $regproganual->mesc_06,
                                                   $regproganual->mesc_07,   $regproganual->mesc_08,  $regproganual->mesc_09,
                                                   $regproganual->mesc_10,   $regproganual->mesc_11,  $regproganual->mesc_12,
                                                   $regproganual->mes_p01,   $regproganual->mes_p02,  $regproganual->mes_p03,
                                                   $regproganual->mes_p04,   $regproganual->mes_p05,  $regproganual->mes_p06,
                                                   $regproganual->mes_p07,   $regproganual->mes_p08,  $regproganual->mes_p09,
                                                   $regproganual->mes_p10,   $regproganual->mes_p11,  $regproganual->mes_p12,
                                                   $regproganual->semaf_01,  $regproganual->semaf_02, $regproganual->semaf_03,
                                                   $regproganual->semaf_04,  $regproganual->semaf_05, $regproganual->semaf_06,
                                                   $regproganual->semaf_07,  $regproganual->semaf_08, $regproganual->semaf_09,
                                                   $regproganual->semaf_10,  $regproganual->semaf_11, $regproganual->semaf_12,
                                                   $regproganual->trimp_01,  $regproganual->trimp_02,
                                                   $regproganual->trimp_03,  $regproganual->trimp_04,
                                                   $regproganual->trimc_01,  $regproganual->trimc_02,
                                                   $regproganual->trimc_03,  $regproganual->trimc_04,                                                   
                                                   $regproganual->tsemp_01,  $regproganual->tsemp_02,
                                                   $regproganual->tsemc_01,  $regproganual->tsemc_02,
                                                   $regproganual->totp_01,   $regproganual->totp_02,
                                                   $regproganual->totc_01,   $regproganual->totc_02,                                                   
                                                   $regproganual->tot_p01,   $regproganual->semafa_01,
                                                   $regproganual->acump_01,  $regproganual->acump_02,$regproganual->acump_03,
                                                   $regproganual->acump_04,  $regproganual->acump_05,$regproganual->acump_06,
                                                   $regproganual->acump_07,  $regproganual->acump_08,$regproganual->acump_09,
                                                   $regproganual->acump_10,  $regproganual->acump_11,$regproganual->acump_12,
                                                   $regproganual->acumc_01,  $regproganual->acumc_02,$regproganual->acumc_03,
                                                   $regproganual->acumc_04,  $regproganual->acumc_05,$regproganual->acumc_06,
                                                   $regproganual->acumc_07,  $regproganual->acumc_08,$regproganual->acumc_09,
                                                   $regproganual->acumc_10,  $regproganual->acumc_11,$regproganual->acumc_12,
                                                   $regproganual->acum_p01,  $regproganual->acum_p02,$regproganual->acum_p03,
                                                   $regproganual->acum_p04,  $regproganual->acum_p05,$regproganual->acum_p06,
                                                   $regproganual->acum_p07,  $regproganual->acum_p08,$regproganual->acum_p09,
                                                   $regproganual->acum_p10,  $regproganual->acum_p11,$regproganual->acum_p12,                                                   
                                                   $regproganual->acum_s01,  $regproganual->acum_s02,$regproganual->acum_s03,
                                                   $regproganual->acum_s04,  $regproganual->acum_s05,$regproganual->acum_s06,
                                                   $regproganual->acum_s07,  $regproganual->acum_s08,$regproganual->acum_s09,
                                                   $regproganual->acum_s10,  $regproganual->acum_s11,$regproganual->acum_s12, 
                                                   $regproganual->obs_01,    $regproganual->obs_02  ,$regproganual->obs_03,
                                                   $regproganual->obs_04,    $regproganual->obs_05  ,$regproganual->obs_06,
                                                   $regproganual->obs_07,    $regproganual->obs_08  ,$regproganual->obs_09,
                                                   $regproganual->obs_10,    $regproganual->obs_11  ,$regproganual->obs_12                                                   
                                                  );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regproganual->periodo_id;
                                    $data[$i][1] =$regproganual->depen_id2;
                                    $data[$i][2] =$regproganual->depen_desc;
                                    $data[$i][3] =$regproganual->folio;
                                    $data[$i][4] =$regproganual->partida;
                                    $data[$i][5] =$regproganual->actividad_desc;                                    
                                    $data[$i][6] =$regproganual->umed_id;
                                    $data[$i][7] =$regproganual->umed_desc; 
                                    $data[$i][8] =$regproganual->epproy_id;
                                    $data[$i][9] =$regproganual->epproy_desc;                                                                         

                                    $data[$i][10]=$regproganual->mesp_01;
                                    $data[$i][11]=$regproganual->mesp_02;
                                    $data[$i][12]=$regproganual->mesp_03;
                                    $data[$i][13]=$regproganual->mesp_04;
                                    $data[$i][14]=$regproganual->mesp_05;
                                    $data[$i][15]=$regproganual->mesp_06;
                                    $data[$i][16]=$regproganual->mesp_07;
                                    $data[$i][17]=$regproganual->mesp_08;
                                    $data[$i][18]=$regproganual->mesp_09;
                                    $data[$i][19]=$regproganual->mesp_10;
                                    $data[$i][20]=$regproganual->mesp_11;
                                    $data[$i][21]=$regproganual->mesp_12; 

                                    $data[$i][22]=$regproganual->mesc_01;
                                    $data[$i][23]=$regproganual->mesc_02;
                                    $data[$i][24]=$regproganual->mesc_03;
                                    $data[$i][25]=$regproganual->mesc_04;
                                    $data[$i][26]=$regproganual->mesc_05;
                                    $data[$i][27]=$regproganual->mesc_06;
                                    $data[$i][28]=$regproganual->mesc_07;
                                    $data[$i][29]=$regproganual->mesc_08;
                                    $data[$i][30]=$regproganual->mesc_09;
                                    $data[$i][31]=$regproganual->mesc_10;
                                    $data[$i][32]=$regproganual->mesc_11;
                                    $data[$i][33]=$regproganual->mesc_12;

                                    $data[$i][34]=$regproganual->mes_p01;
                                    $data[$i][35]=$regproganual->mes_p02;
                                    $data[$i][36]=$regproganual->mes_p03;
                                    $data[$i][37]=$regproganual->mes_p04;
                                    $data[$i][38]=$regproganual->mes_p05;
                                    $data[$i][39]=$regproganual->mes_p06;
                                    $data[$i][40]=$regproganual->mes_p07;
                                    $data[$i][41]=$regproganual->mes_p08;
                                    $data[$i][42]=$regproganual->mes_p09;
                                    $data[$i][43]=$regproganual->mes_p10;
                                    $data[$i][44]=$regproganual->mes_p11;
                                    $data[$i][45]=$regproganual->mes_p12;   

                                    $data[$i][46]=$regproganual->semaf_01;
                                    $data[$i][47]=$regproganual->semaf_02;
                                    $data[$i][48]=$regproganual->semaf_03;
                                    $data[$i][49]=$regproganual->semaf_04;
                                    $data[$i][50]=$regproganual->semaf_05;
                                    $data[$i][51]=$regproganual->semaf_06;
                                    $data[$i][52]=$regproganual->semaf_07;
                                    $data[$i][53]=$regproganual->semaf_08;
                                    $data[$i][54]=$regproganual->semaf_09;
                                    $data[$i][55]=$regproganual->semaf_10;
                                    $data[$i][56]=$regproganual->semaf_11;
                                    $data[$i][57]=$regproganual->semaf_12;

                                    $data[$i][58]=$regproganual->trimp_01;
                                    $data[$i][59]=$regproganual->trimp_02;
                                    $data[$i][60]=$regproganual->trimp_03;
                                    $data[$i][61]=$regproganual->trimp_04;
                                    $data[$i][62]=$regproganual->trimc_01;
                                    $data[$i][63]=$regproganual->trimc_02;
                                    $data[$i][64]=$regproganual->trimc_03;
                                    $data[$i][65]=$regproganual->trimc_04;
                                    $data[$i][66]=$regproganual->tsemp_01;
                                    $data[$i][67]=$regproganual->tsemp_02;
                                    $data[$i][68]=$regproganual->tsemc_01;
                                    $data[$i][69]=$regproganual->tsemc_02;

                                    $data[$i][70]=$regproganual->totp_01;
                                    $data[$i][71]=$regproganual->totp_02;
                                    $data[$i][72]=$regproganual->totc_01;
                                    $data[$i][73]=$regproganual->totc_02;                                    

                                    $data[$i][74]=$regproganual->tot_p01;
                                    $data[$i][75]=$regproganual->semafa_01; 

                                    $data[$i][76]=$regproganual->acump_01; 
                                    $data[$i][77]=$regproganual->acump_02; 
                                    $data[$i][78]=$regproganual->acump_03; 
                                    $data[$i][79]=$regproganual->acump_04; 
                                    $data[$i][80]=$regproganual->acump_05; 
                                    $data[$i][81]=$regproganual->acump_06; 
                                    $data[$i][82]=$regproganual->acump_07; 
                                    $data[$i][83]=$regproganual->acump_08; 
                                    $data[$i][84]=$regproganual->acump_09; 
                                    $data[$i][85]=$regproganual->acump_10; 
                                    $data[$i][86]=$regproganual->acump_11; 
                                    $data[$i][87]=$regproganual->acump_12; 

                                    $data[$i][88]=$regproganual->acumc_01; 
                                    $data[$i][89]=$regproganual->acumc_02; 
                                    $data[$i][90]=$regproganual->acumc_03; 
                                    $data[$i][91]=$regproganual->acumc_04; 
                                    $data[$i][92]=$regproganual->acumc_05; 
                                    $data[$i][93]=$regproganual->acumc_06; 
                                    $data[$i][94]=$regproganual->acumc_07; 
                                    $data[$i][95]=$regproganual->acumc_08; 
                                    $data[$i][96]=$regproganual->acumc_09; 
                                    $data[$i][97]=$regproganual->acumc_10; 
                                    $data[$i][98]=$regproganual->acumc_11; 
                                    $data[$i][99]=$regproganual->acumc_12;   

                                    $data[$i][100]=$regproganual->acum_p01; 
                                    $data[$i][101]=$regproganual->acum_p02; 
                                    $data[$i][102]=$regproganual->acum_p03; 
                                    $data[$i][103]=$regproganual->acum_p04; 
                                    $data[$i][104]=$regproganual->acum_p05; 
                                    $data[$i][105]=$regproganual->acum_p06; 
                                    $data[$i][105]=$regproganual->acum_p07; 
                                    $data[$i][107]=$regproganual->acum_p08; 
                                    $data[$i][108]=$regproganual->acum_p09; 
                                    $data[$i][109]=$regproganual->acum_p10; 
                                    $data[$i][110]=$regproganual->acum_p11; 
                                    $data[$i][111]=$regproganual->acum_p12;                                     

                                    $data[$i][112]=$regproganual->acum_s01; 
                                    $data[$i][113]=$regproganual->acum_s02; 
                                    $data[$i][114]=$regproganual->acum_s03; 
                                    $data[$i][115]=$regproganual->acum_s04; 
                                    $data[$i][116]=$regproganual->acum_s05; 
                                    $data[$i][117]=$regproganual->acum_s06; 
                                    $data[$i][118]=$regproganual->acum_s07; 
                                    $data[$i][119]=$regproganual->acum_s08; 
                                    $data[$i][120]=$regproganual->acum_s09; 
                                    $data[$i][121]=$regproganual->acum_s10; 
                                    $data[$i][122]=$regproganual->acum_s11; 
                                    $data[$i][123]=$regproganual->acum_s12; 

                                    $data[$i][124]=$regproganual->obs_01; 
                                    $data[$i][125]=$regproganual->obs_02; 
                                    $data[$i][126]=$regproganual->obs_03; 
                                    $data[$i][127]=$regproganual->obs_04; 
                                    $data[$i][128]=$regproganual->obs_05; 
                                    $data[$i][129]=$regproganual->obs_06; 
                                    $data[$i][130]=$regproganual->obs_07; 
                                    $data[$i][131]=$regproganual->obs_08; 
                                    $data[$i][132]=$regproganual->obs_09; 
                                    $data[$i][133]=$regproganual->obs_10; 
                                    $data[$i][134]=$regproganual->obs_11; 
                                    $data[$i][135]=$regproganual->obs_12;                                     
                            }  // foreach($regprogeanual as $regproganual)
                        }      // if($regprogeanual->count() > 0){
                    }          // foreach 
                }else{
                    if($request->taccion_id <> '0' ){   
                        //*********** 3 ********************
                        $i =0;
                        foreach($op as $key => $val) {
                            ///print "$key = $val <br>";
                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                       ->select( 
                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2', 'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                           'SIEVAD_EPA.FOLIO',     'SIEVAD_DPA.PARTIDA',   'SIEVAD_DPA.ACTIVIDAD_DESC',
                                           'SIEVAD_DPA.UMED_ID',   'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                           'SIEVAD_EPA.EPPROY_ID','SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',
                                           'SIEVAD_DPA.MESP_01','SIEVAD_DPA.MESP_02','SIEVAD_DPA.MESP_03','SIEVAD_DPA.MESP_04','SIEVAD_DPA.MESP_05','SIEVAD_DPA.MESP_06',
                                           'SIEVAD_DPA.MESP_07','SIEVAD_DPA.MESP_08','SIEVAD_DPA.MESP_09','SIEVAD_DPA.MESP_10','SIEVAD_DPA.MESP_11','SIEVAD_DPA.MESP_12',

                                           'SIEVAD_DPA.MESC_01','SIEVAD_DPA.MESC_02','SIEVAD_DPA.MESC_03','SIEVAD_DPA.MESC_04','SIEVAD_DPA.MESC_05','SIEVAD_DPA.MESC_06',
                                           'SIEVAD_DPA.MESC_07','SIEVAD_DPA.MESC_08','SIEVAD_DPA.MESC_09','SIEVAD_DPA.MESC_10','SIEVAD_DPA.MESC_11','SIEVAD_DPA.MESC_12',

                                           'SIEVAD_DPA.MES_P01','SIEVAD_DPA.MES_P02','SIEVAD_DPA.MES_P03','SIEVAD_DPA.MES_P04','SIEVAD_DPA.MES_P05','SIEVAD_DPA.MES_P06',
                                           'SIEVAD_DPA.MES_P07','SIEVAD_DPA.MES_P08','SIEVAD_DPA.MES_P09','SIEVAD_DPA.MES_P10','SIEVAD_DPA.MES_P11','SIEVAD_DPA.MES_P12',

                                           'SIEVAD_DPA.SEMAF_01','SIEVAD_DPA.SEMAF_02','SIEVAD_DPA.SEMAF_03','SIEVAD_DPA.SEMAF_04','SIEVAD_DPA.SEMAF_05','SIEVAD_DPA.SEMAF_06', 
                                           'SIEVAD_DPA.SEMAF_07','SIEVAD_DPA.SEMAF_08','SIEVAD_DPA.SEMAF_08','SIEVAD_DPA.SEMAF_10','SIEVAD_DPA.SEMAF_11','SIEVAD_DPA.SEMAF_12', 

                                           'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMP_04',

                                           'SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIMC_04',

                                           'SIEVAD_DPA.TSEMP_01','SIEVAD_DPA.TSEMP_02','SIEVAD_DPA.TSEMC_01','SIEVAD_DPA.TSEMC_02',

                                           'SIEVAD_DPA.TOTP_01','SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_01','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01', 

                                           'SIEVAD_DPA.SEMAFA_01',

                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMP_06',
                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMP_12',

                                           'SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUMC_06',
                                           'SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUMC_12',                                           

                                           'SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.ACUM_P06',
                                           'SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.ACUM_P12',

                                           'SIEVAD_DPA.ACUM_S01','SIEVAD_DPA.ACUM_S02','SIEVAD_DPA.ACUM_S03','SIEVAD_DPA.ACUM_S04','SIEVAD_DPA.ACUM_S05','SIEVAD_DPA.ACUM_S06',
                                           'SIEVAD_DPA.ACUM_S07','SIEVAD_DPA.ACUM_S08','SIEVAD_DPA.ACUM_S09','SIEVAD_DPA.ACUM_S10','SIEVAD_DPA.ACUM_S11','SIEVAD_DPA.ACUM_S12',

                                           'SIEVAD_DPA.OBS_01','SIEVAD_DPA.OBS_02','SIEVAD_DPA.OBS_03','SIEVAD_DPA.OBS_04','SIEVAD_DPA.OBS_05','SIEVAD_DPA.OBS_06',
                                           'SIEVAD_DPA.OBS_07','SIEVAD_DPA.OBS_08','SIEVAD_DPA.OBS_09','SIEVAD_DPA.OBS_10','SIEVAD_DPA.OBS_11','SIEVAD_DPA.OBS_12' 
                                              )
 
                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                            ->get();

                            if($regprogeanual->count() > 0){
                                foreach($regprogeanual as $regproganual){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                       $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                       $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                       $regproganual->umed_id   ,$regproganual->umed_desc,
                                                       $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                       $regproganual->mesp_01,   $regproganual->mesp_02,  $regproganual->mesp_03,
                                                       $regproganual->mesp_04,   $regproganual->mesp_05,  $regproganual->mesp_06,
                                                       $regproganual->mesp_07,   $regproganual->mesp_08,  $regproganual->mesp_09,
                                                       $regproganual->mesp_10,   $regproganual->mesp_11,  $regproganual->mesp_12,
                                                       $regproganual->mesc_01,   $regproganual->mesc_02,  $regproganual->mesc_03,
                                                       $regproganual->mesc_04,   $regproganual->mesc_05,  $regproganual->mesc_06,
                                                       $regproganual->mesc_07,   $regproganual->mesc_08,  $regproganual->mesc_09,
                                                       $regproganual->mesc_10,   $regproganual->mesc_11,  $regproganual->mesc_12,
                                                       $regproganual->mes_p01,   $regproganual->mes_p02,  $regproganual->mes_p03,
                                                       $regproganual->mes_p04,   $regproganual->mes_p05,  $regproganual->mes_p06,
                                                       $regproganual->mes_p07,   $regproganual->mes_p08,  $regproganual->mes_p09,
                                                       $regproganual->mes_p10,   $regproganual->mes_p11,  $regproganual->mes_p12,
                                                       $regproganual->semaf_01,  $regproganual->semaf_02, $regproganual->semaf_03,
                                                       $regproganual->semaf_04,  $regproganual->semaf_05, $regproganual->semaf_06,
                                                       $regproganual->semaf_07,  $regproganual->semaf_08, $regproganual->semaf_09,
                                                       $regproganual->semaf_10,  $regproganual->semaf_11, $regproganual->semaf_12,
                                                       $regproganual->trimp_01,  $regproganual->trimp_02,
                                                       $regproganual->trimp_03,  $regproganual->trimp_04,
                                                       $regproganual->trimc_01,  $regproganual->trimc_02,
                                                       $regproganual->trimc_03,  $regproganual->trimc_04,                                                   
                                                       $regproganual->tsemp_01,  $regproganual->tsemp_02,
                                                       $regproganual->tsemc_01,  $regproganual->tsemc_02,
                                                       $regproganual->totp_01,   $regproganual->totp_02,
                                                       $regproganual->totc_01,   $regproganual->totc_02,                                                   
                                                       $regproganual->tot_p01,   $regproganual->semafa_01,
                                                       $regproganual->acump_01,  $regproganual->acump_02,$regproganual->acump_03,
                                                       $regproganual->acump_04,  $regproganual->acump_05,$regproganual->acump_06,
                                                       $regproganual->acump_07,  $regproganual->acump_08,$regproganual->acump_09,
                                                       $regproganual->acump_10,  $regproganual->acump_11,$regproganual->acump_12,
                                                       $regproganual->acumc_01,  $regproganual->acumc_02,$regproganual->acumc_03,
                                                       $regproganual->acumc_04,  $regproganual->acumc_05,$regproganual->acumc_06,
                                                       $regproganual->acumc_07,  $regproganual->acumc_08,$regproganual->acumc_09,
                                                       $regproganual->acumc_10,  $regproganual->acumc_11,$regproganual->acumc_12,
                                                       $regproganual->acum_p01,  $regproganual->acum_p02,$regproganual->acum_p03,
                                                       $regproganual->acum_p04,  $regproganual->acum_p05,$regproganual->acum_p06,
                                                       $regproganual->acum_p07,  $regproganual->acum_p08,$regproganual->acum_p09,
                                                       $regproganual->acum_p10,  $regproganual->acum_p11,$regproganual->acum_p12,                                                   
                                                       $regproganual->acum_s01,  $regproganual->acum_s02,$regproganual->acum_s03,
                                                       $regproganual->acum_s04,  $regproganual->acum_s05,$regproganual->acum_s06,
                                                       $regproganual->acum_s07,  $regproganual->acum_s08,$regproganual->acum_s09,
                                                       $regproganual->acum_s10,  $regproganual->acum_s11,$regproganual->acum_s12, 
                                                       $regproganual->obs_01,    $regproganual->obs_02  ,$regproganual->obs_03,
                                                       $regproganual->obs_04,    $regproganual->obs_05  ,$regproganual->obs_06,
                                                       $regproganual->obs_07,    $regproganual->obs_08  ,$regproganual->obs_09,
                                                       $regproganual->obs_10,    $regproganual->obs_11  ,$regproganual->obs_12                                                   
                                                      );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regproganual->periodo_id;
                                    $data[$i][1] =$regproganual->depen_id2;
                                    $data[$i][2] =$regproganual->depen_desc;
                                    $data[$i][3] =$regproganual->folio;
                                    $data[$i][4] =$regproganual->partida;
                                    $data[$i][5] =$regproganual->actividad_desc;                                    
                                    $data[$i][6] =$regproganual->umed_id;
                                    $data[$i][7] =$regproganual->umed_desc; 
                                    $data[$i][8] =$regproganual->epproy_id;
                                    $data[$i][9] =$regproganual->epproy_desc;                                                                         

                                    $data[$i][10]=$regproganual->mesp_01;
                                    $data[$i][11]=$regproganual->mesp_02;
                                    $data[$i][12]=$regproganual->mesp_03;
                                    $data[$i][13]=$regproganual->mesp_04;
                                    $data[$i][14]=$regproganual->mesp_05;
                                    $data[$i][15]=$regproganual->mesp_06;
                                    $data[$i][16]=$regproganual->mesp_07;
                                    $data[$i][17]=$regproganual->mesp_08;
                                    $data[$i][18]=$regproganual->mesp_09;
                                    $data[$i][19]=$regproganual->mesp_10;
                                    $data[$i][20]=$regproganual->mesp_11;
                                    $data[$i][21]=$regproganual->mesp_12; 

                                    $data[$i][22]=$regproganual->mesc_01;
                                    $data[$i][23]=$regproganual->mesc_02;
                                    $data[$i][24]=$regproganual->mesc_03;
                                    $data[$i][25]=$regproganual->mesc_04;
                                    $data[$i][26]=$regproganual->mesc_05;
                                    $data[$i][27]=$regproganual->mesc_06;
                                    $data[$i][28]=$regproganual->mesc_07;
                                    $data[$i][29]=$regproganual->mesc_08;
                                    $data[$i][30]=$regproganual->mesc_09;
                                    $data[$i][31]=$regproganual->mesc_10;
                                    $data[$i][32]=$regproganual->mesc_11;
                                    $data[$i][33]=$regproganual->mesc_12;

                                    $data[$i][34]=$regproganual->mes_p01;
                                    $data[$i][35]=$regproganual->mes_p02;
                                    $data[$i][36]=$regproganual->mes_p03;
                                    $data[$i][37]=$regproganual->mes_p04;
                                    $data[$i][38]=$regproganual->mes_p05;
                                    $data[$i][39]=$regproganual->mes_p06;
                                    $data[$i][40]=$regproganual->mes_p07;
                                    $data[$i][41]=$regproganual->mes_p08;
                                    $data[$i][42]=$regproganual->mes_p09;
                                    $data[$i][43]=$regproganual->mes_p10;
                                    $data[$i][44]=$regproganual->mes_p11;
                                    $data[$i][45]=$regproganual->mes_p12;   

                                    $data[$i][46]=$regproganual->semaf_01;
                                    $data[$i][47]=$regproganual->semaf_02;
                                    $data[$i][48]=$regproganual->semaf_03;
                                    $data[$i][49]=$regproganual->semaf_04;
                                    $data[$i][50]=$regproganual->semaf_05;
                                    $data[$i][51]=$regproganual->semaf_06;
                                    $data[$i][52]=$regproganual->semaf_07;
                                    $data[$i][53]=$regproganual->semaf_08;
                                    $data[$i][54]=$regproganual->semaf_09;
                                    $data[$i][55]=$regproganual->semaf_10;
                                    $data[$i][56]=$regproganual->semaf_11;
                                    $data[$i][57]=$regproganual->semaf_12;

                                    $data[$i][58]=$regproganual->trimp_01;
                                    $data[$i][59]=$regproganual->trimp_02;
                                    $data[$i][60]=$regproganual->trimp_03;
                                    $data[$i][61]=$regproganual->trimp_04;
                                    $data[$i][62]=$regproganual->trimc_01;
                                    $data[$i][63]=$regproganual->trimc_02;
                                    $data[$i][64]=$regproganual->trimc_03;
                                    $data[$i][65]=$regproganual->trimc_04;
                                    $data[$i][66]=$regproganual->tsemp_01;
                                    $data[$i][67]=$regproganual->tsemp_02;
                                    $data[$i][68]=$regproganual->tsemc_01;
                                    $data[$i][69]=$regproganual->tsemc_02;

                                    $data[$i][70]=$regproganual->totp_01;
                                    $data[$i][71]=$regproganual->totp_02;
                                    $data[$i][72]=$regproganual->totc_01;
                                    $data[$i][73]=$regproganual->totc_02;                                    

                                    $data[$i][74]=$regproganual->tot_p01;
                                    $data[$i][75]=$regproganual->semafa_01; 

                                    $data[$i][76]=$regproganual->acump_01; 
                                    $data[$i][77]=$regproganual->acump_02; 
                                    $data[$i][78]=$regproganual->acump_03; 
                                    $data[$i][79]=$regproganual->acump_04; 
                                    $data[$i][80]=$regproganual->acump_05; 
                                    $data[$i][81]=$regproganual->acump_06; 
                                    $data[$i][82]=$regproganual->acump_07; 
                                    $data[$i][83]=$regproganual->acump_08; 
                                    $data[$i][84]=$regproganual->acump_09; 
                                    $data[$i][85]=$regproganual->acump_10; 
                                    $data[$i][86]=$regproganual->acump_11; 
                                    $data[$i][87]=$regproganual->acump_12; 

                                    $data[$i][88]=$regproganual->acumc_01; 
                                    $data[$i][89]=$regproganual->acumc_02; 
                                    $data[$i][90]=$regproganual->acumc_03; 
                                    $data[$i][91]=$regproganual->acumc_04; 
                                    $data[$i][92]=$regproganual->acumc_05; 
                                    $data[$i][93]=$regproganual->acumc_06; 
                                    $data[$i][94]=$regproganual->acumc_07; 
                                    $data[$i][95]=$regproganual->acumc_08; 
                                    $data[$i][96]=$regproganual->acumc_09; 
                                    $data[$i][97]=$regproganual->acumc_10; 
                                    $data[$i][98]=$regproganual->acumc_11; 
                                    $data[$i][99]=$regproganual->acumc_12;   

                                    $data[$i][100]=$regproganual->acum_p01; 
                                    $data[$i][101]=$regproganual->acum_p02; 
                                    $data[$i][102]=$regproganual->acum_p03; 
                                    $data[$i][103]=$regproganual->acum_p04; 
                                    $data[$i][104]=$regproganual->acum_p05; 
                                    $data[$i][105]=$regproganual->acum_p06; 
                                    $data[$i][105]=$regproganual->acum_p07; 
                                    $data[$i][107]=$regproganual->acum_p08; 
                                    $data[$i][108]=$regproganual->acum_p09; 
                                    $data[$i][109]=$regproganual->acum_p10; 
                                    $data[$i][110]=$regproganual->acum_p11; 
                                    $data[$i][111]=$regproganual->acum_p12;                                     

                                    $data[$i][112]=$regproganual->acum_s01; 
                                    $data[$i][113]=$regproganual->acum_s02; 
                                    $data[$i][114]=$regproganual->acum_s03; 
                                    $data[$i][115]=$regproganual->acum_s04; 
                                    $data[$i][116]=$regproganual->acum_s05; 
                                    $data[$i][117]=$regproganual->acum_s06; 
                                    $data[$i][118]=$regproganual->acum_s07; 
                                    $data[$i][119]=$regproganual->acum_s08; 
                                    $data[$i][120]=$regproganual->acum_s09; 
                                    $data[$i][121]=$regproganual->acum_s10; 
                                    $data[$i][122]=$regproganual->acum_s11; 
                                    $data[$i][123]=$regproganual->acum_s12; 

                                    $data[$i][124]=$regproganual->obs_01; 
                                    $data[$i][125]=$regproganual->obs_02; 
                                    $data[$i][126]=$regproganual->obs_03; 
                                    $data[$i][127]=$regproganual->obs_04; 
                                    $data[$i][128]=$regproganual->obs_05; 
                                    $data[$i][129]=$regproganual->obs_06; 
                                    $data[$i][130]=$regproganual->obs_07; 
                                    $data[$i][131]=$regproganual->obs_08; 
                                    $data[$i][132]=$regproganual->obs_09; 
                                    $data[$i][133]=$regproganual->obs_10; 
                                    $data[$i][134]=$regproganual->obs_11; 
                                    $data[$i][135]=$regproganual->obs_12;                                     
                                }  // foreach($regprogeanual as $regproganual)
                            }      // if($regprogeanual->count() > 0){                            
                        }  // foreach 
                    }      // taccion_id  <> 0
                }          // taccion_id  == 0  
                //dd('contador:'.$i,$data);
                /************ Bitacora inicia *************************************/ 
                setlocale(LC_TIME, "spanish");        
                $xip          = session()->get('ip');
                $xperiodo_id  = (int)date('Y');
                $xprograma_id = 1;
                $xmes_id      = (int)date('m');
                $xproceso_id  =         3;
                $xfuncion_id  =      3001;
                $xtrx_id      =         2;    //Reportes        
                $id           =         0;
                $regbitacora = regBitacoraModel::select('PERIODO_ID','PROGRAMA_ID','MES_ID','PROCESO_ID','FUNCION_ID', 
                                                        'TRX_ID','FOLIO','NO_VECES','FECHA_REG','IP','LOGIN',
                                                        'FECHA_M','IP_M', 'LOGIN_M')
                               ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                        'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO'      => $id])
                               ->get();
                if($regbitacora->count() <= 0){              // Alta
                    $nuevoregBitacora = new regBitacoraModel();              
                    $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                    $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                    $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                    $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                    $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                    $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                    $nuevoregBitacora->FOLIO      = $id;             // Folio    
                    $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                    $nuevoregBitacora->IP         = $ip;             // IP
                    $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                    $nuevoregBitacora->save();
                    if($nuevoregBitacora->save() == true)
                        toastr()->success('Trx de reporte registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                    else
                        toastr()->error('Error de trx de reporte. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                }else{                   
                    //*********** Obtine el no. de veces *****************************
                    $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID'=> $xprograma_id,
                                                          'MES_ID'     => $xmes_id,    'PROCESO_ID' => $xproceso_id, 
                                                          'FUNCION_ID' => $xfuncion_id,'TRX_ID'     => $xtrx_id,
                                                          'FOLIO'      => $id])
                                 ->max('NO_VECES');
                    $xno_veces = $xno_veces+1;                        
                    //*********** Termina de obtener el no de veces *****************************         
                    $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID'=> $xprograma_id,'MES_ID' => $xmes_id,
                                            'PROCESO_ID' => $xproceso_id,'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id,
                                            'FOLIO'      => $id])
                                       ->update([
                                                 'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                                 'IP_M'     => $regbitacora->IP       = $ip,
                                                 'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                                 'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]);
                    toastr()->success('Trx de reporte actualizada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                }   /************ Bitacora termina *************************************/           
                 
                //************** Genera reporte detallado en pantalla ******************/
                $control = $request->control; 
                return view('sicinar.reportes.verReportemensualdet_v2',compact('nombre','usuario','regmeses','periodo_id','mes_id','control','data','i'));
                break;

            case 'E':    //Formato excel detallado 

                $data  = array();
                $dataAsociative = array();
                $dataPoints     = array();                
                $i     = 0;
                if( $request->control == 'S' ){   
                    switch($request->mes_id){
                        case '1':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_01;
                                                $data[$i][14]=$regproganual->mesc_01;
                                                $data[$i][15]=$regproganual->mes_p01;
                                                $data[$i][16]=$regproganual->mes_s01;

                                                $data[$i][17]=$regproganual->acump_01; 
                                                $data[$i][18]=$regproganual->acumc_01; 
                                                $data[$i][19]=$regproganual->acum_p01; 
                                                $data[$i][20]=$regproganual->smf_01; 
                                                $data[$i][21]=$regproganual->obs_01; 
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_01;
                                                $data[$i][14]=$regproganual->mesc_01;
                                                $data[$i][15]=$regproganual->mes_p01;
                                                $data[$i][16]=$regproganual->mes_s01;

                                                $data[$i][17]=$regproganual->acump_01; 
                                                $data[$i][18]=$regproganual->acumc_01; 
                                                $data[$i][19]=$regproganual->acum_p01; 
                                                $data[$i][20]=$regproganual->smf_01; 
                                                $data[$i][21]=$regproganual->obs_01;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 1

                        case '2':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_02;
                                                $data[$i][14]=$regproganual->mesc_02;
                                                $data[$i][15]=$regproganual->mes_p02;
                                                $data[$i][16]=$regproganual->mes_s02;

                                                $data[$i][17]=$regproganual->acump_02; 
                                                $data[$i][18]=$regproganual->acumc_02; 
                                                $data[$i][19]=$regproganual->acum_p02; 
                                                $data[$i][20]=$regproganual->smf_02; 
                                                $data[$i][21]=$regproganual->obs_02; 
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_02;
                                                $data[$i][14]=$regproganual->mesc_02;
                                                $data[$i][15]=$regproganual->mes_p02;
                                                $data[$i][16]=$regproganual->mes_s02;

                                                $data[$i][17]=$regproganual->acump_02; 
                                                $data[$i][18]=$regproganual->acumc_02; 
                                                $data[$i][19]=$regproganual->acum_p02; 
                                                $data[$i][20]=$regproganual->smf_02; 
                                                $data[$i][21]=$regproganual->obs_02;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 2

                        case '3':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_03;
                                                $data[$i][14]=$regproganual->mesc_03;
                                                $data[$i][15]=$regproganual->mes_p03;
                                                $data[$i][16]=$regproganual->mes_s03;

                                                $data[$i][17]=$regproganual->acump_03; 
                                                $data[$i][18]=$regproganual->acumc_03; 
                                                $data[$i][19]=$regproganual->acum_p03; 
                                                $data[$i][20]=$regproganual->smf_03; 
                                                $data[$i][21]=$regproganual->obs_03; 
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_03;
                                                $data[$i][14]=$regproganual->mesc_03;
                                                $data[$i][15]=$regproganual->mes_p03;
                                                $data[$i][16]=$regproganual->mes_s03;

                                                $data[$i][17]=$regproganual->acump_03; 
                                                $data[$i][18]=$regproganual->acumc_03; 
                                                $data[$i][19]=$regproganual->acum_p03; 
                                                $data[$i][20]=$regproganual->smf_03; 
                                                $data[$i][21]=$regproganual->obs_03;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 3

                        case '4':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_04;
                                                $data[$i][14]=$regproganual->mesc_04;
                                                $data[$i][15]=$regproganual->mes_p04;
                                                $data[$i][16]=$regproganual->mes_s04;

                                                $data[$i][17]=$regproganual->acump_04; 
                                                $data[$i][18]=$regproganual->acumc_04; 
                                                $data[$i][19]=$regproganual->acum_p04; 
                                                $data[$i][20]=$regproganual->smf_04; 
                                                $data[$i][21]=$regproganual->obs_04; 
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_04;
                                                $data[$i][14]=$regproganual->mesc_04;
                                                $data[$i][15]=$regproganual->mes_p04;
                                                $data[$i][16]=$regproganual->mes_s04;

                                                $data[$i][17]=$regproganual->acump_04; 
                                                $data[$i][18]=$regproganual->acumc_04; 
                                                $data[$i][19]=$regproganual->acum_p04; 
                                                $data[$i][20]=$regproganual->smf_04; 
                                                $data[$i][21]=$regproganual->obs_04;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 4

                        case '5':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_05;
                                                $data[$i][14]=$regproganual->mesc_05;
                                                $data[$i][15]=$regproganual->mes_p05;
                                                $data[$i][16]=$regproganual->mes_s05;

                                                $data[$i][17]=$regproganual->acump_05; 
                                                $data[$i][18]=$regproganual->acumc_05; 
                                                $data[$i][19]=$regproganual->acum_p05; 
                                                $data[$i][20]=$regproganual->smf_05; 
                                                $data[$i][21]=$regproganual->obs_05; 
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_05;
                                                $data[$i][14]=$regproganual->mesc_05;
                                                $data[$i][15]=$regproganual->mes_p05;
                                                $data[$i][16]=$regproganual->mes_s05;

                                                $data[$i][17]=$regproganual->acump_05; 
                                                $data[$i][18]=$regproganual->acumc_05; 
                                                $data[$i][19]=$regproganual->acum_p05; 
                                                $data[$i][20]=$regproganual->smf_05; 
                                                $data[$i][21]=$regproganual->obs_05;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 5

                        case '6':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_06;
                                                $data[$i][14]=$regproganual->mesc_06;
                                                $data[$i][15]=$regproganual->mes_p06;
                                                $data[$i][16]=$regproganual->mes_s06;

                                                $data[$i][17]=$regproganual->acump_06; 
                                                $data[$i][18]=$regproganual->acumc_06; 
                                                $data[$i][19]=$regproganual->acum_p06; 
                                                $data[$i][20]=$regproganual->smf_06; 
                                                $data[$i][21]=$regproganual->obs_06; 
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_06;
                                                $data[$i][14]=$regproganual->mesc_06;
                                                $data[$i][15]=$regproganual->mes_p06;
                                                $data[$i][16]=$regproganual->mes_s06;

                                                $data[$i][17]=$regproganual->acump_06; 
                                                $data[$i][18]=$regproganual->acumc_06; 
                                                $data[$i][19]=$regproganual->acum_p06; 
                                                $data[$i][20]=$regproganual->smf_06; 
                                                $data[$i][21]=$regproganual->obs_06;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 6

                        case '7':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_07;
                                                $data[$i][14]=$regproganual->mesc_07;
                                                $data[$i][15]=$regproganual->mes_p07;
                                                $data[$i][16]=$regproganual->mes_s07;

                                                $data[$i][17]=$regproganual->acump_07; 
                                                $data[$i][18]=$regproganual->acumc_07; 
                                                $data[$i][19]=$regproganual->acum_p07; 
                                                $data[$i][20]=$regproganual->smf_07; 
                                                $data[$i][21]=$regproganual->obs_07; 
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_07;
                                                $data[$i][14]=$regproganual->mesc_07;
                                                $data[$i][15]=$regproganual->mes_p07;
                                                $data[$i][16]=$regproganual->mes_s07;

                                                $data[$i][17]=$regproganual->acump_07; 
                                                $data[$i][18]=$regproganual->acumc_07; 
                                                $data[$i][19]=$regproganual->acum_p07; 
                                                $data[$i][20]=$regproganual->smf_07; 
                                                $data[$i][21]=$regproganual->obs_07;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 7

                        case '8':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                       'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_08")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                               $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                               $regproganual->obs_08
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_08;
                                                $data[$i][14]=$regproganual->mesc_08;
                                                $data[$i][15]=$regproganual->mes_p08;
                                                $data[$i][16]=$regproganual->mes_s08;

                                                $data[$i][17]=$regproganual->acump_08; 
                                                $data[$i][18]=$regproganual->acumc_08; 
                                                $data[$i][19]=$regproganual->acum_p08; 
                                                $data[$i][20]=$regproganual->smf_08; 
                                                $data[$i][21]=$regproganual->obs_08; 
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                       'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_08")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                               $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                               $regproganual->obs_08
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_08;
                                                $data[$i][14]=$regproganual->mesc_08;
                                                $data[$i][15]=$regproganual->mes_p08;
                                                $data[$i][16]=$regproganual->mes_s08;

                                                $data[$i][17]=$regproganual->acump_08; 
                                                $data[$i][18]=$regproganual->acumc_08; 
                                                $data[$i][19]=$regproganual->acum_p08; 
                                                $data[$i][20]=$regproganual->smf_08; 
                                                $data[$i][21]=$regproganual->obs_08;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 8

                        case '9':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                       'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_09")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                               $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                               $regproganual->obs_09
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_09;
                                                $data[$i][14]=$regproganual->mesc_09;
                                                $data[$i][15]=$regproganual->mes_p09;
                                                $data[$i][16]=$regproganual->mes_s09;

                                                $data[$i][17]=$regproganual->acump_09; 
                                                $data[$i][18]=$regproganual->acumc_09; 
                                                $data[$i][19]=$regproganual->acum_p09; 
                                                $data[$i][20]=$regproganual->smf_09; 
                                                $data[$i][21]=$regproganual->obs_09; 
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                       'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_09")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                               $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                               $regproganual->obs_09
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_09;
                                                $data[$i][14]=$regproganual->mesc_09;
                                                $data[$i][15]=$regproganual->mes_p09;
                                                $data[$i][16]=$regproganual->mes_s09;

                                                $data[$i][17]=$regproganual->acump_09; 
                                                $data[$i][18]=$regproganual->acumc_09; 
                                                $data[$i][19]=$regproganual->acum_p09; 
                                                $data[$i][20]=$regproganual->smf_09; 
                                                $data[$i][21]=$regproganual->obs_09;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 9

                        case '10':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                       'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_10")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                               $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                               $regproganual->obs_10
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_10;
                                                $data[$i][14]=$regproganual->mesc_10;
                                                $data[$i][15]=$regproganual->mes_p10;
                                                $data[$i][16]=$regproganual->mes_s10;

                                                $data[$i][17]=$regproganual->acump_10; 
                                                $data[$i][18]=$regproganual->acumc_10; 
                                                $data[$i][19]=$regproganual->acum_p10; 
                                                $data[$i][20]=$regproganual->smf_10; 
                                                $data[$i][21]=$regproganual->obs_10; 
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                       'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S10 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_10")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                               $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                               $regproganual->obs_10
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_10;
                                                $data[$i][14]=$regproganual->mesc_10;
                                                $data[$i][15]=$regproganual->mes_p10;
                                                $data[$i][16]=$regproganual->mes_s10;

                                                $data[$i][17]=$regproganual->acump_10; 
                                                $data[$i][18]=$regproganual->acumc_10; 
                                                $data[$i][19]=$regproganual->acum_p10; 
                                                $data[$i][20]=$regproganual->smf_10; 
                                                $data[$i][21]=$regproganual->obs_10;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 10

                        case '11':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_11',  'SIEVAD_CAT_COLORES_11.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_11')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_11' ,'SIEVAD_DPA.MESC_11' ,'SIEVAD_DPA.MES_P11' ,'SIEVAD_CAT_COLORES_11.COLOR_COLOR AS MES_S11', 
                                                       'SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.OBS_11'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S11
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_11")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_11,   $regproganual->mesc_11,  $regproganual->mes_p11, $regproganual->mes_s11,  
                                                               $regproganual->acump_11,  $regproganual->acumc_11, $regproganual->acum_p11,$regproganual->smf_11,
                                                               $regproganual->obs_11
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_11;
                                                $data[$i][14]=$regproganual->mesc_11;
                                                $data[$i][15]=$regproganual->mes_p11;
                                                $data[$i][16]=$regproganual->mes_s11;

                                                $data[$i][17]=$regproganual->acump_11; 
                                                $data[$i][18]=$regproganual->acumc_11; 
                                                $data[$i][19]=$regproganual->acum_p11; 
                                                $data[$i][20]=$regproganual->smf_11; 
                                                $data[$i][21]=$regproganual->obs_11; 
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_11',  'SIEVAD_CAT_COLORES_11.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_11')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_11' ,'SIEVAD_DPA.MESC_11' ,'SIEVAD_DPA.MES_P11' ,'SIEVAD_CAT_COLORES_11.COLOR_COLOR AS MES_S11', 
                                                       'SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.OBS_11'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S11 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_11")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_11,   $regproganual->mesc_11,  $regproganual->mes_p11, $regproganual->mes_s11,  
                                                               $regproganual->acump_11,  $regproganual->acumc_11, $regproganual->acum_p11,$regproganual->smf_11,
                                                               $regproganual->obs_11
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_11;
                                                $data[$i][14]=$regproganual->mesc_11;
                                                $data[$i][15]=$regproganual->mes_p11;
                                                $data[$i][16]=$regproganual->mes_s11;

                                                $data[$i][17]=$regproganual->acump_11; 
                                                $data[$i][18]=$regproganual->acumc_11; 
                                                $data[$i][19]=$regproganual->acum_p11; 
                                                $data[$i][20]=$regproganual->smf_11; 
                                                $data[$i][21]=$regproganual->obs_11;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 11

                        case '12':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_12',  'SIEVAD_CAT_COLORES_12.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_12')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_12' ,'SIEVAD_DPA.MESC_12' ,'SIEVAD_DPA.MES_P12' ,'SIEVAD_CAT_COLORES_12.COLOR_COLOR AS MES_S12', 
                                                       'SIEVAD_DPA.ACUMP_12','SIEVAD_DPA.ACUMC_12','SIEVAD_DPA.ACUM_P12','SIEVAD_DPA.OBS_12'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S12
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_12")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_12,   $regproganual->mesc_12,  $regproganual->mes_p12, $regproganual->mes_s12,  
                                                               $regproganual->acump_12,  $regproganual->acumc_12, $regproganual->acum_p12,$regproganual->smf_12,
                                                               $regproganual->obs_12
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_12;
                                                $data[$i][14]=$regproganual->mesc_12;
                                                $data[$i][15]=$regproganual->mes_p12;
                                                $data[$i][16]=$regproganual->mes_s12;

                                                $data[$i][17]=$regproganual->acump_12; 
                                                $data[$i][18]=$regproganual->acumc_12; 
                                                $data[$i][19]=$regproganual->acum_p12; 
                                                $data[$i][20]=$regproganual->smf_12; 
                                                $data[$i][21]=$regproganual->obs_12; 
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_12',  'SIEVAD_CAT_COLORES_12.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_12')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_12' ,'SIEVAD_DPA.MESC_12' ,'SIEVAD_DPA.MES_P12' ,'SIEVAD_CAT_COLORES_12.COLOR_COLOR AS MES_S12', 
                                                       'SIEVAD_DPA.ACUMP_12','SIEVAD_DPA.ACUMC_12','SIEVAD_DPA.ACUM_P12','SIEVAD_DPA.OBS_12'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S12
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_12")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_12,   $regproganual->mesc_12,  $regproganual->mes_p12, $regproganual->mes_s12,  
                                                               $regproganual->acump_12,  $regproganual->acumc_12, $regproganual->acum_p12,$regproganual->smf_12,
                                                               $regproganual->obs_12
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->actividad_desc;  
                                                $data[$i][8] =$regproganual->umed_desc; 
                                                                        
                                                $data[$i][9] =$regproganual->totp_02;
                                                $data[$i][10]=$regproganual->totc_02;
                                                $data[$i][11]=$regproganual->tot_p01; 
                                                $data[$i][12]=$regproganual->color_color; 

                                                $data[$i][13]=$regproganual->mesp_12;
                                                $data[$i][14]=$regproganual->mesc_12;
                                                $data[$i][15]=$regproganual->mes_p12;
                                                $data[$i][16]=$regproganual->mes_s12;

                                                $data[$i][17]=$regproganual->acump_12; 
                                                $data[$i][18]=$regproganual->acumc_12; 
                                                $data[$i][19]=$regproganual->acum_p12; 
                                                $data[$i][20]=$regproganual->smf_12; 
                                                $data[$i][21]=$regproganual->obs_12;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                        break;         // case 12                                                                                                                                                                                                                                                                        
                    } //swith
                }else{                    
                    //if($request->control <> 'S' ){                   
                        switch($request->mes_id){
                            case '1':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_01;
                                                    $data[$i][14]=$regproganual->mesc_01;
                                                    $data[$i][15]=$regproganual->mes_p01;
                                                    $data[$i][16]=$regproganual->mes_s01;

                                                    $data[$i][17]=$regproganual->acump_01; 
                                                    $data[$i][18]=$regproganual->acumc_01; 
                                                    $data[$i][19]=$regproganual->acum_p01; 
                                                    $data[$i][20]=$regproganual->smf_01; 
                                                    //$data[$i][21]=$regproganual->obs_01; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01
                                                                  );       
                                                    //Array multidimencional
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_01;
                                                    $data[$i][14]=$regproganual->mesc_01;
                                                    $data[$i][15]=$regproganual->mes_p01;
                                                    $data[$i][16]=$regproganual->mes_s01;

                                                    $data[$i][17]=$regproganual->acump_01; 
                                                    $data[$i][18]=$regproganual->acumc_01; 
                                                    $data[$i][19]=$regproganual->acum_p01; 
                                                    $data[$i][20]=$regproganual->smf_01; 
                                                    //$data[$i][21]=$regproganual->obs_01;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 1

                            case '2':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02
                                                                  );       
                                                    //Array multidimencional
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_02;
                                                    $data[$i][14]=$regproganual->mesc_02;
                                                    $data[$i][15]=$regproganual->mes_p02;
                                                    $data[$i][16]=$regproganual->mes_s02;

                                                    $data[$i][17]=$regproganual->acump_02; 
                                                    $data[$i][18]=$regproganual->acumc_02; 
                                                    $data[$i][19]=$regproganual->acum_p02; 
                                                    $data[$i][20]=$regproganual->smf_02; 
                                                    //$data[$i][21]=$regproganual->obs_02; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02
                                                                  );       
                                                    //Array multidimencional
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_02;
                                                    $data[$i][14]=$regproganual->mesc_02;
                                                    $data[$i][15]=$regproganual->mes_p02;
                                                    $data[$i][16]=$regproganual->mes_s02;

                                                    $data[$i][17]=$regproganual->acump_02; 
                                                    $data[$i][18]=$regproganual->acumc_02; 
                                                    $data[$i][19]=$regproganual->acum_p02; 
                                                    $data[$i][20]=$regproganual->smf_02; 
                                                    //$data[$i][21]=$regproganual->obs_02;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 2

                            case '3':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03
                                                                  );       
                                                    //Array multidimencional
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_03;
                                                    $data[$i][14]=$regproganual->mesc_03;
                                                    $data[$i][15]=$regproganual->mes_p03;
                                                    $data[$i][16]=$regproganual->mes_s03;

                                                    $data[$i][17]=$regproganual->acump_03; 
                                                    $data[$i][18]=$regproganual->acumc_03; 
                                                    $data[$i][19]=$regproganual->acum_p03; 
                                                    $data[$i][20]=$regproganual->smf_03; 
                                                    //$data[$i][21]=$regproganual->obs_03; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03
                                                                  );       
                                                    //Array multidimencional
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_03;
                                                    $data[$i][14]=$regproganual->mesc_03;
                                                    $data[$i][15]=$regproganual->mes_p03;
                                                    $data[$i][16]=$regproganual->mes_s03;

                                                    $data[$i][17]=$regproganual->acump_03; 
                                                    $data[$i][18]=$regproganual->acumc_03; 
                                                    $data[$i][19]=$regproganual->acum_p03; 
                                                    $data[$i][20]=$regproganual->smf_03; 
                                                    //$data[$i][21]=$regproganual->obs_03;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 3

                            case '4':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_04;
                                                    $data[$i][14]=$regproganual->mesc_04;
                                                    $data[$i][15]=$regproganual->mes_p04;
                                                    $data[$i][16]=$regproganual->mes_s04;

                                                    $data[$i][17]=$regproganual->acump_04; 
                                                    $data[$i][18]=$regproganual->acumc_04; 
                                                    $data[$i][19]=$regproganual->acum_p04; 
                                                    $data[$i][20]=$regproganual->smf_04; 
                                                    //$data[$i][21]=$regproganual->obs_04; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_04;
                                                    $data[$i][14]=$regproganual->mesc_04;
                                                    $data[$i][15]=$regproganual->mes_p04;
                                                    $data[$i][16]=$regproganual->mes_s04;

                                                    $data[$i][17]=$regproganual->acump_04; 
                                                    $data[$i][18]=$regproganual->acumc_04; 
                                                    $data[$i][19]=$regproganual->acum_p04; 
                                                    $data[$i][20]=$regproganual->smf_04; 
                                                    //$data[$i][21]=$regproganual->obs_04;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 4

                            case '5':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_05;
                                                    $data[$i][14]=$regproganual->mesc_05;
                                                    $data[$i][15]=$regproganual->mes_p05;
                                                    $data[$i][16]=$regproganual->mes_s05;

                                                    $data[$i][17]=$regproganual->acump_05; 
                                                    $data[$i][18]=$regproganual->acumc_05; 
                                                    $data[$i][19]=$regproganual->acum_p05; 
                                                    $data[$i][20]=$regproganual->smf_05; 
                                                    //$data[$i][21]=$regproganual->obs_05; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_05;
                                                    $data[$i][14]=$regproganual->mesc_05;
                                                    $data[$i][15]=$regproganual->mes_p05;
                                                    $data[$i][16]=$regproganual->mes_s05;

                                                    $data[$i][17]=$regproganual->acump_05; 
                                                    $data[$i][18]=$regproganual->acumc_05; 
                                                    $data[$i][19]=$regproganual->acum_p05; 
                                                    $data[$i][20]=$regproganual->smf_05; 
                                                    //$data[$i][21]=$regproganual->obs_05;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 5

                            case '6':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_06;
                                                    $data[$i][14]=$regproganual->mesc_06;
                                                    $data[$i][15]=$regproganual->mes_p06;
                                                    $data[$i][16]=$regproganual->mes_s06;

                                                    $data[$i][17]=$regproganual->acump_06; 
                                                    $data[$i][18]=$regproganual->acumc_06; 
                                                    $data[$i][19]=$regproganual->acum_p06; 
                                                    $data[$i][20]=$regproganual->smf_06; 
                                                    //$data[$i][21]=$regproganual->obs_06; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_06;
                                                    $data[$i][14]=$regproganual->mesc_06;
                                                    $data[$i][15]=$regproganual->mes_p06;
                                                    $data[$i][16]=$regproganual->mes_s06;

                                                    $data[$i][17]=$regproganual->acump_06; 
                                                    $data[$i][18]=$regproganual->acumc_06; 
                                                    $data[$i][19]=$regproganual->acum_p06; 
                                                    $data[$i][20]=$regproganual->smf_06; 
                                                    //$data[$i][21]=$regproganual->obs_06;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 6

                            case '7':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_07;
                                                    $data[$i][14]=$regproganual->mesc_07;
                                                    $data[$i][15]=$regproganual->mes_p07;
                                                    $data[$i][16]=$regproganual->mes_s07;

                                                    $data[$i][17]=$regproganual->acump_07; 
                                                    $data[$i][18]=$regproganual->acumc_07; 
                                                    $data[$i][19]=$regproganual->acum_p07; 
                                                    $data[$i][20]=$regproganual->smf_07; 
                                                    //$data[$i][21]=$regproganual->obs_07; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_07;
                                                    $data[$i][14]=$regproganual->mesc_07;
                                                    $data[$i][15]=$regproganual->mes_p07;
                                                    $data[$i][16]=$regproganual->mes_s07;

                                                    $data[$i][17]=$regproganual->acump_07; 
                                                    $data[$i][18]=$regproganual->acumc_07; 
                                                    $data[$i][19]=$regproganual->acum_p07; 
                                                    $data[$i][20]=$regproganual->smf_07; 
                                                    //$data[$i][21]=$regproganual->obs_07;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 7

                            case '8':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                           'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_08")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                                   $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                                   $regproganual->obs_08
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_08;
                                                    $data[$i][14]=$regproganual->mesc_08;
                                                    $data[$i][15]=$regproganual->mes_p08;
                                                    $data[$i][16]=$regproganual->mes_s08;

                                                    $data[$i][17]=$regproganual->acump_08; 
                                                    $data[$i][18]=$regproganual->acumc_08; 
                                                    $data[$i][19]=$regproganual->acum_p08; 
                                                    $data[$i][20]=$regproganual->smf_08; 
                                                    //$data[$i][21]=$regproganual->obs_08; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                           'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_08")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                                   $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                                   $regproganual->obs_08
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_08;
                                                    $data[$i][14]=$regproganual->mesc_08;
                                                    $data[$i][15]=$regproganual->mes_p08;
                                                    $data[$i][16]=$regproganual->mes_s08;

                                                    $data[$i][17]=$regproganual->acump_08; 
                                                    $data[$i][18]=$regproganual->acumc_08; 
                                                    $data[$i][19]=$regproganual->acum_p08; 
                                                    $data[$i][20]=$regproganual->smf_08; 
                                                    //$data[$i][21]=$regproganual->obs_08;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 8

                            case '9':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                           'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_09")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                                   $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                                   $regproganual->obs_09
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_09;
                                                    $data[$i][14]=$regproganual->mesc_09;
                                                    $data[$i][15]=$regproganual->mes_p09;
                                                    $data[$i][16]=$regproganual->mes_s09;

                                                    $data[$i][17]=$regproganual->acump_09; 
                                                    $data[$i][18]=$regproganual->acumc_09; 
                                                    $data[$i][19]=$regproganual->acum_p09; 
                                                    $data[$i][20]=$regproganual->smf_09; 
                                                    //$data[$i][21]=$regproganual->obs_09; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                           'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_09")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                                   $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                                   $regproganual->obs_09
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_09;
                                                    $data[$i][14]=$regproganual->mesc_09;
                                                    $data[$i][15]=$regproganual->mes_p09;
                                                    $data[$i][16]=$regproganual->mes_s09;

                                                    $data[$i][17]=$regproganual->acump_09; 
                                                    $data[$i][18]=$regproganual->acumc_09; 
                                                    $data[$i][19]=$regproganual->acum_p09; 
                                                    $data[$i][20]=$regproganual->smf_09; 
                                                    //$data[$i][21]=$regproganual->obs_09;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 9

                            case '10':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                           'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_10")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                                   $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                                   $regproganual->obs_10
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_10;
                                                    $data[$i][14]=$regproganual->mesc_10;
                                                    $data[$i][15]=$regproganual->mes_p10;
                                                    $data[$i][16]=$regproganual->mes_s10;

                                                    $data[$i][17]=$regproganual->acump_10; 
                                                    $data[$i][18]=$regproganual->acumc_10; 
                                                    $data[$i][19]=$regproganual->acum_p10; 
                                                    $data[$i][20]=$regproganual->smf_10; 
                                                    //$data[$i][21]=$regproganual->obs_10; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                           'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S10 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_10")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                                   $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                                   $regproganual->obs_10
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_10;
                                                    $data[$i][14]=$regproganual->mesc_10;
                                                    $data[$i][15]=$regproganual->mes_p10;
                                                    $data[$i][16]=$regproganual->mes_s10;

                                                    $data[$i][17]=$regproganual->acump_10; 
                                                    $data[$i][18]=$regproganual->acumc_10; 
                                                    $data[$i][19]=$regproganual->acum_p10; 
                                                    $data[$i][20]=$regproganual->smf_10; 
                                                    //$data[$i][21]=$regproganual->obs_10;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 10

                            case '11':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_11',  'SIEVAD_CAT_COLORES_11.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_11')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_11' ,'SIEVAD_DPA.MESC_11' ,'SIEVAD_DPA.MES_P11' ,'SIEVAD_CAT_COLORES_11.COLOR_COLOR AS MES_S11', 
                                                           'SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.OBS_11'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S11
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_11")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_11,   $regproganual->mesc_11,  $regproganual->mes_p11, $regproganual->mes_s11,  
                                                                   $regproganual->acump_11,  $regproganual->acumc_11, $regproganual->acum_p11,$regproganual->smf_11,
                                                                   $regproganual->obs_11
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_11;
                                                    $data[$i][14]=$regproganual->mesc_11;
                                                    $data[$i][15]=$regproganual->mes_p11;
                                                    $data[$i][16]=$regproganual->mes_s11;

                                                    $data[$i][17]=$regproganual->acump_11; 
                                                    $data[$i][18]=$regproganual->acumc_11; 
                                                    $data[$i][19]=$regproganual->acum_p11; 
                                                    $data[$i][20]=$regproganual->smf_11; 
                                                    //$data[$i][21]=$regproganual->obs_11; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_11',  'SIEVAD_CAT_COLORES_11.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_11')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_11' ,'SIEVAD_DPA.MESC_11' ,'SIEVAD_DPA.MES_P11' ,'SIEVAD_CAT_COLORES_11.COLOR_COLOR AS MES_S11', 
                                                           'SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.OBS_11'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S11 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_11")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_11,   $regproganual->mesc_11,  $regproganual->mes_p11, $regproganual->mes_s11,  
                                                                   $regproganual->acump_11,  $regproganual->acumc_11, $regproganual->acum_p11,$regproganual->smf_11,
                                                                   $regproganual->obs_11
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_11;
                                                    $data[$i][14]=$regproganual->mesc_11;
                                                    $data[$i][15]=$regproganual->mes_p11;
                                                    $data[$i][16]=$regproganual->mes_s11;

                                                    $data[$i][17]=$regproganual->acump_11; 
                                                    $data[$i][18]=$regproganual->acumc_11; 
                                                    $data[$i][19]=$regproganual->acum_p11; 
                                                    $data[$i][20]=$regproganual->smf_11; 
                                                    //$data[$i][21]=$regproganual->obs_11;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 11

                            case '12':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_12',  'SIEVAD_CAT_COLORES_12.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_12')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_12' ,'SIEVAD_DPA.MESC_12' ,'SIEVAD_DPA.MES_P12' ,'SIEVAD_CAT_COLORES_12.COLOR_COLOR AS MES_S12', 
                                                           'SIEVAD_DPA.ACUMP_12','SIEVAD_DPA.ACUMC_12','SIEVAD_DPA.ACUM_P12','SIEVAD_DPA.OBS_12'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S12
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_12")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_12,   $regproganual->mesc_12,  $regproganual->mes_p12, $regproganual->mes_s12,  
                                                                   $regproganual->acump_12,  $regproganual->acumc_12, $regproganual->acum_p12,$regproganual->smf_12,
                                                                   $regproganual->obs_12
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_12;
                                                    $data[$i][14]=$regproganual->mesc_12;
                                                    $data[$i][15]=$regproganual->mes_p12;
                                                    $data[$i][16]=$regproganual->mes_s12;

                                                    $data[$i][17]=$regproganual->acump_12; 
                                                    $data[$i][18]=$regproganual->acumc_12; 
                                                    $data[$i][19]=$regproganual->acum_p12; 
                                                    $data[$i][20]=$regproganual->smf_12; 
                                                    //$data[$i][21]=$regproganual->obs_12; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_12',  'SIEVAD_CAT_COLORES_12.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_12')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_12' ,'SIEVAD_DPA.MESC_12' ,'SIEVAD_DPA.MES_P12' ,'SIEVAD_CAT_COLORES_12.COLOR_COLOR AS MES_S12', 
                                                           'SIEVAD_DPA.ACUMP_12','SIEVAD_DPA.ACUMC_12','SIEVAD_DPA.ACUM_P12','SIEVAD_DPA.OBS_12'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S12
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_12")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_12,   $regproganual->mesc_12,  $regproganual->mes_p12, $regproganual->mes_s12,  
                                                                   $regproganual->acump_12,  $regproganual->acumc_12, $regproganual->acum_p12,$regproganual->smf_12,
                                                                   $regproganual->obs_12
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->actividad_desc;  
                                                    $data[$i][8] =$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][9] =$regproganual->totp_02;
                                                    $data[$i][10]=$regproganual->totc_02;
                                                    $data[$i][11]=$regproganual->tot_p01; 
                                                    $data[$i][12]=$regproganual->color_color; 

                                                    $data[$i][13]=$regproganual->mesp_12;
                                                    $data[$i][14]=$regproganual->mesc_12;
                                                    $data[$i][15]=$regproganual->mes_p12;
                                                    $data[$i][16]=$regproganual->mes_s12;

                                                    $data[$i][17]=$regproganual->acump_12; 
                                                    $data[$i][18]=$regproganual->acumc_12; 
                                                    $data[$i][19]=$regproganual->acum_p12; 
                                                    $data[$i][20]=$regproganual->smf_12; 
                                                    //$data[$i][21]=$regproganual->obs_12;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                            break;         // case 12                                                                                                                                                                                                                                                                        
                        }   //swith
                    //}     //if($request->control <> 'S' ){   
                }           //if($request->control == 'S' ){   

                /************ Bitacora inicia *************************************/ 
                setlocale(LC_TIME, "spanish");        
                $xip          = session()->get('ip');
                $xperiodo_id  = (int)date('Y');
                $xprograma_id = 1;
                $xmes_id      = (int)date('m');
                $xproceso_id  =         3;
                $xfuncion_id  =      3001;
                $xtrx_id      =         2;    //Reportes        
                $id           =         0;
                $regbitacora = regBitacoraModel::select('PERIODO_ID', 'PROGRAMA_ID', 'MES_ID', 'PROCESO_ID', 'FUNCION_ID', 'TRX_ID', 'FOLIO', 'NO_VECES', 'FECHA_REG', 'IP', 'LOGIN', 'FECHA_M', 'IP_M', 'LOGIN_M')
                               ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                        'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO'      => $id])
                               ->get();
                if($regbitacora->count() <= 0){              // Alta
                        $nuevoregBitacora = new regBitacoraModel();              
                        $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                        $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                        $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                        $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                        $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                        $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                        $nuevoregBitacora->FOLIO      = $id;             // Folio    
                        $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                        $nuevoregBitacora->IP         = $ip;             // IP
                        $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                        $nuevoregBitacora->save();
                        if($nuevoregBitacora->save() == true)
                            toastr()->success('Trx de reporte Excel registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                        else
                            toastr()->error('Error de trx de reporte Excel. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                }else{                   
                    //*********** Obtine el no. de veces *****************************
                    $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id, 'PROGRAMA_ID' => $xprograma_id, 
                                                      'MES_ID' => $xmes_id, 'PROCESO_ID' => $xproceso_id, 
                                                      'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id,'FOLIO' => $id])
                                 ->max('NO_VECES');
                    $xno_veces = $xno_veces+1;                        
                    //*********** Termina de obtener el no de veces *****************************         
                    $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id,
                                            'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id,
                                            'FOLIO'      => $id])
                                   ->update([
                                             'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                             'IP_M'     => $regbitacora->IP       = $ip,
                                             'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                             'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]); 
                    toastr()->success('Trx de reporte Excel actualizada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                }   /************ Bitacora termina *************************************/         
                
                //*********** Genera reporte a formato excel con parámetros ***********/
                //return Excel::download(new ExcelExportMensualcon_v2($request->periodo_id,$request->mes_id,$request->depen_id,$request->taccion_id,$data,$i),'Reporte_Mensual_Concentrado'.date('d-m-Y').'.xlsx');
                return Excel::download(new ExcelExportMensualdet_v2($request->periodo_id,$request->mes_id,$request->depen_id,$request->taccion_id,$request->control,$data,$i),'Reporte_Mensual_Detallado'.date('d-m-Y').'.xlsx');
                break;

            case 'D':    //Formato PDF detallado
                if($request->taccion_id == '0' ){   
                    $i =0;
                    foreach($op as $key => $val) {
                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                       ->select( 
                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2', 'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                           'SIEVAD_EPA.FOLIO',     'SIEVAD_DPA.PARTIDA',   'SIEVAD_DPA.ACTIVIDAD_DESC',
                                           'SIEVAD_DPA.UMED_ID',   'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                           'SIEVAD_EPA.EPPROY_ID','SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',
                                           'SIEVAD_DPA.MESP_01','SIEVAD_DPA.MESP_02','SIEVAD_DPA.MESP_03','SIEVAD_DPA.MESP_04','SIEVAD_DPA.MESP_05','SIEVAD_DPA.MESP_06',
                                           'SIEVAD_DPA.MESP_07','SIEVAD_DPA.MESP_08','SIEVAD_DPA.MESP_09','SIEVAD_DPA.MESP_10','SIEVAD_DPA.MESP_11','SIEVAD_DPA.MESP_12',

                                           'SIEVAD_DPA.MESC_01','SIEVAD_DPA.MESC_02','SIEVAD_DPA.MESC_03','SIEVAD_DPA.MESC_04','SIEVAD_DPA.MESC_05','SIEVAD_DPA.MESC_06',
                                           'SIEVAD_DPA.MESC_07','SIEVAD_DPA.MESC_08','SIEVAD_DPA.MESC_09','SIEVAD_DPA.MESC_10','SIEVAD_DPA.MESC_11','SIEVAD_DPA.MESC_12',

                                           'SIEVAD_DPA.MES_P01','SIEVAD_DPA.MES_P02','SIEVAD_DPA.MES_P03','SIEVAD_DPA.MES_P04','SIEVAD_DPA.MES_P05','SIEVAD_DPA.MES_P06',
                                           'SIEVAD_DPA.MES_P07','SIEVAD_DPA.MES_P08','SIEVAD_DPA.MES_P09','SIEVAD_DPA.MES_P10','SIEVAD_DPA.MES_P11','SIEVAD_DPA.MES_P12',

                                           'SIEVAD_DPA.SEMAF_01','SIEVAD_DPA.SEMAF_02','SIEVAD_DPA.SEMAF_03','SIEVAD_DPA.SEMAF_04','SIEVAD_DPA.SEMAF_05','SIEVAD_DPA.SEMAF_06', 
                                           'SIEVAD_DPA.SEMAF_07','SIEVAD_DPA.SEMAF_08','SIEVAD_DPA.SEMAF_08','SIEVAD_DPA.SEMAF_10','SIEVAD_DPA.SEMAF_11','SIEVAD_DPA.SEMAF_12', 

                                           'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMP_04',

                                           'SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIMC_04',

                                           'SIEVAD_DPA.TSEMP_01','SIEVAD_DPA.TSEMP_02','SIEVAD_DPA.TSEMC_01','SIEVAD_DPA.TSEMC_02',

                                           'SIEVAD_DPA.TOTP_01','SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_01','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01', 

                                           'SIEVAD_DPA.SEMAFA_01',

                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMP_06',
                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMP_12',

                                           'SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUMC_06',
                                           'SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUMC_12',                                           

                                           'SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.ACUM_P06',
                                           'SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.ACUM_P12',

                                           'SIEVAD_DPA.ACUM_S01','SIEVAD_DPA.ACUM_S02','SIEVAD_DPA.ACUM_S03','SIEVAD_DPA.ACUM_S04','SIEVAD_DPA.ACUM_S05','SIEVAD_DPA.ACUM_S06',
                                           'SIEVAD_DPA.ACUM_S07','SIEVAD_DPA.ACUM_S08','SIEVAD_DPA.ACUM_S09','SIEVAD_DPA.ACUM_S10','SIEVAD_DPA.ACUM_S11','SIEVAD_DPA.ACUM_S12',

                                           'SIEVAD_DPA.OBS_01','SIEVAD_DPA.OBS_02','SIEVAD_DPA.OBS_03','SIEVAD_DPA.OBS_04','SIEVAD_DPA.OBS_05','SIEVAD_DPA.OBS_06',
                                           'SIEVAD_DPA.OBS_07','SIEVAD_DPA.OBS_08','SIEVAD_DPA.OBS_09','SIEVAD_DPA.OBS_10','SIEVAD_DPA.OBS_11','SIEVAD_DPA.OBS_12' 
                                            )
 
                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                               ->get();
                        if($regprogeanual->count() > 0){
                            foreach($regprogeanual as $regproganual){
                                $i++;
                                $dataPoints[$i]=array(
                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                   $regproganual->umed_id   ,$regproganual->umed_desc,
                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                   $regproganual->mesp_01,   $regproganual->mesp_02,  $regproganual->mesp_03,
                                                   $regproganual->mesp_04,   $regproganual->mesp_05,  $regproganual->mesp_06,
                                                   $regproganual->mesp_07,   $regproganual->mesp_08,  $regproganual->mesp_09,
                                                   $regproganual->mesp_10,   $regproganual->mesp_11,  $regproganual->mesp_12,
                                                   $regproganual->mesc_01,   $regproganual->mesc_02,  $regproganual->mesc_03,
                                                   $regproganual->mesc_04,   $regproganual->mesc_05,  $regproganual->mesc_06,
                                                   $regproganual->mesc_07,   $regproganual->mesc_08,  $regproganual->mesc_09,
                                                   $regproganual->mesc_10,   $regproganual->mesc_11,  $regproganual->mesc_12,
                                                   $regproganual->mes_p01,   $regproganual->mes_p02,  $regproganual->mes_p03,
                                                   $regproganual->mes_p04,   $regproganual->mes_p05,  $regproganual->mes_p06,
                                                   $regproganual->mes_p07,   $regproganual->mes_p08,  $regproganual->mes_p09,
                                                   $regproganual->mes_p10,   $regproganual->mes_p11,  $regproganual->mes_p12,
                                                   $regproganual->semaf_01,  $regproganual->semaf_02, $regproganual->semaf_03,
                                                   $regproganual->semaf_04,  $regproganual->semaf_05, $regproganual->semaf_06,
                                                   $regproganual->semaf_07,  $regproganual->semaf_08, $regproganual->semaf_09,
                                                   $regproganual->semaf_10,  $regproganual->semaf_11, $regproganual->semaf_12,
                                                   $regproganual->trimp_01,  $regproganual->trimp_02,
                                                   $regproganual->trimp_03,  $regproganual->trimp_04,
                                                   $regproganual->trimc_01,  $regproganual->trimc_02,
                                                   $regproganual->trimc_03,  $regproganual->trimc_04,                                                   
                                                   $regproganual->tsemp_01,  $regproganual->tsemp_02,
                                                   $regproganual->tsemc_01,  $regproganual->tsemc_02,
                                                   $regproganual->totp_01,   $regproganual->totp_02,
                                                   $regproganual->totc_01,   $regproganual->totc_02,                                                   
                                                   $regproganual->tot_p01,   $regproganual->semafa_01,
                                                   $regproganual->acump_01,  $regproganual->acump_02,$regproganual->acump_03,
                                                   $regproganual->acump_04,  $regproganual->acump_05,$regproganual->acump_06,
                                                   $regproganual->acump_07,  $regproganual->acump_08,$regproganual->acump_09,
                                                   $regproganual->acump_10,  $regproganual->acump_11,$regproganual->acump_12,
                                                   $regproganual->acumc_01,  $regproganual->acumc_02,$regproganual->acumc_03,
                                                   $regproganual->acumc_04,  $regproganual->acumc_05,$regproganual->acumc_06,
                                                   $regproganual->acumc_07,  $regproganual->acumc_08,$regproganual->acumc_09,
                                                   $regproganual->acumc_10,  $regproganual->acumc_11,$regproganual->acumc_12,
                                                   $regproganual->acum_p01,  $regproganual->acum_p02,$regproganual->acum_p03,
                                                   $regproganual->acum_p04,  $regproganual->acum_p05,$regproganual->acum_p06,
                                                   $regproganual->acum_p07,  $regproganual->acum_p08,$regproganual->acum_p09,
                                                   $regproganual->acum_p10,  $regproganual->acum_p11,$regproganual->acum_p12,                                                   
                                                   $regproganual->acum_s01,  $regproganual->acum_s02,$regproganual->acum_s03,
                                                   $regproganual->acum_s04,  $regproganual->acum_s05,$regproganual->acum_s06,
                                                   $regproganual->acum_s07,  $regproganual->acum_s08,$regproganual->acum_s09,
                                                   $regproganual->acum_s10,  $regproganual->acum_s11,$regproganual->acum_s12, 
                                                   $regproganual->obs_01,    $regproganual->obs_02  ,$regproganual->obs_03,
                                                   $regproganual->obs_04,    $regproganual->obs_05  ,$regproganual->obs_06,
                                                   $regproganual->obs_07,    $regproganual->obs_08  ,$regproganual->obs_09,
                                                   $regproganual->obs_10,    $regproganual->obs_11  ,$regproganual->obs_12                                                   
                                                  );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regproganual->periodo_id;
                                    $data[$i][1] =$regproganual->depen_id2;
                                    $data[$i][2] =$regproganual->depen_desc;
                                    $data[$i][3] =$regproganual->folio;
                                    $data[$i][4] =$regproganual->partida;
                                    $data[$i][5] =$regproganual->actividad_desc;                                    
                                    $data[$i][6] =$regproganual->umed_id;
                                    $data[$i][7] =$regproganual->umed_desc; 
                                    $data[$i][8] =$regproganual->epproy_id;
                                    $data[$i][9] =$regproganual->epproy_desc;                                                                         

                                    $data[$i][10]=$regproganual->mesp_01;
                                    $data[$i][11]=$regproganual->mesp_02;
                                    $data[$i][12]=$regproganual->mesp_03;
                                    $data[$i][13]=$regproganual->mesp_04;
                                    $data[$i][14]=$regproganual->mesp_05;
                                    $data[$i][15]=$regproganual->mesp_06;
                                    $data[$i][16]=$regproganual->mesp_07;
                                    $data[$i][17]=$regproganual->mesp_08;
                                    $data[$i][18]=$regproganual->mesp_09;
                                    $data[$i][19]=$regproganual->mesp_10;
                                    $data[$i][20]=$regproganual->mesp_11;
                                    $data[$i][21]=$regproganual->mesp_12; 

                                    $data[$i][22]=$regproganual->mesc_01;
                                    $data[$i][23]=$regproganual->mesc_02;
                                    $data[$i][24]=$regproganual->mesc_03;
                                    $data[$i][25]=$regproganual->mesc_04;
                                    $data[$i][26]=$regproganual->mesc_05;
                                    $data[$i][27]=$regproganual->mesc_06;
                                    $data[$i][28]=$regproganual->mesc_07;
                                    $data[$i][29]=$regproganual->mesc_08;
                                    $data[$i][30]=$regproganual->mesc_09;
                                    $data[$i][31]=$regproganual->mesc_10;
                                    $data[$i][32]=$regproganual->mesc_11;
                                    $data[$i][33]=$regproganual->mesc_12;

                                    $data[$i][34]=$regproganual->mes_p01;
                                    $data[$i][35]=$regproganual->mes_p02;
                                    $data[$i][36]=$regproganual->mes_p03;
                                    $data[$i][37]=$regproganual->mes_p04;
                                    $data[$i][38]=$regproganual->mes_p05;
                                    $data[$i][39]=$regproganual->mes_p06;
                                    $data[$i][40]=$regproganual->mes_p07;
                                    $data[$i][41]=$regproganual->mes_p08;
                                    $data[$i][42]=$regproganual->mes_p09;
                                    $data[$i][43]=$regproganual->mes_p10;
                                    $data[$i][44]=$regproganual->mes_p11;
                                    $data[$i][45]=$regproganual->mes_p12;   

                                    $data[$i][46]=$regproganual->semaf_01;
                                    $data[$i][47]=$regproganual->semaf_02;
                                    $data[$i][48]=$regproganual->semaf_03;
                                    $data[$i][49]=$regproganual->semaf_04;
                                    $data[$i][50]=$regproganual->semaf_05;
                                    $data[$i][51]=$regproganual->semaf_06;
                                    $data[$i][52]=$regproganual->semaf_07;
                                    $data[$i][53]=$regproganual->semaf_08;
                                    $data[$i][54]=$regproganual->semaf_09;
                                    $data[$i][55]=$regproganual->semaf_10;
                                    $data[$i][56]=$regproganual->semaf_11;
                                    $data[$i][57]=$regproganual->semaf_12;

                                    $data[$i][58]=$regproganual->trimp_01;
                                    $data[$i][59]=$regproganual->trimp_02;
                                    $data[$i][60]=$regproganual->trimp_03;
                                    $data[$i][61]=$regproganual->trimp_04;
                                    $data[$i][62]=$regproganual->trimc_01;
                                    $data[$i][63]=$regproganual->trimc_02;
                                    $data[$i][64]=$regproganual->trimc_03;
                                    $data[$i][65]=$regproganual->trimc_04;
                                    $data[$i][66]=$regproganual->tsemp_01;
                                    $data[$i][67]=$regproganual->tsemp_02;
                                    $data[$i][68]=$regproganual->tsemc_01;
                                    $data[$i][69]=$regproganual->tsemc_02;

                                    $data[$i][70]=$regproganual->totp_01;
                                    $data[$i][71]=$regproganual->totp_02;
                                    $data[$i][72]=$regproganual->totc_01;
                                    $data[$i][73]=$regproganual->totc_02;                                    

                                    $data[$i][74]=$regproganual->tot_p01;
                                    $data[$i][75]=$regproganual->semafa_01; 

                                    $data[$i][76]=$regproganual->acump_01; 
                                    $data[$i][77]=$regproganual->acump_02; 
                                    $data[$i][78]=$regproganual->acump_03; 
                                    $data[$i][79]=$regproganual->acump_04; 
                                    $data[$i][80]=$regproganual->acump_05; 
                                    $data[$i][81]=$regproganual->acump_06; 
                                    $data[$i][82]=$regproganual->acump_07; 
                                    $data[$i][83]=$regproganual->acump_08; 
                                    $data[$i][84]=$regproganual->acump_09; 
                                    $data[$i][85]=$regproganual->acump_10; 
                                    $data[$i][86]=$regproganual->acump_11; 
                                    $data[$i][87]=$regproganual->acump_12; 

                                    $data[$i][88]=$regproganual->acumc_01; 
                                    $data[$i][89]=$regproganual->acumc_02; 
                                    $data[$i][90]=$regproganual->acumc_03; 
                                    $data[$i][91]=$regproganual->acumc_04; 
                                    $data[$i][92]=$regproganual->acumc_05; 
                                    $data[$i][93]=$regproganual->acumc_06; 
                                    $data[$i][94]=$regproganual->acumc_07; 
                                    $data[$i][95]=$regproganual->acumc_08; 
                                    $data[$i][96]=$regproganual->acumc_09; 
                                    $data[$i][97]=$regproganual->acumc_10; 
                                    $data[$i][98]=$regproganual->acumc_11; 
                                    $data[$i][99]=$regproganual->acumc_12;   

                                    $data[$i][100]=$regproganual->acum_p01; 
                                    $data[$i][101]=$regproganual->acum_p02; 
                                    $data[$i][102]=$regproganual->acum_p03; 
                                    $data[$i][103]=$regproganual->acum_p04; 
                                    $data[$i][104]=$regproganual->acum_p05; 
                                    $data[$i][105]=$regproganual->acum_p06; 
                                    $data[$i][105]=$regproganual->acum_p07; 
                                    $data[$i][107]=$regproganual->acum_p08; 
                                    $data[$i][108]=$regproganual->acum_p09; 
                                    $data[$i][109]=$regproganual->acum_p10; 
                                    $data[$i][110]=$regproganual->acum_p11; 
                                    $data[$i][111]=$regproganual->acum_p12;                                     

                                    $data[$i][112]=$regproganual->acum_s01; 
                                    $data[$i][113]=$regproganual->acum_s02; 
                                    $data[$i][114]=$regproganual->acum_s03; 
                                    $data[$i][115]=$regproganual->acum_s04; 
                                    $data[$i][116]=$regproganual->acum_s05; 
                                    $data[$i][117]=$regproganual->acum_s06; 
                                    $data[$i][118]=$regproganual->acum_s07; 
                                    $data[$i][119]=$regproganual->acum_s08; 
                                    $data[$i][120]=$regproganual->acum_s09; 
                                    $data[$i][121]=$regproganual->acum_s10; 
                                    $data[$i][122]=$regproganual->acum_s11; 
                                    $data[$i][123]=$regproganual->acum_s12; 

                                    $data[$i][124]=$regproganual->obs_01; 
                                    $data[$i][125]=$regproganual->obs_02; 
                                    $data[$i][126]=$regproganual->obs_03; 
                                    $data[$i][127]=$regproganual->obs_04; 
                                    $data[$i][128]=$regproganual->obs_05; 
                                    $data[$i][129]=$regproganual->obs_06; 
                                    $data[$i][130]=$regproganual->obs_07; 
                                    $data[$i][131]=$regproganual->obs_08; 
                                    $data[$i][132]=$regproganual->obs_09; 
                                    $data[$i][133]=$regproganual->obs_10; 
                                    $data[$i][134]=$regproganual->obs_11; 
                                    $data[$i][135]=$regproganual->obs_12;                                     
                            }  // foreach($regprogeanual as $regproganual)
                        }      // if($regprogeanual->count() > 0){
                    }          // foreach 
                }else{
                    if($request->taccion_id <> '0' ){   
                        //*********** 3 ********************
                        $i =0;
                        foreach($op as $key => $val) {
                            ///print "$key = $val <br>";
                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                       ->select( 
                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2', 'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                           'SIEVAD_EPA.FOLIO',     'SIEVAD_DPA.PARTIDA',   'SIEVAD_DPA.ACTIVIDAD_DESC',
                                           'SIEVAD_DPA.UMED_ID',   'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                           'SIEVAD_EPA.EPPROY_ID','SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',
                                           'SIEVAD_DPA.MESP_01','SIEVAD_DPA.MESP_02','SIEVAD_DPA.MESP_03','SIEVAD_DPA.MESP_04','SIEVAD_DPA.MESP_05','SIEVAD_DPA.MESP_06',
                                           'SIEVAD_DPA.MESP_07','SIEVAD_DPA.MESP_08','SIEVAD_DPA.MESP_09','SIEVAD_DPA.MESP_10','SIEVAD_DPA.MESP_11','SIEVAD_DPA.MESP_12',

                                           'SIEVAD_DPA.MESC_01','SIEVAD_DPA.MESC_02','SIEVAD_DPA.MESC_03','SIEVAD_DPA.MESC_04','SIEVAD_DPA.MESC_05','SIEVAD_DPA.MESC_06',
                                           'SIEVAD_DPA.MESC_07','SIEVAD_DPA.MESC_08','SIEVAD_DPA.MESC_09','SIEVAD_DPA.MESC_10','SIEVAD_DPA.MESC_11','SIEVAD_DPA.MESC_12',

                                           'SIEVAD_DPA.MES_P01','SIEVAD_DPA.MES_P02','SIEVAD_DPA.MES_P03','SIEVAD_DPA.MES_P04','SIEVAD_DPA.MES_P05','SIEVAD_DPA.MES_P06',
                                           'SIEVAD_DPA.MES_P07','SIEVAD_DPA.MES_P08','SIEVAD_DPA.MES_P09','SIEVAD_DPA.MES_P10','SIEVAD_DPA.MES_P11','SIEVAD_DPA.MES_P12',

                                           'SIEVAD_DPA.SEMAF_01','SIEVAD_DPA.SEMAF_02','SIEVAD_DPA.SEMAF_03','SIEVAD_DPA.SEMAF_04','SIEVAD_DPA.SEMAF_05','SIEVAD_DPA.SEMAF_06', 
                                           'SIEVAD_DPA.SEMAF_07','SIEVAD_DPA.SEMAF_08','SIEVAD_DPA.SEMAF_08','SIEVAD_DPA.SEMAF_10','SIEVAD_DPA.SEMAF_11','SIEVAD_DPA.SEMAF_12', 

                                           'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMP_04',

                                           'SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIMC_04',

                                           'SIEVAD_DPA.TSEMP_01','SIEVAD_DPA.TSEMP_02','SIEVAD_DPA.TSEMC_01','SIEVAD_DPA.TSEMC_02',

                                           'SIEVAD_DPA.TOTP_01','SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_01','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01', 

                                           'SIEVAD_DPA.SEMAFA_01',

                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMP_06',
                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMP_12',

                                           'SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUMC_06',
                                           'SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUMC_12',                                           

                                           'SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.ACUM_P06',
                                           'SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.ACUM_P12',

                                           'SIEVAD_DPA.ACUM_S01','SIEVAD_DPA.ACUM_S02','SIEVAD_DPA.ACUM_S03','SIEVAD_DPA.ACUM_S04','SIEVAD_DPA.ACUM_S05','SIEVAD_DPA.ACUM_S06',
                                           'SIEVAD_DPA.ACUM_S07','SIEVAD_DPA.ACUM_S08','SIEVAD_DPA.ACUM_S09','SIEVAD_DPA.ACUM_S10','SIEVAD_DPA.ACUM_S11','SIEVAD_DPA.ACUM_S12',

                                           'SIEVAD_DPA.OBS_01','SIEVAD_DPA.OBS_02','SIEVAD_DPA.OBS_03','SIEVAD_DPA.OBS_04','SIEVAD_DPA.OBS_05','SIEVAD_DPA.OBS_06',
                                           'SIEVAD_DPA.OBS_07','SIEVAD_DPA.OBS_08','SIEVAD_DPA.OBS_09','SIEVAD_DPA.OBS_10','SIEVAD_DPA.OBS_11','SIEVAD_DPA.OBS_12' 
                                              )
 
                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                            ->get();

                            if($regprogeanual->count() > 0){
                                foreach($regprogeanual as $regproganual){
                                    $i++;
                                    $dataPoints[$i]=array(
                                                       $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                       $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                       $regproganual->umed_id   ,$regproganual->umed_desc,
                                                       $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                       $regproganual->mesp_01,   $regproganual->mesp_02,  $regproganual->mesp_03,
                                                       $regproganual->mesp_04,   $regproganual->mesp_05,  $regproganual->mesp_06,
                                                       $regproganual->mesp_07,   $regproganual->mesp_08,  $regproganual->mesp_09,
                                                       $regproganual->mesp_10,   $regproganual->mesp_11,  $regproganual->mesp_12,
                                                       $regproganual->mesc_01,   $regproganual->mesc_02,  $regproganual->mesc_03,
                                                       $regproganual->mesc_04,   $regproganual->mesc_05,  $regproganual->mesc_06,
                                                       $regproganual->mesc_07,   $regproganual->mesc_08,  $regproganual->mesc_09,
                                                       $regproganual->mesc_10,   $regproganual->mesc_11,  $regproganual->mesc_12,
                                                       $regproganual->mes_p01,   $regproganual->mes_p02,  $regproganual->mes_p03,
                                                       $regproganual->mes_p04,   $regproganual->mes_p05,  $regproganual->mes_p06,
                                                       $regproganual->mes_p07,   $regproganual->mes_p08,  $regproganual->mes_p09,
                                                       $regproganual->mes_p10,   $regproganual->mes_p11,  $regproganual->mes_p12,
                                                       $regproganual->semaf_01,  $regproganual->semaf_02, $regproganual->semaf_03,
                                                       $regproganual->semaf_04,  $regproganual->semaf_05, $regproganual->semaf_06,
                                                       $regproganual->semaf_07,  $regproganual->semaf_08, $regproganual->semaf_09,
                                                       $regproganual->semaf_10,  $regproganual->semaf_11, $regproganual->semaf_12,
                                                       $regproganual->trimp_01,  $regproganual->trimp_02,
                                                       $regproganual->trimp_03,  $regproganual->trimp_04,
                                                       $regproganual->trimc_01,  $regproganual->trimc_02,
                                                       $regproganual->trimc_03,  $regproganual->trimc_04,                                                   
                                                       $regproganual->tsemp_01,  $regproganual->tsemp_02,
                                                       $regproganual->tsemc_01,  $regproganual->tsemc_02,
                                                       $regproganual->totp_01,   $regproganual->totp_02,
                                                       $regproganual->totc_01,   $regproganual->totc_02,                                                   
                                                       $regproganual->tot_p01,   $regproganual->semafa_01,
                                                       $regproganual->acump_01,  $regproganual->acump_02,$regproganual->acump_03,
                                                       $regproganual->acump_04,  $regproganual->acump_05,$regproganual->acump_06,
                                                       $regproganual->acump_07,  $regproganual->acump_08,$regproganual->acump_09,
                                                       $regproganual->acump_10,  $regproganual->acump_11,$regproganual->acump_12,
                                                       $regproganual->acumc_01,  $regproganual->acumc_02,$regproganual->acumc_03,
                                                       $regproganual->acumc_04,  $regproganual->acumc_05,$regproganual->acumc_06,
                                                       $regproganual->acumc_07,  $regproganual->acumc_08,$regproganual->acumc_09,
                                                       $regproganual->acumc_10,  $regproganual->acumc_11,$regproganual->acumc_12,
                                                       $regproganual->acum_p01,  $regproganual->acum_p02,$regproganual->acum_p03,
                                                       $regproganual->acum_p04,  $regproganual->acum_p05,$regproganual->acum_p06,
                                                       $regproganual->acum_p07,  $regproganual->acum_p08,$regproganual->acum_p09,
                                                       $regproganual->acum_p10,  $regproganual->acum_p11,$regproganual->acum_p12,                                                   
                                                       $regproganual->acum_s01,  $regproganual->acum_s02,$regproganual->acum_s03,
                                                       $regproganual->acum_s04,  $regproganual->acum_s05,$regproganual->acum_s06,
                                                       $regproganual->acum_s07,  $regproganual->acum_s08,$regproganual->acum_s09,
                                                       $regproganual->acum_s10,  $regproganual->acum_s11,$regproganual->acum_s12, 
                                                       $regproganual->obs_01,    $regproganual->obs_02  ,$regproganual->obs_03,
                                                       $regproganual->obs_04,    $regproganual->obs_05  ,$regproganual->obs_06,
                                                       $regproganual->obs_07,    $regproganual->obs_08  ,$regproganual->obs_09,
                                                       $regproganual->obs_10,    $regproganual->obs_11  ,$regproganual->obs_12                                                   
                                                      );       
                                    //Array multidimencional
                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                    $data[$i][0] =$regproganual->periodo_id;
                                    $data[$i][1] =$regproganual->depen_id2;
                                    $data[$i][2] =$regproganual->depen_desc;
                                    $data[$i][3] =$regproganual->folio;
                                    $data[$i][4] =$regproganual->partida;
                                    $data[$i][5] =$regproganual->actividad_desc;                                    
                                    $data[$i][6] =$regproganual->umed_id;
                                    $data[$i][7] =$regproganual->umed_desc; 
                                    $data[$i][8] =$regproganual->epproy_id;
                                    $data[$i][9] =$regproganual->epproy_desc;                                                                         

                                    $data[$i][10]=$regproganual->mesp_01;
                                    $data[$i][11]=$regproganual->mesp_02;
                                    $data[$i][12]=$regproganual->mesp_03;
                                    $data[$i][13]=$regproganual->mesp_04;
                                    $data[$i][14]=$regproganual->mesp_05;
                                    $data[$i][15]=$regproganual->mesp_06;
                                    $data[$i][16]=$regproganual->mesp_07;
                                    $data[$i][17]=$regproganual->mesp_08;
                                    $data[$i][18]=$regproganual->mesp_09;
                                    $data[$i][19]=$regproganual->mesp_10;
                                    $data[$i][20]=$regproganual->mesp_11;
                                    $data[$i][21]=$regproganual->mesp_12; 

                                    $data[$i][22]=$regproganual->mesc_01;
                                    $data[$i][23]=$regproganual->mesc_02;
                                    $data[$i][24]=$regproganual->mesc_03;
                                    $data[$i][25]=$regproganual->mesc_04;
                                    $data[$i][26]=$regproganual->mesc_05;
                                    $data[$i][27]=$regproganual->mesc_06;
                                    $data[$i][28]=$regproganual->mesc_07;
                                    $data[$i][29]=$regproganual->mesc_08;
                                    $data[$i][30]=$regproganual->mesc_09;
                                    $data[$i][31]=$regproganual->mesc_10;
                                    $data[$i][32]=$regproganual->mesc_11;
                                    $data[$i][33]=$regproganual->mesc_12;

                                    $data[$i][34]=$regproganual->mes_p01;
                                    $data[$i][35]=$regproganual->mes_p02;
                                    $data[$i][36]=$regproganual->mes_p03;
                                    $data[$i][37]=$regproganual->mes_p04;
                                    $data[$i][38]=$regproganual->mes_p05;
                                    $data[$i][39]=$regproganual->mes_p06;
                                    $data[$i][40]=$regproganual->mes_p07;
                                    $data[$i][41]=$regproganual->mes_p08;
                                    $data[$i][42]=$regproganual->mes_p09;
                                    $data[$i][43]=$regproganual->mes_p10;
                                    $data[$i][44]=$regproganual->mes_p11;
                                    $data[$i][45]=$regproganual->mes_p12;   

                                    $data[$i][46]=$regproganual->semaf_01;
                                    $data[$i][47]=$regproganual->semaf_02;
                                    $data[$i][48]=$regproganual->semaf_03;
                                    $data[$i][49]=$regproganual->semaf_04;
                                    $data[$i][50]=$regproganual->semaf_05;
                                    $data[$i][51]=$regproganual->semaf_06;
                                    $data[$i][52]=$regproganual->semaf_07;
                                    $data[$i][53]=$regproganual->semaf_08;
                                    $data[$i][54]=$regproganual->semaf_09;
                                    $data[$i][55]=$regproganual->semaf_10;
                                    $data[$i][56]=$regproganual->semaf_11;
                                    $data[$i][57]=$regproganual->semaf_12;

                                    $data[$i][58]=$regproganual->trimp_01;
                                    $data[$i][59]=$regproganual->trimp_02;
                                    $data[$i][60]=$regproganual->trimp_03;
                                    $data[$i][61]=$regproganual->trimp_04;
                                    $data[$i][62]=$regproganual->trimc_01;
                                    $data[$i][63]=$regproganual->trimc_02;
                                    $data[$i][64]=$regproganual->trimc_03;
                                    $data[$i][65]=$regproganual->trimc_04;
                                    $data[$i][66]=$regproganual->tsemp_01;
                                    $data[$i][67]=$regproganual->tsemp_02;
                                    $data[$i][68]=$regproganual->tsemc_01;
                                    $data[$i][69]=$regproganual->tsemc_02;

                                    $data[$i][70]=$regproganual->totp_01;
                                    $data[$i][71]=$regproganual->totp_02;
                                    $data[$i][72]=$regproganual->totc_01;
                                    $data[$i][73]=$regproganual->totc_02;                                    

                                    $data[$i][74]=$regproganual->tot_p01;
                                    $data[$i][75]=$regproganual->semafa_01; 

                                    $data[$i][76]=$regproganual->acump_01; 
                                    $data[$i][77]=$regproganual->acump_02; 
                                    $data[$i][78]=$regproganual->acump_03; 
                                    $data[$i][79]=$regproganual->acump_04; 
                                    $data[$i][80]=$regproganual->acump_05; 
                                    $data[$i][81]=$regproganual->acump_06; 
                                    $data[$i][82]=$regproganual->acump_07; 
                                    $data[$i][83]=$regproganual->acump_08; 
                                    $data[$i][84]=$regproganual->acump_09; 
                                    $data[$i][85]=$regproganual->acump_10; 
                                    $data[$i][86]=$regproganual->acump_11; 
                                    $data[$i][87]=$regproganual->acump_12; 

                                    $data[$i][88]=$regproganual->acumc_01; 
                                    $data[$i][89]=$regproganual->acumc_02; 
                                    $data[$i][90]=$regproganual->acumc_03; 
                                    $data[$i][91]=$regproganual->acumc_04; 
                                    $data[$i][92]=$regproganual->acumc_05; 
                                    $data[$i][93]=$regproganual->acumc_06; 
                                    $data[$i][94]=$regproganual->acumc_07; 
                                    $data[$i][95]=$regproganual->acumc_08; 
                                    $data[$i][96]=$regproganual->acumc_09; 
                                    $data[$i][97]=$regproganual->acumc_10; 
                                    $data[$i][98]=$regproganual->acumc_11; 
                                    $data[$i][99]=$regproganual->acumc_12;   

                                    $data[$i][100]=$regproganual->acum_p01; 
                                    $data[$i][101]=$regproganual->acum_p02; 
                                    $data[$i][102]=$regproganual->acum_p03; 
                                    $data[$i][103]=$regproganual->acum_p04; 
                                    $data[$i][104]=$regproganual->acum_p05; 
                                    $data[$i][105]=$regproganual->acum_p06; 
                                    $data[$i][105]=$regproganual->acum_p07; 
                                    $data[$i][107]=$regproganual->acum_p08; 
                                    $data[$i][108]=$regproganual->acum_p09; 
                                    $data[$i][109]=$regproganual->acum_p10; 
                                    $data[$i][110]=$regproganual->acum_p11; 
                                    $data[$i][111]=$regproganual->acum_p12;                                     

                                    $data[$i][112]=$regproganual->acum_s01; 
                                    $data[$i][113]=$regproganual->acum_s02; 
                                    $data[$i][114]=$regproganual->acum_s03; 
                                    $data[$i][115]=$regproganual->acum_s04; 
                                    $data[$i][116]=$regproganual->acum_s05; 
                                    $data[$i][117]=$regproganual->acum_s06; 
                                    $data[$i][118]=$regproganual->acum_s07; 
                                    $data[$i][119]=$regproganual->acum_s08; 
                                    $data[$i][120]=$regproganual->acum_s09; 
                                    $data[$i][121]=$regproganual->acum_s10; 
                                    $data[$i][122]=$regproganual->acum_s11; 
                                    $data[$i][123]=$regproganual->acum_s12; 

                                    $data[$i][124]=$regproganual->obs_01; 
                                    $data[$i][125]=$regproganual->obs_02; 
                                    $data[$i][126]=$regproganual->obs_03; 
                                    $data[$i][127]=$regproganual->obs_04; 
                                    $data[$i][128]=$regproganual->obs_05; 
                                    $data[$i][129]=$regproganual->obs_06; 
                                    $data[$i][130]=$regproganual->obs_07; 
                                    $data[$i][131]=$regproganual->obs_08; 
                                    $data[$i][132]=$regproganual->obs_09; 
                                    $data[$i][133]=$regproganual->obs_10; 
                                    $data[$i][134]=$regproganual->obs_11; 
                                    $data[$i][135]=$regproganual->obs_12;                                     
                                }  // foreach($regprogeanual as $regproganual)
                            }      // if($regprogeanual->count() > 0){                            
                        }  // foreach 
                    }      // taccion_id  <> 0
                }          // taccion_id  == 0  
                // Todas las unidades ejecutoras y todos los tipos de proyectoa
                //return back()->withErrors([' Reporte diponible sólo en pantalla y/o excel.']);

                //************** Genera reporte pdf ******************/
                //Parámetro 0 significa que no se impondrá límite de tiempo 
                //(según el manual), el script puede ejecutarse hasta su finalización  
                //- 1 memoria ilimitada
                //set_time_limit(0);
                ini_set("memory_limit",-1);
                ini_set('max_execution_time', 0);
                $control = $request->control;             
                //$pdf = PDF::loadView('sicinar.pdf.reporteMensualconPDF_v2',compact('nombre','usuario','regmeses','periodo_id','mes_id','data','i'));
                $pdf = PDF::loadView('sicinar.pdf.reporteMensualdetPDF_v2',compact('nombre','usuario','regmeses','periodo_id','mes_id','control','data','i'));
                //$options = new Options();
                //$options->set('defaultFont', 'Courier');
                //$pdf->set_option('defaultFont', 'Courier');
                //$pdf->set('defaultFont', 'Courier');
                //$pdf->set_options('isPhpEnabled', true);
                //$pdf->setOptions(['isPhpEnabled' => true]);                
                //******** Horizontal ***********************//
                $pdf->setPaper('A4', 'landscape');      
                //******** vertical *************************//
                //$pdf->setPaper('A4','portrait');
                //*** Output the generated PDF to Browser ***//
                return $pdf->stream('Reporte_Mensual_detallado');
                //return $pdf->download('Reporte_Mensual_detallado');
                break;                              
            }   // switch ($request->tipo) --- Termina tipo de reporte pantalla, excel o PDF 
            break;

        //*******************************************************************************//
        //******** Reportes Base de datos  **********************************************//
        //*******************************************************************************//
        case 'S':    //Base de datos
            switch ($request->tipo) {
            case 'P':    //Por pantalla 
                return back()->withErrors([' Por la cantidad de datos. Reporte diponible sólo en excel.']);
                break;

            case 'E':    //Formato excel 
                $data  = array();
                $dataAsociative = array();
                $dataPoints     = array();                
                $i     = 0;
                if( $request->control == 'S' ){   
                    switch($request->mes_id){
                        case '1':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.LGOB_COD',   'SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01                                                                            
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_01;
                                                $data[$i][16]=$regproganual->mesc_01;
                                                $data[$i][17]=$regproganual->mes_p01;
                                                $data[$i][18]=$regproganual->mes_s01;

                                                $data[$i][19]=$regproganual->acump_01; 
                                                $data[$i][20]=$regproganual->acumc_01; 
                                                $data[$i][21]=$regproganual->acum_p01; 
                                                $data[$i][22]=$regproganual->smf_01; 

                                                $data[$i][23]=$regproganual->obs_01; 
                                                $data[$i][24]=$regproganual->objetivo_desc; 

                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                         'SIEVAD_DPA.LGOB_COD',   'SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_01;
                                                $data[$i][16]=$regproganual->mesc_01;
                                                $data[$i][17]=$regproganual->mes_p01;
                                                $data[$i][18]=$regproganual->mes_s01;

                                                $data[$i][19]=$regproganual->acump_01; 
                                                $data[$i][20]=$regproganual->acumc_01; 
                                                $data[$i][21]=$regproganual->acum_p01; 
                                                $data[$i][22]=$regproganual->smf_01; 
                                                $data[$i][23]=$regproganual->obs_01;   
                                                $data[$i][24]=$regproganual->objetivo_desc; 
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 1

                        case '2':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',

                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.LGOB_COD',   'SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")        

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,

                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02                                                               
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_02;
                                                $data[$i][16]=$regproganual->mesc_02;
                                                $data[$i][17]=$regproganual->mes_p02;
                                                $data[$i][18]=$regproganual->mes_s02;

                                                $data[$i][19]=$regproganual->acump_02; 
                                                $data[$i][20]=$regproganual->acumc_02; 
                                                $data[$i][21]=$regproganual->acum_p02; 
                                                $data[$i][22]=$regproganual->smf_02; 
                                                $data[$i][23]=$regproganual->obs_02;  

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 
                                                
                                                $data[$i][33]=$regproganual->objetivo_desc;                                               
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',

                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'  
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,

                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02                                                               
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_02;
                                                $data[$i][16]=$regproganual->mesc_02;
                                                $data[$i][17]=$regproganual->mes_p02;
                                                $data[$i][18]=$regproganual->mes_s02;

                                                $data[$i][19]=$regproganual->acump_02; 
                                                $data[$i][20]=$regproganual->acumc_02; 
                                                $data[$i][21]=$regproganual->acum_p02; 
                                                $data[$i][22]=$regproganual->smf_02; 
                                                $data[$i][23]=$regproganual->obs_02;    
                                                
                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->objetivo_desc;
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 2

                        case '3':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                     ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03')                                                                         
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',

                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',

                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03',

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC' 
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_03;
                                                $data[$i][16]=$regproganual->mesc_03;
                                                $data[$i][17]=$regproganual->mes_p03;
                                                $data[$i][18]=$regproganual->mes_s03;

                                                $data[$i][19]=$regproganual->acump_03; 
                                                $data[$i][20]=$regproganual->acumc_03; 
                                                $data[$i][21]=$regproganual->acum_p03; 
                                                $data[$i][22]=$regproganual->smf_03; 
                                                $data[$i][23]=$regproganual->obs_03; 

                                                $data[$i][24]=$regproganual->trimp_01;
                                                $data[$i][25]=$regproganual->trimc_01;
                                                $data[$i][26]=$regproganual->trim_p01;
                                                $data[$i][27]=$regproganual->trim_s01; 

                                                $data[$i][28]=$regproganual->mesp_01;
                                                $data[$i][29]=$regproganual->mesc_01;
                                                $data[$i][30]=$regproganual->mes_p01;
                                                $data[$i][31]=$regproganual->mes_s01;

                                                $data[$i][32]=$regproganual->acump_01; 
                                                $data[$i][33]=$regproganual->acumc_01; 
                                                $data[$i][34]=$regproganual->acum_p01; 
                                                $data[$i][35]=$regproganual->smf_01; 
                                                $data[$i][36]=$regproganual->obs_01; 

                                                $data[$i][37]=$regproganual->mesp_02;
                                                $data[$i][38]=$regproganual->mesc_02;
                                                $data[$i][39]=$regproganual->mes_p02;
                                                $data[$i][40]=$regproganual->mes_s02;

                                                $data[$i][41]=$regproganual->acump_02; 
                                                $data[$i][42]=$regproganual->acumc_02; 
                                                $data[$i][43]=$regproganual->acum_p02; 
                                                $data[$i][44]=$regproganual->smf_02; 
                                                $data[$i][45]=$regproganual->obs_02; 

                                                $data[$i][46]=$regproganual->objetivo_desc;
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03')                                                                         
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',

                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',

                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03',

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                             
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01")                                            
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_03;
                                                $data[$i][16]=$regproganual->mesc_03;
                                                $data[$i][17]=$regproganual->mes_p03;
                                                $data[$i][18]=$regproganual->mes_s03;

                                                $data[$i][19]=$regproganual->acump_03; 
                                                $data[$i][20]=$regproganual->acumc_03; 
                                                $data[$i][21]=$regproganual->acum_p03; 
                                                $data[$i][22]=$regproganual->smf_03; 
                                                $data[$i][23]=$regproganual->obs_03; 

                                                $data[$i][24]=$regproganual->trimp_01;
                                                $data[$i][25]=$regproganual->trimc_01;
                                                $data[$i][26]=$regproganual->trim_p01;
                                                $data[$i][27]=$regproganual->trim_s01; 

                                                $data[$i][28]=$regproganual->mesp_01;
                                                $data[$i][29]=$regproganual->mesc_01;
                                                $data[$i][30]=$regproganual->mes_p01;
                                                $data[$i][31]=$regproganual->mes_s01;

                                                $data[$i][32]=$regproganual->acump_01; 
                                                $data[$i][33]=$regproganual->acumc_01; 
                                                $data[$i][34]=$regproganual->acum_p01; 
                                                $data[$i][35]=$regproganual->smf_01; 
                                                $data[$i][36]=$regproganual->obs_01; 

                                                $data[$i][37]=$regproganual->mesp_02;
                                                $data[$i][38]=$regproganual->mesc_02;
                                                $data[$i][39]=$regproganual->mes_p02;
                                                $data[$i][40]=$regproganual->mes_s02;

                                                $data[$i][41]=$regproganual->acump_02; 
                                                $data[$i][42]=$regproganual->acumc_02; 
                                                $data[$i][43]=$regproganual->acum_p02; 
                                                $data[$i][44]=$regproganual->smf_02; 
                                                $data[$i][45]=$regproganual->obs_02; 

                                                $data[$i][46]=$regproganual->objetivo_desc;                                                
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 3

                        case '4':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                     ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                     ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04')                                                                                                                                                
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                    
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01")                                            
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04")    

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,

                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_04;
                                                $data[$i][16]=$regproganual->mesc_04;
                                                $data[$i][17]=$regproganual->mes_p04;
                                                $data[$i][18]=$regproganual->mes_s04;

                                                $data[$i][19]=$regproganual->acump_04; 
                                                $data[$i][20]=$regproganual->acumc_04; 
                                                $data[$i][21]=$regproganual->acum_p04; 
                                                $data[$i][22]=$regproganual->smf_04; 
                                                $data[$i][23]=$regproganual->obs_04; 

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->mesp_02;
                                                $data[$i][34]=$regproganual->mesc_02;
                                                $data[$i][35]=$regproganual->mes_p02;
                                                $data[$i][36]=$regproganual->mes_s02;

                                                $data[$i][37]=$regproganual->acump_02; 
                                                $data[$i][38]=$regproganual->acumc_02; 
                                                $data[$i][39]=$regproganual->acum_p02; 
                                                $data[$i][40]=$regproganual->smf_02; 
                                                $data[$i][41]=$regproganual->obs_02; 

                                                $data[$i][42]=$regproganual->mesp_03;
                                                $data[$i][43]=$regproganual->mesc_03;
                                                $data[$i][44]=$regproganual->mes_p03;
                                                $data[$i][45]=$regproganual->mes_s03;

                                                $data[$i][46]=$regproganual->acump_03; 
                                                $data[$i][47]=$regproganual->acumc_03; 
                                                $data[$i][48]=$regproganual->acum_p03; 
                                                $data[$i][49]=$regproganual->smf_03; 
                                                $data[$i][50]=$regproganual->obs_03;

                                                $data[$i][51]=$regproganual->trimp_01;
                                                $data[$i][52]=$regproganual->trimc_01;
                                                $data[$i][53]=$regproganual->trim_p01;
                                                $data[$i][54]=$regproganual->trim_s01; 

                                                $data[$i][55]=$regproganual->objetivo_desc;  
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04')                                                                                                                                                
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                   
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01")                                            
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,

                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_04;
                                                $data[$i][16]=$regproganual->mesc_04;
                                                $data[$i][17]=$regproganual->mes_p04;
                                                $data[$i][18]=$regproganual->mes_s04;

                                                $data[$i][19]=$regproganual->acump_04; 
                                                $data[$i][20]=$regproganual->acumc_04; 
                                                $data[$i][21]=$regproganual->acum_p04; 
                                                $data[$i][22]=$regproganual->smf_04; 
                                                $data[$i][23]=$regproganual->obs_04; 

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->mesp_02;
                                                $data[$i][34]=$regproganual->mesc_02;
                                                $data[$i][35]=$regproganual->mes_p02;
                                                $data[$i][36]=$regproganual->mes_s02;

                                                $data[$i][37]=$regproganual->acump_02; 
                                                $data[$i][38]=$regproganual->acumc_02; 
                                                $data[$i][39]=$regproganual->acum_p02; 
                                                $data[$i][40]=$regproganual->smf_02; 
                                                $data[$i][41]=$regproganual->obs_02; 

                                                $data[$i][42]=$regproganual->mesp_03;
                                                $data[$i][43]=$regproganual->mesc_03;
                                                $data[$i][44]=$regproganual->mes_p03;
                                                $data[$i][45]=$regproganual->mes_s03;

                                                $data[$i][46]=$regproganual->acump_03; 
                                                $data[$i][47]=$regproganual->acumc_03; 
                                                $data[$i][48]=$regproganual->acum_p03; 
                                                $data[$i][49]=$regproganual->smf_03; 
                                                $data[$i][50]=$regproganual->obs_03;

                                                $data[$i][51]=$regproganual->trimp_01;
                                                $data[$i][52]=$regproganual->trimc_01;
                                                $data[$i][53]=$regproganual->trim_p01;
                                                $data[$i][54]=$regproganual->trim_s01; 

                                                $data[$i][55]=$regproganual->objetivo_desc;  
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 4

                        case '5':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                     ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                     ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                     ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')                                                                                                                                                                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                          
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01")                                            
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_05;
                                                $data[$i][16]=$regproganual->mesc_05;
                                                $data[$i][17]=$regproganual->mes_p05;
                                                $data[$i][18]=$regproganual->mes_s05;

                                                $data[$i][19]=$regproganual->acump_05; 
                                                $data[$i][20]=$regproganual->acumc_05; 
                                                $data[$i][21]=$regproganual->acum_p05; 
                                                $data[$i][22]=$regproganual->smf_05; 
                                                $data[$i][23]=$regproganual->obs_05; 

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->mesp_02;
                                                $data[$i][34]=$regproganual->mesc_02;
                                                $data[$i][35]=$regproganual->mes_p02;
                                                $data[$i][36]=$regproganual->mes_s02;

                                                $data[$i][37]=$regproganual->acump_02; 
                                                $data[$i][38]=$regproganual->acumc_02; 
                                                $data[$i][39]=$regproganual->acum_p02; 
                                                $data[$i][40]=$regproganual->smf_02; 
                                                $data[$i][41]=$regproganual->obs_02; 

                                                $data[$i][42]=$regproganual->mesp_03;
                                                $data[$i][43]=$regproganual->mesc_03;
                                                $data[$i][44]=$regproganual->mes_p03;
                                                $data[$i][45]=$regproganual->mes_s03;

                                                $data[$i][46]=$regproganual->acump_03; 
                                                $data[$i][47]=$regproganual->acumc_03; 
                                                $data[$i][48]=$regproganual->acum_p03; 
                                                $data[$i][49]=$regproganual->smf_03; 
                                                $data[$i][50]=$regproganual->obs_03;
                                                
                                                $data[$i][51]=$regproganual->trimp_01;
                                                $data[$i][52]=$regproganual->trimc_01;
                                                $data[$i][53]=$regproganual->trim_p01;
                                                $data[$i][54]=$regproganual->trim_s01; 

                                                $data[$i][55]=$regproganual->mesp_04;
                                                $data[$i][56]=$regproganual->mesc_04;
                                                $data[$i][57]=$regproganual->mes_p04;
                                                $data[$i][58]=$regproganual->mes_s04;

                                                $data[$i][59]=$regproganual->acump_04; 
                                                $data[$i][60]=$regproganual->acumc_04; 
                                                $data[$i][61]=$regproganual->acum_p04; 
                                                $data[$i][62]=$regproganual->smf_04; 
                                                $data[$i][63]=$regproganual->obs_04; 

                                                $data[$i][64]=$regproganual->objetivo_desc;  
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')                                                                                                                                                                                                                     
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                          
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01")                                            
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_05;
                                                $data[$i][16]=$regproganual->mesc_05;
                                                $data[$i][17]=$regproganual->mes_p05;
                                                $data[$i][18]=$regproganual->mes_s05;

                                                $data[$i][19]=$regproganual->acump_05; 
                                                $data[$i][20]=$regproganual->acumc_05; 
                                                $data[$i][21]=$regproganual->acum_p05; 
                                                $data[$i][22]=$regproganual->smf_05; 
                                                $data[$i][23]=$regproganual->obs_05; 

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->mesp_02;
                                                $data[$i][34]=$regproganual->mesc_02;
                                                $data[$i][35]=$regproganual->mes_p02;
                                                $data[$i][36]=$regproganual->mes_s02;

                                                $data[$i][37]=$regproganual->acump_02; 
                                                $data[$i][38]=$regproganual->acumc_02; 
                                                $data[$i][39]=$regproganual->acum_p02; 
                                                $data[$i][40]=$regproganual->smf_02; 
                                                $data[$i][41]=$regproganual->obs_02; 

                                                $data[$i][42]=$regproganual->mesp_03;
                                                $data[$i][43]=$regproganual->mesc_03;
                                                $data[$i][44]=$regproganual->mes_p03;
                                                $data[$i][45]=$regproganual->mes_s03;

                                                $data[$i][46]=$regproganual->acump_03; 
                                                $data[$i][47]=$regproganual->acumc_03; 
                                                $data[$i][48]=$regproganual->acum_p03; 
                                                $data[$i][49]=$regproganual->smf_03; 
                                                $data[$i][50]=$regproganual->obs_03;
                                                
                                                $data[$i][51]=$regproganual->trimp_01;
                                                $data[$i][52]=$regproganual->trimc_01;
                                                $data[$i][53]=$regproganual->trim_p01;
                                                $data[$i][54]=$regproganual->trim_s01; 

                                                $data[$i][55]=$regproganual->mesp_04;
                                                $data[$i][56]=$regproganual->mesc_04;
                                                $data[$i][57]=$regproganual->mes_p04;
                                                $data[$i][58]=$regproganual->mes_s04;

                                                $data[$i][59]=$regproganual->acump_04; 
                                                $data[$i][60]=$regproganual->acumc_04; 
                                                $data[$i][61]=$regproganual->acum_p04; 
                                                $data[$i][62]=$regproganual->smf_04; 
                                                $data[$i][63]=$regproganual->obs_04; 

                                                $data[$i][64]=$regproganual->objetivo_desc;  
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 5

                        case '6':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                     ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                     ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                     ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                     ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06')                                                                        
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                            
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")    
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02")                             

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_06;
                                                $data[$i][16]=$regproganual->mesc_06;
                                                $data[$i][17]=$regproganual->mes_p06;
                                                $data[$i][18]=$regproganual->mes_s06;

                                                $data[$i][19]=$regproganual->acump_06; 
                                                $data[$i][20]=$regproganual->acumc_06; 
                                                $data[$i][21]=$regproganual->acum_p06; 
                                                $data[$i][22]=$regproganual->smf_06; 
                                                $data[$i][23]=$regproganual->obs_06; 

                                                $data[$i][24]=$regproganual->trimp_02;
                                                $data[$i][25]=$regproganual->trimc_02;
                                                $data[$i][26]=$regproganual->trim_p02;
                                                $data[$i][27]=$regproganual->trim_s02;  

                                                $data[$i][28]=$regproganual->mesp_01;
                                                $data[$i][29]=$regproganual->mesc_01;
                                                $data[$i][30]=$regproganual->mes_p01;
                                                $data[$i][31]=$regproganual->mes_s01;

                                                $data[$i][32]=$regproganual->acump_01; 
                                                $data[$i][33]=$regproganual->acumc_01; 
                                                $data[$i][34]=$regproganual->acum_p01; 
                                                $data[$i][35]=$regproganual->smf_01; 
                                                $data[$i][36]=$regproganual->obs_01; 

                                                $data[$i][37]=$regproganual->mesp_02;
                                                $data[$i][38]=$regproganual->mesc_02;
                                                $data[$i][39]=$regproganual->mes_p02;
                                                $data[$i][40]=$regproganual->mes_s02;

                                                $data[$i][41]=$regproganual->acump_02; 
                                                $data[$i][42]=$regproganual->acumc_02; 
                                                $data[$i][43]=$regproganual->acum_p02; 
                                                $data[$i][44]=$regproganual->smf_02; 
                                                $data[$i][45]=$regproganual->obs_02; 

                                                $data[$i][46]=$regproganual->mesp_03;
                                                $data[$i][47]=$regproganual->mesc_03;
                                                $data[$i][48]=$regproganual->mes_p03;
                                                $data[$i][49]=$regproganual->mes_s03;

                                                $data[$i][50]=$regproganual->acump_03; 
                                                $data[$i][51]=$regproganual->acumc_03; 
                                                $data[$i][52]=$regproganual->acum_p03; 
                                                $data[$i][53]=$regproganual->smf_03; 
                                                $data[$i][54]=$regproganual->obs_03;
                                                
                                                $data[$i][55]=$regproganual->trimp_01;
                                                $data[$i][56]=$regproganual->trimc_01;
                                                $data[$i][57]=$regproganual->trim_p01;
                                                $data[$i][58]=$regproganual->trim_s01; 

                                                $data[$i][59]=$regproganual->mesp_04;
                                                $data[$i][60]=$regproganual->mesc_04;
                                                $data[$i][61]=$regproganual->mes_p04;
                                                $data[$i][62]=$regproganual->mes_s04;

                                                $data[$i][63]=$regproganual->acump_04; 
                                                $data[$i][64]=$regproganual->acumc_04; 
                                                $data[$i][65]=$regproganual->acum_p04; 
                                                $data[$i][66]=$regproganual->smf_04; 
                                                $data[$i][67]=$regproganual->obs_04; 

                                                $data[$i][68]=$regproganual->mesp_05;
                                                $data[$i][69]=$regproganual->mesc_05;
                                                $data[$i][70]=$regproganual->mes_p05;
                                                $data[$i][71]=$regproganual->mes_s05;

                                                $data[$i][72]=$regproganual->acump_05; 
                                                $data[$i][73]=$regproganual->acumc_05; 
                                                $data[$i][74]=$regproganual->acum_p05; 
                                                $data[$i][75]=$regproganual->smf_05; 
                                                $data[$i][76]=$regproganual->obs_05;    

                                                $data[$i][77]=$regproganual->objetivo_desc;    
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                     ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                     ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                     ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                     ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06')                                                                        
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                      
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")  
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02")                 
              
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_06;
                                                $data[$i][16]=$regproganual->mesc_06;
                                                $data[$i][17]=$regproganual->mes_p06;
                                                $data[$i][18]=$regproganual->mes_s06;

                                                $data[$i][19]=$regproganual->acump_06; 
                                                $data[$i][20]=$regproganual->acumc_06; 
                                                $data[$i][21]=$regproganual->acum_p06; 
                                                $data[$i][22]=$regproganual->smf_06; 
                                                $data[$i][23]=$regproganual->obs_06; 

                                                $data[$i][24]=$regproganual->trimp_02;
                                                $data[$i][25]=$regproganual->trimc_02;
                                                $data[$i][26]=$regproganual->trim_p02;
                                                $data[$i][27]=$regproganual->trim_s02;  

                                                $data[$i][28]=$regproganual->mesp_01;
                                                $data[$i][29]=$regproganual->mesc_01;
                                                $data[$i][30]=$regproganual->mes_p01;
                                                $data[$i][31]=$regproganual->mes_s01;

                                                $data[$i][32]=$regproganual->acump_01; 
                                                $data[$i][33]=$regproganual->acumc_01; 
                                                $data[$i][34]=$regproganual->acum_p01; 
                                                $data[$i][35]=$regproganual->smf_01; 
                                                $data[$i][36]=$regproganual->obs_01; 

                                                $data[$i][37]=$regproganual->mesp_02;
                                                $data[$i][38]=$regproganual->mesc_02;
                                                $data[$i][39]=$regproganual->mes_p02;
                                                $data[$i][40]=$regproganual->mes_s02;

                                                $data[$i][41]=$regproganual->acump_02; 
                                                $data[$i][42]=$regproganual->acumc_02; 
                                                $data[$i][43]=$regproganual->acum_p02; 
                                                $data[$i][44]=$regproganual->smf_02; 
                                                $data[$i][45]=$regproganual->obs_02; 

                                                $data[$i][46]=$regproganual->mesp_03;
                                                $data[$i][47]=$regproganual->mesc_03;
                                                $data[$i][48]=$regproganual->mes_p03;
                                                $data[$i][49]=$regproganual->mes_s03;

                                                $data[$i][50]=$regproganual->acump_03; 
                                                $data[$i][51]=$regproganual->acumc_03; 
                                                $data[$i][52]=$regproganual->acum_p03; 
                                                $data[$i][53]=$regproganual->smf_03; 
                                                $data[$i][54]=$regproganual->obs_03;
                                                
                                                $data[$i][55]=$regproganual->trimp_01;
                                                $data[$i][56]=$regproganual->trimc_01;
                                                $data[$i][57]=$regproganual->trim_p01;
                                                $data[$i][58]=$regproganual->trim_s01; 

                                                $data[$i][59]=$regproganual->mesp_04;
                                                $data[$i][60]=$regproganual->mesc_04;
                                                $data[$i][61]=$regproganual->mes_p04;
                                                $data[$i][62]=$regproganual->mes_s04;

                                                $data[$i][63]=$regproganual->acump_04; 
                                                $data[$i][64]=$regproganual->acumc_04; 
                                                $data[$i][65]=$regproganual->acum_p04; 
                                                $data[$i][66]=$regproganual->smf_04; 
                                                $data[$i][67]=$regproganual->obs_04; 

                                                $data[$i][68]=$regproganual->mesp_05;
                                                $data[$i][69]=$regproganual->mesc_05;
                                                $data[$i][70]=$regproganual->mes_p05;
                                                $data[$i][71]=$regproganual->mes_s05;

                                                $data[$i][72]=$regproganual->acump_05; 
                                                $data[$i][73]=$regproganual->acumc_05; 
                                                $data[$i][74]=$regproganual->acum_p05; 
                                                $data[$i][75]=$regproganual->smf_05; 
                                                $data[$i][76]=$regproganual->obs_05;    
  
                                                $data[$i][77]=$regproganual->objetivo_desc;        
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 6

                        case '7':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                     ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                     ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                     ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                     ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                     ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07')                                                                                                                                             
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                                                                                                                                       
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")     
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")  

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,

                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_07;
                                                $data[$i][16]=$regproganual->mesc_07;
                                                $data[$i][17]=$regproganual->mes_p07;
                                                $data[$i][18]=$regproganual->mes_s07;

                                                $data[$i][19]=$regproganual->acump_07; 
                                                $data[$i][20]=$regproganual->acumc_07; 
                                                $data[$i][21]=$regproganual->acum_p07; 
                                                $data[$i][22]=$regproganual->smf_07; 
                                                $data[$i][23]=$regproganual->obs_07; 

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->mesp_02;
                                                $data[$i][34]=$regproganual->mesc_02;
                                                $data[$i][35]=$regproganual->mes_p02;
                                                $data[$i][36]=$regproganual->mes_s02;

                                                $data[$i][37]=$regproganual->acump_02; 
                                                $data[$i][38]=$regproganual->acumc_02; 
                                                $data[$i][39]=$regproganual->acum_p02; 
                                                $data[$i][40]=$regproganual->smf_02; 
                                                $data[$i][41]=$regproganual->obs_02; 

                                                $data[$i][42]=$regproganual->mesp_03;
                                                $data[$i][43]=$regproganual->mesc_03;
                                                $data[$i][44]=$regproganual->mes_p03;
                                                $data[$i][45]=$regproganual->mes_s03;

                                                $data[$i][46]=$regproganual->acump_03; 
                                                $data[$i][47]=$regproganual->acumc_03; 
                                                $data[$i][48]=$regproganual->acum_p03; 
                                                $data[$i][49]=$regproganual->smf_03; 
                                                $data[$i][50]=$regproganual->obs_03;
                                                
                                                $data[$i][51]=$regproganual->trimp_01;
                                                $data[$i][52]=$regproganual->trimc_01;
                                                $data[$i][53]=$regproganual->trim_p01;
                                                $data[$i][54]=$regproganual->trim_s01; 

                                                $data[$i][55]=$regproganual->mesp_04;
                                                $data[$i][56]=$regproganual->mesc_04;
                                                $data[$i][57]=$regproganual->mes_p04;
                                                $data[$i][58]=$regproganual->mes_s04;

                                                $data[$i][59]=$regproganual->acump_04; 
                                                $data[$i][60]=$regproganual->acumc_04; 
                                                $data[$i][61]=$regproganual->acum_p04; 
                                                $data[$i][62]=$regproganual->smf_04; 
                                                $data[$i][63]=$regproganual->obs_04; 

                                                $data[$i][64]=$regproganual->mesp_05;
                                                $data[$i][65]=$regproganual->mesc_05;
                                                $data[$i][66]=$regproganual->mes_p05;
                                                $data[$i][67]=$regproganual->mes_s05;

                                                $data[$i][68]=$regproganual->acump_05; 
                                                $data[$i][69]=$regproganual->acumc_05; 
                                                $data[$i][70]=$regproganual->acum_p05; 
                                                $data[$i][71]=$regproganual->smf_05; 
                                                $data[$i][72]=$regproganual->obs_05;    

                                                $data[$i][73]=$regproganual->mesp_06;
                                                $data[$i][74]=$regproganual->mesc_06;
                                                $data[$i][75]=$regproganual->mes_p06;
                                                $data[$i][76]=$regproganual->mes_s06;

                                                $data[$i][77]=$regproganual->acump_06; 
                                                $data[$i][78]=$regproganual->acumc_06; 
                                                $data[$i][79]=$regproganual->acum_p06; 
                                                $data[$i][80]=$regproganual->smf_06; 
                                                $data[$i][81]=$regproganual->obs_06; 

                                                $data[$i][82]=$regproganual->trimp_02;
                                                $data[$i][83]=$regproganual->trimc_02;
                                                $data[$i][84]=$regproganual->trim_p02;
                                                $data[$i][85]=$regproganual->trim_s02;

                                                $data[$i][86]=$regproganual->objetivo_desc;        
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07')                                                                                                                                             
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                                                                                                                                      
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")  
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")   
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                               
                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_07;
                                                $data[$i][16]=$regproganual->mesc_07;
                                                $data[$i][17]=$regproganual->mes_p07;
                                                $data[$i][18]=$regproganual->mes_s07;

                                                $data[$i][19]=$regproganual->acump_07; 
                                                $data[$i][20]=$regproganual->acumc_07; 
                                                $data[$i][21]=$regproganual->acum_p07; 
                                                $data[$i][22]=$regproganual->smf_07; 
                                                $data[$i][23]=$regproganual->obs_07; 

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->mesp_02;
                                                $data[$i][34]=$regproganual->mesc_02;
                                                $data[$i][35]=$regproganual->mes_p02;
                                                $data[$i][36]=$regproganual->mes_s02;

                                                $data[$i][37]=$regproganual->acump_02; 
                                                $data[$i][38]=$regproganual->acumc_02; 
                                                $data[$i][39]=$regproganual->acum_p02; 
                                                $data[$i][40]=$regproganual->smf_02; 
                                                $data[$i][41]=$regproganual->obs_02; 

                                                $data[$i][42]=$regproganual->mesp_03;
                                                $data[$i][43]=$regproganual->mesc_03;
                                                $data[$i][44]=$regproganual->mes_p03;
                                                $data[$i][45]=$regproganual->mes_s03;

                                                $data[$i][46]=$regproganual->acump_03; 
                                                $data[$i][47]=$regproganual->acumc_03; 
                                                $data[$i][48]=$regproganual->acum_p03; 
                                                $data[$i][49]=$regproganual->smf_03; 
                                                $data[$i][50]=$regproganual->obs_03;
                                                
                                                $data[$i][51]=$regproganual->trimp_01;
                                                $data[$i][52]=$regproganual->trimc_01;
                                                $data[$i][53]=$regproganual->trim_p01;
                                                $data[$i][54]=$regproganual->trim_s01; 

                                                $data[$i][55]=$regproganual->mesp_04;
                                                $data[$i][56]=$regproganual->mesc_04;
                                                $data[$i][57]=$regproganual->mes_p04;
                                                $data[$i][58]=$regproganual->mes_s04;

                                                $data[$i][59]=$regproganual->acump_04; 
                                                $data[$i][60]=$regproganual->acumc_04; 
                                                $data[$i][61]=$regproganual->acum_p04; 
                                                $data[$i][62]=$regproganual->smf_04; 
                                                $data[$i][63]=$regproganual->obs_04; 

                                                $data[$i][64]=$regproganual->mesp_05;
                                                $data[$i][65]=$regproganual->mesc_05;
                                                $data[$i][66]=$regproganual->mes_p05;
                                                $data[$i][67]=$regproganual->mes_s05;

                                                $data[$i][68]=$regproganual->acump_05; 
                                                $data[$i][69]=$regproganual->acumc_05; 
                                                $data[$i][70]=$regproganual->acum_p05; 
                                                $data[$i][71]=$regproganual->smf_05; 
                                                $data[$i][72]=$regproganual->obs_05;    

                                                $data[$i][73]=$regproganual->mesp_06;
                                                $data[$i][74]=$regproganual->mesc_06;
                                                $data[$i][75]=$regproganual->mes_p06;
                                                $data[$i][76]=$regproganual->mes_s06;

                                                $data[$i][77]=$regproganual->acump_06; 
                                                $data[$i][78]=$regproganual->acumc_06; 
                                                $data[$i][79]=$regproganual->acum_p06; 
                                                $data[$i][80]=$regproganual->smf_06; 
                                                $data[$i][81]=$regproganual->obs_06; 

                                                $data[$i][82]=$regproganual->trimp_02;
                                                $data[$i][83]=$regproganual->trimc_02;
                                                $data[$i][84]=$regproganual->trim_p02;
                                                $data[$i][85]=$regproganual->trim_s02;
  
                                                $data[$i][86]=$regproganual->objetivo_desc;        
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 7

                        case '8':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                     ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                     ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                     ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                     ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                     ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                     ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                       'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                       'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                             
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")  
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_08")  

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                               
                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07,
                                                               $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                               $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                               $regproganual->obs_08
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_08;
                                                $data[$i][16]=$regproganual->mesc_08;
                                                $data[$i][17]=$regproganual->mes_p08;
                                                $data[$i][18]=$regproganual->mes_s08;

                                                $data[$i][19]=$regproganual->acump_08; 
                                                $data[$i][20]=$regproganual->acumc_08; 
                                                $data[$i][21]=$regproganual->acum_p08; 
                                                $data[$i][22]=$regproganual->smf_08; 
                                                $data[$i][23]=$regproganual->obs_08; 

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->mesp_02;
                                                $data[$i][34]=$regproganual->mesc_02;
                                                $data[$i][35]=$regproganual->mes_p02;
                                                $data[$i][36]=$regproganual->mes_s02;

                                                $data[$i][37]=$regproganual->acump_02; 
                                                $data[$i][38]=$regproganual->acumc_02; 
                                                $data[$i][39]=$regproganual->acum_p02; 
                                                $data[$i][40]=$regproganual->smf_02; 
                                                $data[$i][41]=$regproganual->obs_02; 

                                                $data[$i][42]=$regproganual->mesp_03;
                                                $data[$i][43]=$regproganual->mesc_03;
                                                $data[$i][44]=$regproganual->mes_p03;
                                                $data[$i][45]=$regproganual->mes_s03;

                                                $data[$i][46]=$regproganual->acump_03; 
                                                $data[$i][47]=$regproganual->acumc_03; 
                                                $data[$i][48]=$regproganual->acum_p03; 
                                                $data[$i][49]=$regproganual->smf_03; 
                                                $data[$i][50]=$regproganual->obs_03;
                                                
                                                $data[$i][51]=$regproganual->trimp_01;
                                                $data[$i][52]=$regproganual->trimc_01;
                                                $data[$i][53]=$regproganual->trim_p01;
                                                $data[$i][54]=$regproganual->trim_s01; 

                                                $data[$i][55]=$regproganual->mesp_04;
                                                $data[$i][56]=$regproganual->mesc_04;
                                                $data[$i][57]=$regproganual->mes_p04;
                                                $data[$i][58]=$regproganual->mes_s04;

                                                $data[$i][59]=$regproganual->acump_04; 
                                                $data[$i][60]=$regproganual->acumc_04; 
                                                $data[$i][61]=$regproganual->acum_p04; 
                                                $data[$i][62]=$regproganual->smf_04; 
                                                $data[$i][63]=$regproganual->obs_04; 

                                                $data[$i][64]=$regproganual->mesp_05;
                                                $data[$i][65]=$regproganual->mesc_05;
                                                $data[$i][66]=$regproganual->mes_p05;
                                                $data[$i][67]=$regproganual->mes_s05;

                                                $data[$i][68]=$regproganual->acump_05; 
                                                $data[$i][69]=$regproganual->acumc_05; 
                                                $data[$i][70]=$regproganual->acum_p05; 
                                                $data[$i][71]=$regproganual->smf_05; 
                                                $data[$i][72]=$regproganual->obs_05;    

                                                $data[$i][73]=$regproganual->mesp_06;
                                                $data[$i][74]=$regproganual->mesc_06;
                                                $data[$i][75]=$regproganual->mes_p06;
                                                $data[$i][66]=$regproganual->mes_s06;

                                                $data[$i][77]=$regproganual->acump_06; 
                                                $data[$i][78]=$regproganual->acumc_06; 
                                                $data[$i][79]=$regproganual->acum_p06; 
                                                $data[$i][80]=$regproganual->smf_06; 
                                                $data[$i][81]=$regproganual->obs_06; 

                                                $data[$i][82]=$regproganual->trimp_02;
                                                $data[$i][83]=$regproganual->trimc_02;
                                                $data[$i][84]=$regproganual->trim_p02;
                                                $data[$i][85]=$regproganual->trim_s02;

                                                $data[$i][86]=$regproganual->mesp_07;
                                                $data[$i][87]=$regproganual->mesc_07;
                                                $data[$i][88]=$regproganual->mes_p07;
                                                $data[$i][89]=$regproganual->mes_s07;

                                                $data[$i][90]=$regproganual->acump_07; 
                                                $data[$i][91]=$regproganual->acumc_07; 
                                                $data[$i][92]=$regproganual->acum_p07; 
                                                $data[$i][93]=$regproganual->smf_07; 
                                                $data[$i][94]=$regproganual->obs_07; 

                                                $data[$i][95]=$regproganual->objetivo_desc;       
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                         ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                       'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                       'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                          
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")     
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_08")  
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                               
                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07,
                                                               $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                               $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                               $regproganual->obs_08
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_08;
                                                $data[$i][16]=$regproganual->mesc_08;
                                                $data[$i][17]=$regproganual->mes_p08;
                                                $data[$i][18]=$regproganual->mes_s08;

                                                $data[$i][19]=$regproganual->acump_08; 
                                                $data[$i][20]=$regproganual->acumc_08; 
                                                $data[$i][21]=$regproganual->acum_p08; 
                                                $data[$i][22]=$regproganual->smf_08; 
                                                $data[$i][23]=$regproganual->obs_08; 

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->mesp_02;
                                                $data[$i][34]=$regproganual->mesc_02;
                                                $data[$i][35]=$regproganual->mes_p02;
                                                $data[$i][36]=$regproganual->mes_s02;

                                                $data[$i][37]=$regproganual->acump_02; 
                                                $data[$i][38]=$regproganual->acumc_02; 
                                                $data[$i][39]=$regproganual->acum_p02; 
                                                $data[$i][40]=$regproganual->smf_02; 
                                                $data[$i][41]=$regproganual->obs_02; 

                                                $data[$i][42]=$regproganual->mesp_03;
                                                $data[$i][43]=$regproganual->mesc_03;
                                                $data[$i][44]=$regproganual->mes_p03;
                                                $data[$i][45]=$regproganual->mes_s03;

                                                $data[$i][46]=$regproganual->acump_03; 
                                                $data[$i][47]=$regproganual->acumc_03; 
                                                $data[$i][48]=$regproganual->acum_p03; 
                                                $data[$i][49]=$regproganual->smf_03; 
                                                $data[$i][50]=$regproganual->obs_03;
                                                
                                                $data[$i][51]=$regproganual->trimp_01;
                                                $data[$i][52]=$regproganual->trimc_01;
                                                $data[$i][53]=$regproganual->trim_p01;
                                                $data[$i][54]=$regproganual->trim_s01; 

                                                $data[$i][55]=$regproganual->mesp_04;
                                                $data[$i][56]=$regproganual->mesc_04;
                                                $data[$i][57]=$regproganual->mes_p04;
                                                $data[$i][58]=$regproganual->mes_s04;

                                                $data[$i][59]=$regproganual->acump_04; 
                                                $data[$i][60]=$regproganual->acumc_04; 
                                                $data[$i][61]=$regproganual->acum_p04; 
                                                $data[$i][62]=$regproganual->smf_04; 
                                                $data[$i][63]=$regproganual->obs_04; 

                                                $data[$i][64]=$regproganual->mesp_05;
                                                $data[$i][65]=$regproganual->mesc_05;
                                                $data[$i][66]=$regproganual->mes_p05;
                                                $data[$i][67]=$regproganual->mes_s05;

                                                $data[$i][68]=$regproganual->acump_05; 
                                                $data[$i][69]=$regproganual->acumc_05; 
                                                $data[$i][70]=$regproganual->acum_p05; 
                                                $data[$i][71]=$regproganual->smf_05; 
                                                $data[$i][72]=$regproganual->obs_05;    

                                                $data[$i][73]=$regproganual->mesp_06;
                                                $data[$i][74]=$regproganual->mesc_06;
                                                $data[$i][75]=$regproganual->mes_p06;
                                                $data[$i][66]=$regproganual->mes_s06;

                                                $data[$i][77]=$regproganual->acump_06; 
                                                $data[$i][78]=$regproganual->acumc_06; 
                                                $data[$i][79]=$regproganual->acum_p06; 
                                                $data[$i][80]=$regproganual->smf_06; 
                                                $data[$i][81]=$regproganual->obs_06; 

                                                $data[$i][82]=$regproganual->trimp_02;
                                                $data[$i][83]=$regproganual->trimc_02;
                                                $data[$i][84]=$regproganual->trim_p02;
                                                $data[$i][85]=$regproganual->trim_s02;

                                                $data[$i][86]=$regproganual->mesp_07;
                                                $data[$i][87]=$regproganual->mesc_07;
                                                $data[$i][88]=$regproganual->mes_p07;
                                                $data[$i][89]=$regproganual->mes_s07;

                                                $data[$i][90]=$regproganual->acump_07; 
                                                $data[$i][91]=$regproganual->acumc_07; 
                                                $data[$i][92]=$regproganual->acum_p07; 
                                                $data[$i][93]=$regproganual->smf_07; 
                                                $data[$i][94]=$regproganual->obs_07; 
 
                                                $data[$i][95]=$regproganual->objetivo_desc;       
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 8

                        case '9':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')                                                                       
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                     ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                     ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                     ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                     ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                     ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                     ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                     ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                       'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                       'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                       'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                       'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                       'SIEVAD_DPA.TRIMP_03' ,'SIEVAD_DPA.TRIMC_03' ,'SIEVAD_DPA.TRIM_P03',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                                                                                
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")    
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_08")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_09")     
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S03")                                                           

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                               
                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07,
                                                               $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                               $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                               $regproganual->obs_08,
                                                               $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                               $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                               $regproganual->obs_09,
                                                               $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_09;
                                                $data[$i][16]=$regproganual->mesc_09;
                                                $data[$i][17]=$regproganual->mes_p09;
                                                $data[$i][18]=$regproganual->mes_s09;

                                                $data[$i][19] =$regproganual->acump_09; 
                                                $data[$i][20]=$regproganual->acumc_09; 
                                                $data[$i][21]=$regproganual->acum_p09; 
                                                $data[$i][22]=$regproganual->smf_09; 
                                                $data[$i][23]=$regproganual->obs_09; 

                                                $data[$i][24]=$regproganual->trimp_03;
                                                $data[$i][25]=$regproganual->trimc_03;
                                                $data[$i][26]=$regproganual->trim_p03;
                                                $data[$i][27]=$regproganual->trim_s03; 

                                                $data[$i][28]=$regproganual->mesp_01;
                                                $data[$i][29]=$regproganual->mesc_01;
                                                $data[$i][30]=$regproganual->mes_p01;
                                                $data[$i][31]=$regproganual->mes_s01;

                                                $data[$i][32]=$regproganual->acump_01; 
                                                $data[$i][33]=$regproganual->acumc_01; 
                                                $data[$i][34]=$regproganual->acum_p01; 
                                                $data[$i][35]=$regproganual->smf_01; 
                                                $data[$i][36]=$regproganual->obs_01; 

                                                $data[$i][37]=$regproganual->mesp_02;
                                                $data[$i][38]=$regproganual->mesc_02;
                                                $data[$i][39]=$regproganual->mes_p02;
                                                $data[$i][40]=$regproganual->mes_s02;

                                                $data[$i][41]=$regproganual->acump_02; 
                                                $data[$i][42]=$regproganual->acumc_02; 
                                                $data[$i][43]=$regproganual->acum_p02; 
                                                $data[$i][44]=$regproganual->smf_02; 
                                                $data[$i][45]=$regproganual->obs_02; 

                                                $data[$i][46]=$regproganual->mesp_03;
                                                $data[$i][47]=$regproganual->mesc_03;
                                                $data[$i][48]=$regproganual->mes_p03;
                                                $data[$i][49]=$regproganual->mes_s03;

                                                $data[$i][50]=$regproganual->acump_03; 
                                                $data[$i][51]=$regproganual->acumc_03; 
                                                $data[$i][52]=$regproganual->acum_p03; 
                                                $data[$i][53]=$regproganual->smf_03; 
                                                $data[$i][54]=$regproganual->obs_03;
                                                
                                                $data[$i][55]=$regproganual->trimp_01;
                                                $data[$i][56]=$regproganual->trimc_01;
                                                $data[$i][57]=$regproganual->trim_p01;
                                                $data[$i][58]=$regproganual->trim_s01; 

                                                $data[$i][59]=$regproganual->mesp_04;
                                                $data[$i][60]=$regproganual->mesc_04;
                                                $data[$i][61]=$regproganual->mes_p04;
                                                $data[$i][62]=$regproganual->mes_s04;

                                                $data[$i][63]=$regproganual->acump_04; 
                                                $data[$i][64]=$regproganual->acumc_04; 
                                                $data[$i][65]=$regproganual->acum_p04; 
                                                $data[$i][66]=$regproganual->smf_04; 
                                                $data[$i][67]=$regproganual->obs_04; 

                                                $data[$i][68]=$regproganual->mesp_05;
                                                $data[$i][69]=$regproganual->mesc_05;
                                                $data[$i][70]=$regproganual->mes_p05;
                                                $data[$i][71]=$regproganual->mes_s05;

                                                $data[$i][72]=$regproganual->acump_05; 
                                                $data[$i][73]=$regproganual->acumc_05; 
                                                $data[$i][74]=$regproganual->acum_p05; 
                                                $data[$i][75]=$regproganual->smf_05; 
                                                $data[$i][76]=$regproganual->obs_05;    

                                                $data[$i][77]=$regproganual->mesp_06;
                                                $data[$i][78]=$regproganual->mesc_06;
                                                $data[$i][79]=$regproganual->mes_p06;
                                                $data[$i][80]=$regproganual->mes_s06;

                                                $data[$i][81]=$regproganual->acump_06; 
                                                $data[$i][82]=$regproganual->acumc_06; 
                                                $data[$i][83]=$regproganual->acum_p06; 
                                                $data[$i][84]=$regproganual->smf_06; 
                                                $data[$i][85]=$regproganual->obs_06; 

                                                $data[$i][86]=$regproganual->trimp_02;
                                                $data[$i][87]=$regproganual->trimc_02;
                                                $data[$i][88]=$regproganual->trim_p02;
                                                $data[$i][89]=$regproganual->trim_s02;

                                                $data[$i][90]=$regproganual->mesp_07;
                                                $data[$i][91]=$regproganual->mesc_07;
                                                $data[$i][92]=$regproganual->mes_p07;
                                                $data[$i][93]=$regproganual->mes_s07;

                                                $data[$i][94]=$regproganual->acump_07; 
                                                $data[$i][95]=$regproganual->acumc_07; 
                                                $data[$i][96]=$regproganual->acum_p07; 
                                                $data[$i][97]=$regproganual->smf_07; 
                                                $data[$i][98]=$regproganual->obs_07; 

                                                $data[$i][99]=$regproganual->mesp_08;
                                                $data[$i][100]=$regproganual->mesc_08;
                                                $data[$i][101]=$regproganual->mes_p08;
                                                $data[$i][102]=$regproganual->mes_s08;

                                                $data[$i][103]=$regproganual->acump_08; 
                                                $data[$i][104]=$regproganual->acumc_08; 
                                                $data[$i][105]=$regproganual->acum_p08; 
                                                $data[$i][106]=$regproganual->smf_08; 
                                                $data[$i][107]=$regproganual->obs_08; 

                                                $data[$i][108]=$regproganual->objetivo_desc;     
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                         ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                         ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                       'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                       'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                       'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                       'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                       'SIEVAD_DPA.TRIMP_03' ,'SIEVAD_DPA.TRIMC_03' ,'SIEVAD_DPA.TRIM_P03',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC' 
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")    
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_08")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_09")  
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S03")                                            

                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                               
                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07,
                                                               $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                               $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                               $regproganual->obs_08,
                                                               $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                               $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                               $regproganual->obs_09,
                                                               $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_09;
                                                $data[$i][16]=$regproganual->mesc_09;
                                                $data[$i][17]=$regproganual->mes_p09;
                                                $data[$i][18]=$regproganual->mes_s09;

                                                $data[$i][19] =$regproganual->acump_09; 
                                                $data[$i][20]=$regproganual->acumc_09; 
                                                $data[$i][21]=$regproganual->acum_p09; 
                                                $data[$i][22]=$regproganual->smf_09; 
                                                $data[$i][23]=$regproganual->obs_09; 

                                                $data[$i][24]=$regproganual->trimp_03;
                                                $data[$i][25]=$regproganual->trimc_03;
                                                $data[$i][26]=$regproganual->trim_p03;
                                                $data[$i][27]=$regproganual->trim_s03; 

                                                $data[$i][28]=$regproganual->mesp_01;
                                                $data[$i][29]=$regproganual->mesc_01;
                                                $data[$i][30]=$regproganual->mes_p01;
                                                $data[$i][31]=$regproganual->mes_s01;

                                                $data[$i][32]=$regproganual->acump_01; 
                                                $data[$i][33]=$regproganual->acumc_01; 
                                                $data[$i][34]=$regproganual->acum_p01; 
                                                $data[$i][35]=$regproganual->smf_01; 
                                                $data[$i][36]=$regproganual->obs_01; 

                                                $data[$i][37]=$regproganual->mesp_02;
                                                $data[$i][38]=$regproganual->mesc_02;
                                                $data[$i][39]=$regproganual->mes_p02;
                                                $data[$i][40]=$regproganual->mes_s02;

                                                $data[$i][41]=$regproganual->acump_02; 
                                                $data[$i][42]=$regproganual->acumc_02; 
                                                $data[$i][43]=$regproganual->acum_p02; 
                                                $data[$i][44]=$regproganual->smf_02; 
                                                $data[$i][45]=$regproganual->obs_02; 

                                                $data[$i][46]=$regproganual->mesp_03;
                                                $data[$i][47]=$regproganual->mesc_03;
                                                $data[$i][48]=$regproganual->mes_p03;
                                                $data[$i][49]=$regproganual->mes_s03;

                                                $data[$i][50]=$regproganual->acump_03; 
                                                $data[$i][51]=$regproganual->acumc_03; 
                                                $data[$i][52]=$regproganual->acum_p03; 
                                                $data[$i][53]=$regproganual->smf_03; 
                                                $data[$i][54]=$regproganual->obs_03;
                                                
                                                $data[$i][55]=$regproganual->trimp_01;
                                                $data[$i][56]=$regproganual->trimc_01;
                                                $data[$i][57]=$regproganual->trim_p01;
                                                $data[$i][58]=$regproganual->trim_s01; 

                                                $data[$i][59]=$regproganual->mesp_04;
                                                $data[$i][60]=$regproganual->mesc_04;
                                                $data[$i][61]=$regproganual->mes_p04;
                                                $data[$i][62]=$regproganual->mes_s04;

                                                $data[$i][63]=$regproganual->acump_04; 
                                                $data[$i][64]=$regproganual->acumc_04; 
                                                $data[$i][65]=$regproganual->acum_p04; 
                                                $data[$i][66]=$regproganual->smf_04; 
                                                $data[$i][67]=$regproganual->obs_04; 

                                                $data[$i][68]=$regproganual->mesp_05;
                                                $data[$i][69]=$regproganual->mesc_05;
                                                $data[$i][70]=$regproganual->mes_p05;
                                                $data[$i][71]=$regproganual->mes_s05;

                                                $data[$i][72]=$regproganual->acump_05; 
                                                $data[$i][73]=$regproganual->acumc_05; 
                                                $data[$i][74]=$regproganual->acum_p05; 
                                                $data[$i][75]=$regproganual->smf_05; 
                                                $data[$i][76]=$regproganual->obs_05;    

                                                $data[$i][77]=$regproganual->mesp_06;
                                                $data[$i][78]=$regproganual->mesc_06;
                                                $data[$i][79]=$regproganual->mes_p06;
                                                $data[$i][80]=$regproganual->mes_s06;

                                                $data[$i][81]=$regproganual->acump_06; 
                                                $data[$i][82]=$regproganual->acumc_06; 
                                                $data[$i][83]=$regproganual->acum_p06; 
                                                $data[$i][84]=$regproganual->smf_06; 
                                                $data[$i][85]=$regproganual->obs_06; 

                                                $data[$i][86]=$regproganual->trimp_02;
                                                $data[$i][87]=$regproganual->trimc_02;
                                                $data[$i][88]=$regproganual->trim_p02;
                                                $data[$i][89]=$regproganual->trim_s02;

                                                $data[$i][90]=$regproganual->mesp_07;
                                                $data[$i][91]=$regproganual->mesc_07;
                                                $data[$i][92]=$regproganual->mes_p07;
                                                $data[$i][93]=$regproganual->mes_s07;

                                                $data[$i][94]=$regproganual->acump_07; 
                                                $data[$i][95]=$regproganual->acumc_07; 
                                                $data[$i][96]=$regproganual->acum_p07; 
                                                $data[$i][97]=$regproganual->smf_07; 
                                                $data[$i][98]=$regproganual->obs_07; 

                                                $data[$i][99]=$regproganual->mesp_08;
                                                $data[$i][100]=$regproganual->mesc_08;
                                                $data[$i][101]=$regproganual->mes_p08;
                                                $data[$i][102]=$regproganual->mes_s08;

                                                $data[$i][103]=$regproganual->acump_08; 
                                                $data[$i][104]=$regproganual->acumc_08; 
                                                $data[$i][105]=$regproganual->acum_p08; 
                                                $data[$i][106]=$regproganual->smf_08; 
                                                $data[$i][107]=$regproganual->obs_08; 

                                                $data[$i][108]=$regproganual->objetivo_desc;     
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 9

                        case '10':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                     ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                     ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                     ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                     ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                     ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                     ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                     ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                                     ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10') 
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIM_P02',

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                       'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                       'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                       'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                       'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                       'SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIM_P03',

                                                       'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                       'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC' 
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")        
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_08")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_09")  
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S03") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_10")       

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                               
                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07,
                                                               $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                               $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                               $regproganual->obs_08,
                                                               $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                               $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                               $regproganual->obs_09,
                                                               $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03,

                                                               $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                               $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                               $regproganual->obs_10
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_10;
                                                $data[$i][16]=$regproganual->mesc_10;
                                                $data[$i][17]=$regproganual->mes_p10;
                                                $data[$i][18]=$regproganual->mes_s10;

                                                $data[$i][19]=$regproganual->acump_10; 
                                                $data[$i][20]=$regproganual->acumc_10; 
                                                $data[$i][21]=$regproganual->acum_p10; 
                                                $data[$i][22]=$regproganual->smf_10; 
                                                $data[$i][23]=$regproganual->obs_10;

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->mesp_02;
                                                $data[$i][34]=$regproganual->mesc_02;
                                                $data[$i][35]=$regproganual->mes_p02;
                                                $data[$i][36]=$regproganual->mes_s02;

                                                $data[$i][37]=$regproganual->acump_02; 
                                                $data[$i][38]=$regproganual->acumc_02; 
                                                $data[$i][39]=$regproganual->acum_p02; 
                                                $data[$i][40]=$regproganual->smf_02; 
                                                $data[$i][41]=$regproganual->obs_02; 

                                                $data[$i][42]=$regproganual->mesp_03;
                                                $data[$i][43]=$regproganual->mesc_03;
                                                $data[$i][44]=$regproganual->mes_p03;
                                                $data[$i][45]=$regproganual->mes_s03;

                                                $data[$i][46]=$regproganual->acump_03; 
                                                $data[$i][47]=$regproganual->acumc_03; 
                                                $data[$i][48]=$regproganual->acum_p03; 
                                                $data[$i][49]=$regproganual->smf_03; 
                                                $data[$i][50]=$regproganual->obs_03;
                                                
                                                $data[$i][51]=$regproganual->trimp_01;
                                                $data[$i][52]=$regproganual->trimc_01;
                                                $data[$i][53]=$regproganual->trim_p01;
                                                $data[$i][54]=$regproganual->trim_s01; 

                                                $data[$i][55]=$regproganual->mesp_04;
                                                $data[$i][56]=$regproganual->mesc_04;
                                                $data[$i][57]=$regproganual->mes_p04;
                                                $data[$i][58]=$regproganual->mes_s04;

                                                $data[$i][59]=$regproganual->acump_04; 
                                                $data[$i][60]=$regproganual->acumc_04; 
                                                $data[$i][61]=$regproganual->acum_p04; 
                                                $data[$i][62]=$regproganual->smf_04; 
                                                $data[$i][63]=$regproganual->obs_04; 

                                                $data[$i][64]=$regproganual->mesp_05;
                                                $data[$i][65]=$regproganual->mesc_05;
                                                $data[$i][66]=$regproganual->mes_p05;
                                                $data[$i][67]=$regproganual->mes_s05;

                                                $data[$i][68]=$regproganual->acump_05; 
                                                $data[$i][69]=$regproganual->acumc_05; 
                                                $data[$i][70]=$regproganual->acum_p05; 
                                                $data[$i][71]=$regproganual->smf_05; 
                                                $data[$i][72]=$regproganual->obs_05;    

                                                $data[$i][73]=$regproganual->mesp_06;
                                                $data[$i][74]=$regproganual->mesc_06;
                                                $data[$i][75]=$regproganual->mes_p06;
                                                $data[$i][76]=$regproganual->mes_s06;

                                                $data[$i][77]=$regproganual->acump_06; 
                                                $data[$i][78]=$regproganual->acumc_06; 
                                                $data[$i][79]=$regproganual->acum_p06; 
                                                $data[$i][80]=$regproganual->smf_06; 
                                                $data[$i][81]=$regproganual->obs_06; 

                                                $data[$i][82]=$regproganual->trimp_02;
                                                $data[$i][83]=$regproganual->trimc_02;
                                                $data[$i][84]=$regproganual->trim_p02;
                                                $data[$i][85]=$regproganual->trim_s02;

                                                $data[$i][86]=$regproganual->mesp_07;
                                                $data[$i][87]=$regproganual->mesc_07;
                                                $data[$i][88]=$regproganual->mes_p07;
                                                $data[$i][89]=$regproganual->mes_s07;

                                                $data[$i][90]=$regproganual->acump_07; 
                                                $data[$i][91]=$regproganual->acumc_07; 
                                                $data[$i][92]=$regproganual->acum_p07; 
                                                $data[$i][93]=$regproganual->smf_07; 
                                                $data[$i][94]=$regproganual->obs_07; 

                                                $data[$i][95]=$regproganual->mesp_08;
                                                $data[$i][96]=$regproganual->mesc_08;
                                                $data[$i][97]=$regproganual->mes_p08;
                                                $data[$i][98]=$regproganual->mes_s08;

                                                $data[$i][99]=$regproganual->acump_08; 
                                                $data[$i][100]=$regproganual->acumc_08; 
                                                $data[$i][101]=$regproganual->acum_p08; 
                                                $data[$i][102]=$regproganual->smf_08; 
                                                $data[$i][103]=$regproganual->obs_08; 

                                                $data[$i][104]=$regproganual->mesp_09;
                                                $data[$i][105]=$regproganual->mesc_09;
                                                $data[$i][106]=$regproganual->mes_p09;
                                                $data[$i][107]=$regproganual->mes_s09;

                                                $data[$i][108] =$regproganual->acump_09; 
                                                $data[$i][109] =$regproganual->acumc_09; 
                                                $data[$i][110] =$regproganual->acum_p09; 
                                                $data[$i][111]=$regproganual->smf_09; 
                                                $data[$i][112]=$regproganual->obs_09; 

                                                $data[$i][113]=$regproganual->trimp_03;
                                                $data[$i][114]=$regproganual->trimc_03;
                                                $data[$i][115]=$regproganual->trim_p03;
                                                $data[$i][116]=$regproganual->trim_s03; 
 
                                                $data[$i][117]=$regproganual->objetivo_desc;    
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                         ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                         ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                                         ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10') 
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIM_P02',

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                       'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                       'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                       'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                       'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                       'SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIM_P03',

                                                       'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                       'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                            
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")     
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_08")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_09")  
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S03") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_10") 
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                               
                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07,
                                                               $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                               $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                               $regproganual->obs_08,
                                                               $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                               $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                               $regproganual->obs_09,
                                                               $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03,
                                                               
                                                               $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                               $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                               $regproganual->obs_10
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_10;
                                                $data[$i][16]=$regproganual->mesc_10;
                                                $data[$i][17]=$regproganual->mes_p10;
                                                $data[$i][18]=$regproganual->mes_s10;

                                                $data[$i][19]=$regproganual->acump_10; 
                                                $data[$i][20]=$regproganual->acumc_10; 
                                                $data[$i][21]=$regproganual->acum_p10; 
                                                $data[$i][22]=$regproganual->smf_10; 
                                                $data[$i][23]=$regproganual->obs_10;

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->mesp_02;
                                                $data[$i][34]=$regproganual->mesc_02;
                                                $data[$i][35]=$regproganual->mes_p02;
                                                $data[$i][36]=$regproganual->mes_s02;

                                                $data[$i][37]=$regproganual->acump_02; 
                                                $data[$i][38]=$regproganual->acumc_02; 
                                                $data[$i][39]=$regproganual->acum_p02; 
                                                $data[$i][40]=$regproganual->smf_02; 
                                                $data[$i][41]=$regproganual->obs_02; 

                                                $data[$i][42]=$regproganual->mesp_03;
                                                $data[$i][43]=$regproganual->mesc_03;
                                                $data[$i][44]=$regproganual->mes_p03;
                                                $data[$i][45]=$regproganual->mes_s03;

                                                $data[$i][46]=$regproganual->acump_03; 
                                                $data[$i][47]=$regproganual->acumc_03; 
                                                $data[$i][48]=$regproganual->acum_p03; 
                                                $data[$i][49]=$regproganual->smf_03; 
                                                $data[$i][50]=$regproganual->obs_03;
                                                
                                                $data[$i][51]=$regproganual->trimp_01;
                                                $data[$i][52]=$regproganual->trimc_01;
                                                $data[$i][53]=$regproganual->trim_p01;
                                                $data[$i][54]=$regproganual->trim_s01; 

                                                $data[$i][55]=$regproganual->mesp_04;
                                                $data[$i][56]=$regproganual->mesc_04;
                                                $data[$i][57]=$regproganual->mes_p04;
                                                $data[$i][58]=$regproganual->mes_s04;

                                                $data[$i][59]=$regproganual->acump_04; 
                                                $data[$i][60]=$regproganual->acumc_04; 
                                                $data[$i][61]=$regproganual->acum_p04; 
                                                $data[$i][62]=$regproganual->smf_04; 
                                                $data[$i][63]=$regproganual->obs_04; 

                                                $data[$i][64]=$regproganual->mesp_05;
                                                $data[$i][65]=$regproganual->mesc_05;
                                                $data[$i][66]=$regproganual->mes_p05;
                                                $data[$i][67]=$regproganual->mes_s05;

                                                $data[$i][68]=$regproganual->acump_05; 
                                                $data[$i][69]=$regproganual->acumc_05; 
                                                $data[$i][70]=$regproganual->acum_p05; 
                                                $data[$i][71]=$regproganual->smf_05; 
                                                $data[$i][72]=$regproganual->obs_05;    

                                                $data[$i][73]=$regproganual->mesp_06;
                                                $data[$i][74]=$regproganual->mesc_06;
                                                $data[$i][75]=$regproganual->mes_p06;
                                                $data[$i][76]=$regproganual->mes_s06;

                                                $data[$i][77]=$regproganual->acump_06; 
                                                $data[$i][78]=$regproganual->acumc_06; 
                                                $data[$i][79]=$regproganual->acum_p06; 
                                                $data[$i][80]=$regproganual->smf_06; 
                                                $data[$i][81]=$regproganual->obs_06; 

                                                $data[$i][82]=$regproganual->trimp_02;
                                                $data[$i][83]=$regproganual->trimc_02;
                                                $data[$i][84]=$regproganual->trim_p02;
                                                $data[$i][85]=$regproganual->trim_s02;

                                                $data[$i][86]=$regproganual->mesp_07;
                                                $data[$i][87]=$regproganual->mesc_07;
                                                $data[$i][88]=$regproganual->mes_p07;
                                                $data[$i][89]=$regproganual->mes_s07;

                                                $data[$i][90]=$regproganual->acump_07; 
                                                $data[$i][91]=$regproganual->acumc_07; 
                                                $data[$i][92]=$regproganual->acum_p07; 
                                                $data[$i][93]=$regproganual->smf_07; 
                                                $data[$i][94]=$regproganual->obs_07; 

                                                $data[$i][95]=$regproganual->mesp_08;
                                                $data[$i][96]=$regproganual->mesc_08;
                                                $data[$i][97]=$regproganual->mes_p08;
                                                $data[$i][98]=$regproganual->mes_s08;

                                                $data[$i][99]=$regproganual->acump_08; 
                                                $data[$i][100]=$regproganual->acumc_08; 
                                                $data[$i][101]=$regproganual->acum_p08; 
                                                $data[$i][102]=$regproganual->smf_08; 
                                                $data[$i][103]=$regproganual->obs_08; 

                                                $data[$i][104]=$regproganual->mesp_09;
                                                $data[$i][105]=$regproganual->mesc_09;
                                                $data[$i][106]=$regproganual->mes_p09;
                                                $data[$i][107]=$regproganual->mes_s09;

                                                $data[$i][108] =$regproganual->acump_09; 
                                                $data[$i][109] =$regproganual->acumc_09; 
                                                $data[$i][110] =$regproganual->acum_p09; 
                                                $data[$i][111]=$regproganual->smf_09; 
                                                $data[$i][112]=$regproganual->obs_09; 

                                                $data[$i][113]=$regproganual->trimp_03;
                                                $data[$i][114]=$regproganual->trimc_03;
                                                $data[$i][115]=$regproganual->trim_p03;
                                                $data[$i][116]=$regproganual->trim_s03; 
   
                                                $data[$i][117]=$regproganual->objetivo_desc;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 10

                        case '11':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                     ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                     ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                     ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                     ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                     ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                     ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                     ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                                     ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10') 
                                                                     ->join('SIEVAD_CAT_COLORES_11',  'SIEVAD_CAT_COLORES_11.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_11')
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIM_P02',

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                       'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                       'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                       'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                       'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                       'SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIM_P03',

                                                       'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                       'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10',
                                                       'SIEVAD_DPA.MESP_11' ,'SIEVAD_DPA.MESC_11' ,'SIEVAD_DPA.MES_P11' ,'SIEVAD_CAT_COLORES_11.COLOR_COLOR AS MES_S11', 
                                                       'SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.OBS_11' ,
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                                                                                  
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")  
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_08")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_09")  
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S03") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_10") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S11
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_11")   

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                               
                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07,
                                                               $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                               $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                               $regproganual->obs_08,
                                                               $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                               $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                               $regproganual->obs_09,
                                                               $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03,
                                                               
                                                               $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                               $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                               $regproganual->obs_10,
                                                               $regproganual->mesp_11,   $regproganual->mesc_11,  $regproganual->mes_p11, $regproganual->mes_s11,  
                                                               $regproganual->acump_11,  $regproganual->acumc_11, $regproganual->acum_p11,$regproganual->smf_11,
                                                               $regproganual->obs_11
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_11;
                                                $data[$i][16]=$regproganual->mesc_11;
                                                $data[$i][17]=$regproganual->mes_p11;
                                                $data[$i][18]=$regproganual->mes_s11;

                                                $data[$i][19]=$regproganual->acump_11; 
                                                $data[$i][20]=$regproganual->acumc_11; 
                                                $data[$i][21]=$regproganual->acum_p11; 
                                                $data[$i][22]=$regproganual->smf_11; 
                                                $data[$i][23]=$regproganual->obs_11;

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->mesp_02;
                                                $data[$i][34]=$regproganual->mesc_02;
                                                $data[$i][35]=$regproganual->mes_p02;
                                                $data[$i][36]=$regproganual->mes_s02;

                                                $data[$i][37]=$regproganual->acump_02; 
                                                $data[$i][38]=$regproganual->acumc_02; 
                                                $data[$i][39]=$regproganual->acum_p02; 
                                                $data[$i][40]=$regproganual->smf_02; 
                                                $data[$i][41]=$regproganual->obs_02; 

                                                $data[$i][42]=$regproganual->mesp_03;
                                                $data[$i][43]=$regproganual->mesc_03;
                                                $data[$i][44]=$regproganual->mes_p03;
                                                $data[$i][45]=$regproganual->mes_s03;

                                                $data[$i][46]=$regproganual->acump_03; 
                                                $data[$i][47]=$regproganual->acumc_03; 
                                                $data[$i][48]=$regproganual->acum_p03; 
                                                $data[$i][49]=$regproganual->smf_03; 
                                                $data[$i][50]=$regproganual->obs_03;
                                                
                                                $data[$i][51]=$regproganual->trimp_01;
                                                $data[$i][52]=$regproganual->trimc_01;
                                                $data[$i][53]=$regproganual->trim_p01;
                                                $data[$i][54]=$regproganual->trim_s01; 

                                                $data[$i][55]=$regproganual->mesp_04;
                                                $data[$i][56]=$regproganual->mesc_04;
                                                $data[$i][57]=$regproganual->mes_p04;
                                                $data[$i][58]=$regproganual->mes_s04;

                                                $data[$i][59]=$regproganual->acump_04; 
                                                $data[$i][60]=$regproganual->acumc_04; 
                                                $data[$i][61]=$regproganual->acum_p04; 
                                                $data[$i][62]=$regproganual->smf_04; 
                                                $data[$i][63]=$regproganual->obs_04; 

                                                $data[$i][64]=$regproganual->mesp_05;
                                                $data[$i][65]=$regproganual->mesc_05;
                                                $data[$i][66]=$regproganual->mes_p05;
                                                $data[$i][67]=$regproganual->mes_s05;

                                                $data[$i][68]=$regproganual->acump_05; 
                                                $data[$i][69]=$regproganual->acumc_05; 
                                                $data[$i][70]=$regproganual->acum_p05; 
                                                $data[$i][71]=$regproganual->smf_05; 
                                                $data[$i][72]=$regproganual->obs_05;    

                                                $data[$i][73]=$regproganual->mesp_06;
                                                $data[$i][74]=$regproganual->mesc_06;
                                                $data[$i][75]=$regproganual->mes_p06;
                                                $data[$i][76]=$regproganual->mes_s06;

                                                $data[$i][77]=$regproganual->acump_06; 
                                                $data[$i][78]=$regproganual->acumc_06; 
                                                $data[$i][79]=$regproganual->acum_p06; 
                                                $data[$i][80]=$regproganual->smf_06; 
                                                $data[$i][81]=$regproganual->obs_06; 

                                                $data[$i][82]=$regproganual->trimp_02;
                                                $data[$i][83]=$regproganual->trimc_02;
                                                $data[$i][84]=$regproganual->trim_p02;
                                                $data[$i][85]=$regproganual->trim_s02;

                                                $data[$i][86]=$regproganual->mesp_07;
                                                $data[$i][87]=$regproganual->mesc_07;
                                                $data[$i][88]=$regproganual->mes_p07;
                                                $data[$i][89]=$regproganual->mes_s07;

                                                $data[$i][90]=$regproganual->acump_07; 
                                                $data[$i][91]=$regproganual->acumc_07; 
                                                $data[$i][92]=$regproganual->acum_p07; 
                                                $data[$i][93]=$regproganual->smf_07; 
                                                $data[$i][94]=$regproganual->obs_07; 

                                                $data[$i][95]=$regproganual->mesp_08;
                                                $data[$i][96]=$regproganual->mesc_08;
                                                $data[$i][97]=$regproganual->mes_p08;
                                                $data[$i][98]=$regproganual->mes_s08;

                                                $data[$i][99]=$regproganual->acump_08; 
                                                $data[$i][100]=$regproganual->acumc_08; 
                                                $data[$i][101]=$regproganual->acum_p08; 
                                                $data[$i][102]=$regproganual->smf_08; 
                                                $data[$i][103]=$regproganual->obs_08; 

                                                $data[$i][104]=$regproganual->mesp_09;
                                                $data[$i][105]=$regproganual->mesc_09;
                                                $data[$i][106]=$regproganual->mes_p09;
                                                $data[$i][107]=$regproganual->mes_s09;

                                                $data[$i][108] =$regproganual->acump_09; 
                                                $data[$i][109]=$regproganual->acumc_09; 
                                                $data[$i][110]=$regproganual->acum_p09; 
                                                $data[$i][111]=$regproganual->smf_09; 
                                                $data[$i][112]=$regproganual->obs_09; 

                                                $data[$i][113]=$regproganual->trimp_03;
                                                $data[$i][114]=$regproganual->trimc_03;
                                                $data[$i][115]=$regproganual->trim_p03;
                                                $data[$i][116]=$regproganual->trim_s03; 

                                                $data[$i][117]=$regproganual->mesp_10;
                                                $data[$i][118]=$regproganual->mesc_10;
                                                $data[$i][119]=$regproganual->mes_p10;
                                                $data[$i][120]=$regproganual->mes_s10;

                                                $data[$i][121]=$regproganual->acump_10; 
                                                $data[$i][122]=$regproganual->acumc_10; 
                                                $data[$i][123]=$regproganual->acum_p10; 
                                                $data[$i][124]=$regproganual->smf_10; 
                                                $data[$i][125]=$regproganual->obs_10; 
 
                                                $data[$i][126]=$regproganual->objetivo_desc;    
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                         ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                         ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                                         ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10') 
                                                                         ->join('SIEVAD_CAT_COLORES_11',  'SIEVAD_CAT_COLORES_11.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_11')
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIM_P02', 

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                       'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                       'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                       'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                       'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                       'SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIM_P03',     

                                                       'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                       'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10',
                                                       'SIEVAD_DPA.MESP_11' ,'SIEVAD_DPA.MESC_11' ,'SIEVAD_DPA.MES_P11' ,'SIEVAD_CAT_COLORES_11.COLOR_COLOR AS MES_S11', 
                                                       'SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.OBS_11' ,
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                                                                                
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")    
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_08")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_09")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_10") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S11
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_11")   
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P04 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 >= 90) AND (SIEVAD_DPA.TRIM_P04 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 >= 70) AND (SIEVAD_DPA.TRIM_P04 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 >= 50) AND (SIEVAD_DPA.TRIM_P04 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 >  0)  AND (SIEVAD_DPA.TRIM_P04 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S04")                                            
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                               
                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07,
                                                               $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                               $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                               $regproganual->obs_08,
                                                               $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                               $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                               $regproganual->obs_09,
                                                               $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03,
                                                               
                                                               $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                               $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                               $regproganual->obs_10,
                                                               $regproganual->mesp_11,   $regproganual->mesc_11,  $regproganual->mes_p11, $regproganual->mes_s11,  
                                                               $regproganual->acump_11,  $regproganual->acumc_11, $regproganual->acum_p11,$regproganual->smf_11,
                                                               $regproganual->obs_11
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_11;
                                                $data[$i][16]=$regproganual->mesc_11;
                                                $data[$i][17]=$regproganual->mes_p11;
                                                $data[$i][18]=$regproganual->mes_s11;

                                                $data[$i][19]=$regproganual->acump_11; 
                                                $data[$i][20]=$regproganual->acumc_11; 
                                                $data[$i][21]=$regproganual->acum_p11; 
                                                $data[$i][22]=$regproganual->smf_11; 
                                                $data[$i][23]=$regproganual->obs_11;

                                                $data[$i][24]=$regproganual->mesp_01;
                                                $data[$i][25]=$regproganual->mesc_01;
                                                $data[$i][26]=$regproganual->mes_p01;
                                                $data[$i][27]=$regproganual->mes_s01;

                                                $data[$i][28]=$regproganual->acump_01; 
                                                $data[$i][29]=$regproganual->acumc_01; 
                                                $data[$i][30]=$regproganual->acum_p01; 
                                                $data[$i][31]=$regproganual->smf_01; 
                                                $data[$i][32]=$regproganual->obs_01; 

                                                $data[$i][33]=$regproganual->mesp_02;
                                                $data[$i][34]=$regproganual->mesc_02;
                                                $data[$i][35]=$regproganual->mes_p02;
                                                $data[$i][36]=$regproganual->mes_s02;

                                                $data[$i][37]=$regproganual->acump_02; 
                                                $data[$i][38]=$regproganual->acumc_02; 
                                                $data[$i][39]=$regproganual->acum_p02; 
                                                $data[$i][40]=$regproganual->smf_02; 
                                                $data[$i][41]=$regproganual->obs_02; 

                                                $data[$i][42]=$regproganual->mesp_03;
                                                $data[$i][43]=$regproganual->mesc_03;
                                                $data[$i][44]=$regproganual->mes_p03;
                                                $data[$i][45]=$regproganual->mes_s03;

                                                $data[$i][46]=$regproganual->acump_03; 
                                                $data[$i][47]=$regproganual->acumc_03; 
                                                $data[$i][48]=$regproganual->acum_p03; 
                                                $data[$i][49]=$regproganual->smf_03; 
                                                $data[$i][50]=$regproganual->obs_03;
                                                
                                                $data[$i][51]=$regproganual->trimp_01;
                                                $data[$i][52]=$regproganual->trimc_01;
                                                $data[$i][53]=$regproganual->trim_p01;
                                                $data[$i][54]=$regproganual->trim_s01; 

                                                $data[$i][55]=$regproganual->mesp_04;
                                                $data[$i][56]=$regproganual->mesc_04;
                                                $data[$i][57]=$regproganual->mes_p04;
                                                $data[$i][58]=$regproganual->mes_s04;

                                                $data[$i][59]=$regproganual->acump_04; 
                                                $data[$i][60]=$regproganual->acumc_04; 
                                                $data[$i][61]=$regproganual->acum_p04; 
                                                $data[$i][62]=$regproganual->smf_04; 
                                                $data[$i][63]=$regproganual->obs_04; 

                                                $data[$i][64]=$regproganual->mesp_05;
                                                $data[$i][65]=$regproganual->mesc_05;
                                                $data[$i][66]=$regproganual->mes_p05;
                                                $data[$i][67]=$regproganual->mes_s05;

                                                $data[$i][68]=$regproganual->acump_05; 
                                                $data[$i][69]=$regproganual->acumc_05; 
                                                $data[$i][70]=$regproganual->acum_p05; 
                                                $data[$i][71]=$regproganual->smf_05; 
                                                $data[$i][72]=$regproganual->obs_05;    

                                                $data[$i][73]=$regproganual->mesp_06;
                                                $data[$i][74]=$regproganual->mesc_06;
                                                $data[$i][75]=$regproganual->mes_p06;
                                                $data[$i][76]=$regproganual->mes_s06;

                                                $data[$i][77]=$regproganual->acump_06; 
                                                $data[$i][78]=$regproganual->acumc_06; 
                                                $data[$i][79]=$regproganual->acum_p06; 
                                                $data[$i][80]=$regproganual->smf_06; 
                                                $data[$i][81]=$regproganual->obs_06; 

                                                $data[$i][82]=$regproganual->trimp_02;
                                                $data[$i][83]=$regproganual->trimc_02;
                                                $data[$i][84]=$regproganual->trim_p02;
                                                $data[$i][85]=$regproganual->trim_s02;

                                                $data[$i][86]=$regproganual->mesp_07;
                                                $data[$i][87]=$regproganual->mesc_07;
                                                $data[$i][88]=$regproganual->mes_p07;
                                                $data[$i][89]=$regproganual->mes_s07;

                                                $data[$i][90]=$regproganual->acump_07; 
                                                $data[$i][91]=$regproganual->acumc_07; 
                                                $data[$i][92]=$regproganual->acum_p07; 
                                                $data[$i][93]=$regproganual->smf_07; 
                                                $data[$i][94]=$regproganual->obs_07; 

                                                $data[$i][95]=$regproganual->mesp_08;
                                                $data[$i][96]=$regproganual->mesc_08;
                                                $data[$i][97]=$regproganual->mes_p08;
                                                $data[$i][98]=$regproganual->mes_s08;

                                                $data[$i][99]=$regproganual->acump_08; 
                                                $data[$i][100]=$regproganual->acumc_08; 
                                                $data[$i][101]=$regproganual->acum_p08; 
                                                $data[$i][102]=$regproganual->smf_08; 
                                                $data[$i][103]=$regproganual->obs_08; 

                                                $data[$i][104]=$regproganual->mesp_09;
                                                $data[$i][105]=$regproganual->mesc_09;
                                                $data[$i][106]=$regproganual->mes_p09;
                                                $data[$i][107]=$regproganual->mes_s09;

                                                $data[$i][108] =$regproganual->acump_09; 
                                                $data[$i][109]=$regproganual->acumc_09; 
                                                $data[$i][110]=$regproganual->acum_p09; 
                                                $data[$i][111]=$regproganual->smf_09; 
                                                $data[$i][112]=$regproganual->obs_09; 

                                                $data[$i][113]=$regproganual->trimp_03;
                                                $data[$i][114]=$regproganual->trimc_03;
                                                $data[$i][115]=$regproganual->trim_p03;
                                                $data[$i][116]=$regproganual->trim_s03; 

                                                $data[$i][117]=$regproganual->mesp_10;
                                                $data[$i][118]=$regproganual->mesc_10;
                                                $data[$i][119]=$regproganual->mes_p10;
                                                $data[$i][120]=$regproganual->mes_s10;

                                                $data[$i][121]=$regproganual->acump_10; 
                                                $data[$i][122]=$regproganual->acumc_10; 
                                                $data[$i][123]=$regproganual->acum_p10; 
                                                $data[$i][124]=$regproganual->smf_10; 
                                                $data[$i][125]=$regproganual->obs_10; 
 
                                                $data[$i][126]=$regproganual->objetivo_desc;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                            break;     // case 11

                        case '12':
                            if($request->taccion_id == '0' ){   
                                $i =0;
                                foreach($op as $key => $val) {
                                    $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                    $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                     ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                     ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                     ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')                                                                    
                                                                     ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                     ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                     ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                     ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                     ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                     ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                     ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                     ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                     ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                                     ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10') 
                                                                     ->join('SIEVAD_CAT_COLORES_11',  'SIEVAD_CAT_COLORES_11.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_11')
                                                                     ->join('SIEVAD_CAT_COLORES_12',  'SIEVAD_CAT_COLORES_12.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_12') 
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIM_P01',                                                       

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIM_P02',   

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                       'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                       'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                       'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                       'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                       'SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIM_P03',

                                                       'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                       'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10',
                                                       'SIEVAD_DPA.MESP_11' ,'SIEVAD_DPA.MESC_11' ,'SIEVAD_DPA.MES_P11' ,'SIEVAD_CAT_COLORES_11.COLOR_COLOR AS MES_S11', 
                                                       'SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.OBS_11',
                                                       'SIEVAD_DPA.MESP_12' ,'SIEVAD_DPA.MESC_12' ,'SIEVAD_DPA.MES_P12' ,'SIEVAD_CAT_COLORES_12.COLOR_COLOR AS MES_S12', 
                                                       'SIEVAD_DPA.ACUMP_12','SIEVAD_DPA.ACUMC_12','SIEVAD_DPA.ACUM_P12','SIEVAD_DPA.OBS_12',

                                                       'SIEVAD_DPA.TRIMP_04','SIEVAD_DPA.TRIMC_04','SIEVAD_DPA.TRIM_P04',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                       
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")    
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_08")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_09")  
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S03") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_10") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S11
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_11")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S12
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_12")  
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P04 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 >= 90) AND (SIEVAD_DPA.TRIM_P04 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 >= 70) AND (SIEVAD_DPA.TRIM_P04 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 >= 50) AND (SIEVAD_DPA.TRIM_P04 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 >  0)  AND (SIEVAD_DPA.TRIM_P04 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S04")    

                                           ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                           ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                           ->get();
                                    if($regprogeanual->count() > 0){
                                        foreach($regprogeanual as $regproganual){
                                            $i++;
                                            $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                               
                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07,
                                                               $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                               $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                               $regproganual->obs_08,
                                                               $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                               $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                               $regproganual->obs_09,
                                                               $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03,
                                                               
                                                               $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                               $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                               $regproganual->obs_10,
                                                               $regproganual->mesp_11,   $regproganual->mesc_11,  $regproganual->mes_p11, $regproganual->mes_s11,  
                                                               $regproganual->acump_11,  $regproganual->acumc_11, $regproganual->acum_p11,$regproganual->smf_11,
                                                               $regproganual->obs_11,
                                                               $regproganual->mesp_12,   $regproganual->mesc_12,  $regproganual->mes_p12, $regproganual->mes_s12,  
                                                               $regproganual->acump_12,  $regproganual->acumc_12, $regproganual->acum_p12,$regproganual->smf_12,
                                                               $regproganual->obs_12,
                                                               $regproganual->trimp_04,  $regproganual->trimc_04, $regproganual->trim_p04,$regproganual->trim_s04
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_12;
                                                $data[$i][16]=$regproganual->mesc_12;
                                                $data[$i][17]=$regproganual->mes_p12;
                                                $data[$i][18]=$regproganual->mes_s12;

                                                $data[$i][19]=$regproganual->acump_12; 
                                                $data[$i][20]=$regproganual->acumc_12; 
                                                $data[$i][21]=$regproganual->acum_p12; 
                                                $data[$i][22]=$regproganual->smf_12; 
                                                $data[$i][23]=$regproganual->obs_12; 

                                                $data[$i][24]=$regproganual->trimp_04;
                                                $data[$i][25]=$regproganual->trimc_04;
                                                $data[$i][26]=$regproganual->trim_p04;
                                                $data[$i][27]=$regproganual->trim_s04; 

                                                $data[$i][28]=$regproganual->mesp_01;
                                                $data[$i][29]=$regproganual->mesc_01;
                                                $data[$i][30]=$regproganual->mes_p01;
                                                $data[$i][31]=$regproganual->mes_s01;

                                                $data[$i][32]=$regproganual->acump_01; 
                                                $data[$i][33]=$regproganual->acumc_01; 
                                                $data[$i][34]=$regproganual->acum_p01; 
                                                $data[$i][35]=$regproganual->smf_01; 
                                                $data[$i][36]=$regproganual->obs_01; 

                                                $data[$i][37]=$regproganual->mesp_02;
                                                $data[$i][38]=$regproganual->mesc_02;
                                                $data[$i][39]=$regproganual->mes_p02;
                                                $data[$i][40]=$regproganual->mes_s02;

                                                $data[$i][41]=$regproganual->acump_02; 
                                                $data[$i][42]=$regproganual->acumc_02; 
                                                $data[$i][43]=$regproganual->acum_p02; 
                                                $data[$i][44]=$regproganual->smf_02; 
                                                $data[$i][45]=$regproganual->obs_02; 

                                                $data[$i][46]=$regproganual->mesp_03;
                                                $data[$i][47]=$regproganual->mesc_03;
                                                $data[$i][48]=$regproganual->mes_p03;
                                                $data[$i][49]=$regproganual->mes_s03;

                                                $data[$i][50]=$regproganual->acump_03; 
                                                $data[$i][51]=$regproganual->acumc_03; 
                                                $data[$i][52]=$regproganual->acum_p03; 
                                                $data[$i][53]=$regproganual->smf_03; 
                                                $data[$i][54]=$regproganual->obs_03;
                                                
                                                $data[$i][55]=$regproganual->trimp_01;
                                                $data[$i][56]=$regproganual->trimc_01;
                                                $data[$i][57]=$regproganual->trim_p01;
                                                $data[$i][58]=$regproganual->trim_s01; 

                                                $data[$i][59]=$regproganual->mesp_04;
                                                $data[$i][60]=$regproganual->mesc_04;
                                                $data[$i][61]=$regproganual->mes_p04;
                                                $data[$i][62]=$regproganual->mes_s04;

                                                $data[$i][63]=$regproganual->acump_04; 
                                                $data[$i][64]=$regproganual->acumc_04; 
                                                $data[$i][65]=$regproganual->acum_p04; 
                                                $data[$i][66]=$regproganual->smf_04; 
                                                $data[$i][67]=$regproganual->obs_04; 

                                                $data[$i][68]=$regproganual->mesp_05;
                                                $data[$i][69]=$regproganual->mesc_05;
                                                $data[$i][70]=$regproganual->mes_p05;
                                                $data[$i][71]=$regproganual->mes_s05;

                                                $data[$i][72]=$regproganual->acump_05; 
                                                $data[$i][73]=$regproganual->acumc_05; 
                                                $data[$i][74]=$regproganual->acum_p05; 
                                                $data[$i][75]=$regproganual->smf_05; 
                                                $data[$i][76]=$regproganual->obs_05;    

                                                $data[$i][77]=$regproganual->mesp_06;
                                                $data[$i][78]=$regproganual->mesc_06;
                                                $data[$i][79]=$regproganual->mes_p06;
                                                $data[$i][80]=$regproganual->mes_s06;

                                                $data[$i][81]=$regproganual->acump_06; 
                                                $data[$i][82]=$regproganual->acumc_06; 
                                                $data[$i][83]=$regproganual->acum_p06; 
                                                $data[$i][84]=$regproganual->smf_06; 
                                                $data[$i][85]=$regproganual->obs_06; 

                                                $data[$i][86]=$regproganual->trimp_02;
                                                $data[$i][87]=$regproganual->trimc_02;
                                                $data[$i][88]=$regproganual->trim_p02;
                                                $data[$i][89]=$regproganual->trim_s02;

                                                $data[$i][90]=$regproganual->mesp_07;
                                                $data[$i][91]=$regproganual->mesc_07;
                                                $data[$i][92]=$regproganual->mes_p07;
                                                $data[$i][93]=$regproganual->mes_s07;

                                                $data[$i][94]=$regproganual->acump_07; 
                                                $data[$i][95]=$regproganual->acumc_07; 
                                                $data[$i][96]=$regproganual->acum_p07; 
                                                $data[$i][97]=$regproganual->smf_07; 
                                                $data[$i][98]=$regproganual->obs_07; 

                                                $data[$i][99]=$regproganual->mesp_08;
                                                $data[$i][100]=$regproganual->mesc_08;
                                                $data[$i][101]=$regproganual->mes_p08;
                                                $data[$i][102]=$regproganual->mes_s08;

                                                $data[$i][103]=$regproganual->acump_08; 
                                                $data[$i][104]=$regproganual->acumc_08; 
                                                $data[$i][105]=$regproganual->acum_p08; 
                                                $data[$i][106]=$regproganual->smf_08; 
                                                $data[$i][107]=$regproganual->obs_08; 

                                                $data[$i][108]=$regproganual->mesp_09;
                                                $data[$i][109]=$regproganual->mesc_09;
                                                $data[$i][110]=$regproganual->mes_p09;
                                                $data[$i][111]=$regproganual->mes_s09;

                                                $data[$i][112] =$regproganual->acump_09; 
                                                $data[$i][113] =$regproganual->acumc_09; 
                                                $data[$i][114] =$regproganual->acum_p09; 
                                                $data[$i][115]=$regproganual->smf_09; 
                                                $data[$i][116]=$regproganual->obs_09; 

                                                $data[$i][117]=$regproganual->trimp_03;
                                                $data[$i][118]=$regproganual->trimc_03;
                                                $data[$i][119]=$regproganual->trim_p03;
                                                $data[$i][120]=$regproganual->trim_s03; 

                                                $data[$i][121]=$regproganual->mesp_10;
                                                $data[$i][122]=$regproganual->mesc_10;
                                                $data[$i][123]=$regproganual->mes_p10;
                                                $data[$i][124]=$regproganual->mes_s10;

                                                $data[$i][125]=$regproganual->acump_10; 
                                                $data[$i][126]=$regproganual->acumc_10; 
                                                $data[$i][127]=$regproganual->acum_p10; 
                                                $data[$i][128]=$regproganual->smf_10; 
                                                $data[$i][129]=$regproganual->obs_10; 

                                                $data[$i][130]=$regproganual->mesp_11;
                                                $data[$i][131]=$regproganual->mesc_11;
                                                $data[$i][132]=$regproganual->mes_p11;
                                                $data[$i][133]=$regproganual->mes_s11;

                                                $data[$i][134]=$regproganual->acump_11; 
                                                $data[$i][135]=$regproganual->acumc_11; 
                                                $data[$i][136]=$regproganual->acum_p11; 
                                                $data[$i][137]=$regproganual->smf_11; 
                                                $data[$i][138]=$regproganual->obs_11; 

                                                $data[$i][139]=$regproganual->objetivo_desc;    
                                        }  // foreach($regprogeanual as $regproganual)
                                    }      // if($regprogeanual->count() > 0){
                                }          // foreach 
                            }else{
                                if($request->taccion_id <> '0' ){   
                                    //*********** 3 ********************
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        ///print "$key = $val <br>";
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                         ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                         ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                                         ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10') 
                                                                         ->join('SIEVAD_CAT_COLORES_11',  'SIEVAD_CAT_COLORES_11.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_11')
                                                                         ->join('SIEVAD_CAT_COLORES_12',  'SIEVAD_CAT_COLORES_12.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_12') 
                                                   ->select( 
                                                       'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                       'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                       'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                       'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                       'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                       'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                       'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                       'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                       'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIM_P01',

                                                       'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                       'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                       'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                       'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                       'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                       'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                       'SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIM_P02',                                                       

                                                       'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                       'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                       'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                       'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                       'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                       'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                       'SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIM_P03',

                                                       'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                       'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10',
                                                       'SIEVAD_DPA.MESP_11' ,'SIEVAD_DPA.MESC_11' ,'SIEVAD_DPA.MES_P11' ,'SIEVAD_CAT_COLORES_11.COLOR_COLOR AS MES_S11', 
                                                       'SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.OBS_11',
                                                       'SIEVAD_DPA.MESP_12' ,'SIEVAD_DPA.MESC_12' ,'SIEVAD_DPA.MES_P12' ,'SIEVAD_CAT_COLORES_12.COLOR_COLOR AS MES_S12', 
                                                       'SIEVAD_DPA.ACUMP_12','SIEVAD_DPA.ACUMC_12','SIEVAD_DPA.ACUM_P12','SIEVAD_DPA.OBS_12',

                                                       'SIEVAD_DPA.TRIMP_04','SIEVAD_DPA.TRIMC_04','SIEVAD_DPA.TRIM_P04',
                                                       'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                                                                                                                                                                                               
                                                        )
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_01")   
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_02")      
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_03") 
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S01") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_04") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_05") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_06")   
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S02") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_07")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_08")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_09")  
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S03") 

                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_10") 
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S11
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_11")  
                                           ->selectRaw("CASE SIEVAD_DPA.ACUM_S12
                                                            WHEN 1 THEN 'ROJO'
                                                            WHEN 2 THEN 'NARANJA'
                                                            WHEN 3 THEN 'AMARILLO'
                                                            WHEN 4 THEN 'VERDE'                                              
                                                            WHEN 5 THEN 'MORADO'
                                                        END AS SMF_12")  
                                           ->selectRaw("CASE 
                                                           WHEN (SIEVAD_DPA.TRIM_P04 > 0) THEN 
                                                              CASE
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 > 110)  THEN 'MORADO' 
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 >= 90) AND (SIEVAD_DPA.TRIM_P04 < 110) THEN 'VERDE'
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 >= 70) AND (SIEVAD_DPA.TRIM_P04 <  90) THEN 'AMARILLO'
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 >= 50) AND (SIEVAD_DPA.TRIM_P04 <  70) THEN 'NARANJA'
                                                                  WHEN (SIEVAD_DPA.TRIM_P04 >  0)  AND (SIEVAD_DPA.TRIM_P04 <  50) THEN 'ROJO'
                                                              END
                                                              ELSE NULL 
                                                          END AS TRIM_S04")                                                          
             
                                        ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                        ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                        ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                        ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                        ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                        ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                        ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                        ->get();

                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                               $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                               $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                               $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                               $regproganual->umed_desc,
                                                               $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                               $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                               $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                               $regproganual->obs_01,
                                                               $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                               $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                               $regproganual->obs_02,
                                                               $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                               $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                               $regproganual->obs_03,
                                                               $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                               
                                                               $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                               $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                               $regproganual->obs_04,
                                                               $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                               $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                               $regproganual->obs_05,
                                                               $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                               $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                               $regproganual->obs_06,
                                                               $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                               
                                                               $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                               $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                               $regproganual->obs_07,
                                                               $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                               $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                               $regproganual->obs_08,
                                                               $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                               $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                               $regproganual->obs_09,
                                                               $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03,
                                                               
                                                               $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                               $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                               $regproganual->obs_10,
                                                               $regproganual->mesp_11,   $regproganual->mesc_11,  $regproganual->mes_p11, $regproganual->mes_s11,  
                                                               $regproganual->acump_11,  $regproganual->acumc_11, $regproganual->acum_p11,$regproganual->smf_11,
                                                               $regproganual->obs_11,
                                                               $regproganual->mesp_12,   $regproganual->mesc_12,  $regproganual->mes_p12, $regproganual->mes_s12,  
                                                               $regproganual->acump_12,  $regproganual->acumc_12, $regproganual->acum_p12,$regproganual->smf_12,
                                                               $regproganual->obs_12,
                                                               $regproganual->trimp_04,  $regproganual->trimc_04, $regproganual->trim_p04,$regproganual->trim_s04
                                                              );       
                                                //Array multidimencional
                                                //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                $data[$i][0] =$regproganual->periodo_id;
                                                $data[$i][1] =$regproganual->depen_id2;
                                                $data[$i][2] =$regproganual->depen_desc;
                                                
                                                $data[$i][3] =$regproganual->epproy_id;
                                                $data[$i][4] =$regproganual->epproy_desc; 

                                                $data[$i][5] =$regproganual->folio;
                                                $data[$i][6] =$regproganual->partida;
                                                $data[$i][7] =$regproganual->lgob_cod;
                                                $data[$i][8] =$regproganual->ciprep_id;
                                                $data[$i][9] =$regproganual->actividad_desc;  
                                                $data[$i][10]=$regproganual->umed_desc; 
                                                                        
                                                $data[$i][11]=$regproganual->totp_02;
                                                $data[$i][12]=$regproganual->totc_02;
                                                $data[$i][13]=$regproganual->tot_p01; 
                                                $data[$i][14]=$regproganual->color_color; 

                                                $data[$i][15]=$regproganual->mesp_12;
                                                $data[$i][16]=$regproganual->mesc_12;
                                                $data[$i][17]=$regproganual->mes_p12;
                                                $data[$i][18]=$regproganual->mes_s12;

                                                $data[$i][19]=$regproganual->acump_12; 
                                                $data[$i][20]=$regproganual->acumc_12; 
                                                $data[$i][21]=$regproganual->acum_p12; 
                                                $data[$i][22]=$regproganual->smf_12; 
                                                $data[$i][23]=$regproganual->obs_12; 

                                                $data[$i][24]=$regproganual->trimp_04;
                                                $data[$i][25]=$regproganual->trimc_04;
                                                $data[$i][26]=$regproganual->trim_p04;
                                                $data[$i][27]=$regproganual->trim_s04; 

                                                $data[$i][28]=$regproganual->mesp_01;
                                                $data[$i][29]=$regproganual->mesc_01;
                                                $data[$i][30]=$regproganual->mes_p01;
                                                $data[$i][31]=$regproganual->mes_s01;

                                                $data[$i][32]=$regproganual->acump_01; 
                                                $data[$i][33]=$regproganual->acumc_01; 
                                                $data[$i][34]=$regproganual->acum_p01; 
                                                $data[$i][35]=$regproganual->smf_01; 
                                                $data[$i][36]=$regproganual->obs_01; 

                                                $data[$i][37]=$regproganual->mesp_02;
                                                $data[$i][38]=$regproganual->mesc_02;
                                                $data[$i][39]=$regproganual->mes_p02;
                                                $data[$i][40]=$regproganual->mes_s02;

                                                $data[$i][41]=$regproganual->acump_02; 
                                                $data[$i][42]=$regproganual->acumc_02; 
                                                $data[$i][43]=$regproganual->acum_p02; 
                                                $data[$i][44]=$regproganual->smf_02; 
                                                $data[$i][45]=$regproganual->obs_02; 

                                                $data[$i][46]=$regproganual->mesp_03;
                                                $data[$i][47]=$regproganual->mesc_03;
                                                $data[$i][48]=$regproganual->mes_p03;
                                                $data[$i][49]=$regproganual->mes_s03;

                                                $data[$i][50]=$regproganual->acump_03; 
                                                $data[$i][51]=$regproganual->acumc_03; 
                                                $data[$i][52]=$regproganual->acum_p03; 
                                                $data[$i][53]=$regproganual->smf_03; 
                                                $data[$i][54]=$regproganual->obs_03;
                                                
                                                $data[$i][55]=$regproganual->trimp_01;
                                                $data[$i][56]=$regproganual->trimc_01;
                                                $data[$i][57]=$regproganual->trim_p01;
                                                $data[$i][58]=$regproganual->trim_s01; 

                                                $data[$i][59]=$regproganual->mesp_04;
                                                $data[$i][60]=$regproganual->mesc_04;
                                                $data[$i][61]=$regproganual->mes_p04;
                                                $data[$i][62]=$regproganual->mes_s04;

                                                $data[$i][63]=$regproganual->acump_04; 
                                                $data[$i][64]=$regproganual->acumc_04; 
                                                $data[$i][65]=$regproganual->acum_p04; 
                                                $data[$i][66]=$regproganual->smf_04; 
                                                $data[$i][67]=$regproganual->obs_04; 

                                                $data[$i][68]=$regproganual->mesp_05;
                                                $data[$i][69]=$regproganual->mesc_05;
                                                $data[$i][70]=$regproganual->mes_p05;
                                                $data[$i][71]=$regproganual->mes_s05;

                                                $data[$i][72]=$regproganual->acump_05; 
                                                $data[$i][73]=$regproganual->acumc_05; 
                                                $data[$i][74]=$regproganual->acum_p05; 
                                                $data[$i][75]=$regproganual->smf_05; 
                                                $data[$i][76]=$regproganual->obs_05;    

                                                $data[$i][77]=$regproganual->mesp_06;
                                                $data[$i][78]=$regproganual->mesc_06;
                                                $data[$i][79]=$regproganual->mes_p06;
                                                $data[$i][80]=$regproganual->mes_s06;

                                                $data[$i][81]=$regproganual->acump_06; 
                                                $data[$i][82]=$regproganual->acumc_06; 
                                                $data[$i][83]=$regproganual->acum_p06; 
                                                $data[$i][84]=$regproganual->smf_06; 
                                                $data[$i][85]=$regproganual->obs_06; 

                                                $data[$i][86]=$regproganual->trimp_02;
                                                $data[$i][87]=$regproganual->trimc_02;
                                                $data[$i][88]=$regproganual->trim_p02;
                                                $data[$i][89]=$regproganual->trim_s02;

                                                $data[$i][90]=$regproganual->mesp_07;
                                                $data[$i][91]=$regproganual->mesc_07;
                                                $data[$i][92]=$regproganual->mes_p07;
                                                $data[$i][93]=$regproganual->mes_s07;

                                                $data[$i][94]=$regproganual->acump_07; 
                                                $data[$i][95]=$regproganual->acumc_07; 
                                                $data[$i][96]=$regproganual->acum_p07; 
                                                $data[$i][97]=$regproganual->smf_07; 
                                                $data[$i][98]=$regproganual->obs_07; 

                                                $data[$i][99]=$regproganual->mesp_08;
                                                $data[$i][100]=$regproganual->mesc_08;
                                                $data[$i][101]=$regproganual->mes_p08;
                                                $data[$i][102]=$regproganual->mes_s08;

                                                $data[$i][103]=$regproganual->acump_08; 
                                                $data[$i][104]=$regproganual->acumc_08; 
                                                $data[$i][105]=$regproganual->acum_p08; 
                                                $data[$i][106]=$regproganual->smf_08; 
                                                $data[$i][107]=$regproganual->obs_08; 

                                                $data[$i][108]=$regproganual->mesp_09;
                                                $data[$i][109]=$regproganual->mesc_09;
                                                $data[$i][110]=$regproganual->mes_p09;
                                                $data[$i][111]=$regproganual->mes_s09;

                                                $data[$i][112] =$regproganual->acump_09; 
                                                $data[$i][113] =$regproganual->acumc_09; 
                                                $data[$i][114] =$regproganual->acum_p09; 
                                                $data[$i][115]=$regproganual->smf_09; 
                                                $data[$i][116]=$regproganual->obs_09; 

                                                $data[$i][117]=$regproganual->trimp_03;
                                                $data[$i][118]=$regproganual->trimc_03;
                                                $data[$i][119]=$regproganual->trim_p03;
                                                $data[$i][120]=$regproganual->trim_s03; 

                                                $data[$i][121]=$regproganual->mesp_10;
                                                $data[$i][122]=$regproganual->mesc_10;
                                                $data[$i][123]=$regproganual->mes_p10;
                                                $data[$i][124]=$regproganual->mes_s10;

                                                $data[$i][125]=$regproganual->acump_10; 
                                                $data[$i][126]=$regproganual->acumc_10; 
                                                $data[$i][127]=$regproganual->acum_p10; 
                                                $data[$i][128]=$regproganual->smf_10; 
                                                $data[$i][129]=$regproganual->obs_10; 

                                                $data[$i][130]=$regproganual->mesp_11;
                                                $data[$i][131]=$regproganual->mesc_11;
                                                $data[$i][132]=$regproganual->mes_p11;
                                                $data[$i][133]=$regproganual->mes_s11;

                                                $data[$i][134]=$regproganual->acump_11; 
                                                $data[$i][135]=$regproganual->acumc_11; 
                                                $data[$i][136]=$regproganual->acum_p11; 
                                                $data[$i][137]=$regproganual->smf_11; 
                                                $data[$i][138]=$regproganual->obs_11; 
  
                                                $data[$i][139]=$regproganual->objetivo_desc;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){                            
                                    }  // foreach 
                                }      // taccion_id  <> 0
                            }          // taccion_id  == 0  
                        break;         // case 12                                                                                                                                                                                                                                                                        
                    } //swith
                }else{                    
                    //if($request->control <> 'S' ){                   
                        switch($request->mes_id){
                            case '1':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.LGOB_COD',   'SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01                                                                            
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_01;
                                                    $data[$i][16]=$regproganual->mesc_01;
                                                    $data[$i][17]=$regproganual->mes_p01;
                                                    $data[$i][18]=$regproganual->mes_s01;

                                                    $data[$i][19]=$regproganual->acump_01; 
                                                    $data[$i][20]=$regproganual->acumc_01; 
                                                    $data[$i][21]=$regproganual->acum_p01; 
                                                    $data[$i][22]=$regproganual->smf_01; 

                                                    $data[$i][23]=$regproganual->obs_01; 
                                                    $data[$i][24]=$regproganual->objetivo_desc; 

                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                             'SIEVAD_DPA.LGOB_COD',   'SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_01;
                                                    $data[$i][16]=$regproganual->mesc_01;
                                                    $data[$i][17]=$regproganual->mes_p01;
                                                    $data[$i][18]=$regproganual->mes_s01;

                                                    $data[$i][19]=$regproganual->acump_01; 
                                                    $data[$i][20]=$regproganual->acumc_01; 
                                                    $data[$i][21]=$regproganual->acum_p01; 
                                                    $data[$i][22]=$regproganual->smf_01; 
                                                    $data[$i][23]=$regproganual->obs_01;   
                                                    $data[$i][24]=$regproganual->objetivo_desc; 
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 1

                            case '2':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',

                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.LGOB_COD',   'SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")        

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,

                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02                                                               
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_02;
                                                    $data[$i][16]=$regproganual->mesc_02;
                                                    $data[$i][17]=$regproganual->mes_p02;
                                                    $data[$i][18]=$regproganual->mes_s02;

                                                    $data[$i][19]=$regproganual->acump_02; 
                                                    $data[$i][20]=$regproganual->acumc_02; 
                                                    $data[$i][21]=$regproganual->acum_p02; 
                                                    $data[$i][22]=$regproganual->smf_02; 
                                                    $data[$i][23]=$regproganual->obs_02;  

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 
                                                    
                                                    $data[$i][33]=$regproganual->objetivo_desc;                                               
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                             ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',

                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'  
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,

                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02                                                               
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_02;
                                                    $data[$i][16]=$regproganual->mesc_02;
                                                    $data[$i][17]=$regproganual->mes_p02;
                                                    $data[$i][18]=$regproganual->mes_s02;

                                                    $data[$i][19]=$regproganual->acump_02; 
                                                    $data[$i][20]=$regproganual->acumc_02; 
                                                    $data[$i][21]=$regproganual->acum_p02; 
                                                    $data[$i][22]=$regproganual->smf_02; 
                                                    $data[$i][23]=$regproganual->obs_02;    
                                                    
                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->objetivo_desc;
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 2

                            case '3':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03')                                                                         
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',

                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',

                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03',

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC' 
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_03;
                                                    $data[$i][16]=$regproganual->mesc_03;
                                                    $data[$i][17]=$regproganual->mes_p03;
                                                    $data[$i][18]=$regproganual->mes_s03;

                                                    $data[$i][19]=$regproganual->acump_03; 
                                                    $data[$i][20]=$regproganual->acumc_03; 
                                                    $data[$i][21]=$regproganual->acum_p03; 
                                                    $data[$i][22]=$regproganual->smf_03; 
                                                    $data[$i][23]=$regproganual->obs_03; 

                                                    $data[$i][24]=$regproganual->trimp_01;
                                                    $data[$i][25]=$regproganual->trimc_01;
                                                    $data[$i][26]=$regproganual->trim_p01;
                                                    $data[$i][27]=$regproganual->trim_s01; 

                                                    $data[$i][28]=$regproganual->mesp_01;
                                                    $data[$i][29]=$regproganual->mesc_01;
                                                    $data[$i][30]=$regproganual->mes_p01;
                                                    $data[$i][31]=$regproganual->mes_s01;

                                                    $data[$i][32]=$regproganual->acump_01; 
                                                    $data[$i][33]=$regproganual->acumc_01; 
                                                    $data[$i][34]=$regproganual->acum_p01; 
                                                    $data[$i][35]=$regproganual->smf_01; 
                                                    $data[$i][36]=$regproganual->obs_01; 

                                                    $data[$i][37]=$regproganual->mesp_02;
                                                    $data[$i][38]=$regproganual->mesc_02;
                                                    $data[$i][39]=$regproganual->mes_p02;
                                                    $data[$i][40]=$regproganual->mes_s02;

                                                    $data[$i][41]=$regproganual->acump_02; 
                                                    $data[$i][42]=$regproganual->acumc_02; 
                                                    $data[$i][43]=$regproganual->acum_p02; 
                                                    $data[$i][44]=$regproganual->smf_02; 
                                                    $data[$i][45]=$regproganual->obs_02; 

                                                    $data[$i][46]=$regproganual->objetivo_desc;
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                             ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                             ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03')                                                                         
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',

                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',

                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03',

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                             
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01")                                            
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_03;
                                                    $data[$i][16]=$regproganual->mesc_03;
                                                    $data[$i][17]=$regproganual->mes_p03;
                                                    $data[$i][18]=$regproganual->mes_s03;

                                                    $data[$i][19]=$regproganual->acump_03; 
                                                    $data[$i][20]=$regproganual->acumc_03; 
                                                    $data[$i][21]=$regproganual->acum_p03; 
                                                    $data[$i][22]=$regproganual->smf_03; 
                                                    $data[$i][23]=$regproganual->obs_03; 

                                                    $data[$i][24]=$regproganual->trimp_01;
                                                    $data[$i][25]=$regproganual->trimc_01;
                                                    $data[$i][26]=$regproganual->trim_p01;
                                                    $data[$i][27]=$regproganual->trim_s01; 

                                                    $data[$i][28]=$regproganual->mesp_01;
                                                    $data[$i][29]=$regproganual->mesc_01;
                                                    $data[$i][30]=$regproganual->mes_p01;
                                                    $data[$i][31]=$regproganual->mes_s01;

                                                    $data[$i][32]=$regproganual->acump_01; 
                                                    $data[$i][33]=$regproganual->acumc_01; 
                                                    $data[$i][34]=$regproganual->acum_p01; 
                                                    $data[$i][35]=$regproganual->smf_01; 
                                                    $data[$i][36]=$regproganual->obs_01; 

                                                    $data[$i][37]=$regproganual->mesp_02;
                                                    $data[$i][38]=$regproganual->mesc_02;
                                                    $data[$i][39]=$regproganual->mes_p02;
                                                    $data[$i][40]=$regproganual->mes_s02;

                                                    $data[$i][41]=$regproganual->acump_02; 
                                                    $data[$i][42]=$regproganual->acumc_02; 
                                                    $data[$i][43]=$regproganual->acum_p02; 
                                                    $data[$i][44]=$regproganual->smf_02; 
                                                    $data[$i][45]=$regproganual->obs_02; 

                                                    $data[$i][46]=$regproganual->objetivo_desc;                                                
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 3

                            case '4':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04')                                                                                                                                                
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                    
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01")                                            
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04")    

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,

                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_04;
                                                    $data[$i][16]=$regproganual->mesc_04;
                                                    $data[$i][17]=$regproganual->mes_p04;
                                                    $data[$i][18]=$regproganual->mes_s04;

                                                    $data[$i][19]=$regproganual->acump_04; 
                                                    $data[$i][20]=$regproganual->acumc_04; 
                                                    $data[$i][21]=$regproganual->acum_p04; 
                                                    $data[$i][22]=$regproganual->smf_04; 
                                                    $data[$i][23]=$regproganual->obs_04; 

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->mesp_02;
                                                    $data[$i][34]=$regproganual->mesc_02;
                                                    $data[$i][35]=$regproganual->mes_p02;
                                                    $data[$i][36]=$regproganual->mes_s02;

                                                    $data[$i][37]=$regproganual->acump_02; 
                                                    $data[$i][38]=$regproganual->acumc_02; 
                                                    $data[$i][39]=$regproganual->acum_p02; 
                                                    $data[$i][40]=$regproganual->smf_02; 
                                                    $data[$i][41]=$regproganual->obs_02; 

                                                    $data[$i][42]=$regproganual->mesp_03;
                                                    $data[$i][43]=$regproganual->mesc_03;
                                                    $data[$i][44]=$regproganual->mes_p03;
                                                    $data[$i][45]=$regproganual->mes_s03;

                                                    $data[$i][46]=$regproganual->acump_03; 
                                                    $data[$i][47]=$regproganual->acumc_03; 
                                                    $data[$i][48]=$regproganual->acum_p03; 
                                                    $data[$i][49]=$regproganual->smf_03; 
                                                    $data[$i][50]=$regproganual->obs_03;

                                                    $data[$i][51]=$regproganual->trimp_01;
                                                    $data[$i][52]=$regproganual->trimc_01;
                                                    $data[$i][53]=$regproganual->trim_p01;
                                                    $data[$i][54]=$regproganual->trim_s01; 

                                                    $data[$i][55]=$regproganual->objetivo_desc;  
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                             ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                             ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                             ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04')                                                                                                                                                
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                   
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01")                                            
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,

                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_04;
                                                    $data[$i][16]=$regproganual->mesc_04;
                                                    $data[$i][17]=$regproganual->mes_p04;
                                                    $data[$i][18]=$regproganual->mes_s04;

                                                    $data[$i][19]=$regproganual->acump_04; 
                                                    $data[$i][20]=$regproganual->acumc_04; 
                                                    $data[$i][21]=$regproganual->acum_p04; 
                                                    $data[$i][22]=$regproganual->smf_04; 
                                                    $data[$i][23]=$regproganual->obs_04; 

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->mesp_02;
                                                    $data[$i][34]=$regproganual->mesc_02;
                                                    $data[$i][35]=$regproganual->mes_p02;
                                                    $data[$i][36]=$regproganual->mes_s02;

                                                    $data[$i][37]=$regproganual->acump_02; 
                                                    $data[$i][38]=$regproganual->acumc_02; 
                                                    $data[$i][39]=$regproganual->acum_p02; 
                                                    $data[$i][40]=$regproganual->smf_02; 
                                                    $data[$i][41]=$regproganual->obs_02; 

                                                    $data[$i][42]=$regproganual->mesp_03;
                                                    $data[$i][43]=$regproganual->mesc_03;
                                                    $data[$i][44]=$regproganual->mes_p03;
                                                    $data[$i][45]=$regproganual->mes_s03;

                                                    $data[$i][46]=$regproganual->acump_03; 
                                                    $data[$i][47]=$regproganual->acumc_03; 
                                                    $data[$i][48]=$regproganual->acum_p03; 
                                                    $data[$i][49]=$regproganual->smf_03; 
                                                    $data[$i][50]=$regproganual->obs_03;

                                                    $data[$i][51]=$regproganual->trimp_01;
                                                    $data[$i][52]=$regproganual->trimc_01;
                                                    $data[$i][53]=$regproganual->trim_p01;
                                                    $data[$i][54]=$regproganual->trim_s01; 

                                                    $data[$i][55]=$regproganual->objetivo_desc;  
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 4

                            case '5':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')                                                                                                                                                                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                          
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01")                                            
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_05;
                                                    $data[$i][16]=$regproganual->mesc_05;
                                                    $data[$i][17]=$regproganual->mes_p05;
                                                    $data[$i][18]=$regproganual->mes_s05;

                                                    $data[$i][19]=$regproganual->acump_05; 
                                                    $data[$i][20]=$regproganual->acumc_05; 
                                                    $data[$i][21]=$regproganual->acum_p05; 
                                                    $data[$i][22]=$regproganual->smf_05; 
                                                    $data[$i][23]=$regproganual->obs_05; 

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->mesp_02;
                                                    $data[$i][34]=$regproganual->mesc_02;
                                                    $data[$i][35]=$regproganual->mes_p02;
                                                    $data[$i][36]=$regproganual->mes_s02;

                                                    $data[$i][37]=$regproganual->acump_02; 
                                                    $data[$i][38]=$regproganual->acumc_02; 
                                                    $data[$i][39]=$regproganual->acum_p02; 
                                                    $data[$i][40]=$regproganual->smf_02; 
                                                    $data[$i][41]=$regproganual->obs_02; 

                                                    $data[$i][42]=$regproganual->mesp_03;
                                                    $data[$i][43]=$regproganual->mesc_03;
                                                    $data[$i][44]=$regproganual->mes_p03;
                                                    $data[$i][45]=$regproganual->mes_s03;

                                                    $data[$i][46]=$regproganual->acump_03; 
                                                    $data[$i][47]=$regproganual->acumc_03; 
                                                    $data[$i][48]=$regproganual->acum_p03; 
                                                    $data[$i][49]=$regproganual->smf_03; 
                                                    $data[$i][50]=$regproganual->obs_03;
                                                    
                                                    $data[$i][51]=$regproganual->trimp_01;
                                                    $data[$i][52]=$regproganual->trimc_01;
                                                    $data[$i][53]=$regproganual->trim_p01;
                                                    $data[$i][54]=$regproganual->trim_s01; 

                                                    $data[$i][55]=$regproganual->mesp_04;
                                                    $data[$i][56]=$regproganual->mesc_04;
                                                    $data[$i][57]=$regproganual->mes_p04;
                                                    $data[$i][58]=$regproganual->mes_s04;

                                                    $data[$i][59]=$regproganual->acump_04; 
                                                    $data[$i][60]=$regproganual->acumc_04; 
                                                    $data[$i][61]=$regproganual->acum_p04; 
                                                    $data[$i][62]=$regproganual->smf_04; 
                                                    $data[$i][63]=$regproganual->obs_04; 

                                                    $data[$i][64]=$regproganual->objetivo_desc;  
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                             ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                             ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                             ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                             ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')                                                                                                                                                                                                                     
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                          
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01")                                            
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_05;
                                                    $data[$i][16]=$regproganual->mesc_05;
                                                    $data[$i][17]=$regproganual->mes_p05;
                                                    $data[$i][18]=$regproganual->mes_s05;

                                                    $data[$i][19]=$regproganual->acump_05; 
                                                    $data[$i][20]=$regproganual->acumc_05; 
                                                    $data[$i][21]=$regproganual->acum_p05; 
                                                    $data[$i][22]=$regproganual->smf_05; 
                                                    $data[$i][23]=$regproganual->obs_05; 

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->mesp_02;
                                                    $data[$i][34]=$regproganual->mesc_02;
                                                    $data[$i][35]=$regproganual->mes_p02;
                                                    $data[$i][36]=$regproganual->mes_s02;

                                                    $data[$i][37]=$regproganual->acump_02; 
                                                    $data[$i][38]=$regproganual->acumc_02; 
                                                    $data[$i][39]=$regproganual->acum_p02; 
                                                    $data[$i][40]=$regproganual->smf_02; 
                                                    $data[$i][41]=$regproganual->obs_02; 

                                                    $data[$i][42]=$regproganual->mesp_03;
                                                    $data[$i][43]=$regproganual->mesc_03;
                                                    $data[$i][44]=$regproganual->mes_p03;
                                                    $data[$i][45]=$regproganual->mes_s03;

                                                    $data[$i][46]=$regproganual->acump_03; 
                                                    $data[$i][47]=$regproganual->acumc_03; 
                                                    $data[$i][48]=$regproganual->acum_p03; 
                                                    $data[$i][49]=$regproganual->smf_03; 
                                                    $data[$i][50]=$regproganual->obs_03;
                                                    
                                                    $data[$i][51]=$regproganual->trimp_01;
                                                    $data[$i][52]=$regproganual->trimc_01;
                                                    $data[$i][53]=$regproganual->trim_p01;
                                                    $data[$i][54]=$regproganual->trim_s01; 

                                                    $data[$i][55]=$regproganual->mesp_04;
                                                    $data[$i][56]=$regproganual->mesc_04;
                                                    $data[$i][57]=$regproganual->mes_p04;
                                                    $data[$i][58]=$regproganual->mes_s04;

                                                    $data[$i][59]=$regproganual->acump_04; 
                                                    $data[$i][60]=$regproganual->acumc_04; 
                                                    $data[$i][61]=$regproganual->acum_p04; 
                                                    $data[$i][62]=$regproganual->smf_04; 
                                                    $data[$i][63]=$regproganual->obs_04; 

                                                    $data[$i][64]=$regproganual->objetivo_desc;  
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 5

                            case '6':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06')                                                                        
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                            
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")    
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02")                             

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_06;
                                                    $data[$i][16]=$regproganual->mesc_06;
                                                    $data[$i][17]=$regproganual->mes_p06;
                                                    $data[$i][18]=$regproganual->mes_s06;

                                                    $data[$i][19]=$regproganual->acump_06; 
                                                    $data[$i][20]=$regproganual->acumc_06; 
                                                    $data[$i][21]=$regproganual->acum_p06; 
                                                    $data[$i][22]=$regproganual->smf_06; 
                                                    $data[$i][23]=$regproganual->obs_06; 

                                                    $data[$i][24]=$regproganual->trimp_02;
                                                    $data[$i][25]=$regproganual->trimc_02;
                                                    $data[$i][26]=$regproganual->trim_p02;
                                                    $data[$i][27]=$regproganual->trim_s02;  

                                                    $data[$i][28]=$regproganual->mesp_01;
                                                    $data[$i][29]=$regproganual->mesc_01;
                                                    $data[$i][30]=$regproganual->mes_p01;
                                                    $data[$i][31]=$regproganual->mes_s01;

                                                    $data[$i][32]=$regproganual->acump_01; 
                                                    $data[$i][33]=$regproganual->acumc_01; 
                                                    $data[$i][34]=$regproganual->acum_p01; 
                                                    $data[$i][35]=$regproganual->smf_01; 
                                                    $data[$i][36]=$regproganual->obs_01; 

                                                    $data[$i][37]=$regproganual->mesp_02;
                                                    $data[$i][38]=$regproganual->mesc_02;
                                                    $data[$i][39]=$regproganual->mes_p02;
                                                    $data[$i][40]=$regproganual->mes_s02;

                                                    $data[$i][41]=$regproganual->acump_02; 
                                                    $data[$i][42]=$regproganual->acumc_02; 
                                                    $data[$i][43]=$regproganual->acum_p02; 
                                                    $data[$i][44]=$regproganual->smf_02; 
                                                    $data[$i][45]=$regproganual->obs_02; 

                                                    $data[$i][46]=$regproganual->mesp_03;
                                                    $data[$i][47]=$regproganual->mesc_03;
                                                    $data[$i][48]=$regproganual->mes_p03;
                                                    $data[$i][49]=$regproganual->mes_s03;

                                                    $data[$i][50]=$regproganual->acump_03; 
                                                    $data[$i][51]=$regproganual->acumc_03; 
                                                    $data[$i][52]=$regproganual->acum_p03; 
                                                    $data[$i][53]=$regproganual->smf_03; 
                                                    $data[$i][54]=$regproganual->obs_03;
                                                    
                                                    $data[$i][55]=$regproganual->trimp_01;
                                                    $data[$i][56]=$regproganual->trimc_01;
                                                    $data[$i][57]=$regproganual->trim_p01;
                                                    $data[$i][58]=$regproganual->trim_s01; 

                                                    $data[$i][59]=$regproganual->mesp_04;
                                                    $data[$i][60]=$regproganual->mesc_04;
                                                    $data[$i][61]=$regproganual->mes_p04;
                                                    $data[$i][62]=$regproganual->mes_s04;

                                                    $data[$i][63]=$regproganual->acump_04; 
                                                    $data[$i][64]=$regproganual->acumc_04; 
                                                    $data[$i][65]=$regproganual->acum_p04; 
                                                    $data[$i][66]=$regproganual->smf_04; 
                                                    $data[$i][67]=$regproganual->obs_04; 

                                                    $data[$i][68]=$regproganual->mesp_05;
                                                    $data[$i][69]=$regproganual->mesc_05;
                                                    $data[$i][70]=$regproganual->mes_p05;
                                                    $data[$i][71]=$regproganual->mes_s05;

                                                    $data[$i][72]=$regproganual->acump_05; 
                                                    $data[$i][73]=$regproganual->acumc_05; 
                                                    $data[$i][74]=$regproganual->acum_p05; 
                                                    $data[$i][75]=$regproganual->smf_05; 
                                                    $data[$i][76]=$regproganual->obs_05;    

                                                    $data[$i][77]=$regproganual->objetivo_desc;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06')                                                                        
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                      
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")  
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02")                 
                  
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_06;
                                                    $data[$i][16]=$regproganual->mesc_06;
                                                    $data[$i][17]=$regproganual->mes_p06;
                                                    $data[$i][18]=$regproganual->mes_s06;

                                                    $data[$i][19]=$regproganual->acump_06; 
                                                    $data[$i][20]=$regproganual->acumc_06; 
                                                    $data[$i][21]=$regproganual->acum_p06; 
                                                    $data[$i][22]=$regproganual->smf_06; 
                                                    $data[$i][23]=$regproganual->obs_06; 

                                                    $data[$i][24]=$regproganual->trimp_02;
                                                    $data[$i][25]=$regproganual->trimc_02;
                                                    $data[$i][26]=$regproganual->trim_p02;
                                                    $data[$i][27]=$regproganual->trim_s02;  

                                                    $data[$i][28]=$regproganual->mesp_01;
                                                    $data[$i][29]=$regproganual->mesc_01;
                                                    $data[$i][30]=$regproganual->mes_p01;
                                                    $data[$i][31]=$regproganual->mes_s01;

                                                    $data[$i][32]=$regproganual->acump_01; 
                                                    $data[$i][33]=$regproganual->acumc_01; 
                                                    $data[$i][34]=$regproganual->acum_p01; 
                                                    $data[$i][35]=$regproganual->smf_01; 
                                                    $data[$i][36]=$regproganual->obs_01; 

                                                    $data[$i][37]=$regproganual->mesp_02;
                                                    $data[$i][38]=$regproganual->mesc_02;
                                                    $data[$i][39]=$regproganual->mes_p02;
                                                    $data[$i][40]=$regproganual->mes_s02;

                                                    $data[$i][41]=$regproganual->acump_02; 
                                                    $data[$i][42]=$regproganual->acumc_02; 
                                                    $data[$i][43]=$regproganual->acum_p02; 
                                                    $data[$i][44]=$regproganual->smf_02; 
                                                    $data[$i][45]=$regproganual->obs_02; 

                                                    $data[$i][46]=$regproganual->mesp_03;
                                                    $data[$i][47]=$regproganual->mesc_03;
                                                    $data[$i][48]=$regproganual->mes_p03;
                                                    $data[$i][49]=$regproganual->mes_s03;

                                                    $data[$i][50]=$regproganual->acump_03; 
                                                    $data[$i][51]=$regproganual->acumc_03; 
                                                    $data[$i][52]=$regproganual->acum_p03; 
                                                    $data[$i][53]=$regproganual->smf_03; 
                                                    $data[$i][54]=$regproganual->obs_03;
                                                    
                                                    $data[$i][55]=$regproganual->trimp_01;
                                                    $data[$i][56]=$regproganual->trimc_01;
                                                    $data[$i][57]=$regproganual->trim_p01;
                                                    $data[$i][58]=$regproganual->trim_s01; 

                                                    $data[$i][59]=$regproganual->mesp_04;
                                                    $data[$i][60]=$regproganual->mesc_04;
                                                    $data[$i][61]=$regproganual->mes_p04;
                                                    $data[$i][62]=$regproganual->mes_s04;

                                                    $data[$i][63]=$regproganual->acump_04; 
                                                    $data[$i][64]=$regproganual->acumc_04; 
                                                    $data[$i][65]=$regproganual->acum_p04; 
                                                    $data[$i][66]=$regproganual->smf_04; 
                                                    $data[$i][67]=$regproganual->obs_04; 

                                                    $data[$i][68]=$regproganual->mesp_05;
                                                    $data[$i][69]=$regproganual->mesc_05;
                                                    $data[$i][70]=$regproganual->mes_p05;
                                                    $data[$i][71]=$regproganual->mes_s05;

                                                    $data[$i][72]=$regproganual->acump_05; 
                                                    $data[$i][73]=$regproganual->acumc_05; 
                                                    $data[$i][74]=$regproganual->acum_p05; 
                                                    $data[$i][75]=$regproganual->smf_05; 
                                                    $data[$i][76]=$regproganual->obs_05;    
      
                                                    $data[$i][77]=$regproganual->objetivo_desc;        
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 6

                            case '7':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07')                                                                                                                                             
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                                                                                                                                       
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")     
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")  

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,

                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_07;
                                                    $data[$i][16]=$regproganual->mesc_07;
                                                    $data[$i][17]=$regproganual->mes_p07;
                                                    $data[$i][18]=$regproganual->mes_s07;

                                                    $data[$i][19]=$regproganual->acump_07; 
                                                    $data[$i][20]=$regproganual->acumc_07; 
                                                    $data[$i][21]=$regproganual->acum_p07; 
                                                    $data[$i][22]=$regproganual->smf_07; 
                                                    $data[$i][23]=$regproganual->obs_07; 

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->mesp_02;
                                                    $data[$i][34]=$regproganual->mesc_02;
                                                    $data[$i][35]=$regproganual->mes_p02;
                                                    $data[$i][36]=$regproganual->mes_s02;

                                                    $data[$i][37]=$regproganual->acump_02; 
                                                    $data[$i][38]=$regproganual->acumc_02; 
                                                    $data[$i][39]=$regproganual->acum_p02; 
                                                    $data[$i][40]=$regproganual->smf_02; 
                                                    $data[$i][41]=$regproganual->obs_02; 

                                                    $data[$i][42]=$regproganual->mesp_03;
                                                    $data[$i][43]=$regproganual->mesc_03;
                                                    $data[$i][44]=$regproganual->mes_p03;
                                                    $data[$i][45]=$regproganual->mes_s03;

                                                    $data[$i][46]=$regproganual->acump_03; 
                                                    $data[$i][47]=$regproganual->acumc_03; 
                                                    $data[$i][48]=$regproganual->acum_p03; 
                                                    $data[$i][49]=$regproganual->smf_03; 
                                                    $data[$i][50]=$regproganual->obs_03;
                                                    
                                                    $data[$i][51]=$regproganual->trimp_01;
                                                    $data[$i][52]=$regproganual->trimc_01;
                                                    $data[$i][53]=$regproganual->trim_p01;
                                                    $data[$i][54]=$regproganual->trim_s01; 

                                                    $data[$i][55]=$regproganual->mesp_04;
                                                    $data[$i][56]=$regproganual->mesc_04;
                                                    $data[$i][57]=$regproganual->mes_p04;
                                                    $data[$i][58]=$regproganual->mes_s04;

                                                    $data[$i][59]=$regproganual->acump_04; 
                                                    $data[$i][60]=$regproganual->acumc_04; 
                                                    $data[$i][61]=$regproganual->acum_p04; 
                                                    $data[$i][62]=$regproganual->smf_04; 
                                                    $data[$i][63]=$regproganual->obs_04; 

                                                    $data[$i][64]=$regproganual->mesp_05;
                                                    $data[$i][65]=$regproganual->mesc_05;
                                                    $data[$i][66]=$regproganual->mes_p05;
                                                    $data[$i][67]=$regproganual->mes_s05;

                                                    $data[$i][68]=$regproganual->acump_05; 
                                                    $data[$i][69]=$regproganual->acumc_05; 
                                                    $data[$i][70]=$regproganual->acum_p05; 
                                                    $data[$i][71]=$regproganual->smf_05; 
                                                    $data[$i][72]=$regproganual->obs_05;    

                                                    $data[$i][73]=$regproganual->mesp_06;
                                                    $data[$i][74]=$regproganual->mesc_06;
                                                    $data[$i][75]=$regproganual->mes_p06;
                                                    $data[$i][76]=$regproganual->mes_s06;

                                                    $data[$i][77]=$regproganual->acump_06; 
                                                    $data[$i][78]=$regproganual->acumc_06; 
                                                    $data[$i][79]=$regproganual->acum_p06; 
                                                    $data[$i][80]=$regproganual->smf_06; 
                                                    $data[$i][81]=$regproganual->obs_06; 

                                                    $data[$i][82]=$regproganual->trimp_02;
                                                    $data[$i][83]=$regproganual->trimc_02;
                                                    $data[$i][84]=$regproganual->trim_p02;
                                                    $data[$i][85]=$regproganual->trim_s02;

                                                    $data[$i][86]=$regproganual->objetivo_desc;        
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                             ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                             ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                             ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                             ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                             ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                             ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07')                                                                                                                                             
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                                                                                                                                      
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")  
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")   
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                                   
                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_07;
                                                    $data[$i][16]=$regproganual->mesc_07;
                                                    $data[$i][17]=$regproganual->mes_p07;
                                                    $data[$i][18]=$regproganual->mes_s07;

                                                    $data[$i][19]=$regproganual->acump_07; 
                                                    $data[$i][20]=$regproganual->acumc_07; 
                                                    $data[$i][21]=$regproganual->acum_p07; 
                                                    $data[$i][22]=$regproganual->smf_07; 
                                                    $data[$i][23]=$regproganual->obs_07; 

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->mesp_02;
                                                    $data[$i][34]=$regproganual->mesc_02;
                                                    $data[$i][35]=$regproganual->mes_p02;
                                                    $data[$i][36]=$regproganual->mes_s02;

                                                    $data[$i][37]=$regproganual->acump_02; 
                                                    $data[$i][38]=$regproganual->acumc_02; 
                                                    $data[$i][39]=$regproganual->acum_p02; 
                                                    $data[$i][40]=$regproganual->smf_02; 
                                                    $data[$i][41]=$regproganual->obs_02; 

                                                    $data[$i][42]=$regproganual->mesp_03;
                                                    $data[$i][43]=$regproganual->mesc_03;
                                                    $data[$i][44]=$regproganual->mes_p03;
                                                    $data[$i][45]=$regproganual->mes_s03;

                                                    $data[$i][46]=$regproganual->acump_03; 
                                                    $data[$i][47]=$regproganual->acumc_03; 
                                                    $data[$i][48]=$regproganual->acum_p03; 
                                                    $data[$i][49]=$regproganual->smf_03; 
                                                    $data[$i][50]=$regproganual->obs_03;
                                                    
                                                    $data[$i][51]=$regproganual->trimp_01;
                                                    $data[$i][52]=$regproganual->trimc_01;
                                                    $data[$i][53]=$regproganual->trim_p01;
                                                    $data[$i][54]=$regproganual->trim_s01; 

                                                    $data[$i][55]=$regproganual->mesp_04;
                                                    $data[$i][56]=$regproganual->mesc_04;
                                                    $data[$i][57]=$regproganual->mes_p04;
                                                    $data[$i][58]=$regproganual->mes_s04;

                                                    $data[$i][59]=$regproganual->acump_04; 
                                                    $data[$i][60]=$regproganual->acumc_04; 
                                                    $data[$i][61]=$regproganual->acum_p04; 
                                                    $data[$i][62]=$regproganual->smf_04; 
                                                    $data[$i][63]=$regproganual->obs_04; 

                                                    $data[$i][64]=$regproganual->mesp_05;
                                                    $data[$i][65]=$regproganual->mesc_05;
                                                    $data[$i][66]=$regproganual->mes_p05;
                                                    $data[$i][67]=$regproganual->mes_s05;

                                                    $data[$i][68]=$regproganual->acump_05; 
                                                    $data[$i][69]=$regproganual->acumc_05; 
                                                    $data[$i][70]=$regproganual->acum_p05; 
                                                    $data[$i][71]=$regproganual->smf_05; 
                                                    $data[$i][72]=$regproganual->obs_05;    

                                                    $data[$i][73]=$regproganual->mesp_06;
                                                    $data[$i][74]=$regproganual->mesc_06;
                                                    $data[$i][75]=$regproganual->mes_p06;
                                                    $data[$i][76]=$regproganual->mes_s06;

                                                    $data[$i][77]=$regproganual->acump_06; 
                                                    $data[$i][78]=$regproganual->acumc_06; 
                                                    $data[$i][79]=$regproganual->acum_p06; 
                                                    $data[$i][80]=$regproganual->smf_06; 
                                                    $data[$i][81]=$regproganual->obs_06; 

                                                    $data[$i][82]=$regproganual->trimp_02;
                                                    $data[$i][83]=$regproganual->trimc_02;
                                                    $data[$i][84]=$regproganual->trim_p02;
                                                    $data[$i][85]=$regproganual->trim_s02;
      
                                                    $data[$i][86]=$regproganual->objetivo_desc;        
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 7

                            case '8':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                         ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                           'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                           'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                             
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")  
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_08")  

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                                   
                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07,
                                                                   $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                                   $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                                   $regproganual->obs_08
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_08;
                                                    $data[$i][16]=$regproganual->mesc_08;
                                                    $data[$i][17]=$regproganual->mes_p08;
                                                    $data[$i][18]=$regproganual->mes_s08;

                                                    $data[$i][19]=$regproganual->acump_08; 
                                                    $data[$i][20]=$regproganual->acumc_08; 
                                                    $data[$i][21]=$regproganual->acum_p08; 
                                                    $data[$i][22]=$regproganual->smf_08; 
                                                    $data[$i][23]=$regproganual->obs_08; 

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->mesp_02;
                                                    $data[$i][34]=$regproganual->mesc_02;
                                                    $data[$i][35]=$regproganual->mes_p02;
                                                    $data[$i][36]=$regproganual->mes_s02;

                                                    $data[$i][37]=$regproganual->acump_02; 
                                                    $data[$i][38]=$regproganual->acumc_02; 
                                                    $data[$i][39]=$regproganual->acum_p02; 
                                                    $data[$i][40]=$regproganual->smf_02; 
                                                    $data[$i][41]=$regproganual->obs_02; 

                                                    $data[$i][42]=$regproganual->mesp_03;
                                                    $data[$i][43]=$regproganual->mesc_03;
                                                    $data[$i][44]=$regproganual->mes_p03;
                                                    $data[$i][45]=$regproganual->mes_s03;

                                                    $data[$i][46]=$regproganual->acump_03; 
                                                    $data[$i][47]=$regproganual->acumc_03; 
                                                    $data[$i][48]=$regproganual->acum_p03; 
                                                    $data[$i][49]=$regproganual->smf_03; 
                                                    $data[$i][50]=$regproganual->obs_03;
                                                    
                                                    $data[$i][51]=$regproganual->trimp_01;
                                                    $data[$i][52]=$regproganual->trimc_01;
                                                    $data[$i][53]=$regproganual->trim_p01;
                                                    $data[$i][54]=$regproganual->trim_s01; 

                                                    $data[$i][55]=$regproganual->mesp_04;
                                                    $data[$i][56]=$regproganual->mesc_04;
                                                    $data[$i][57]=$regproganual->mes_p04;
                                                    $data[$i][58]=$regproganual->mes_s04;

                                                    $data[$i][59]=$regproganual->acump_04; 
                                                    $data[$i][60]=$regproganual->acumc_04; 
                                                    $data[$i][61]=$regproganual->acum_p04; 
                                                    $data[$i][62]=$regproganual->smf_04; 
                                                    $data[$i][63]=$regproganual->obs_04; 

                                                    $data[$i][64]=$regproganual->mesp_05;
                                                    $data[$i][65]=$regproganual->mesc_05;
                                                    $data[$i][66]=$regproganual->mes_p05;
                                                    $data[$i][67]=$regproganual->mes_s05;

                                                    $data[$i][68]=$regproganual->acump_05; 
                                                    $data[$i][69]=$regproganual->acumc_05; 
                                                    $data[$i][70]=$regproganual->acum_p05; 
                                                    $data[$i][71]=$regproganual->smf_05; 
                                                    $data[$i][72]=$regproganual->obs_05;    

                                                    $data[$i][73]=$regproganual->mesp_06;
                                                    $data[$i][74]=$regproganual->mesc_06;
                                                    $data[$i][75]=$regproganual->mes_p06;
                                                    $data[$i][66]=$regproganual->mes_s06;

                                                    $data[$i][77]=$regproganual->acump_06; 
                                                    $data[$i][78]=$regproganual->acumc_06; 
                                                    $data[$i][79]=$regproganual->acum_p06; 
                                                    $data[$i][80]=$regproganual->smf_06; 
                                                    $data[$i][81]=$regproganual->obs_06; 

                                                    $data[$i][82]=$regproganual->trimp_02;
                                                    $data[$i][83]=$regproganual->trimc_02;
                                                    $data[$i][84]=$regproganual->trim_p02;
                                                    $data[$i][85]=$regproganual->trim_s02;

                                                    $data[$i][86]=$regproganual->mesp_07;
                                                    $data[$i][87]=$regproganual->mesc_07;
                                                    $data[$i][88]=$regproganual->mes_p07;
                                                    $data[$i][89]=$regproganual->mes_s07;

                                                    $data[$i][90]=$regproganual->acump_07; 
                                                    $data[$i][91]=$regproganual->acumc_07; 
                                                    $data[$i][92]=$regproganual->acum_p07; 
                                                    $data[$i][93]=$regproganual->smf_07; 
                                                    $data[$i][94]=$regproganual->obs_07; 

                                                    $data[$i][95]=$regproganual->objetivo_desc;       
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                             ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                             ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                             ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                             ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                             ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                             ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                             ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                           'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                           'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                          
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")     
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_08")  
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                                   
                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07,
                                                                   $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                                   $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                                   $regproganual->obs_08
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_08;
                                                    $data[$i][16]=$regproganual->mesc_08;
                                                    $data[$i][17]=$regproganual->mes_p08;
                                                    $data[$i][18]=$regproganual->mes_s08;

                                                    $data[$i][19]=$regproganual->acump_08; 
                                                    $data[$i][20]=$regproganual->acumc_08; 
                                                    $data[$i][21]=$regproganual->acum_p08; 
                                                    $data[$i][22]=$regproganual->smf_08; 
                                                    $data[$i][23]=$regproganual->obs_08; 

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->mesp_02;
                                                    $data[$i][34]=$regproganual->mesc_02;
                                                    $data[$i][35]=$regproganual->mes_p02;
                                                    $data[$i][36]=$regproganual->mes_s02;

                                                    $data[$i][37]=$regproganual->acump_02; 
                                                    $data[$i][38]=$regproganual->acumc_02; 
                                                    $data[$i][39]=$regproganual->acum_p02; 
                                                    $data[$i][40]=$regproganual->smf_02; 
                                                    $data[$i][41]=$regproganual->obs_02; 

                                                    $data[$i][42]=$regproganual->mesp_03;
                                                    $data[$i][43]=$regproganual->mesc_03;
                                                    $data[$i][44]=$regproganual->mes_p03;
                                                    $data[$i][45]=$regproganual->mes_s03;

                                                    $data[$i][46]=$regproganual->acump_03; 
                                                    $data[$i][47]=$regproganual->acumc_03; 
                                                    $data[$i][48]=$regproganual->acum_p03; 
                                                    $data[$i][49]=$regproganual->smf_03; 
                                                    $data[$i][50]=$regproganual->obs_03;
                                                    
                                                    $data[$i][51]=$regproganual->trimp_01;
                                                    $data[$i][52]=$regproganual->trimc_01;
                                                    $data[$i][53]=$regproganual->trim_p01;
                                                    $data[$i][54]=$regproganual->trim_s01; 

                                                    $data[$i][55]=$regproganual->mesp_04;
                                                    $data[$i][56]=$regproganual->mesc_04;
                                                    $data[$i][57]=$regproganual->mes_p04;
                                                    $data[$i][58]=$regproganual->mes_s04;

                                                    $data[$i][59]=$regproganual->acump_04; 
                                                    $data[$i][60]=$regproganual->acumc_04; 
                                                    $data[$i][61]=$regproganual->acum_p04; 
                                                    $data[$i][62]=$regproganual->smf_04; 
                                                    $data[$i][63]=$regproganual->obs_04; 

                                                    $data[$i][64]=$regproganual->mesp_05;
                                                    $data[$i][65]=$regproganual->mesc_05;
                                                    $data[$i][66]=$regproganual->mes_p05;
                                                    $data[$i][67]=$regproganual->mes_s05;

                                                    $data[$i][68]=$regproganual->acump_05; 
                                                    $data[$i][69]=$regproganual->acumc_05; 
                                                    $data[$i][70]=$regproganual->acum_p05; 
                                                    $data[$i][71]=$regproganual->smf_05; 
                                                    $data[$i][72]=$regproganual->obs_05;    

                                                    $data[$i][73]=$regproganual->mesp_06;
                                                    $data[$i][74]=$regproganual->mesc_06;
                                                    $data[$i][75]=$regproganual->mes_p06;
                                                    $data[$i][66]=$regproganual->mes_s06;

                                                    $data[$i][77]=$regproganual->acump_06; 
                                                    $data[$i][78]=$regproganual->acumc_06; 
                                                    $data[$i][79]=$regproganual->acum_p06; 
                                                    $data[$i][80]=$regproganual->smf_06; 
                                                    $data[$i][81]=$regproganual->obs_06; 

                                                    $data[$i][82]=$regproganual->trimp_02;
                                                    $data[$i][83]=$regproganual->trimc_02;
                                                    $data[$i][84]=$regproganual->trim_p02;
                                                    $data[$i][85]=$regproganual->trim_s02;

                                                    $data[$i][86]=$regproganual->mesp_07;
                                                    $data[$i][87]=$regproganual->mesc_07;
                                                    $data[$i][88]=$regproganual->mes_p07;
                                                    $data[$i][89]=$regproganual->mes_s07;

                                                    $data[$i][90]=$regproganual->acump_07; 
                                                    $data[$i][91]=$regproganual->acumc_07; 
                                                    $data[$i][92]=$regproganual->acum_p07; 
                                                    $data[$i][93]=$regproganual->smf_07; 
                                                    $data[$i][94]=$regproganual->obs_07; 
     
                                                    $data[$i][95]=$regproganual->objetivo_desc;       
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 8

                            case '9':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')                                                                       
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                         ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                         ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                           'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                           'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                           'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                           'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                           'SIEVAD_DPA.TRIMP_03' ,'SIEVAD_DPA.TRIMC_03' ,'SIEVAD_DPA.TRIM_P03',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                                                                                
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")    
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_08")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_09")     
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S03")                                                           

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                                   
                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07,
                                                                   $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                                   $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                                   $regproganual->obs_08,
                                                                   $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                                   $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                                   $regproganual->obs_09,
                                                                   $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_09;
                                                    $data[$i][16]=$regproganual->mesc_09;
                                                    $data[$i][17]=$regproganual->mes_p09;
                                                    $data[$i][18]=$regproganual->mes_s09;

                                                    $data[$i][19] =$regproganual->acump_09; 
                                                    $data[$i][20]=$regproganual->acumc_09; 
                                                    $data[$i][21]=$regproganual->acum_p09; 
                                                    $data[$i][22]=$regproganual->smf_09; 
                                                    $data[$i][23]=$regproganual->obs_09; 

                                                    $data[$i][24]=$regproganual->trimp_03;
                                                    $data[$i][25]=$regproganual->trimc_03;
                                                    $data[$i][26]=$regproganual->trim_p03;
                                                    $data[$i][27]=$regproganual->trim_s03; 

                                                    $data[$i][28]=$regproganual->mesp_01;
                                                    $data[$i][29]=$regproganual->mesc_01;
                                                    $data[$i][30]=$regproganual->mes_p01;
                                                    $data[$i][31]=$regproganual->mes_s01;

                                                    $data[$i][32]=$regproganual->acump_01; 
                                                    $data[$i][33]=$regproganual->acumc_01; 
                                                    $data[$i][34]=$regproganual->acum_p01; 
                                                    $data[$i][35]=$regproganual->smf_01; 
                                                    $data[$i][36]=$regproganual->obs_01; 

                                                    $data[$i][37]=$regproganual->mesp_02;
                                                    $data[$i][38]=$regproganual->mesc_02;
                                                    $data[$i][39]=$regproganual->mes_p02;
                                                    $data[$i][40]=$regproganual->mes_s02;

                                                    $data[$i][41]=$regproganual->acump_02; 
                                                    $data[$i][42]=$regproganual->acumc_02; 
                                                    $data[$i][43]=$regproganual->acum_p02; 
                                                    $data[$i][44]=$regproganual->smf_02; 
                                                    $data[$i][45]=$regproganual->obs_02; 

                                                    $data[$i][46]=$regproganual->mesp_03;
                                                    $data[$i][47]=$regproganual->mesc_03;
                                                    $data[$i][48]=$regproganual->mes_p03;
                                                    $data[$i][49]=$regproganual->mes_s03;

                                                    $data[$i][50]=$regproganual->acump_03; 
                                                    $data[$i][51]=$regproganual->acumc_03; 
                                                    $data[$i][52]=$regproganual->acum_p03; 
                                                    $data[$i][53]=$regproganual->smf_03; 
                                                    $data[$i][54]=$regproganual->obs_03;
                                                    
                                                    $data[$i][55]=$regproganual->trimp_01;
                                                    $data[$i][56]=$regproganual->trimc_01;
                                                    $data[$i][57]=$regproganual->trim_p01;
                                                    $data[$i][58]=$regproganual->trim_s01; 

                                                    $data[$i][59]=$regproganual->mesp_04;
                                                    $data[$i][60]=$regproganual->mesc_04;
                                                    $data[$i][61]=$regproganual->mes_p04;
                                                    $data[$i][62]=$regproganual->mes_s04;

                                                    $data[$i][63]=$regproganual->acump_04; 
                                                    $data[$i][64]=$regproganual->acumc_04; 
                                                    $data[$i][65]=$regproganual->acum_p04; 
                                                    $data[$i][66]=$regproganual->smf_04; 
                                                    $data[$i][67]=$regproganual->obs_04; 

                                                    $data[$i][68]=$regproganual->mesp_05;
                                                    $data[$i][69]=$regproganual->mesc_05;
                                                    $data[$i][70]=$regproganual->mes_p05;
                                                    $data[$i][71]=$regproganual->mes_s05;

                                                    $data[$i][72]=$regproganual->acump_05; 
                                                    $data[$i][73]=$regproganual->acumc_05; 
                                                    $data[$i][74]=$regproganual->acum_p05; 
                                                    $data[$i][75]=$regproganual->smf_05; 
                                                    $data[$i][76]=$regproganual->obs_05;    

                                                    $data[$i][77]=$regproganual->mesp_06;
                                                    $data[$i][78]=$regproganual->mesc_06;
                                                    $data[$i][79]=$regproganual->mes_p06;
                                                    $data[$i][80]=$regproganual->mes_s06;

                                                    $data[$i][81]=$regproganual->acump_06; 
                                                    $data[$i][82]=$regproganual->acumc_06; 
                                                    $data[$i][83]=$regproganual->acum_p06; 
                                                    $data[$i][84]=$regproganual->smf_06; 
                                                    $data[$i][85]=$regproganual->obs_06; 

                                                    $data[$i][86]=$regproganual->trimp_02;
                                                    $data[$i][87]=$regproganual->trimc_02;
                                                    $data[$i][88]=$regproganual->trim_p02;
                                                    $data[$i][89]=$regproganual->trim_s02;

                                                    $data[$i][90]=$regproganual->mesp_07;
                                                    $data[$i][91]=$regproganual->mesc_07;
                                                    $data[$i][92]=$regproganual->mes_p07;
                                                    $data[$i][93]=$regproganual->mes_s07;

                                                    $data[$i][94]=$regproganual->acump_07; 
                                                    $data[$i][95]=$regproganual->acumc_07; 
                                                    $data[$i][96]=$regproganual->acum_p07; 
                                                    $data[$i][97]=$regproganual->smf_07; 
                                                    $data[$i][98]=$regproganual->obs_07; 

                                                    $data[$i][99]=$regproganual->mesp_08;
                                                    $data[$i][100]=$regproganual->mesc_08;
                                                    $data[$i][101]=$regproganual->mes_p08;
                                                    $data[$i][102]=$regproganual->mes_s08;

                                                    $data[$i][103]=$regproganual->acump_08; 
                                                    $data[$i][104]=$regproganual->acumc_08; 
                                                    $data[$i][105]=$regproganual->acum_p08; 
                                                    $data[$i][106]=$regproganual->smf_08; 
                                                    $data[$i][107]=$regproganual->obs_08; 

                                                    $data[$i][108]=$regproganual->objetivo_desc;     
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                             ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                             ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                             ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                             ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                             ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                             ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                             ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                             ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01' ,'SIEVAD_DPA.TRIMC_01' ,'SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02' ,'SIEVAD_DPA.TRIMC_02' ,'SIEVAD_DPA.TRIM_P02',

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                           'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                           'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                           'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                           'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                           'SIEVAD_DPA.TRIMP_03' ,'SIEVAD_DPA.TRIMC_03' ,'SIEVAD_DPA.TRIM_P03',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC' 
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")    
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_08")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_09")  
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S03")                                            

                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                                   
                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07,
                                                                   $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                                   $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                                   $regproganual->obs_08,
                                                                   $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                                   $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                                   $regproganual->obs_09,
                                                                   $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_09;
                                                    $data[$i][16]=$regproganual->mesc_09;
                                                    $data[$i][17]=$regproganual->mes_p09;
                                                    $data[$i][18]=$regproganual->mes_s09;

                                                    $data[$i][19] =$regproganual->acump_09; 
                                                    $data[$i][20]=$regproganual->acumc_09; 
                                                    $data[$i][21]=$regproganual->acum_p09; 
                                                    $data[$i][22]=$regproganual->smf_09; 
                                                    $data[$i][23]=$regproganual->obs_09; 

                                                    $data[$i][24]=$regproganual->trimp_03;
                                                    $data[$i][25]=$regproganual->trimc_03;
                                                    $data[$i][26]=$regproganual->trim_p03;
                                                    $data[$i][27]=$regproganual->trim_s03; 

                                                    $data[$i][28]=$regproganual->mesp_01;
                                                    $data[$i][29]=$regproganual->mesc_01;
                                                    $data[$i][30]=$regproganual->mes_p01;
                                                    $data[$i][31]=$regproganual->mes_s01;

                                                    $data[$i][32]=$regproganual->acump_01; 
                                                    $data[$i][33]=$regproganual->acumc_01; 
                                                    $data[$i][34]=$regproganual->acum_p01; 
                                                    $data[$i][35]=$regproganual->smf_01; 
                                                    $data[$i][36]=$regproganual->obs_01; 

                                                    $data[$i][37]=$regproganual->mesp_02;
                                                    $data[$i][38]=$regproganual->mesc_02;
                                                    $data[$i][39]=$regproganual->mes_p02;
                                                    $data[$i][40]=$regproganual->mes_s02;

                                                    $data[$i][41]=$regproganual->acump_02; 
                                                    $data[$i][42]=$regproganual->acumc_02; 
                                                    $data[$i][43]=$regproganual->acum_p02; 
                                                    $data[$i][44]=$regproganual->smf_02; 
                                                    $data[$i][45]=$regproganual->obs_02; 

                                                    $data[$i][46]=$regproganual->mesp_03;
                                                    $data[$i][47]=$regproganual->mesc_03;
                                                    $data[$i][48]=$regproganual->mes_p03;
                                                    $data[$i][49]=$regproganual->mes_s03;

                                                    $data[$i][50]=$regproganual->acump_03; 
                                                    $data[$i][51]=$regproganual->acumc_03; 
                                                    $data[$i][52]=$regproganual->acum_p03; 
                                                    $data[$i][53]=$regproganual->smf_03; 
                                                    $data[$i][54]=$regproganual->obs_03;
                                                    
                                                    $data[$i][55]=$regproganual->trimp_01;
                                                    $data[$i][56]=$regproganual->trimc_01;
                                                    $data[$i][57]=$regproganual->trim_p01;
                                                    $data[$i][58]=$regproganual->trim_s01; 

                                                    $data[$i][59]=$regproganual->mesp_04;
                                                    $data[$i][60]=$regproganual->mesc_04;
                                                    $data[$i][61]=$regproganual->mes_p04;
                                                    $data[$i][62]=$regproganual->mes_s04;

                                                    $data[$i][63]=$regproganual->acump_04; 
                                                    $data[$i][64]=$regproganual->acumc_04; 
                                                    $data[$i][65]=$regproganual->acum_p04; 
                                                    $data[$i][66]=$regproganual->smf_04; 
                                                    $data[$i][67]=$regproganual->obs_04; 

                                                    $data[$i][68]=$regproganual->mesp_05;
                                                    $data[$i][69]=$regproganual->mesc_05;
                                                    $data[$i][70]=$regproganual->mes_p05;
                                                    $data[$i][71]=$regproganual->mes_s05;

                                                    $data[$i][72]=$regproganual->acump_05; 
                                                    $data[$i][73]=$regproganual->acumc_05; 
                                                    $data[$i][74]=$regproganual->acum_p05; 
                                                    $data[$i][75]=$regproganual->smf_05; 
                                                    $data[$i][76]=$regproganual->obs_05;    

                                                    $data[$i][77]=$regproganual->mesp_06;
                                                    $data[$i][78]=$regproganual->mesc_06;
                                                    $data[$i][79]=$regproganual->mes_p06;
                                                    $data[$i][80]=$regproganual->mes_s06;

                                                    $data[$i][81]=$regproganual->acump_06; 
                                                    $data[$i][82]=$regproganual->acumc_06; 
                                                    $data[$i][83]=$regproganual->acum_p06; 
                                                    $data[$i][84]=$regproganual->smf_06; 
                                                    $data[$i][85]=$regproganual->obs_06; 

                                                    $data[$i][86]=$regproganual->trimp_02;
                                                    $data[$i][87]=$regproganual->trimc_02;
                                                    $data[$i][88]=$regproganual->trim_p02;
                                                    $data[$i][89]=$regproganual->trim_s02;

                                                    $data[$i][90]=$regproganual->mesp_07;
                                                    $data[$i][91]=$regproganual->mesc_07;
                                                    $data[$i][92]=$regproganual->mes_p07;
                                                    $data[$i][93]=$regproganual->mes_s07;

                                                    $data[$i][94]=$regproganual->acump_07; 
                                                    $data[$i][95]=$regproganual->acumc_07; 
                                                    $data[$i][96]=$regproganual->acum_p07; 
                                                    $data[$i][97]=$regproganual->smf_07; 
                                                    $data[$i][98]=$regproganual->obs_07; 

                                                    $data[$i][99]=$regproganual->mesp_08;
                                                    $data[$i][100]=$regproganual->mesc_08;
                                                    $data[$i][101]=$regproganual->mes_p08;
                                                    $data[$i][102]=$regproganual->mes_s08;

                                                    $data[$i][103]=$regproganual->acump_08; 
                                                    $data[$i][104]=$regproganual->acumc_08; 
                                                    $data[$i][105]=$regproganual->acum_p08; 
                                                    $data[$i][106]=$regproganual->smf_08; 
                                                    $data[$i][107]=$regproganual->obs_08; 

                                                    $data[$i][108]=$regproganual->objetivo_desc;     
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 9

                            case '10':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                         ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                         ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                                         ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10') 
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIM_P02',

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                           'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                           'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                           'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                           'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                           'SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIM_P03',

                                                           'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                           'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC' 
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")        
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_08")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_09")  
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S03") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_10")       

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                                   
                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07,
                                                                   $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                                   $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                                   $regproganual->obs_08,
                                                                   $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                                   $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                                   $regproganual->obs_09,
                                                                   $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03,

                                                                   $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                                   $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                                   $regproganual->obs_10
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_10;
                                                    $data[$i][16]=$regproganual->mesc_10;
                                                    $data[$i][17]=$regproganual->mes_p10;
                                                    $data[$i][18]=$regproganual->mes_s10;

                                                    $data[$i][19]=$regproganual->acump_10; 
                                                    $data[$i][20]=$regproganual->acumc_10; 
                                                    $data[$i][21]=$regproganual->acum_p10; 
                                                    $data[$i][22]=$regproganual->smf_10; 
                                                    $data[$i][23]=$regproganual->obs_10;

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->mesp_02;
                                                    $data[$i][34]=$regproganual->mesc_02;
                                                    $data[$i][35]=$regproganual->mes_p02;
                                                    $data[$i][36]=$regproganual->mes_s02;

                                                    $data[$i][37]=$regproganual->acump_02; 
                                                    $data[$i][38]=$regproganual->acumc_02; 
                                                    $data[$i][39]=$regproganual->acum_p02; 
                                                    $data[$i][40]=$regproganual->smf_02; 
                                                    $data[$i][41]=$regproganual->obs_02; 

                                                    $data[$i][42]=$regproganual->mesp_03;
                                                    $data[$i][43]=$regproganual->mesc_03;
                                                    $data[$i][44]=$regproganual->mes_p03;
                                                    $data[$i][45]=$regproganual->mes_s03;

                                                    $data[$i][46]=$regproganual->acump_03; 
                                                    $data[$i][47]=$regproganual->acumc_03; 
                                                    $data[$i][48]=$regproganual->acum_p03; 
                                                    $data[$i][49]=$regproganual->smf_03; 
                                                    $data[$i][50]=$regproganual->obs_03;
                                                    
                                                    $data[$i][51]=$regproganual->trimp_01;
                                                    $data[$i][52]=$regproganual->trimc_01;
                                                    $data[$i][53]=$regproganual->trim_p01;
                                                    $data[$i][54]=$regproganual->trim_s01; 

                                                    $data[$i][55]=$regproganual->mesp_04;
                                                    $data[$i][56]=$regproganual->mesc_04;
                                                    $data[$i][57]=$regproganual->mes_p04;
                                                    $data[$i][58]=$regproganual->mes_s04;

                                                    $data[$i][59]=$regproganual->acump_04; 
                                                    $data[$i][60]=$regproganual->acumc_04; 
                                                    $data[$i][61]=$regproganual->acum_p04; 
                                                    $data[$i][62]=$regproganual->smf_04; 
                                                    $data[$i][63]=$regproganual->obs_04; 

                                                    $data[$i][64]=$regproganual->mesp_05;
                                                    $data[$i][65]=$regproganual->mesc_05;
                                                    $data[$i][66]=$regproganual->mes_p05;
                                                    $data[$i][67]=$regproganual->mes_s05;

                                                    $data[$i][68]=$regproganual->acump_05; 
                                                    $data[$i][69]=$regproganual->acumc_05; 
                                                    $data[$i][70]=$regproganual->acum_p05; 
                                                    $data[$i][71]=$regproganual->smf_05; 
                                                    $data[$i][72]=$regproganual->obs_05;    

                                                    $data[$i][73]=$regproganual->mesp_06;
                                                    $data[$i][74]=$regproganual->mesc_06;
                                                    $data[$i][75]=$regproganual->mes_p06;
                                                    $data[$i][76]=$regproganual->mes_s06;

                                                    $data[$i][77]=$regproganual->acump_06; 
                                                    $data[$i][78]=$regproganual->acumc_06; 
                                                    $data[$i][79]=$regproganual->acum_p06; 
                                                    $data[$i][80]=$regproganual->smf_06; 
                                                    $data[$i][81]=$regproganual->obs_06; 

                                                    $data[$i][82]=$regproganual->trimp_02;
                                                    $data[$i][83]=$regproganual->trimc_02;
                                                    $data[$i][84]=$regproganual->trim_p02;
                                                    $data[$i][85]=$regproganual->trim_s02;

                                                    $data[$i][86]=$regproganual->mesp_07;
                                                    $data[$i][87]=$regproganual->mesc_07;
                                                    $data[$i][88]=$regproganual->mes_p07;
                                                    $data[$i][89]=$regproganual->mes_s07;

                                                    $data[$i][90]=$regproganual->acump_07; 
                                                    $data[$i][91]=$regproganual->acumc_07; 
                                                    $data[$i][92]=$regproganual->acum_p07; 
                                                    $data[$i][93]=$regproganual->smf_07; 
                                                    $data[$i][94]=$regproganual->obs_07; 

                                                    $data[$i][95]=$regproganual->mesp_08;
                                                    $data[$i][96]=$regproganual->mesc_08;
                                                    $data[$i][97]=$regproganual->mes_p08;
                                                    $data[$i][98]=$regproganual->mes_s08;

                                                    $data[$i][99]=$regproganual->acump_08; 
                                                    $data[$i][100]=$regproganual->acumc_08; 
                                                    $data[$i][101]=$regproganual->acum_p08; 
                                                    $data[$i][102]=$regproganual->smf_08; 
                                                    $data[$i][103]=$regproganual->obs_08; 

                                                    $data[$i][104]=$regproganual->mesp_09;
                                                    $data[$i][105]=$regproganual->mesc_09;
                                                    $data[$i][106]=$regproganual->mes_p09;
                                                    $data[$i][107]=$regproganual->mes_s09;

                                                    $data[$i][108] =$regproganual->acump_09; 
                                                    $data[$i][109] =$regproganual->acumc_09; 
                                                    $data[$i][110] =$regproganual->acum_p09; 
                                                    $data[$i][111]=$regproganual->smf_09; 
                                                    $data[$i][112]=$regproganual->obs_09; 

                                                    $data[$i][113]=$regproganual->trimp_03;
                                                    $data[$i][114]=$regproganual->trimc_03;
                                                    $data[$i][115]=$regproganual->trim_p03;
                                                    $data[$i][116]=$regproganual->trim_s03; 
     
                                                    $data[$i][117]=$regproganual->objetivo_desc;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                             ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                             ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                             ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                             ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                             ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                             ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                             ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                             ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                                             ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10') 
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIM_P02',

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                           'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                           'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                           'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                           'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                           'SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIM_P03',

                                                           'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                           'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                            
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")     
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_08")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_09")  
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S03") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_10") 
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                                   
                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07,
                                                                   $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                                   $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                                   $regproganual->obs_08,
                                                                   $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                                   $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                                   $regproganual->obs_09,
                                                                   $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03,
                                                                   
                                                                   $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                                   $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                                   $regproganual->obs_10
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_10;
                                                    $data[$i][16]=$regproganual->mesc_10;
                                                    $data[$i][17]=$regproganual->mes_p10;
                                                    $data[$i][18]=$regproganual->mes_s10;

                                                    $data[$i][19]=$regproganual->acump_10; 
                                                    $data[$i][20]=$regproganual->acumc_10; 
                                                    $data[$i][21]=$regproganual->acum_p10; 
                                                    $data[$i][22]=$regproganual->smf_10; 
                                                    $data[$i][23]=$regproganual->obs_10;

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->mesp_02;
                                                    $data[$i][34]=$regproganual->mesc_02;
                                                    $data[$i][35]=$regproganual->mes_p02;
                                                    $data[$i][36]=$regproganual->mes_s02;

                                                    $data[$i][37]=$regproganual->acump_02; 
                                                    $data[$i][38]=$regproganual->acumc_02; 
                                                    $data[$i][39]=$regproganual->acum_p02; 
                                                    $data[$i][40]=$regproganual->smf_02; 
                                                    $data[$i][41]=$regproganual->obs_02; 

                                                    $data[$i][42]=$regproganual->mesp_03;
                                                    $data[$i][43]=$regproganual->mesc_03;
                                                    $data[$i][44]=$regproganual->mes_p03;
                                                    $data[$i][45]=$regproganual->mes_s03;

                                                    $data[$i][46]=$regproganual->acump_03; 
                                                    $data[$i][47]=$regproganual->acumc_03; 
                                                    $data[$i][48]=$regproganual->acum_p03; 
                                                    $data[$i][49]=$regproganual->smf_03; 
                                                    $data[$i][50]=$regproganual->obs_03;
                                                    
                                                    $data[$i][51]=$regproganual->trimp_01;
                                                    $data[$i][52]=$regproganual->trimc_01;
                                                    $data[$i][53]=$regproganual->trim_p01;
                                                    $data[$i][54]=$regproganual->trim_s01; 

                                                    $data[$i][55]=$regproganual->mesp_04;
                                                    $data[$i][56]=$regproganual->mesc_04;
                                                    $data[$i][57]=$regproganual->mes_p04;
                                                    $data[$i][58]=$regproganual->mes_s04;

                                                    $data[$i][59]=$regproganual->acump_04; 
                                                    $data[$i][60]=$regproganual->acumc_04; 
                                                    $data[$i][61]=$regproganual->acum_p04; 
                                                    $data[$i][62]=$regproganual->smf_04; 
                                                    $data[$i][63]=$regproganual->obs_04; 

                                                    $data[$i][64]=$regproganual->mesp_05;
                                                    $data[$i][65]=$regproganual->mesc_05;
                                                    $data[$i][66]=$regproganual->mes_p05;
                                                    $data[$i][67]=$regproganual->mes_s05;

                                                    $data[$i][68]=$regproganual->acump_05; 
                                                    $data[$i][69]=$regproganual->acumc_05; 
                                                    $data[$i][70]=$regproganual->acum_p05; 
                                                    $data[$i][71]=$regproganual->smf_05; 
                                                    $data[$i][72]=$regproganual->obs_05;    

                                                    $data[$i][73]=$regproganual->mesp_06;
                                                    $data[$i][74]=$regproganual->mesc_06;
                                                    $data[$i][75]=$regproganual->mes_p06;
                                                    $data[$i][76]=$regproganual->mes_s06;

                                                    $data[$i][77]=$regproganual->acump_06; 
                                                    $data[$i][78]=$regproganual->acumc_06; 
                                                    $data[$i][79]=$regproganual->acum_p06; 
                                                    $data[$i][80]=$regproganual->smf_06; 
                                                    $data[$i][81]=$regproganual->obs_06; 

                                                    $data[$i][82]=$regproganual->trimp_02;
                                                    $data[$i][83]=$regproganual->trimc_02;
                                                    $data[$i][84]=$regproganual->trim_p02;
                                                    $data[$i][85]=$regproganual->trim_s02;

                                                    $data[$i][86]=$regproganual->mesp_07;
                                                    $data[$i][87]=$regproganual->mesc_07;
                                                    $data[$i][88]=$regproganual->mes_p07;
                                                    $data[$i][89]=$regproganual->mes_s07;

                                                    $data[$i][90]=$regproganual->acump_07; 
                                                    $data[$i][91]=$regproganual->acumc_07; 
                                                    $data[$i][92]=$regproganual->acum_p07; 
                                                    $data[$i][93]=$regproganual->smf_07; 
                                                    $data[$i][94]=$regproganual->obs_07; 

                                                    $data[$i][95]=$regproganual->mesp_08;
                                                    $data[$i][96]=$regproganual->mesc_08;
                                                    $data[$i][97]=$regproganual->mes_p08;
                                                    $data[$i][98]=$regproganual->mes_s08;

                                                    $data[$i][99]=$regproganual->acump_08; 
                                                    $data[$i][100]=$regproganual->acumc_08; 
                                                    $data[$i][101]=$regproganual->acum_p08; 
                                                    $data[$i][102]=$regproganual->smf_08; 
                                                    $data[$i][103]=$regproganual->obs_08; 

                                                    $data[$i][104]=$regproganual->mesp_09;
                                                    $data[$i][105]=$regproganual->mesc_09;
                                                    $data[$i][106]=$regproganual->mes_p09;
                                                    $data[$i][107]=$regproganual->mes_s09;

                                                    $data[$i][108] =$regproganual->acump_09; 
                                                    $data[$i][109] =$regproganual->acumc_09; 
                                                    $data[$i][110] =$regproganual->acum_p09; 
                                                    $data[$i][111]=$regproganual->smf_09; 
                                                    $data[$i][112]=$regproganual->obs_09; 

                                                    $data[$i][113]=$regproganual->trimp_03;
                                                    $data[$i][114]=$regproganual->trimc_03;
                                                    $data[$i][115]=$regproganual->trim_p03;
                                                    $data[$i][116]=$regproganual->trim_s03; 
       
                                                    $data[$i][117]=$regproganual->objetivo_desc;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 10

                            case '11':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                         ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                         ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                                         ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10') 
                                                                         ->join('SIEVAD_CAT_COLORES_11',  'SIEVAD_CAT_COLORES_11.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_11')
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIM_P02',

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                           'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                           'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                           'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                           'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                           'SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIM_P03',

                                                           'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                           'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10',
                                                           'SIEVAD_DPA.MESP_11' ,'SIEVAD_DPA.MESC_11' ,'SIEVAD_DPA.MES_P11' ,'SIEVAD_CAT_COLORES_11.COLOR_COLOR AS MES_S11', 
                                                           'SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.OBS_11' ,
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                                                                                  
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")  
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_08")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_09")  
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S03") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_10") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S11
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_11")   

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                                   
                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07,
                                                                   $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                                   $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                                   $regproganual->obs_08,
                                                                   $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                                   $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                                   $regproganual->obs_09,
                                                                   $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03,
                                                                   
                                                                   $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                                   $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                                   $regproganual->obs_10,
                                                                   $regproganual->mesp_11,   $regproganual->mesc_11,  $regproganual->mes_p11, $regproganual->mes_s11,  
                                                                   $regproganual->acump_11,  $regproganual->acumc_11, $regproganual->acum_p11,$regproganual->smf_11,
                                                                   $regproganual->obs_11
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_11;
                                                    $data[$i][16]=$regproganual->mesc_11;
                                                    $data[$i][17]=$regproganual->mes_p11;
                                                    $data[$i][18]=$regproganual->mes_s11;

                                                    $data[$i][19]=$regproganual->acump_11; 
                                                    $data[$i][20]=$regproganual->acumc_11; 
                                                    $data[$i][21]=$regproganual->acum_p11; 
                                                    $data[$i][22]=$regproganual->smf_11; 
                                                    $data[$i][23]=$regproganual->obs_11;

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->mesp_02;
                                                    $data[$i][34]=$regproganual->mesc_02;
                                                    $data[$i][35]=$regproganual->mes_p02;
                                                    $data[$i][36]=$regproganual->mes_s02;

                                                    $data[$i][37]=$regproganual->acump_02; 
                                                    $data[$i][38]=$regproganual->acumc_02; 
                                                    $data[$i][39]=$regproganual->acum_p02; 
                                                    $data[$i][40]=$regproganual->smf_02; 
                                                    $data[$i][41]=$regproganual->obs_02; 

                                                    $data[$i][42]=$regproganual->mesp_03;
                                                    $data[$i][43]=$regproganual->mesc_03;
                                                    $data[$i][44]=$regproganual->mes_p03;
                                                    $data[$i][45]=$regproganual->mes_s03;

                                                    $data[$i][46]=$regproganual->acump_03; 
                                                    $data[$i][47]=$regproganual->acumc_03; 
                                                    $data[$i][48]=$regproganual->acum_p03; 
                                                    $data[$i][49]=$regproganual->smf_03; 
                                                    $data[$i][50]=$regproganual->obs_03;
                                                    
                                                    $data[$i][51]=$regproganual->trimp_01;
                                                    $data[$i][52]=$regproganual->trimc_01;
                                                    $data[$i][53]=$regproganual->trim_p01;
                                                    $data[$i][54]=$regproganual->trim_s01; 

                                                    $data[$i][55]=$regproganual->mesp_04;
                                                    $data[$i][56]=$regproganual->mesc_04;
                                                    $data[$i][57]=$regproganual->mes_p04;
                                                    $data[$i][58]=$regproganual->mes_s04;

                                                    $data[$i][59]=$regproganual->acump_04; 
                                                    $data[$i][60]=$regproganual->acumc_04; 
                                                    $data[$i][61]=$regproganual->acum_p04; 
                                                    $data[$i][62]=$regproganual->smf_04; 
                                                    $data[$i][63]=$regproganual->obs_04; 

                                                    $data[$i][64]=$regproganual->mesp_05;
                                                    $data[$i][65]=$regproganual->mesc_05;
                                                    $data[$i][66]=$regproganual->mes_p05;
                                                    $data[$i][67]=$regproganual->mes_s05;

                                                    $data[$i][68]=$regproganual->acump_05; 
                                                    $data[$i][69]=$regproganual->acumc_05; 
                                                    $data[$i][70]=$regproganual->acum_p05; 
                                                    $data[$i][71]=$regproganual->smf_05; 
                                                    $data[$i][72]=$regproganual->obs_05;    

                                                    $data[$i][73]=$regproganual->mesp_06;
                                                    $data[$i][74]=$regproganual->mesc_06;
                                                    $data[$i][75]=$regproganual->mes_p06;
                                                    $data[$i][76]=$regproganual->mes_s06;

                                                    $data[$i][77]=$regproganual->acump_06; 
                                                    $data[$i][78]=$regproganual->acumc_06; 
                                                    $data[$i][79]=$regproganual->acum_p06; 
                                                    $data[$i][80]=$regproganual->smf_06; 
                                                    $data[$i][81]=$regproganual->obs_06; 

                                                    $data[$i][82]=$regproganual->trimp_02;
                                                    $data[$i][83]=$regproganual->trimc_02;
                                                    $data[$i][84]=$regproganual->trim_p02;
                                                    $data[$i][85]=$regproganual->trim_s02;

                                                    $data[$i][86]=$regproganual->mesp_07;
                                                    $data[$i][87]=$regproganual->mesc_07;
                                                    $data[$i][88]=$regproganual->mes_p07;
                                                    $data[$i][89]=$regproganual->mes_s07;

                                                    $data[$i][90]=$regproganual->acump_07; 
                                                    $data[$i][91]=$regproganual->acumc_07; 
                                                    $data[$i][92]=$regproganual->acum_p07; 
                                                    $data[$i][93]=$regproganual->smf_07; 
                                                    $data[$i][94]=$regproganual->obs_07; 

                                                    $data[$i][95]=$regproganual->mesp_08;
                                                    $data[$i][96]=$regproganual->mesc_08;
                                                    $data[$i][97]=$regproganual->mes_p08;
                                                    $data[$i][98]=$regproganual->mes_s08;

                                                    $data[$i][99]=$regproganual->acump_08; 
                                                    $data[$i][100]=$regproganual->acumc_08; 
                                                    $data[$i][101]=$regproganual->acum_p08; 
                                                    $data[$i][102]=$regproganual->smf_08; 
                                                    $data[$i][103]=$regproganual->obs_08; 

                                                    $data[$i][104]=$regproganual->mesp_09;
                                                    $data[$i][105]=$regproganual->mesc_09;
                                                    $data[$i][106]=$regproganual->mes_p09;
                                                    $data[$i][107]=$regproganual->mes_s09;

                                                    $data[$i][108] =$regproganual->acump_09; 
                                                    $data[$i][109]=$regproganual->acumc_09; 
                                                    $data[$i][110]=$regproganual->acum_p09; 
                                                    $data[$i][111]=$regproganual->smf_09; 
                                                    $data[$i][112]=$regproganual->obs_09; 

                                                    $data[$i][113]=$regproganual->trimp_03;
                                                    $data[$i][114]=$regproganual->trimc_03;
                                                    $data[$i][115]=$regproganual->trim_p03;
                                                    $data[$i][116]=$regproganual->trim_s03; 

                                                    $data[$i][117]=$regproganual->mesp_10;
                                                    $data[$i][118]=$regproganual->mesc_10;
                                                    $data[$i][119]=$regproganual->mes_p10;
                                                    $data[$i][120]=$regproganual->mes_s10;

                                                    $data[$i][121]=$regproganual->acump_10; 
                                                    $data[$i][122]=$regproganual->acumc_10; 
                                                    $data[$i][123]=$regproganual->acum_p10; 
                                                    $data[$i][124]=$regproganual->smf_10; 
                                                    $data[$i][125]=$regproganual->obs_10; 
     
                                                    $data[$i][126]=$regproganual->objetivo_desc;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                             ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                             ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                             ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                             ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                             ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                             ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                             ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                             ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                                             ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10') 
                                                                             ->join('SIEVAD_CAT_COLORES_11',  'SIEVAD_CAT_COLORES_11.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_11')
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIM_P02', 

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                           'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                           'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                           'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                           'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                           'SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIM_P03',     

                                                           'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                           'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10',
                                                           'SIEVAD_DPA.MESP_11' ,'SIEVAD_DPA.MESC_11' ,'SIEVAD_DPA.MES_P11' ,'SIEVAD_CAT_COLORES_11.COLOR_COLOR AS MES_S11', 
                                                           'SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.OBS_11' ,
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                                                                                
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")    
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_08")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_09")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_10") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S11
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_11")   
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P04 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 >= 90) AND (SIEVAD_DPA.TRIM_P04 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 >= 70) AND (SIEVAD_DPA.TRIM_P04 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 >= 50) AND (SIEVAD_DPA.TRIM_P04 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 >  0)  AND (SIEVAD_DPA.TRIM_P04 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S04")                                            
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                                   
                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07,
                                                                   $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                                   $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                                   $regproganual->obs_08,
                                                                   $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                                   $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                                   $regproganual->obs_09,
                                                                   $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03,
                                                                   
                                                                   $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                                   $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                                   $regproganual->obs_10,
                                                                   $regproganual->mesp_11,   $regproganual->mesc_11,  $regproganual->mes_p11, $regproganual->mes_s11,  
                                                                   $regproganual->acump_11,  $regproganual->acumc_11, $regproganual->acum_p11,$regproganual->smf_11,
                                                                   $regproganual->obs_11
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_11;
                                                    $data[$i][16]=$regproganual->mesc_11;
                                                    $data[$i][17]=$regproganual->mes_p11;
                                                    $data[$i][18]=$regproganual->mes_s11;

                                                    $data[$i][19]=$regproganual->acump_11; 
                                                    $data[$i][20]=$regproganual->acumc_11; 
                                                    $data[$i][21]=$regproganual->acum_p11; 
                                                    $data[$i][22]=$regproganual->smf_11; 
                                                    $data[$i][23]=$regproganual->obs_11;

                                                    $data[$i][24]=$regproganual->mesp_01;
                                                    $data[$i][25]=$regproganual->mesc_01;
                                                    $data[$i][26]=$regproganual->mes_p01;
                                                    $data[$i][27]=$regproganual->mes_s01;

                                                    $data[$i][28]=$regproganual->acump_01; 
                                                    $data[$i][29]=$regproganual->acumc_01; 
                                                    $data[$i][30]=$regproganual->acum_p01; 
                                                    $data[$i][31]=$regproganual->smf_01; 
                                                    $data[$i][32]=$regproganual->obs_01; 

                                                    $data[$i][33]=$regproganual->mesp_02;
                                                    $data[$i][34]=$regproganual->mesc_02;
                                                    $data[$i][35]=$regproganual->mes_p02;
                                                    $data[$i][36]=$regproganual->mes_s02;

                                                    $data[$i][37]=$regproganual->acump_02; 
                                                    $data[$i][38]=$regproganual->acumc_02; 
                                                    $data[$i][39]=$regproganual->acum_p02; 
                                                    $data[$i][40]=$regproganual->smf_02; 
                                                    $data[$i][41]=$regproganual->obs_02; 

                                                    $data[$i][42]=$regproganual->mesp_03;
                                                    $data[$i][43]=$regproganual->mesc_03;
                                                    $data[$i][44]=$regproganual->mes_p03;
                                                    $data[$i][45]=$regproganual->mes_s03;

                                                    $data[$i][46]=$regproganual->acump_03; 
                                                    $data[$i][47]=$regproganual->acumc_03; 
                                                    $data[$i][48]=$regproganual->acum_p03; 
                                                    $data[$i][49]=$regproganual->smf_03; 
                                                    $data[$i][50]=$regproganual->obs_03;
                                                    
                                                    $data[$i][51]=$regproganual->trimp_01;
                                                    $data[$i][52]=$regproganual->trimc_01;
                                                    $data[$i][53]=$regproganual->trim_p01;
                                                    $data[$i][54]=$regproganual->trim_s01; 

                                                    $data[$i][55]=$regproganual->mesp_04;
                                                    $data[$i][56]=$regproganual->mesc_04;
                                                    $data[$i][57]=$regproganual->mes_p04;
                                                    $data[$i][58]=$regproganual->mes_s04;

                                                    $data[$i][59]=$regproganual->acump_04; 
                                                    $data[$i][60]=$regproganual->acumc_04; 
                                                    $data[$i][61]=$regproganual->acum_p04; 
                                                    $data[$i][62]=$regproganual->smf_04; 
                                                    $data[$i][63]=$regproganual->obs_04; 

                                                    $data[$i][64]=$regproganual->mesp_05;
                                                    $data[$i][65]=$regproganual->mesc_05;
                                                    $data[$i][66]=$regproganual->mes_p05;
                                                    $data[$i][67]=$regproganual->mes_s05;

                                                    $data[$i][68]=$regproganual->acump_05; 
                                                    $data[$i][69]=$regproganual->acumc_05; 
                                                    $data[$i][70]=$regproganual->acum_p05; 
                                                    $data[$i][71]=$regproganual->smf_05; 
                                                    $data[$i][72]=$regproganual->obs_05;    

                                                    $data[$i][73]=$regproganual->mesp_06;
                                                    $data[$i][74]=$regproganual->mesc_06;
                                                    $data[$i][75]=$regproganual->mes_p06;
                                                    $data[$i][76]=$regproganual->mes_s06;

                                                    $data[$i][77]=$regproganual->acump_06; 
                                                    $data[$i][78]=$regproganual->acumc_06; 
                                                    $data[$i][79]=$regproganual->acum_p06; 
                                                    $data[$i][80]=$regproganual->smf_06; 
                                                    $data[$i][81]=$regproganual->obs_06; 

                                                    $data[$i][82]=$regproganual->trimp_02;
                                                    $data[$i][83]=$regproganual->trimc_02;
                                                    $data[$i][84]=$regproganual->trim_p02;
                                                    $data[$i][85]=$regproganual->trim_s02;

                                                    $data[$i][86]=$regproganual->mesp_07;
                                                    $data[$i][87]=$regproganual->mesc_07;
                                                    $data[$i][88]=$regproganual->mes_p07;
                                                    $data[$i][89]=$regproganual->mes_s07;

                                                    $data[$i][90]=$regproganual->acump_07; 
                                                    $data[$i][91]=$regproganual->acumc_07; 
                                                    $data[$i][92]=$regproganual->acum_p07; 
                                                    $data[$i][93]=$regproganual->smf_07; 
                                                    $data[$i][94]=$regproganual->obs_07; 

                                                    $data[$i][95]=$regproganual->mesp_08;
                                                    $data[$i][96]=$regproganual->mesc_08;
                                                    $data[$i][97]=$regproganual->mes_p08;
                                                    $data[$i][98]=$regproganual->mes_s08;

                                                    $data[$i][99]=$regproganual->acump_08; 
                                                    $data[$i][100]=$regproganual->acumc_08; 
                                                    $data[$i][101]=$regproganual->acum_p08; 
                                                    $data[$i][102]=$regproganual->smf_08; 
                                                    $data[$i][103]=$regproganual->obs_08; 

                                                    $data[$i][104]=$regproganual->mesp_09;
                                                    $data[$i][105]=$regproganual->mesc_09;
                                                    $data[$i][106]=$regproganual->mes_p09;
                                                    $data[$i][107]=$regproganual->mes_s09;

                                                    $data[$i][108] =$regproganual->acump_09; 
                                                    $data[$i][109]=$regproganual->acumc_09; 
                                                    $data[$i][110]=$regproganual->acum_p09; 
                                                    $data[$i][111]=$regproganual->smf_09; 
                                                    $data[$i][112]=$regproganual->obs_09; 

                                                    $data[$i][113]=$regproganual->trimp_03;
                                                    $data[$i][114]=$regproganual->trimc_03;
                                                    $data[$i][115]=$regproganual->trim_p03;
                                                    $data[$i][116]=$regproganual->trim_s03; 

                                                    $data[$i][117]=$regproganual->mesp_10;
                                                    $data[$i][118]=$regproganual->mesc_10;
                                                    $data[$i][119]=$regproganual->mes_p10;
                                                    $data[$i][120]=$regproganual->mes_s10;

                                                    $data[$i][121]=$regproganual->acump_10; 
                                                    $data[$i][122]=$regproganual->acumc_10; 
                                                    $data[$i][123]=$regproganual->acum_p10; 
                                                    $data[$i][124]=$regproganual->smf_10; 
                                                    $data[$i][125]=$regproganual->obs_10; 
     
                                                    $data[$i][126]=$regproganual->objetivo_desc;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                                break;     // case 11

                            case '12':
                                if($request->taccion_id == '0' ){   
                                    $i =0;
                                    foreach($op as $key => $val) {
                                        $val         = str_replace(" ", "", Trim($val)); #quita ' '   
                                        $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                         ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                         ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                         ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')                                                                    
                                                                         ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                         ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                         ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                         ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                         ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                         ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                         ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                         ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                         ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                                         ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10') 
                                                                         ->join('SIEVAD_CAT_COLORES_11',  'SIEVAD_CAT_COLORES_11.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_11')
                                                                         ->join('SIEVAD_CAT_COLORES_12',  'SIEVAD_CAT_COLORES_12.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_12') 
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIM_P01',                                                       

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIM_P02',   

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                           'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                           'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                           'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                           'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                           'SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIM_P03',

                                                           'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                           'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10',
                                                           'SIEVAD_DPA.MESP_11' ,'SIEVAD_DPA.MESC_11' ,'SIEVAD_DPA.MES_P11' ,'SIEVAD_CAT_COLORES_11.COLOR_COLOR AS MES_S11', 
                                                           'SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.OBS_11',
                                                           'SIEVAD_DPA.MESP_12' ,'SIEVAD_DPA.MESC_12' ,'SIEVAD_DPA.MES_P12' ,'SIEVAD_CAT_COLORES_12.COLOR_COLOR AS MES_S12', 
                                                           'SIEVAD_DPA.ACUMP_12','SIEVAD_DPA.ACUMC_12','SIEVAD_DPA.ACUM_P12','SIEVAD_DPA.OBS_12',

                                                           'SIEVAD_DPA.TRIMP_04','SIEVAD_DPA.TRIMC_04','SIEVAD_DPA.TRIM_P04',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                       
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")    
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_08")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_09")  
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S03") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_10") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S11
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_11")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S12
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_12")  
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P04 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 >= 90) AND (SIEVAD_DPA.TRIM_P04 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 >= 70) AND (SIEVAD_DPA.TRIM_P04 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 >= 50) AND (SIEVAD_DPA.TRIM_P04 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 >  0)  AND (SIEVAD_DPA.TRIM_P04 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S04")    

                                               ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                               ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                               ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                               ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                               ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                               ->get();
                                        if($regprogeanual->count() > 0){
                                            foreach($regprogeanual as $regproganual){
                                                $i++;
                                                $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                                   
                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07,
                                                                   $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                                   $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                                   $regproganual->obs_08,
                                                                   $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                                   $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                                   $regproganual->obs_09,
                                                                   $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03,
                                                                   
                                                                   $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                                   $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                                   $regproganual->obs_10,
                                                                   $regproganual->mesp_11,   $regproganual->mesc_11,  $regproganual->mes_p11, $regproganual->mes_s11,  
                                                                   $regproganual->acump_11,  $regproganual->acumc_11, $regproganual->acum_p11,$regproganual->smf_11,
                                                                   $regproganual->obs_11,
                                                                   $regproganual->mesp_12,   $regproganual->mesc_12,  $regproganual->mes_p12, $regproganual->mes_s12,  
                                                                   $regproganual->acump_12,  $regproganual->acumc_12, $regproganual->acum_p12,$regproganual->smf_12,
                                                                   $regproganual->obs_12,
                                                                   $regproganual->trimp_04,  $regproganual->trimc_04, $regproganual->trim_p04,$regproganual->trim_s04
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_12;
                                                    $data[$i][16]=$regproganual->mesc_12;
                                                    $data[$i][17]=$regproganual->mes_p12;
                                                    $data[$i][18]=$regproganual->mes_s12;

                                                    $data[$i][19]=$regproganual->acump_12; 
                                                    $data[$i][20]=$regproganual->acumc_12; 
                                                    $data[$i][21]=$regproganual->acum_p12; 
                                                    $data[$i][22]=$regproganual->smf_12; 
                                                    $data[$i][23]=$regproganual->obs_12; 

                                                    $data[$i][24]=$regproganual->trimp_04;
                                                    $data[$i][25]=$regproganual->trimc_04;
                                                    $data[$i][26]=$regproganual->trim_p04;
                                                    $data[$i][27]=$regproganual->trim_s04; 

                                                    $data[$i][28]=$regproganual->mesp_01;
                                                    $data[$i][29]=$regproganual->mesc_01;
                                                    $data[$i][30]=$regproganual->mes_p01;
                                                    $data[$i][31]=$regproganual->mes_s01;

                                                    $data[$i][32]=$regproganual->acump_01; 
                                                    $data[$i][33]=$regproganual->acumc_01; 
                                                    $data[$i][34]=$regproganual->acum_p01; 
                                                    $data[$i][35]=$regproganual->smf_01; 
                                                    $data[$i][36]=$regproganual->obs_01; 

                                                    $data[$i][37]=$regproganual->mesp_02;
                                                    $data[$i][38]=$regproganual->mesc_02;
                                                    $data[$i][39]=$regproganual->mes_p02;
                                                    $data[$i][40]=$regproganual->mes_s02;

                                                    $data[$i][41]=$regproganual->acump_02; 
                                                    $data[$i][42]=$regproganual->acumc_02; 
                                                    $data[$i][43]=$regproganual->acum_p02; 
                                                    $data[$i][44]=$regproganual->smf_02; 
                                                    $data[$i][45]=$regproganual->obs_02; 

                                                    $data[$i][46]=$regproganual->mesp_03;
                                                    $data[$i][47]=$regproganual->mesc_03;
                                                    $data[$i][48]=$regproganual->mes_p03;
                                                    $data[$i][49]=$regproganual->mes_s03;

                                                    $data[$i][50]=$regproganual->acump_03; 
                                                    $data[$i][51]=$regproganual->acumc_03; 
                                                    $data[$i][52]=$regproganual->acum_p03; 
                                                    $data[$i][53]=$regproganual->smf_03; 
                                                    $data[$i][54]=$regproganual->obs_03;
                                                    
                                                    $data[$i][55]=$regproganual->trimp_01;
                                                    $data[$i][56]=$regproganual->trimc_01;
                                                    $data[$i][57]=$regproganual->trim_p01;
                                                    $data[$i][58]=$regproganual->trim_s01; 

                                                    $data[$i][59]=$regproganual->mesp_04;
                                                    $data[$i][60]=$regproganual->mesc_04;
                                                    $data[$i][61]=$regproganual->mes_p04;
                                                    $data[$i][62]=$regproganual->mes_s04;

                                                    $data[$i][63]=$regproganual->acump_04; 
                                                    $data[$i][64]=$regproganual->acumc_04; 
                                                    $data[$i][65]=$regproganual->acum_p04; 
                                                    $data[$i][66]=$regproganual->smf_04; 
                                                    $data[$i][67]=$regproganual->obs_04; 

                                                    $data[$i][68]=$regproganual->mesp_05;
                                                    $data[$i][69]=$regproganual->mesc_05;
                                                    $data[$i][70]=$regproganual->mes_p05;
                                                    $data[$i][71]=$regproganual->mes_s05;

                                                    $data[$i][72]=$regproganual->acump_05; 
                                                    $data[$i][73]=$regproganual->acumc_05; 
                                                    $data[$i][74]=$regproganual->acum_p05; 
                                                    $data[$i][75]=$regproganual->smf_05; 
                                                    $data[$i][76]=$regproganual->obs_05;    

                                                    $data[$i][77]=$regproganual->mesp_06;
                                                    $data[$i][78]=$regproganual->mesc_06;
                                                    $data[$i][79]=$regproganual->mes_p06;
                                                    $data[$i][80]=$regproganual->mes_s06;

                                                    $data[$i][81]=$regproganual->acump_06; 
                                                    $data[$i][82]=$regproganual->acumc_06; 
                                                    $data[$i][83]=$regproganual->acum_p06; 
                                                    $data[$i][84]=$regproganual->smf_06; 
                                                    $data[$i][85]=$regproganual->obs_06; 

                                                    $data[$i][86]=$regproganual->trimp_02;
                                                    $data[$i][87]=$regproganual->trimc_02;
                                                    $data[$i][88]=$regproganual->trim_p02;
                                                    $data[$i][89]=$regproganual->trim_s02;

                                                    $data[$i][90]=$regproganual->mesp_07;
                                                    $data[$i][91]=$regproganual->mesc_07;
                                                    $data[$i][92]=$regproganual->mes_p07;
                                                    $data[$i][93]=$regproganual->mes_s07;

                                                    $data[$i][94]=$regproganual->acump_07; 
                                                    $data[$i][95]=$regproganual->acumc_07; 
                                                    $data[$i][96]=$regproganual->acum_p07; 
                                                    $data[$i][97]=$regproganual->smf_07; 
                                                    $data[$i][98]=$regproganual->obs_07; 

                                                    $data[$i][99]=$regproganual->mesp_08;
                                                    $data[$i][100]=$regproganual->mesc_08;
                                                    $data[$i][101]=$regproganual->mes_p08;
                                                    $data[$i][102]=$regproganual->mes_s08;

                                                    $data[$i][103]=$regproganual->acump_08; 
                                                    $data[$i][104]=$regproganual->acumc_08; 
                                                    $data[$i][105]=$regproganual->acum_p08; 
                                                    $data[$i][106]=$regproganual->smf_08; 
                                                    $data[$i][107]=$regproganual->obs_08; 

                                                    $data[$i][108]=$regproganual->mesp_09;
                                                    $data[$i][109]=$regproganual->mesc_09;
                                                    $data[$i][110]=$regproganual->mes_p09;
                                                    $data[$i][111]=$regproganual->mes_s09;

                                                    $data[$i][112] =$regproganual->acump_09; 
                                                    $data[$i][113] =$regproganual->acumc_09; 
                                                    $data[$i][114] =$regproganual->acum_p09; 
                                                    $data[$i][115]=$regproganual->smf_09; 
                                                    $data[$i][116]=$regproganual->obs_09; 

                                                    $data[$i][117]=$regproganual->trimp_03;
                                                    $data[$i][118]=$regproganual->trimc_03;
                                                    $data[$i][119]=$regproganual->trim_p03;
                                                    $data[$i][120]=$regproganual->trim_s03; 

                                                    $data[$i][121]=$regproganual->mesp_10;
                                                    $data[$i][122]=$regproganual->mesc_10;
                                                    $data[$i][123]=$regproganual->mes_p10;
                                                    $data[$i][124]=$regproganual->mes_s10;

                                                    $data[$i][125]=$regproganual->acump_10; 
                                                    $data[$i][126]=$regproganual->acumc_10; 
                                                    $data[$i][127]=$regproganual->acum_p10; 
                                                    $data[$i][128]=$regproganual->smf_10; 
                                                    $data[$i][129]=$regproganual->obs_10; 

                                                    $data[$i][130]=$regproganual->mesp_11;
                                                    $data[$i][131]=$regproganual->mesc_11;
                                                    $data[$i][132]=$regproganual->mes_p11;
                                                    $data[$i][133]=$regproganual->mes_s11;

                                                    $data[$i][134]=$regproganual->acump_11; 
                                                    $data[$i][135]=$regproganual->acumc_11; 
                                                    $data[$i][136]=$regproganual->acum_p11; 
                                                    $data[$i][137]=$regproganual->smf_11; 
                                                    $data[$i][138]=$regproganual->obs_11; 

                                                    $data[$i][139]=$regproganual->objetivo_desc;    
                                            }  // foreach($regprogeanual as $regproganual)
                                        }      // if($regprogeanual->count() > 0){
                                    }          // foreach 
                                }else{
                                    if($request->taccion_id <> '0' ){   
                                        //*********** 3 ********************
                                        $i =0;
                                        foreach($op as $key => $val) {
                                            ///print "$key = $val <br>";
                                            $val         = str_replace(" ", "", Trim($val)); #quita ' '                    
                                            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=','SIEVAD_EPA.DEPEN_ID2')
                                                                             ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=','SIEVAD_EPA.EPPROY_ID')                              
                                                                             ->join('SIEVAD_DPA',             'SIEVAD_DPA.FOLIO',                '=','SIEVAD_EPA.FOLIO')
                                                                             ->join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID',      '=','SIEVAD_DPA.UMED_ID')
                                                                             ->join('SIEVAD_CAT_COLORES',     'SIEVAD_CAT_COLORES.COLOR_ID',     '=','SIEVAD_DPA.SEMAFA_01')
                                                                             ->join('SIEVAD_CAT_COLORES_01',  'SIEVAD_CAT_COLORES_01.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_01')                                                                      
                                                                             ->join('SIEVAD_CAT_COLORES_02',  'SIEVAD_CAT_COLORES_02.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_02') 
                                                                             ->join('SIEVAD_CAT_COLORES_03',  'SIEVAD_CAT_COLORES_03.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_03') 
                                                                             ->join('SIEVAD_CAT_COLORES_04',  'SIEVAD_CAT_COLORES_04.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_04') 
                                                                             ->join('SIEVAD_CAT_COLORES_05',  'SIEVAD_CAT_COLORES_05.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_05')
                                                                             ->join('SIEVAD_CAT_COLORES_06',  'SIEVAD_CAT_COLORES_06.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_06') 
                                                                             ->join('SIEVAD_CAT_COLORES_07',  'SIEVAD_CAT_COLORES_07.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_07') 
                                                                             ->join('SIEVAD_CAT_COLORES_08',  'SIEVAD_CAT_COLORES_08.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_08') 
                                                                             ->join('SIEVAD_CAT_COLORES_09',  'SIEVAD_CAT_COLORES_09.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_09')
                                                                             ->join('SIEVAD_CAT_COLORES_10',  'SIEVAD_CAT_COLORES_10.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_10') 
                                                                             ->join('SIEVAD_CAT_COLORES_11',  'SIEVAD_CAT_COLORES_11.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_11')
                                                                             ->join('SIEVAD_CAT_COLORES_12',  'SIEVAD_CAT_COLORES_12.COLOR_ID',  '=','SIEVAD_DPA.SEMAF_12') 
                                                       ->select( 
                                                           'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                           'SIEVAD_EPA.EPPROY_ID' ,'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',                                                       
                                                           'SIEVAD_EPA.FOLIO'     ,'SIEVAD_DPA.PARTIDA'  ,'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                           'SIEVAD_DPA.TOTP_02','SIEVAD_DPA.TOTC_02','SIEVAD_DPA.TOT_P01','SIEVAD_CAT_COLORES.COLOR_COLOR', 

                                                           'SIEVAD_DPA.MESP_01' ,'SIEVAD_DPA.MESC_01' ,'SIEVAD_DPA.MES_P01' ,'SIEVAD_CAT_COLORES_01.COLOR_COLOR AS MES_S01', 
                                                           'SIEVAD_DPA.ACUMP_01','SIEVAD_DPA.ACUMC_01','SIEVAD_DPA.ACUM_P01','SIEVAD_DPA.OBS_01',
                                                           'SIEVAD_DPA.MESP_02' ,'SIEVAD_DPA.MESC_02' ,'SIEVAD_DPA.MES_P02' ,'SIEVAD_CAT_COLORES_02.COLOR_COLOR AS MES_S02', 
                                                           'SIEVAD_DPA.ACUMP_02','SIEVAD_DPA.ACUMC_02','SIEVAD_DPA.ACUM_P02','SIEVAD_DPA.OBS_02',
                                                           'SIEVAD_DPA.MESP_03' ,'SIEVAD_DPA.MESC_03' ,'SIEVAD_DPA.MES_P03' ,'SIEVAD_CAT_COLORES_03.COLOR_COLOR AS MES_S03', 
                                                           'SIEVAD_DPA.ACUMP_03','SIEVAD_DPA.ACUMC_03','SIEVAD_DPA.ACUM_P03','SIEVAD_DPA.OBS_03', 

                                                           'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIM_P01',

                                                           'SIEVAD_DPA.MESP_04' ,'SIEVAD_DPA.MESC_04' ,'SIEVAD_DPA.MES_P04' ,'SIEVAD_CAT_COLORES_04.COLOR_COLOR AS MES_S04', 
                                                           'SIEVAD_DPA.ACUMP_04','SIEVAD_DPA.ACUMC_04','SIEVAD_DPA.ACUM_P04','SIEVAD_DPA.OBS_04',
                                                           'SIEVAD_DPA.MESP_05' ,'SIEVAD_DPA.MESC_05' ,'SIEVAD_DPA.MES_P05' ,'SIEVAD_CAT_COLORES_05.COLOR_COLOR AS MES_S05', 
                                                           'SIEVAD_DPA.ACUMP_05','SIEVAD_DPA.ACUMC_05','SIEVAD_DPA.ACUM_P05','SIEVAD_DPA.OBS_05',
                                                           'SIEVAD_DPA.MESP_06' ,'SIEVAD_DPA.MESC_06' ,'SIEVAD_DPA.MES_P06' ,'SIEVAD_CAT_COLORES_06.COLOR_COLOR AS MES_S06', 
                                                           'SIEVAD_DPA.ACUMP_06','SIEVAD_DPA.ACUMC_06','SIEVAD_DPA.ACUM_P06','SIEVAD_DPA.OBS_06',

                                                           'SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIM_P02',                                                       

                                                           'SIEVAD_DPA.MESP_07' ,'SIEVAD_DPA.MESC_07' ,'SIEVAD_DPA.MES_P07' ,'SIEVAD_CAT_COLORES_07.COLOR_COLOR AS MES_S07', 
                                                           'SIEVAD_DPA.ACUMP_07','SIEVAD_DPA.ACUMC_07','SIEVAD_DPA.ACUM_P07','SIEVAD_DPA.OBS_07',
                                                           'SIEVAD_DPA.MESP_08' ,'SIEVAD_DPA.MESC_08' ,'SIEVAD_DPA.MES_P08' ,'SIEVAD_CAT_COLORES_08.COLOR_COLOR AS MES_S08', 
                                                           'SIEVAD_DPA.ACUMP_08','SIEVAD_DPA.ACUMC_08','SIEVAD_DPA.ACUM_P08','SIEVAD_DPA.OBS_08',
                                                           'SIEVAD_DPA.MESP_09' ,'SIEVAD_DPA.MESC_09' ,'SIEVAD_DPA.MES_P09' ,'SIEVAD_CAT_COLORES_09.COLOR_COLOR AS MES_S09', 
                                                           'SIEVAD_DPA.ACUMP_09','SIEVAD_DPA.ACUMC_09','SIEVAD_DPA.ACUM_P09','SIEVAD_DPA.OBS_09',

                                                           'SIEVAD_DPA.TRIMP_03','SIEVAD_DPA.TRIMC_03','SIEVAD_DPA.TRIM_P03',

                                                           'SIEVAD_DPA.MESP_10' ,'SIEVAD_DPA.MESC_10' ,'SIEVAD_DPA.MES_P10' ,'SIEVAD_CAT_COLORES_10.COLOR_COLOR AS MES_S10', 
                                                           'SIEVAD_DPA.ACUMP_10','SIEVAD_DPA.ACUMC_10','SIEVAD_DPA.ACUM_P10','SIEVAD_DPA.OBS_10',
                                                           'SIEVAD_DPA.MESP_11' ,'SIEVAD_DPA.MESC_11' ,'SIEVAD_DPA.MES_P11' ,'SIEVAD_CAT_COLORES_11.COLOR_COLOR AS MES_S11', 
                                                           'SIEVAD_DPA.ACUMP_11','SIEVAD_DPA.ACUMC_11','SIEVAD_DPA.ACUM_P11','SIEVAD_DPA.OBS_11',
                                                           'SIEVAD_DPA.MESP_12' ,'SIEVAD_DPA.MESC_12' ,'SIEVAD_DPA.MES_P12' ,'SIEVAD_CAT_COLORES_12.COLOR_COLOR AS MES_S12', 
                                                           'SIEVAD_DPA.ACUMP_12','SIEVAD_DPA.ACUMC_12','SIEVAD_DPA.ACUM_P12','SIEVAD_DPA.OBS_12',

                                                           'SIEVAD_DPA.TRIMP_04','SIEVAD_DPA.TRIMC_04','SIEVAD_DPA.TRIM_P04',
                                                           'SIEVAD_DPA.LGOB_COD','SIEVAD_DPA.CIPREP_ID','SIEVAD_DPA.OBJETIVO_DESC'                                                                                                                                                                                                                                                                                                               
                                                            )
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S01 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_01")   
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S02 
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_02")      
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S03
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_03") 
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P01 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 90) AND (SIEVAD_DPA.TRIM_P01 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 70) AND (SIEVAD_DPA.TRIM_P01 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >= 50) AND (SIEVAD_DPA.TRIM_P01 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P01 >  0)  AND (SIEVAD_DPA.TRIM_P01 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S01") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S04
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_04") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S05
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_05") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S06
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_06")   
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P02 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 90) AND (SIEVAD_DPA.TRIM_P02 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 70) AND (SIEVAD_DPA.TRIM_P02 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >= 50) AND (SIEVAD_DPA.TRIM_P02 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P02 >  0)  AND (SIEVAD_DPA.TRIM_P02 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S02") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S07
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_07")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S08
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_08")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S09
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_09")  
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P03 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 90) AND (SIEVAD_DPA.TRIM_P03 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 70) AND (SIEVAD_DPA.TRIM_P03 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >= 50) AND (SIEVAD_DPA.TRIM_P03 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P03 >  0)  AND (SIEVAD_DPA.TRIM_P03 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S03") 

                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S10
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_10") 
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S11
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_11")  
                                               ->selectRaw("CASE SIEVAD_DPA.ACUM_S12
                                                                WHEN 1 THEN 'ROJO'
                                                                WHEN 2 THEN 'NARANJA'
                                                                WHEN 3 THEN 'AMARILLO'
                                                                WHEN 4 THEN 'VERDE'                                              
                                                                WHEN 5 THEN 'MORADO'
                                                            END AS SMF_12")  
                                               ->selectRaw("CASE 
                                                               WHEN (SIEVAD_DPA.TRIM_P04 > 0) THEN 
                                                                  CASE
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 > 110)  THEN 'MORADO' 
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 >= 90) AND (SIEVAD_DPA.TRIM_P04 < 110) THEN 'VERDE'
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 >= 70) AND (SIEVAD_DPA.TRIM_P04 <  90) THEN 'AMARILLO'
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 >= 50) AND (SIEVAD_DPA.TRIM_P04 <  70) THEN 'NARANJA'
                                                                      WHEN (SIEVAD_DPA.TRIM_P04 >  0)  AND (SIEVAD_DPA.TRIM_P04 <  50) THEN 'ROJO'
                                                                  END
                                                                  ELSE NULL 
                                                              END AS TRIM_S04")                                                          
                 
                                            ->Where(    'SIEVAD_EPA.PERIODO_ID','=' ,$request->periodo_id)
                                            ->Where(    'SIEVAD_EPA.TACCION_ID','=' ,$request->taccion_id)
                                            ->where(    TRIM('SIEVAD_EPA.DEPEN_ID2'), 'LIKE', "%$val%")
                                            ->orderBy(  'SIEVAD_EPA.PERIODO_ID','ASC')                   
                                            ->orderBy(  'SIEVAD_EPA.DEPEN_ID2' ,'ASC')
                                            ->orderBy(  'SIEVAD_EPA.FOLIO'     ,'ASC')
                                            ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                                            ->get();

                                            if($regprogeanual->count() > 0){
                                                foreach($regprogeanual as $regproganual){
                                                    $i++;
                                                    $dataPoints[$i]=array(
                                                                   $regproganual->periodo_id,$regproganual->depen_id2,$regproganual->depen_desc,
                                                                   $regproganual->epproy_id ,$regproganual->epproy_desc,
                                                                   $regproganual->folio     ,$regproganual->partida  ,$regproganual->actividad_desc,
                                                                   $regproganual->umed_desc,
                                                                   $regproganual->totp_02,   $regproganual->totc_02,  $regproganual->tot_p01, $regproganual->color_color,

                                                                   $regproganual->mesp_01,   $regproganual->mesc_01,  $regproganual->mes_p01, $regproganual->mes_s01,  
                                                                   $regproganual->acump_01,  $regproganual->acumc_01, $regproganual->acum_p01,$regproganual->smf_01,
                                                                   $regproganual->obs_01,
                                                                   $regproganual->mesp_02,   $regproganual->mesc_02,  $regproganual->mes_p02, $regproganual->mes_s02,  
                                                                   $regproganual->acump_02,  $regproganual->acumc_02, $regproganual->acum_p02,$regproganual->smf_02,
                                                                   $regproganual->obs_02,
                                                                   $regproganual->mesp_03,   $regproganual->mesc_03,  $regproganual->mes_p03, $regproganual->mes_s03,  
                                                                   $regproganual->acump_03,  $regproganual->acumc_03, $regproganual->acum_p03,$regproganual->smf_03,
                                                                   $regproganual->obs_03,
                                                                   $regproganual->trimp_01,  $regproganual->trimc_01, $regproganual->trim_p01,$regproganual->trim_s01,
                                                                   
                                                                   $regproganual->mesp_04,   $regproganual->mesc_04,  $regproganual->mes_p04, $regproganual->mes_s04,  
                                                                   $regproganual->acump_04,  $regproganual->acumc_04, $regproganual->acum_p04,$regproganual->smf_04,
                                                                   $regproganual->obs_04,
                                                                   $regproganual->mesp_05,   $regproganual->mesc_05,  $regproganual->mes_p05, $regproganual->mes_s05,  
                                                                   $regproganual->acump_05,  $regproganual->acumc_05, $regproganual->acum_p05,$regproganual->smf_05,
                                                                   $regproganual->obs_05,
                                                                   $regproganual->mesp_06,   $regproganual->mesc_06,  $regproganual->mes_p06, $regproganual->mes_s06,  
                                                                   $regproganual->acump_06,  $regproganual->acumc_06, $regproganual->acum_p06,$regproganual->smf_06,
                                                                   $regproganual->obs_06,
                                                                   $regproganual->trimp_02,  $regproganual->trimc_02, $regproganual->trim_p02,$regproganual->trim_s02,
                                                                   
                                                                   $regproganual->mesp_07,   $regproganual->mesc_07,  $regproganual->mes_p07, $regproganual->mes_s07,  
                                                                   $regproganual->acump_07,  $regproganual->acumc_07, $regproganual->acum_p07,$regproganual->smf_07,
                                                                   $regproganual->obs_07,
                                                                   $regproganual->mesp_08,   $regproganual->mesc_08,  $regproganual->mes_p08, $regproganual->mes_s08,  
                                                                   $regproganual->acump_08,  $regproganual->acumc_08, $regproganual->acum_p08,$regproganual->smf_08,
                                                                   $regproganual->obs_08,
                                                                   $regproganual->mesp_09,   $regproganual->mesc_09,  $regproganual->mes_p09, $regproganual->mes_s09,  
                                                                   $regproganual->acump_09,  $regproganual->acumc_09, $regproganual->acum_p09,$regproganual->smf_09,
                                                                   $regproganual->obs_09,
                                                                   $regproganual->trimp_03,  $regproganual->trimc_03, $regproganual->trim_p03,$regproganual->trim_s03,
                                                                   
                                                                   $regproganual->mesp_10,   $regproganual->mesc_10,  $regproganual->mes_p10, $regproganual->mes_s10,  
                                                                   $regproganual->acump_10,  $regproganual->acumc_10, $regproganual->acum_p10,$regproganual->smf_10,
                                                                   $regproganual->obs_10,
                                                                   $regproganual->mesp_11,   $regproganual->mesc_11,  $regproganual->mes_p11, $regproganual->mes_s11,  
                                                                   $regproganual->acump_11,  $regproganual->acumc_11, $regproganual->acum_p11,$regproganual->smf_11,
                                                                   $regproganual->obs_11,
                                                                   $regproganual->mesp_12,   $regproganual->mesc_12,  $regproganual->mes_p12, $regproganual->mes_s12,  
                                                                   $regproganual->acump_12,  $regproganual->acumc_12, $regproganual->acum_p12,$regproganual->smf_12,
                                                                   $regproganual->obs_12,
                                                                   $regproganual->trimp_04,  $regproganual->trimc_04, $regproganual->trim_p04,$regproganual->trim_s04
                                                                  );       
                                                    //Array multidimencional
                                                    //https://www.w3schools.com/php/php_arrays_multidimensional.asp   
                                                    //https://www.geeksforgeeks.org/multidimensional-arrays-in-php/
                                                    $data[$i][0] =$regproganual->periodo_id;
                                                    $data[$i][1] =$regproganual->depen_id2;
                                                    $data[$i][2] =$regproganual->depen_desc;
                                                    
                                                    $data[$i][3] =$regproganual->epproy_id;
                                                    $data[$i][4] =$regproganual->epproy_desc; 

                                                    $data[$i][5] =$regproganual->folio;
                                                    $data[$i][6] =$regproganual->partida;
                                                    $data[$i][7] =$regproganual->lgob_cod;
                                                    $data[$i][8] =$regproganual->ciprep_id;
                                                    $data[$i][9] =$regproganual->actividad_desc;  
                                                    $data[$i][10]=$regproganual->umed_desc; 
                                                                            
                                                    $data[$i][11]=$regproganual->totp_02;
                                                    $data[$i][12]=$regproganual->totc_02;
                                                    $data[$i][13]=$regproganual->tot_p01; 
                                                    $data[$i][14]=$regproganual->color_color; 

                                                    $data[$i][15]=$regproganual->mesp_12;
                                                    $data[$i][16]=$regproganual->mesc_12;
                                                    $data[$i][17]=$regproganual->mes_p12;
                                                    $data[$i][18]=$regproganual->mes_s12;

                                                    $data[$i][19]=$regproganual->acump_12; 
                                                    $data[$i][20]=$regproganual->acumc_12; 
                                                    $data[$i][21]=$regproganual->acum_p12; 
                                                    $data[$i][22]=$regproganual->smf_12; 
                                                    $data[$i][23]=$regproganual->obs_12; 

                                                    $data[$i][24]=$regproganual->trimp_04;
                                                    $data[$i][25]=$regproganual->trimc_04;
                                                    $data[$i][26]=$regproganual->trim_p04;
                                                    $data[$i][27]=$regproganual->trim_s04; 

                                                    $data[$i][28]=$regproganual->mesp_01;
                                                    $data[$i][29]=$regproganual->mesc_01;
                                                    $data[$i][30]=$regproganual->mes_p01;
                                                    $data[$i][31]=$regproganual->mes_s01;

                                                    $data[$i][32]=$regproganual->acump_01; 
                                                    $data[$i][33]=$regproganual->acumc_01; 
                                                    $data[$i][34]=$regproganual->acum_p01; 
                                                    $data[$i][35]=$regproganual->smf_01; 
                                                    $data[$i][36]=$regproganual->obs_01; 

                                                    $data[$i][37]=$regproganual->mesp_02;
                                                    $data[$i][38]=$regproganual->mesc_02;
                                                    $data[$i][39]=$regproganual->mes_p02;
                                                    $data[$i][40]=$regproganual->mes_s02;

                                                    $data[$i][41]=$regproganual->acump_02; 
                                                    $data[$i][42]=$regproganual->acumc_02; 
                                                    $data[$i][43]=$regproganual->acum_p02; 
                                                    $data[$i][44]=$regproganual->smf_02; 
                                                    $data[$i][45]=$regproganual->obs_02; 

                                                    $data[$i][46]=$regproganual->mesp_03;
                                                    $data[$i][47]=$regproganual->mesc_03;
                                                    $data[$i][48]=$regproganual->mes_p03;
                                                    $data[$i][49]=$regproganual->mes_s03;

                                                    $data[$i][50]=$regproganual->acump_03; 
                                                    $data[$i][51]=$regproganual->acumc_03; 
                                                    $data[$i][52]=$regproganual->acum_p03; 
                                                    $data[$i][53]=$regproganual->smf_03; 
                                                    $data[$i][54]=$regproganual->obs_03;
                                                    
                                                    $data[$i][55]=$regproganual->trimp_01;
                                                    $data[$i][56]=$regproganual->trimc_01;
                                                    $data[$i][57]=$regproganual->trim_p01;
                                                    $data[$i][58]=$regproganual->trim_s01; 

                                                    $data[$i][59]=$regproganual->mesp_04;
                                                    $data[$i][60]=$regproganual->mesc_04;
                                                    $data[$i][61]=$regproganual->mes_p04;
                                                    $data[$i][62]=$regproganual->mes_s04;

                                                    $data[$i][63]=$regproganual->acump_04; 
                                                    $data[$i][64]=$regproganual->acumc_04; 
                                                    $data[$i][65]=$regproganual->acum_p04; 
                                                    $data[$i][66]=$regproganual->smf_04; 
                                                    $data[$i][67]=$regproganual->obs_04; 

                                                    $data[$i][68]=$regproganual->mesp_05;
                                                    $data[$i][69]=$regproganual->mesc_05;
                                                    $data[$i][70]=$regproganual->mes_p05;
                                                    $data[$i][71]=$regproganual->mes_s05;

                                                    $data[$i][72]=$regproganual->acump_05; 
                                                    $data[$i][73]=$regproganual->acumc_05; 
                                                    $data[$i][74]=$regproganual->acum_p05; 
                                                    $data[$i][75]=$regproganual->smf_05; 
                                                    $data[$i][76]=$regproganual->obs_05;    

                                                    $data[$i][77]=$regproganual->mesp_06;
                                                    $data[$i][78]=$regproganual->mesc_06;
                                                    $data[$i][79]=$regproganual->mes_p06;
                                                    $data[$i][80]=$regproganual->mes_s06;

                                                    $data[$i][81]=$regproganual->acump_06; 
                                                    $data[$i][82]=$regproganual->acumc_06; 
                                                    $data[$i][83]=$regproganual->acum_p06; 
                                                    $data[$i][84]=$regproganual->smf_06; 
                                                    $data[$i][85]=$regproganual->obs_06; 

                                                    $data[$i][86]=$regproganual->trimp_02;
                                                    $data[$i][87]=$regproganual->trimc_02;
                                                    $data[$i][88]=$regproganual->trim_p02;
                                                    $data[$i][89]=$regproganual->trim_s02;

                                                    $data[$i][90]=$regproganual->mesp_07;
                                                    $data[$i][91]=$regproganual->mesc_07;
                                                    $data[$i][92]=$regproganual->mes_p07;
                                                    $data[$i][93]=$regproganual->mes_s07;

                                                    $data[$i][94]=$regproganual->acump_07; 
                                                    $data[$i][95]=$regproganual->acumc_07; 
                                                    $data[$i][96]=$regproganual->acum_p07; 
                                                    $data[$i][97]=$regproganual->smf_07; 
                                                    $data[$i][98]=$regproganual->obs_07; 

                                                    $data[$i][99]=$regproganual->mesp_08;
                                                    $data[$i][100]=$regproganual->mesc_08;
                                                    $data[$i][101]=$regproganual->mes_p08;
                                                    $data[$i][102]=$regproganual->mes_s08;

                                                    $data[$i][103]=$regproganual->acump_08; 
                                                    $data[$i][104]=$regproganual->acumc_08; 
                                                    $data[$i][105]=$regproganual->acum_p08; 
                                                    $data[$i][106]=$regproganual->smf_08; 
                                                    $data[$i][107]=$regproganual->obs_08; 

                                                    $data[$i][108]=$regproganual->mesp_09;
                                                    $data[$i][109]=$regproganual->mesc_09;
                                                    $data[$i][110]=$regproganual->mes_p09;
                                                    $data[$i][111]=$regproganual->mes_s09;

                                                    $data[$i][112] =$regproganual->acump_09; 
                                                    $data[$i][113] =$regproganual->acumc_09; 
                                                    $data[$i][114] =$regproganual->acum_p09; 
                                                    $data[$i][115]=$regproganual->smf_09; 
                                                    $data[$i][116]=$regproganual->obs_09; 

                                                    $data[$i][117]=$regproganual->trimp_03;
                                                    $data[$i][118]=$regproganual->trimc_03;
                                                    $data[$i][119]=$regproganual->trim_p03;
                                                    $data[$i][120]=$regproganual->trim_s03; 

                                                    $data[$i][121]=$regproganual->mesp_10;
                                                    $data[$i][122]=$regproganual->mesc_10;
                                                    $data[$i][123]=$regproganual->mes_p10;
                                                    $data[$i][124]=$regproganual->mes_s10;

                                                    $data[$i][125]=$regproganual->acump_10; 
                                                    $data[$i][126]=$regproganual->acumc_10; 
                                                    $data[$i][127]=$regproganual->acum_p10; 
                                                    $data[$i][128]=$regproganual->smf_10; 
                                                    $data[$i][129]=$regproganual->obs_10; 

                                                    $data[$i][130]=$regproganual->mesp_11;
                                                    $data[$i][131]=$regproganual->mesc_11;
                                                    $data[$i][132]=$regproganual->mes_p11;
                                                    $data[$i][133]=$regproganual->mes_s11;

                                                    $data[$i][134]=$regproganual->acump_11; 
                                                    $data[$i][135]=$regproganual->acumc_11; 
                                                    $data[$i][136]=$regproganual->acum_p11; 
                                                    $data[$i][137]=$regproganual->smf_11; 
                                                    $data[$i][138]=$regproganual->obs_11; 
      
                                                    $data[$i][139]=$regproganual->objetivo_desc;    
                                                }  // foreach($regprogeanual as $regproganual)
                                            }      // if($regprogeanual->count() > 0){                            
                                        }  // foreach 
                                    }      // taccion_id  <> 0
                                }          // taccion_id  == 0  
                            break;         // case 12                                                                                                                                                                                                                                                                        
                        } //swith
                    //}     //if($request->control <> 'S' ){   
                }           //if($request->control == 'S' ){   

                /************ Bitacora inicia *************************************/ 
                setlocale(LC_TIME, "spanish");        
                $xip          = session()->get('ip');
                $xperiodo_id  = (int)date('Y');
                $xprograma_id = 1;
                $xmes_id      = (int)date('m');
                $xproceso_id  =         3;
                $xfuncion_id  =      3001;
                $xtrx_id      =         2;    //Reportes        
                $id           =         0;
                $regbitacora = regBitacoraModel::select('PERIODO_ID', 'PROGRAMA_ID', 'MES_ID', 'PROCESO_ID', 'FUNCION_ID', 'TRX_ID', 'FOLIO', 'NO_VECES', 'FECHA_REG', 'IP', 'LOGIN', 'FECHA_M', 'IP_M', 'LOGIN_M')
                               ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                        'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO'      => $id])
                               ->get();
                if($regbitacora->count() <= 0){              // Alta
                        $nuevoregBitacora = new regBitacoraModel();              
                        $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                        $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                        $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                        $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                        $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                        $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                        $nuevoregBitacora->FOLIO      = $id;             // Folio    
                        $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                        $nuevoregBitacora->IP         = $ip;             // IP
                        $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                        $nuevoregBitacora->save();
                        if($nuevoregBitacora->save() == true)
                            toastr()->success('Trx de reporte Excel registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                        else
                            toastr()->error('Error de trx de reporte Excel. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                }else{                   
                    //*********** Obtine el no. de veces *****************************
                    $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id, 'PROGRAMA_ID' => $xprograma_id, 
                                                      'MES_ID' => $xmes_id, 'PROCESO_ID' => $xproceso_id, 
                                                      'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id,'FOLIO' => $id])
                                 ->max('NO_VECES');
                    $xno_veces = $xno_veces+1;                        
                    //*********** Termina de obtener el no de veces *****************************         
                    $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id,
                                            'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id,
                                            'FOLIO'      => $id])
                                   ->update([
                                             'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                             'IP_M'     => $regbitacora->IP       = $ip,
                                             'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                             'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]);
                    toastr()->success('Trx de reporte Excel actualizada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                }   /************ Bitacora termina *************************************/         
                
                //*********** Genera reporte a formato excel con parámetros ***********/
                //return Excel::download(new ExcelExportMensualdet_v2($request->periodo_id,$request->mes_id,$request->depen_id,$request->taccion_id,$request->control,$data,$i),'Reporte_Mensual_Detallado'.date('d-m-Y').'.xlsx');
                return Excel::download(new ExcelExportMensualbddet_V2($request->periodo_id,$request->mes_id,$request->depen_id,$request->taccion_id,$request->control,$data,$i),'Reporte_Base_de_Datos'.date('d-m-Y').'.xlsx');            
                break;

            case 'D':    //Formato PDF 
                return back()->withErrors([' Por la cantidad de datos. Reporte diponible sólo en excel.']);
                break;                              
            }   // switch ($request->tipo) --- Termina tipo de reporte pantalla, excel o PDF          
            break;                              

        }   // switch .... Clase de reportes C-concentrados, D-detallados  S-Sabana          
    }





    /***********************************************************************************/
    /*** Filtro para generar reporte mensual                                      ******/
    /***********************************************************************************/
    public function actionReporteMensualFiltro(){
        $nombre       = session()->get('userlog');
        $pass         = session()->get('passlog');
        if($nombre == NULL AND $pass == NULL){
            return view('sicinar.login.expirada');
        }
        $usuario      = session()->get('usuario');
        $rango        = session()->get('rango');
        $ip           = session()->get('ip');
        $arbol_id     = session()->get('arbol_id');        
        $depen_id     = session()->get('depen_id');     

        $regperiodos  = regPeriodosModel::select('PERIODO_ID', 'PERIODO_DESC')
                        ->get();         
        $regmeses     = regMesesModel::select('MES_ID','MES_DESC')
                        ->get();   
        $regtipometa  = regTipometaModel::select('TACCION_ID','TACCION_DESC')
                        ->orderBy('TACCION_ID','asc')
                        ->get();                               
        //********* Validar rol de usuario **********************/
        if(session()->get('rango') !== '0'){  
            //$regdepen     =regdepenModel::select('DEPEN_ID', 'DEPEN_DESC')
            //               ->where(  'DEPEN_STATUS','1')
            //               ->orderBy('DEPEN_ID'    ,'ASC')
            //               ->get();   
            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                              'SIEVAD_EPA.DEPEN_ID2')
                                             ->join('SIEVAD_DPA','SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                           ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->selectRaw('COUNT(*) AS NACTIV')
                           ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID'             ,'ASC')
                           ->orderBy(  'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC','ASC')
                           ->get();
        }else{                     
            //$regdepen     =regdepenModel::select('DEPEN_ID', 'DEPEN_DESC')
            //               ->where('DEPEN_STATUS','1')
            //               ->where('DEPEN_ID'    ,$depen_id)
            //               ->get();                            
            $regprogeanual=regProgeAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                              'SIEVAD_DPA.DEPEN_ID2')
                                             ->join('SIEVAD_DPA','SIEVAD_DPA.FOLIO','=','SIEVAD_EPA.FOLIO')
                           ->select(   'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->selectRaw('COUNT(*) AS NACTIV')                           
                           ->groupBy(  'SIEVAD_EPA.PERIODO_ID','SIEVAD_EPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->where(    'SIEVAD_EPA.DEPEN_ID2'              ,$depen_id)            
                           ->orderBy(  'SIEVAD_EPA.PERIODO_ID'             ,'ASC')
                           ->orderBy(  'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC','ASC')
                           ->get();     
        }                        
        if($regprogeanual->count() <= 0){
            toastr()->error('No existen programas anuales.','Lo siento!',['positionClass' => 'toast-bottom-right']);
        }
        return view('sicinar.reportes.reporteMensual',compact('nombre','usuario','regperiodos','regmeses','regprogeanual','regtipometa')); 
    }

    /***********************************************************************************/
    /*** Generar reporte mensual                                               ******/
    /***********************************************************************************/
    public function actionVerReporteMensual(reportemensualfiltroRequest $request){
        $nombre       = session()->get('userlog');
        $pass         = session()->get('passlog');
        if($nombre == NULL AND $pass == NULL){
            return view('sicinar.login.expirada');
        }
        $usuario      = session()->get('usuario');
        $rango        = session()->get('rango');
        $ip           = session()->get('ip');
        $arbol_id     = session()->get('arbol_id');        
        $depen_id     = session()->get('depen_id');     

     
        $regmeses     = regMesesModel::select('MES_ID','MES_DESC')
                        ->get();      
        $regepprog    = regEPprogramaModel::select('EPPROG_ID','EPPROG_DESC')
                        ->orderBy('EPPROG_ID','asc')
                        ->get();                         
        $regepproy    = regEPproyectoModel::select('EPPROy_ID','EPPROy_DESC')
                        ->orderBy('EPPROy_ID','asc')
                        ->get();   
       $regdepen      = regdepenModel::select('DEPEN_ID', 'DEPEN_DESC')
                        ->orderBy('DEPEN_DESC'  ,'ASC')
                        ->get();                                  
        $regumedida   = regUmedidaModel::select('UMED_ID','UMED_DESC')
                        ->orderBy('UMED_DESC','asc')
                        ->get();                           
        //**************************************************************//
        // ***** busqueda https://github.com/rimorsoft/Search-simple ***//
        // ***** video https://www.youtube.com/watch?v=bmtD9GUaszw   ***//                            
        //**************************************************************//
        $periodo_id= $request->get('periodo_id'); //Periodo
        $mes_id    = $request->get('mes_id');     // Mes
        $depen_id  = $request->get('depen_id');   // Dependencia ejecutora
        $tipo      = $request->get('tipo');       // P-antalla, E-xcel, D-PDF 
        $folio     = $request->get('folio');     
        $clase     = $request->get('clase');      //clase de reporte C-concentrado, D-Detallado, S-sabana
        $trim      = $request->get('trim');       // Trimestre
        

        //if($request->clase == 'C'){
        switch ($request->clase) {
        //*******************************************************************************//
        //******** Reportes concentrados  ***********************************************//
        //*******************************************************************************//
        case 'C':    //Concentrados

            //**************************************************************************//
            // Generar reportes concentrados                                            //
            //**************************************************************************//
            switch ($request->tipo) {
            case 'P':    //Por pantalla concentrado
                if($request->depen_id == '0' && $request->taccion_id == '0' ){   
                    // Todas las unidades ejecutoras y todos los tipos     
                    $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                                      'SIEVAD_DPA.DEPEN_ID2')
                                                     ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                      'SIEVAD_DPA.FOLIO')
                           ->select(   'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')

                           ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')                           

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')          
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_01)  AS GTAP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_02)  AS GTAP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_01)  AS GTAC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_02)  AS GTAC_02')
                           ->selectRaw('COUNT(*) AS NACTIV')
                           ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                           ->groupBy(  'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')
                           ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                           ->get();                            

                    if($regprogdanual->count() <= 0)
                        toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);
                }else{
                    if($request->depen_id <> '0' && $request->taccion_id == '0' ){   
                       //*********** 2 ********************
                        $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID',
                                                                                  '=','SIEVAD_DPA.DEPEN_ID2')
                                                     ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                      'SIEVAD_DPA.FOLIO')
                           ->select(   'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')

                           ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')                           

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')          
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_01)  AS GTAP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_02)  AS GTAP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_01)  AS GTAC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_02)  AS GTAC_02')
                           ->selectRaw('COUNT(*) AS NACTIV')

                           ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                           ->Where(    'SIEVAD_DPA.DEPEN_ID2' ,'=',$request->depen_id)
                           ->groupBy(  'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')
                           ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                           ->get();                                              
                        if($regprogdanual->count() <= 0)
                            toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);
                    }else{
                        if($request->depen_id == '0' && $request->taccion_id <> '0' ){   
                           //*********** 3 ********************
                           $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID',
                                                                                      '=','SIEVAD_DPA.DEPEN_ID2')
                                                     ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                      'SIEVAD_DPA.FOLIO')
                           ->select(   'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->selectRaw('COUNT(*) AS NACTIV')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')

                           ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')                           

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')          
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_01)  AS GTAP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_02)  AS GTAP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_01)  AS GTAC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_02)  AS GTAC_02')
                           ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                           //->Where(  'SIEVAD_DPA.DEPEN_ID2' ,'=',$request->depen_id)
                           ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                           ->groupBy(  'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')
                           ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                           ->get();                                              
                            if($regprogdanual->count() <= 0)
                                toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);                          
                        }else{
                            if($request->depen_id <> '0' && $request->taccion_id <> '0' ){   
                               //*********** 4 ********************
                               $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_DEPENDENCIAS',
                                                                       'SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID',
                                                                                          '=','SIEVAD_DPA.DEPEN_ID2')
                                                         ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                          'SIEVAD_DPA.FOLIO')
                               ->select(   'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                               ->selectRaw('COUNT(*) AS NACTIV')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')

                               ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')                           

                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')          
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12') 

                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12') 

                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_01)  AS GTAP_01')
                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02)  AS GTAP_02')
                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_01)  AS GTAC_01')
                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02)  AS GTAC_02')
                               ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                               ->Where(    'SIEVAD_DPA.DEPEN_ID2' ,'=',$request->depen_id)
                               ->Where(    'SIEVAD_DPA.TACCION_ID','=',$request->taccion_id)
                               ->groupBy(  'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                               ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')
                               ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                               ->get();                                              
                                if($regprogdanual->count() <= 0)
                                    toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);                                                 
                            }   // depen_id        
                        }   // depen_id        
                    }   // depen_id  
                }   // depen_id
                /************ Bitacora inicia *************************************/ 
                setlocale(LC_TIME, "spanish");        
                $xip          = session()->get('ip');
                $xperiodo_id  = (int)date('Y');
                $xprograma_id = 1;
                $xmes_id      = (int)date('m');
                $xproceso_id  =         3;
                $xfuncion_id  =      3001;
                $xtrx_id      =         2;    //Reportes        
                $id           =         0;
                $regbitacora = regBitacoraModel::select('PERIODO_ID','PROGRAMA_ID','MES_ID','PROCESO_ID','FUNCION_ID', 
                                                        'TRX_ID','FOLIO','NO_VECES','FECHA_REG','IP','LOGIN',
                                                        'FECHA_M','IP_M', 'LOGIN_M')
                               ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                        'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO'      => $id])
                               ->get();
                if($regbitacora->count() <= 0){              // Alta
                    $nuevoregBitacora = new regBitacoraModel();              
                    $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                    $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                    $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                    $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                    $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                    $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                    $nuevoregBitacora->FOLIO      = $id;             // Folio    
                    $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                    $nuevoregBitacora->IP         = $ip;             // IP
                    $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                    $nuevoregBitacora->save();
                    if($nuevoregBitacora->save() == true)
                        toastr()->success('Trx de reporte registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                    else
                        toastr()->error('Error de trx de reporte. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                }else{                   
                    //*********** Obtine el no. de veces *****************************
                    $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID'=> $xprograma_id,
                                                          'MES_ID'     => $xmes_id,    'PROCESO_ID' => $xproceso_id, 
                                                          'FUNCION_ID' => $xfuncion_id,'TRX_ID'     => $xtrx_id,
                                                          'FOLIO'      => $id])
                                 ->max('NO_VECES');
                    $xno_veces = $xno_veces+1;                        
                    //*********** Termina de obtener el no de veces *****************************         
                    $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID'=> $xprograma_id,'MES_ID' => $xmes_id,
                                            'PROCESO_ID' => $xproceso_id,'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id,
                                            'FOLIO'      => $id])
                                       ->update([
                                                 'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                                 'IP_M'     => $regbitacora->IP       = $ip,
                                                 'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                                 'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]);
                    toastr()->success('Trx de reporte actualizada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                }   /************ Bitacora termina *************************************/         
                //************** Genera reporte concentrado en pantalla ******************/
                return view('sicinar.reportes.verReportemensualcon',compact('nombre','usuario','regprogdanual','regtotal','regmeses','periodo_id','mes_id','depen_id'));
                break;

            case 'E':    //Formato excel concentrado            
                /************ Bitacora inicia *************************************/ 
                setlocale(LC_TIME, "spanish");        
                $xip          = session()->get('ip');
                $xperiodo_id  = (int)date('Y');
                $xprograma_id = 1;
                $xmes_id      = (int)date('m');
                $xproceso_id  =         3;
                $xfuncion_id  =      3001;
                $xtrx_id      =         2;    //Reportes        
                $id           =         0;
                $regbitacora = regBitacoraModel::select('PERIODO_ID', 'PROGRAMA_ID', 'MES_ID', 'PROCESO_ID', 'FUNCION_ID', 'TRX_ID', 'FOLIO', 'NO_VECES', 'FECHA_REG', 'IP', 'LOGIN', 'FECHA_M', 'IP_M', 'LOGIN_M')
                               ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                        'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO'      => $id])
                               ->get();
                if($regbitacora->count() <= 0){              // Alta
                        $nuevoregBitacora = new regBitacoraModel();              
                        $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                        $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                        $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                        $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                        $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                        $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                        $nuevoregBitacora->FOLIO      = $id;             // Folio    
                        $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                        $nuevoregBitacora->IP         = $ip;             // IP
                        $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                        $nuevoregBitacora->save();
                        if($nuevoregBitacora->save() == true)
                            toastr()->success('Trx de reporte Excel registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                        else
                            toastr()->error('Error de trx de reporte Excel. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                }else{                   
                    //*********** Obtine el no. de veces *****************************
                    $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id, 'PROGRAMA_ID' => $xprograma_id, 
                                                      'MES_ID' => $xmes_id, 'PROCESO_ID' => $xproceso_id, 
                                                      'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id,'FOLIO' => $id])
                                 ->max('NO_VECES');
                    $xno_veces = $xno_veces+1;                        
                    //*********** Termina de obtener el no de veces *****************************         
                    $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id,
                                            'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id,
                                            'FOLIO'      => $id])
                                   ->update([
                                             'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                             'IP_M'     => $regbitacora->IP       = $ip,
                                             'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                             'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]);
                    toastr()->success('Trx de reporte Excel actualizada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                }   /************ Bitacora termina *************************************/         

                //*********** Genera reporte a formato excel con parámetros ***********/
                return Excel::download(new ExcelExportMensualcon($request->periodo_id,$request->mes_id,$request->depen_id,$request->taccion_id),'Reporte_Mensual_Concentrado'.date('d-m-Y').'.xlsx');
                break;

            case 'D':    //Formato PDF concentrado
                if($request->depen_id == '0' && $request->taccion_id == '0' ){   
                    // Todas las unidades ejecutoras y todos los tipos     
                    $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                                      'SIEVAD_DPA.DEPEN_ID2')
                                                     ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                      'SIEVAD_DPA.FOLIO')
                           ->select(   'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')

                           ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')                           

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')          
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_01)  AS GTAP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_02)  AS GTAP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_01)  AS GTAC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_02)  AS GTAC_02')
                           ->selectRaw('COUNT(*) AS NACTIV')
                           ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                           ->groupBy(  'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')
                           ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                           ->get();                            

                    if($regprogdanual->count() <= 0)
                        toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);
                }else{
                    if($request->depen_id <> '0' && $request->taccion_id == '0' ){   
                       //*********** 2 ********************
                        $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID',
                                                                                  '=','SIEVAD_DPA.DEPEN_ID2')
                                                     ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                      'SIEVAD_DPA.FOLIO')
                           ->select(   'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')

                           ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')                           

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')          
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_01)  AS GTAP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_02)  AS GTAP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_01)  AS GTAC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_02)  AS GTAC_02')
                           ->selectRaw('COUNT(*) AS NACTIV')

                           ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                           ->Where(    'SIEVAD_DPA.DEPEN_ID2' ,'=',$request->depen_id)
                           ->groupBy(  'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')
                           ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                           ->get();                                              
                        if($regprogdanual->count() <= 0)
                            toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);
                    }else{
                        if($request->depen_id == '0' && $request->taccion_id <> '0' ){   
                           //*********** 3 ********************
                           $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID',
                                                                                      '=','SIEVAD_DPA.DEPEN_ID2')
                                                     ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                      'SIEVAD_DPA.FOLIO')
                           ->select(   'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->selectRaw('COUNT(*) AS NACTIV')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')

                           ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                           ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')                           

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')          
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11') 
                           ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12') 

                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_01)  AS GTAP_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTP_02)  AS GTAP_02')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_01)  AS GTAC_01')
                           ->selectRaw('SUM(SIEVAD_DPA.TOTC_02)  AS GTAC_02')
                           ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                           //->Where(  'SIEVAD_DPA.DEPEN_ID2' ,'=',$request->depen_id)
                           ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                           ->groupBy(  'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                           ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')
                           ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                           ->get();                                              
                            if($regprogdanual->count() <= 0)
                                toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);                          
                        }else{
                            if($request->depen_id <> '0' && $request->taccion_id <> '0' ){   
                               //*********** 4 ********************
                               $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_DEPENDENCIAS',
                                                                       'SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID',
                                                                                          '=','SIEVAD_DPA.DEPEN_ID2')
                                                         ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                          'SIEVAD_DPA.FOLIO')
                               ->select(   'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                               ->selectRaw('COUNT(*) AS NACTIV')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_01) AS GMP_01')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_02) AS GMP_02')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_03) AS GMP_03')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_04) AS GMP_04')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_05) AS GMP_05')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_06) AS GMP_06')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_07) AS GMP_07')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_08) AS GMP_08')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_09) AS GMP_09')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_10) AS GMP_10')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_11) AS GMP_11')
                               ->selectRaw('SUM(SIEVAD_DPA.MESP_12) AS GMP_12')

                               ->selectRaw('SUM(SIEVAD_DPA.MESC_01) AS GMC_01')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_02) AS GMC_02')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_03) AS GMC_03')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_04) AS GMC_04')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_05) AS GMC_05')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_06) AS GMC_06')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_07) AS GMC_07')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_08) AS GMC_08')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_09) AS GMC_09')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_10) AS GMC_10')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_11) AS GMC_11')
                               ->selectRaw('SUM(SIEVAD_DPA.MESC_12) AS GMC_12')                           

                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_01) AS GACUMP_01')          
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_02) AS GACUMP_02') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_03) AS GACUMP_03') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_04) AS GACUMP_04') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_05) AS GACUMP_05') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_06) AS GACUMP_06') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_07) AS GACUMP_07') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_08) AS GACUMP_08') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_09) AS GACUMP_09') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_10) AS GACUMP_10') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_11) AS GACUMP_11') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMP_12) AS GACUMP_12') 

                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_01) AS GACUMC_01') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_02) AS GACUMC_02') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_03) AS GACUMC_03') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_04) AS GACUMC_04') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_05) AS GACUMC_05') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_06) AS GACUMC_06') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_07) AS GACUMC_07') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_08) AS GACUMC_08') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_09) AS GACUMC_09') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_10) AS GACUMC_10') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_11) AS GACUMC_11') 
                               ->selectRaw('SUM(SIEVAD_DPA.ACUMC_12) AS GACUMC_12') 

                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_01)  AS GTAP_01')
                               ->selectRaw('SUM(SIEVAD_DPA.TOTP_02)  AS GTAP_02')
                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_01)  AS GTAC_01')
                               ->selectRaw('SUM(SIEVAD_DPA.TOTC_02)  AS GTAC_02')
                               ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                               ->Where(    'SIEVAD_DPA.DEPEN_ID2' ,'=',$request->depen_id)
                               ->Where(    'SIEVAD_DPA.TACCION_ID','=',$request->taccion_id)
                               ->groupBy(  'SIEVAD_DPA.PERIODO_ID','SIEVAD_DPA.DEPEN_ID2','SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC')
                               ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')
                               ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                               ->get();                                              
                               if($regprogdanual->count() <= 0)
                                  toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);                                                 
                            }   // depen_id        
                        }   // depen_id        
                    }   // depen_id  
                }   // depen_id

                /************ Bitacora inicia *************************************/ 
                setlocale(LC_TIME, "spanish");        
                $xip          = session()->get('ip');
                $xperiodo_id  = (int)date('Y');
                $xprograma_id = 1;
                $xmes_id      = (int)date('m');
                $xproceso_id  =         3;
                $xfuncion_id  =      3001;
                $xtrx_id      =         2;    //Reportes        
                $id           =         0;
                $regbitacora = regBitacoraModel::select('PERIODO_ID','PROGRAMA_ID','MES_ID','PROCESO_ID','FUNCION_ID', 
                               'TRX_ID', 'FOLIO', 'NO_VECES', 'FECHA_REG', 'IP', 'LOGIN', 'FECHA_M', 'IP_M', 'LOGIN_M')
                               ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                        'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO'      => $id])
                               ->get();
                if($regbitacora->count() <= 0){              // Alta
                    $nuevoregBitacora = new regBitacoraModel();              
                    $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                    $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                    $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                    $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                    $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                    $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                    $nuevoregBitacora->FOLIO      = $id;             // Folio    
                    $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                    $nuevoregBitacora->IP         = $ip;             // IP
                    $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                    $nuevoregBitacora->save();
                    if($nuevoregBitacora->save() == true)
                        toastr()->success('Trx de reporte PDF registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                    else
                        toastr()->error('Error de trx de reporte PDF. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                }else{                   
                    //*********** Obtine el no. de veces *****************************
                    $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id, 
                                                          'MES_ID'     => $xmes_id,    'PROCESO_ID'  => $xproceso_id, 
                                                          'FUNCION_ID' => $xfuncion_id,'TRX_ID'      => $xtrx_id,
                                                          'FOLIO'      => $id])
                                ->max('NO_VECES');
                    $xno_veces = $xno_veces+1;                        
                    //*********** Termina de obtener el no de veces *****************************         
                    $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id,
                                            'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id,
                                            'FOLIO'      => $id])
                                       ->update([
                                                 'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                                 'IP_M'     => $regbitacora->IP       = $ip,
                                                 'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                                 'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]);
                    toastr()->success('Trx de reporte PDF actualizada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                }   /************ Bitacora termina *************************************/         


                //************** Genera reporte pdf ******************/
                //Parámetro 0 significa que no se impondrá límite de tiempo 
                //(según el manual), el script puede ejecutarse hasta su finalización        
                set_time_limit(0);
                ini_set("memory_limit",-1);
                ini_set('max_execution_time', 0);            
                $pdf = PDF::loadView('sicinar.pdf.reporteMensualconPDF',compact('nombre','usuario','regprogdanual','regtotal','regmeses','periodo_id','mes_id','depen_id'));
                //$options = new Options();
                //$options->set('defaultFont', 'Courier');
                //$pdf->set_option('defaultFont', 'Courier');
                //$pdf->set('defaultFont', 'Courier');
                //$pdf->set_options('isPhpEnabled', true);
                //$pdf->setOptions(['isPhpEnabled' => true]);                
                //******** Horizontal ***********************//
                $pdf->setPaper('A4', 'landscape');      
                //******** vertical *************************//
                //$pdf->setPaper('A4','portrait');
                //*** Output the generated PDF to Browser ***//
                return $pdf->stream('Reporte_Mensual_Concentrado');

                break;                              
            }   // switch ($request->tipo) --- Termina tipo de reporte pantalla, excel o PDF   
            break;
        
        /********************************************************************************/
        /********************** Reportes detallados   ***********************************/
        /********************************************************************************/
        case 'D':  //****** Reportes detallados
            //**************************************************************************//
            // Generar reporte detallado                                            ****//
            //**************************************************************************//
            switch ($request->tipo) {
            case 'P':    //Por pantalla detallado
                if($request->depen_id == '0' && $request->taccion_id == '0' ){   
                    // Todas las unidades ejecutoras y todos los tipos de proyectoa
                    $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                                      'SIEVAD_DPA.UMED_ID')
                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=',
                                                                                      'SIEVAD_DPA.EPPROY_ID')      
                                                     ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                                      'SIEVAD_DPA.DEPEN_ID2')
                                                     ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                      'SIEVAD_DPA.FOLIO')
                                  ->select(
                                           'SIEVAD_DPA.PERIODO_ID',
                                           'SIEVAD_DPA.DEPEN_ID2',
                                           'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                           'SIEVAD_DPA.FOLIO',
                                           'SIEVAD_DPA.PARTIDA',
                                           'SIEVAD_DPA.ACTIVIDAD_DESC',
                                           'SIEVAD_DPA.UMED_ID',  
                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                           'SIEVAD_DPA.EPPROY_ID',
                                           'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',
                                           'SIEVAD_DPA.MESP_01',
                                           'SIEVAD_DPA.MESP_02',
                                           'SIEVAD_DPA.MESP_03',
                                           'SIEVAD_DPA.MESP_04',
                                           'SIEVAD_DPA.MESP_05',
                                           'SIEVAD_DPA.MESP_06',
                                           'SIEVAD_DPA.MESP_07',
                                           'SIEVAD_DPA.MESP_08',
                                           'SIEVAD_DPA.MESP_09',
                                           'SIEVAD_DPA.MESP_10',
                                           'SIEVAD_DPA.MESP_11',
                                           'SIEVAD_DPA.MESP_12',

                                           'SIEVAD_DPA.MESC_01',
                                           'SIEVAD_DPA.MESC_02',
                                           'SIEVAD_DPA.MESC_03',
                                           'SIEVAD_DPA.MESC_04',
                                           'SIEVAD_DPA.MESC_05',
                                           'SIEVAD_DPA.MESC_06',
                                           'SIEVAD_DPA.MESC_07',
                                           'SIEVAD_DPA.MESC_08',
                                           'SIEVAD_DPA.MESC_09',
                                           'SIEVAD_DPA.MESC_10',
                                           'SIEVAD_DPA.MESC_11',
                                           'SIEVAD_DPA.MESC_12',

                                           'SIEVAD_DPA.MES_P01',
                                           'SIEVAD_DPA.MES_P02',
                                           'SIEVAD_DPA.MES_P03',
                                           'SIEVAD_DPA.MES_P04',
                                           'SIEVAD_DPA.MES_P05',
                                           'SIEVAD_DPA.MES_P06',
                                           'SIEVAD_DPA.MES_P07',
                                           'SIEVAD_DPA.MES_P08',
                                           'SIEVAD_DPA.MES_P09',
                                           'SIEVAD_DPA.MES_P10',
                                           'SIEVAD_DPA.MES_P11',
                                           'SIEVAD_DPA.MES_P12',

                                           'SIEVAD_DPA.SEMAF_01',     
                                           'SIEVAD_DPA.SEMAF_02', 
                                           'SIEVAD_DPA.SEMAF_03', 
                                           'SIEVAD_DPA.SEMAF_04', 
                                           'SIEVAD_DPA.SEMAF_05', 
                                           'SIEVAD_DPA.SEMAF_06', 
                                           'SIEVAD_DPA.SEMAF_07', 
                                           'SIEVAD_DPA.SEMAF_08', 
                                           'SIEVAD_DPA.SEMAF_08', 
                                           'SIEVAD_DPA.SEMAF_10', 
                                           'SIEVAD_DPA.SEMAF_11', 
                                           'SIEVAD_DPA.SEMAF_12', 

                                           'SIEVAD_DPA.TRIMP_01',
                                           'SIEVAD_DPA.TRIMP_02',
                                           'SIEVAD_DPA.TRIMP_03',
                                           'SIEVAD_DPA.TRIMP_04',

                                           'SIEVAD_DPA.TRIMC_01',
                                           'SIEVAD_DPA.TRIMC_02',
                                           'SIEVAD_DPA.TRIMC_03',
                                           'SIEVAD_DPA.TRIMC_04',

                                           'SIEVAD_DPA.TSEMP_01',
                                           'SIEVAD_DPA.TSEMP_02',
                                           'SIEVAD_DPA.TSEMC_01',
                                           'SIEVAD_DPA.TSEMC_02',

                                           'SIEVAD_DPA.TOTP_01',
                                           'SIEVAD_DPA.TOTP_02',
                                           'SIEVAD_DPA.TOTC_01',
                                           'SIEVAD_DPA.TOTC_02', 
                                           'SIEVAD_DPA.TOT_P01', 

                                           'SIEVAD_DPA.SEMAFA_01',

                                           'SIEVAD_DPA.ACUMP_01',
                                           'SIEVAD_DPA.ACUMP_02',
                                           'SIEVAD_DPA.ACUMP_03',
                                           'SIEVAD_DPA.ACUMP_04',
                                           'SIEVAD_DPA.ACUMP_05',
                                           'SIEVAD_DPA.ACUMP_06',
                                           'SIEVAD_DPA.ACUMP_07',
                                           'SIEVAD_DPA.ACUMP_08',
                                           'SIEVAD_DPA.ACUMP_09',
                                           'SIEVAD_DPA.ACUMP_10',
                                           'SIEVAD_DPA.ACUMP_11',
                                           'SIEVAD_DPA.ACUMP_12',

                                           'SIEVAD_DPA.ACUMC_01',
                                           'SIEVAD_DPA.ACUMC_02',
                                           'SIEVAD_DPA.ACUMC_03',
                                           'SIEVAD_DPA.ACUMC_04',
                                           'SIEVAD_DPA.ACUMC_05',
                                           'SIEVAD_DPA.ACUMC_06',
                                           'SIEVAD_DPA.ACUMC_07',
                                           'SIEVAD_DPA.ACUMC_08',
                                           'SIEVAD_DPA.ACUMC_09',
                                           'SIEVAD_DPA.ACUMC_10',
                                           'SIEVAD_DPA.ACUMC_11',
                                           'SIEVAD_DPA.ACUMC_12',                                           

                                           'SIEVAD_DPA.ACUM_P01',
                                           'SIEVAD_DPA.ACUM_P02',
                                           'SIEVAD_DPA.ACUM_P03',
                                           'SIEVAD_DPA.ACUM_P04',
                                           'SIEVAD_DPA.ACUM_P05',
                                           'SIEVAD_DPA.ACUM_P06',
                                           'SIEVAD_DPA.ACUM_P07',
                                           'SIEVAD_DPA.ACUM_P08',
                                           'SIEVAD_DPA.ACUM_P09',
                                           'SIEVAD_DPA.ACUM_P10',
                                           'SIEVAD_DPA.ACUM_P11',
                                           'SIEVAD_DPA.ACUM_P12',

                                           'SIEVAD_DPA.ACUM_S01',
                                           'SIEVAD_DPA.ACUM_S02',
                                           'SIEVAD_DPA.ACUM_S03',
                                           'SIEVAD_DPA.ACUM_S04',
                                           'SIEVAD_DPA.ACUM_S05',
                                           'SIEVAD_DPA.ACUM_S06',
                                           'SIEVAD_DPA.ACUM_S07',
                                           'SIEVAD_DPA.ACUM_S08',
                                           'SIEVAD_DPA.ACUM_S09',
                                           'SIEVAD_DPA.ACUM_S10',
                                           'SIEVAD_DPA.ACUM_S11',
                                           'SIEVAD_DPA.ACUM_S12')
 
                               ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                               ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')                   
                               ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                               ->orderBy(  'SIEVAD_DPA.FOLIO'     ,'ASC')
                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')                               
                               ->get(); 
                    if($regprogdanual->count() <= 0)
                        toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);
                }else{
                    if($request->depen_id <> '0' && $request->taccion_id == '0' ){   
                        //*********** 2 ***********************//
                        $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                                      'SIEVAD_DPA.UMED_ID')
                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=',
                                                                                      'SIEVAD_DPA.EPPROY_ID')      
                                                     ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                                      'SIEVAD_DPA.DEPEN_ID2')
                                                     ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                      'SIEVAD_DPA.FOLIO')
                                  ->select(
                                           'SIEVAD_DPA.PERIODO_ID',
                                           'SIEVAD_DPA.DEPEN_ID2',
                                           'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                           'SIEVAD_DPA.FOLIO',
                                           'SIEVAD_DPA.PARTIDA',
                                           'SIEVAD_DPA.ACTIVIDAD_DESC',
                                           'SIEVAD_DPA.UMED_ID',  
                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                           'SIEVAD_DPA.EPPROY_ID',
                                           'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',
                                           'SIEVAD_DPA.MESP_01',
                                           'SIEVAD_DPA.MESP_02',
                                           'SIEVAD_DPA.MESP_03',
                                           'SIEVAD_DPA.MESP_04',
                                           'SIEVAD_DPA.MESP_05',
                                           'SIEVAD_DPA.MESP_06',
                                           'SIEVAD_DPA.MESP_07',
                                           'SIEVAD_DPA.MESP_08',
                                           'SIEVAD_DPA.MESP_09',
                                           'SIEVAD_DPA.MESP_10',
                                           'SIEVAD_DPA.MESP_11',
                                           'SIEVAD_DPA.MESP_12',

                                           'SIEVAD_DPA.MESC_01',
                                           'SIEVAD_DPA.MESC_02',
                                           'SIEVAD_DPA.MESC_03',
                                           'SIEVAD_DPA.MESC_04',
                                           'SIEVAD_DPA.MESC_05',
                                           'SIEVAD_DPA.MESC_06',
                                           'SIEVAD_DPA.MESC_07',
                                           'SIEVAD_DPA.MESC_08',
                                           'SIEVAD_DPA.MESC_09',
                                           'SIEVAD_DPA.MESC_10',
                                           'SIEVAD_DPA.MESC_11',
                                           'SIEVAD_DPA.MESC_12',

                                           'SIEVAD_DPA.MES_P01',
                                           'SIEVAD_DPA.MES_P02',
                                           'SIEVAD_DPA.MES_P03',
                                           'SIEVAD_DPA.MES_P04',
                                           'SIEVAD_DPA.MES_P05',
                                           'SIEVAD_DPA.MES_P06',
                                           'SIEVAD_DPA.MES_P07',
                                           'SIEVAD_DPA.MES_P08',
                                           'SIEVAD_DPA.MES_P09',
                                           'SIEVAD_DPA.MES_P10',
                                           'SIEVAD_DPA.MES_P11',
                                           'SIEVAD_DPA.MES_P12',

                                           'SIEVAD_DPA.SEMAF_01',     
                                           'SIEVAD_DPA.SEMAF_02', 
                                           'SIEVAD_DPA.SEMAF_03', 
                                           'SIEVAD_DPA.SEMAF_04', 
                                           'SIEVAD_DPA.SEMAF_05', 
                                           'SIEVAD_DPA.SEMAF_06', 
                                           'SIEVAD_DPA.SEMAF_07', 
                                           'SIEVAD_DPA.SEMAF_08', 
                                           'SIEVAD_DPA.SEMAF_08', 
                                           'SIEVAD_DPA.SEMAF_10', 
                                           'SIEVAD_DPA.SEMAF_11', 
                                           'SIEVAD_DPA.SEMAF_12', 

                                           'SIEVAD_DPA.TRIMP_01',
                                           'SIEVAD_DPA.TRIMP_02',
                                           'SIEVAD_DPA.TRIMP_03',
                                           'SIEVAD_DPA.TRIMP_04',

                                           'SIEVAD_DPA.TRIMC_01',
                                           'SIEVAD_DPA.TRIMC_02',
                                           'SIEVAD_DPA.TRIMC_03',
                                           'SIEVAD_DPA.TRIMC_04',

                                           'SIEVAD_DPA.TSEMP_01',
                                           'SIEVAD_DPA.TSEMP_02',
                                           'SIEVAD_DPA.TSEMC_01',
                                           'SIEVAD_DPA.TSEMC_02',

                                           'SIEVAD_DPA.TOTP_01',
                                           'SIEVAD_DPA.TOTP_02',
                                           'SIEVAD_DPA.TOTC_01',
                                           'SIEVAD_DPA.TOTC_02', 
                                           'SIEVAD_DPA.TOT_P01', 

                                           'SIEVAD_DPA.SEMAFA_01',

                                           'SIEVAD_DPA.ACUMP_01',
                                           'SIEVAD_DPA.ACUMP_02',
                                           'SIEVAD_DPA.ACUMP_03',
                                           'SIEVAD_DPA.ACUMP_04',
                                           'SIEVAD_DPA.ACUMP_05',
                                           'SIEVAD_DPA.ACUMP_06',
                                           'SIEVAD_DPA.ACUMP_07',
                                           'SIEVAD_DPA.ACUMP_08',
                                           'SIEVAD_DPA.ACUMP_09',
                                           'SIEVAD_DPA.ACUMP_10',
                                           'SIEVAD_DPA.ACUMP_11',
                                           'SIEVAD_DPA.ACUMP_12',

                                           'SIEVAD_DPA.ACUMC_01',
                                           'SIEVAD_DPA.ACUMC_02',
                                           'SIEVAD_DPA.ACUMC_03',
                                           'SIEVAD_DPA.ACUMC_04',
                                           'SIEVAD_DPA.ACUMC_05',
                                           'SIEVAD_DPA.ACUMC_06',
                                           'SIEVAD_DPA.ACUMC_07',
                                           'SIEVAD_DPA.ACUMC_08',
                                           'SIEVAD_DPA.ACUMC_09',
                                           'SIEVAD_DPA.ACUMC_10',
                                           'SIEVAD_DPA.ACUMC_11',
                                           'SIEVAD_DPA.ACUMC_12',                                           

                                           'SIEVAD_DPA.ACUM_P01',
                                           'SIEVAD_DPA.ACUM_P02',
                                           'SIEVAD_DPA.ACUM_P03',
                                           'SIEVAD_DPA.ACUM_P04',
                                           'SIEVAD_DPA.ACUM_P05',
                                           'SIEVAD_DPA.ACUM_P06',
                                           'SIEVAD_DPA.ACUM_P07',
                                           'SIEVAD_DPA.ACUM_P08',
                                           'SIEVAD_DPA.ACUM_P09',
                                           'SIEVAD_DPA.ACUM_P10',
                                           'SIEVAD_DPA.ACUM_P11',
                                           'SIEVAD_DPA.ACUM_P12',

                                           'SIEVAD_DPA.ACUM_S01',
                                           'SIEVAD_DPA.ACUM_S02',
                                           'SIEVAD_DPA.ACUM_S03',
                                           'SIEVAD_DPA.ACUM_S04',
                                           'SIEVAD_DPA.ACUM_S05',
                                           'SIEVAD_DPA.ACUM_S06',
                                           'SIEVAD_DPA.ACUM_S07',
                                           'SIEVAD_DPA.ACUM_S08',
                                           'SIEVAD_DPA.ACUM_S09',
                                           'SIEVAD_DPA.ACUM_S10',
                                           'SIEVAD_DPA.ACUM_S11',
                                           'SIEVAD_DPA.ACUM_S12')


                               ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                               ->Where(    'SIEVAD_DPA.DEPEN_ID2' ,'=',$request->depen_id)
                               ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')                   
                               ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                               ->orderBy(  'SIEVAD_DPA.FOLIO'     ,'ASC')
                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')
                               ->get();                       
                        if($regprogdanual->count() <= 0)
                            toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);
                    }else{
                        if($request->depen_id == '0' && $request->taccion_id <> '0' ){   
                            //*********** 2 ***********************//
                            $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                                          'SIEVAD_DPA.UMED_ID')
                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=',
                                                                                          'SIEVAD_DPA.EPPROY_ID')      
                                                         ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                                          'SIEVAD_DPA.DEPEN_ID2')
                                                         ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                          'SIEVAD_DPA.FOLIO')
                                      ->select(
                                               'SIEVAD_DPA.PERIODO_ID',
                                               'SIEVAD_DPA.DEPEN_ID2',
                                               'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                               'SIEVAD_DPA.FOLIO',
                                               'SIEVAD_DPA.PARTIDA',
                                               'SIEVAD_DPA.ACTIVIDAD_DESC',
                                               'SIEVAD_DPA.UMED_ID',  
                                               'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                               'SIEVAD_DPA.EPPROY_ID',
                                               'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',
                                               'SIEVAD_DPA.MESP_01',
                                               'SIEVAD_DPA.MESP_02',
                                               'SIEVAD_DPA.MESP_03',
                                               'SIEVAD_DPA.MESP_04',
                                               'SIEVAD_DPA.MESP_05',
                                               'SIEVAD_DPA.MESP_06',
                                               'SIEVAD_DPA.MESP_07',
                                               'SIEVAD_DPA.MESP_08',
                                               'SIEVAD_DPA.MESP_09',
                                               'SIEVAD_DPA.MESP_10',
                                               'SIEVAD_DPA.MESP_11',
                                               'SIEVAD_DPA.MESP_12',

                                               'SIEVAD_DPA.MESC_01',
                                               'SIEVAD_DPA.MESC_02',
                                               'SIEVAD_DPA.MESC_03',
                                               'SIEVAD_DPA.MESC_04',
                                               'SIEVAD_DPA.MESC_05',
                                               'SIEVAD_DPA.MESC_06',
                                               'SIEVAD_DPA.MESC_07',
                                               'SIEVAD_DPA.MESC_08',
                                               'SIEVAD_DPA.MESC_09',
                                               'SIEVAD_DPA.MESC_10',
                                               'SIEVAD_DPA.MESC_11',
                                               'SIEVAD_DPA.MESC_12',

                                               'SIEVAD_DPA.MES_P01',
                                               'SIEVAD_DPA.MES_P02',
                                               'SIEVAD_DPA.MES_P03',
                                               'SIEVAD_DPA.MES_P04',
                                               'SIEVAD_DPA.MES_P05',
                                               'SIEVAD_DPA.MES_P06',
                                               'SIEVAD_DPA.MES_P07',
                                               'SIEVAD_DPA.MES_P08',
                                               'SIEVAD_DPA.MES_P09',
                                               'SIEVAD_DPA.MES_P10',
                                               'SIEVAD_DPA.MES_P11',
                                               'SIEVAD_DPA.MES_P12',

                                               'SIEVAD_DPA.SEMAF_01',     
                                               'SIEVAD_DPA.SEMAF_02', 
                                               'SIEVAD_DPA.SEMAF_03', 
                                               'SIEVAD_DPA.SEMAF_04', 
                                               'SIEVAD_DPA.SEMAF_05', 
                                               'SIEVAD_DPA.SEMAF_06', 
                                               'SIEVAD_DPA.SEMAF_07', 
                                               'SIEVAD_DPA.SEMAF_08', 
                                               'SIEVAD_DPA.SEMAF_08', 
                                               'SIEVAD_DPA.SEMAF_10', 
                                               'SIEVAD_DPA.SEMAF_11', 
                                               'SIEVAD_DPA.SEMAF_12', 

                                               'SIEVAD_DPA.TRIMP_01',
                                               'SIEVAD_DPA.TRIMP_02',
                                               'SIEVAD_DPA.TRIMP_03',
                                               'SIEVAD_DPA.TRIMP_04',

                                               'SIEVAD_DPA.TRIMC_01',
                                               'SIEVAD_DPA.TRIMC_02',
                                               'SIEVAD_DPA.TRIMC_03',
                                               'SIEVAD_DPA.TRIMC_04',

                                               'SIEVAD_DPA.TSEMP_01',
                                               'SIEVAD_DPA.TSEMP_02',
                                               'SIEVAD_DPA.TSEMC_01',
                                               'SIEVAD_DPA.TSEMC_02',

                                               'SIEVAD_DPA.TOTP_01',
                                               'SIEVAD_DPA.TOTP_02',
                                               'SIEVAD_DPA.TOTC_01',
                                               'SIEVAD_DPA.TOTC_02', 
                                               'SIEVAD_DPA.TOT_P01', 

                                               'SIEVAD_DPA.SEMAFA_01',

                                               'SIEVAD_DPA.ACUMP_01',
                                               'SIEVAD_DPA.ACUMP_02',
                                               'SIEVAD_DPA.ACUMP_03',
                                               'SIEVAD_DPA.ACUMP_04',
                                               'SIEVAD_DPA.ACUMP_05',
                                               'SIEVAD_DPA.ACUMP_06',
                                               'SIEVAD_DPA.ACUMP_07',
                                               'SIEVAD_DPA.ACUMP_08',
                                               'SIEVAD_DPA.ACUMP_09',
                                               'SIEVAD_DPA.ACUMP_10',
                                               'SIEVAD_DPA.ACUMP_11',
                                               'SIEVAD_DPA.ACUMP_12',

                                               'SIEVAD_DPA.ACUMC_01',
                                               'SIEVAD_DPA.ACUMC_02',
                                               'SIEVAD_DPA.ACUMC_03',
                                               'SIEVAD_DPA.ACUMC_04',
                                               'SIEVAD_DPA.ACUMC_05',
                                               'SIEVAD_DPA.ACUMC_06',
                                               'SIEVAD_DPA.ACUMC_07',
                                               'SIEVAD_DPA.ACUMC_08',
                                               'SIEVAD_DPA.ACUMC_09',
                                               'SIEVAD_DPA.ACUMC_10',
                                               'SIEVAD_DPA.ACUMC_11',
                                               'SIEVAD_DPA.ACUMC_12',                                           

                                               'SIEVAD_DPA.ACUM_P01',
                                               'SIEVAD_DPA.ACUM_P02',
                                               'SIEVAD_DPA.ACUM_P03',
                                               'SIEVAD_DPA.ACUM_P04',
                                               'SIEVAD_DPA.ACUM_P05',
                                               'SIEVAD_DPA.ACUM_P06',
                                               'SIEVAD_DPA.ACUM_P07',
                                               'SIEVAD_DPA.ACUM_P08',
                                               'SIEVAD_DPA.ACUM_P09',
                                               'SIEVAD_DPA.ACUM_P10',
                                               'SIEVAD_DPA.ACUM_P11',
                                               'SIEVAD_DPA.ACUM_P12',

                                               'SIEVAD_DPA.ACUM_S01',
                                               'SIEVAD_DPA.ACUM_S02',
                                               'SIEVAD_DPA.ACUM_S03',
                                               'SIEVAD_DPA.ACUM_S04',
                                               'SIEVAD_DPA.ACUM_S05',
                                               'SIEVAD_DPA.ACUM_S06',
                                               'SIEVAD_DPA.ACUM_S07',
                                               'SIEVAD_DPA.ACUM_S08',
                                               'SIEVAD_DPA.ACUM_S09',
                                               'SIEVAD_DPA.ACUM_S10',
                                               'SIEVAD_DPA.ACUM_S11',
                                               'SIEVAD_DPA.ACUM_S12')


                                   ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                   ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')                   
                                   ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                                   ->orderBy(  'SIEVAD_DPA.FOLIO'     ,'ASC')
                                   ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')
                                   ->get();                       
                                if($regprogdanual->count() <= 0)
                                    toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);                          
                            }else{
                                if($request->depen_id <> '0' && $request->taccion_id <> '0' ){   
                                    //*********** 2 ***********************//
                                    $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA','SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                                                  'SIEVAD_DPA.UMED_ID')
                                                                 ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=',
                                                                                                  'SIEVAD_DPA.EPPROY_ID')      
                                                                 ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                                                  'SIEVAD_DPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                                  'SIEVAD_DPA.FOLIO')
                                              ->select(
                                                       'SIEVAD_DPA.PERIODO_ID',
                                                       'SIEVAD_DPA.DEPEN_ID2',
                                                       'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_DPA.FOLIO',
                                                       'SIEVAD_DPA.PARTIDA',
                                                       'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_DPA.UMED_ID',  
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.EPPROY_ID',
                                                       'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',
                                                       'SIEVAD_DPA.MESP_01',
                                                       'SIEVAD_DPA.MESP_02',
                                                       'SIEVAD_DPA.MESP_03',
                                                       'SIEVAD_DPA.MESP_04',
                                                       'SIEVAD_DPA.MESP_05',
                                                       'SIEVAD_DPA.MESP_06',
                                                       'SIEVAD_DPA.MESP_07',
                                                       'SIEVAD_DPA.MESP_08',
                                                       'SIEVAD_DPA.MESP_09',
                                                       'SIEVAD_DPA.MESP_10',
                                                       'SIEVAD_DPA.MESP_11',
                                                       'SIEVAD_DPA.MESP_12',

                                                       'SIEVAD_DPA.MESC_01',
                                                       'SIEVAD_DPA.MESC_02',
                                                       'SIEVAD_DPA.MESC_03',
                                                       'SIEVAD_DPA.MESC_04',
                                                       'SIEVAD_DPA.MESC_05',
                                                       'SIEVAD_DPA.MESC_06',
                                                       'SIEVAD_DPA.MESC_07',
                                                       'SIEVAD_DPA.MESC_08',
                                                       'SIEVAD_DPA.MESC_09',
                                                       'SIEVAD_DPA.MESC_10',
                                                       'SIEVAD_DPA.MESC_11',
                                                       'SIEVAD_DPA.MESC_12',

                                                       'SIEVAD_DPA.MES_P01',
                                                       'SIEVAD_DPA.MES_P02',
                                                       'SIEVAD_DPA.MES_P03',
                                                       'SIEVAD_DPA.MES_P04',
                                                       'SIEVAD_DPA.MES_P05',
                                                       'SIEVAD_DPA.MES_P06',
                                                       'SIEVAD_DPA.MES_P07',
                                                       'SIEVAD_DPA.MES_P08',
                                                       'SIEVAD_DPA.MES_P09',
                                                       'SIEVAD_DPA.MES_P10',
                                                       'SIEVAD_DPA.MES_P11',
                                                       'SIEVAD_DPA.MES_P12',

                                                       'SIEVAD_DPA.SEMAF_01',     
                                                       'SIEVAD_DPA.SEMAF_02', 
                                                       'SIEVAD_DPA.SEMAF_03', 
                                                       'SIEVAD_DPA.SEMAF_04', 
                                                       'SIEVAD_DPA.SEMAF_05', 
                                                       'SIEVAD_DPA.SEMAF_06', 
                                                       'SIEVAD_DPA.SEMAF_07', 
                                                       'SIEVAD_DPA.SEMAF_08', 
                                                       'SIEVAD_DPA.SEMAF_08', 
                                                       'SIEVAD_DPA.SEMAF_10', 
                                                       'SIEVAD_DPA.SEMAF_11', 
                                                       'SIEVAD_DPA.SEMAF_12', 

                                                       'SIEVAD_DPA.TRIMP_01',
                                                       'SIEVAD_DPA.TRIMP_02',
                                                       'SIEVAD_DPA.TRIMP_03',
                                                       'SIEVAD_DPA.TRIMP_04',

                                                       'SIEVAD_DPA.TRIMC_01',
                                                       'SIEVAD_DPA.TRIMC_02',
                                                       'SIEVAD_DPA.TRIMC_03',
                                                       'SIEVAD_DPA.TRIMC_04',

                                                       'SIEVAD_DPA.TSEMP_01',
                                                       'SIEVAD_DPA.TSEMP_02',
                                                       'SIEVAD_DPA.TSEMC_01',
                                                       'SIEVAD_DPA.TSEMC_02',

                                                       'SIEVAD_DPA.TOTP_01',
                                                       'SIEVAD_DPA.TOTP_02',
                                                       'SIEVAD_DPA.TOTC_01',
                                                       'SIEVAD_DPA.TOTC_02', 
                                                       'SIEVAD_DPA.TOT_P01', 

                                                       'SIEVAD_DPA.SEMAFA_01',

                                                       'SIEVAD_DPA.ACUMP_01',
                                                       'SIEVAD_DPA.ACUMP_02',
                                                       'SIEVAD_DPA.ACUMP_03',
                                                       'SIEVAD_DPA.ACUMP_04',
                                                       'SIEVAD_DPA.ACUMP_05',
                                                       'SIEVAD_DPA.ACUMP_06',
                                                       'SIEVAD_DPA.ACUMP_07',
                                                       'SIEVAD_DPA.ACUMP_08',
                                                       'SIEVAD_DPA.ACUMP_09',
                                                       'SIEVAD_DPA.ACUMP_10',
                                                       'SIEVAD_DPA.ACUMP_11',
                                                       'SIEVAD_DPA.ACUMP_12',

                                                       'SIEVAD_DPA.ACUMC_01',
                                                       'SIEVAD_DPA.ACUMC_02',
                                                       'SIEVAD_DPA.ACUMC_03',
                                                       'SIEVAD_DPA.ACUMC_04',
                                                       'SIEVAD_DPA.ACUMC_05',
                                                       'SIEVAD_DPA.ACUMC_06',
                                                       'SIEVAD_DPA.ACUMC_07',
                                                       'SIEVAD_DPA.ACUMC_08',
                                                       'SIEVAD_DPA.ACUMC_09',
                                                       'SIEVAD_DPA.ACUMC_10',
                                                       'SIEVAD_DPA.ACUMC_11',
                                                       'SIEVAD_DPA.ACUMC_12',                                           

                                                       'SIEVAD_DPA.ACUM_P01',
                                                       'SIEVAD_DPA.ACUM_P02',
                                                       'SIEVAD_DPA.ACUM_P03',
                                                       'SIEVAD_DPA.ACUM_P04',
                                                       'SIEVAD_DPA.ACUM_P05',
                                                       'SIEVAD_DPA.ACUM_P06',
                                                       'SIEVAD_DPA.ACUM_P07',
                                                       'SIEVAD_DPA.ACUM_P08',
                                                       'SIEVAD_DPA.ACUM_P09',
                                                       'SIEVAD_DPA.ACUM_P10',
                                                       'SIEVAD_DPA.ACUM_P11',
                                                       'SIEVAD_DPA.ACUM_P12',

                                                       'SIEVAD_DPA.ACUM_S01',
                                                       'SIEVAD_DPA.ACUM_S02',
                                                       'SIEVAD_DPA.ACUM_S03',
                                                       'SIEVAD_DPA.ACUM_S04',
                                                       'SIEVAD_DPA.ACUM_S05',
                                                       'SIEVAD_DPA.ACUM_S06',
                                                       'SIEVAD_DPA.ACUM_S07',
                                                       'SIEVAD_DPA.ACUM_S08',
                                                       'SIEVAD_DPA.ACUM_S09',
                                                       'SIEVAD_DPA.ACUM_S10',
                                                       'SIEVAD_DPA.ACUM_S11',
                                                       'SIEVAD_DPA.ACUM_S12')


                                           ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                                           ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                           ->Where(    'SIEVAD_DPA.DEPEN_ID2' ,'=',$request->depen_id)
                                           ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')
                                           ->get();                       
                                        if($regprogdanual->count() <= 0)
                                            toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);                                                        
                            }   // depen_id                                   
                        }   // depen_id                                   
                    }   // depen_id                          
                }   // depen_id
                /************ Bitacora inicia *************************************/ 
                setlocale(LC_TIME, "spanish");        
                $xip          = session()->get('ip');
                $xperiodo_id  = (int)date('Y');
                $xprograma_id = 1;
                $xmes_id      = (int)date('m');
                $xproceso_id  =         3;
                $xfuncion_id  =      3001;
                $xtrx_id      =         2;    //Reportes        
                $id           =         0;
                $regbitacora = regBitacoraModel::select('PERIODO_ID','PROGRAMA_ID','MES_ID','PROCESO_ID','FUNCION_ID', 
                                                        'TRX_ID','FOLIO','NO_VECES','FECHA_REG','IP','LOGIN',
                                                        'FECHA_M','IP_M', 'LOGIN_M')
                               ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                        'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO'      => $id])
                               ->get();
                if($regbitacora->count() <= 0){              // Alta
                    $nuevoregBitacora = new regBitacoraModel();              
                    $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                    $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                    $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                    $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                    $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                    $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                    $nuevoregBitacora->FOLIO      = $id;             // Folio    
                    $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                    $nuevoregBitacora->IP         = $ip;             // IP
                    $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                    $nuevoregBitacora->save();
                    if($nuevoregBitacora->save() == true)
                        toastr()->success('Trx de reporte registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                    else
                        toastr()->error('Error de trx de reporte. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                }else{                   
                    //*********** Obtine el no. de veces *****************************
                    $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID'=> $xprograma_id,
                                                          'MES_ID'     => $xmes_id,    'PROCESO_ID' => $xproceso_id, 
                                                          'FUNCION_ID' => $xfuncion_id,'TRX_ID'     => $xtrx_id,
                                                          'FOLIO'      => $id])
                                 ->max('NO_VECES');
                    $xno_veces = $xno_veces+1;                        
                    //*********** Termina de obtener el no de veces *****************************         
                    $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID'=> $xprograma_id,'MES_ID' => $xmes_id,
                                            'PROCESO_ID' => $xproceso_id,'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id,
                                            'FOLIO'      => $id])
                                       ->update([
                                                 'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                                 'IP_M'     => $regbitacora->IP       = $ip,
                                                 'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                                 'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]);
                    toastr()->success('Trx de reporte actualizada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                }   /************ Bitacora termina *************************************/           
                
                //************** Genera reporte detallado en pantalla ******************/
                // Selecciona el trimestre
                return view('sicinar.reportes.verReportemensualdet',compact('nombre','usuario','regprogdanual','regtotal','regmeses','periodo_id','mes_id','depen_id'));
                break;

            case 'E':    //Formato excel detallado

                /************ Bitacora inicia *************************************/ 
                setlocale(LC_TIME, "spanish");        
                $xip          = session()->get('ip');
                $xperiodo_id  = (int)date('Y');
                $xprograma_id = 1;
                $xmes_id      = (int)date('m');
                $xproceso_id  =         3;
                $xfuncion_id  =      3001;
                $xtrx_id      =         2;    //Reportes        
                $id           =         0;
                $regbitacora = regBitacoraModel::select('PERIODO_ID', 'PROGRAMA_ID', 'MES_ID', 'PROCESO_ID', 'FUNCION_ID', 'TRX_ID', 'FOLIO', 'NO_VECES', 'FECHA_REG', 'IP', 'LOGIN', 'FECHA_M', 'IP_M', 'LOGIN_M')
                               ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                        'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO'      => $id])
                               ->get();
                if($regbitacora->count() <= 0){              // Alta
                        $nuevoregBitacora = new regBitacoraModel();              
                        $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                        $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                        $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                        $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                        $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                        $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                        $nuevoregBitacora->FOLIO      = $id;             // Folio    
                        $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                        $nuevoregBitacora->IP         = $ip;             // IP
                        $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                        $nuevoregBitacora->save();
                        if($nuevoregBitacora->save() == true)
                            toastr()->success('Trx de reporte Excel registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                        else
                            toastr()->error('Error de trx de reporte Excel. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                }else{                   
                    //*********** Obtine el no. de veces *****************************
                    $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id, 'PROGRAMA_ID' => $xprograma_id, 
                                                      'MES_ID' => $xmes_id, 'PROCESO_ID' => $xproceso_id, 
                                                      'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id,'FOLIO' => $id])
                                 ->max('NO_VECES');
                    $xno_veces = $xno_veces+1;                        
                    //*********** Termina de obtener el no de veces *****************************         
                    $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id,
                                            'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id,
                                            'FOLIO'      => $id])
                                   ->update([
                                             'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                             'IP_M'     => $regbitacora->IP       = $ip,
                                             'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                             'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]);
                    toastr()->success('Trx de reporte Excel actualizada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                }   /************ Bitacora termina *************************************/         
                
                //*********** Genera reporte a formato excel con parámetros ***********/
                return Excel::download(new ExcelExportMensualdet($request->periodo_id,$request->mes_id,$request->depen_id,$request->taccion_id),'Reporte_Mensual_Detallado'.date('d-m-Y').'.xlsx');
                break;

            case 'D':    //Formato PDF detallado
                //return back()->withErrors([' Reporte diponible sólo en pantalla y/o excel.']);
                if($request->depen_id == '0' && $request->taccion_id == '0' ){   
                    // Todas las unidades ejecutoras y todos los tipos de proyectoa
                    return back()->withErrors([' Reporte diponible sólo en pantalla y/o excel.']);
                }else{
                    if($request->depen_id <> '0' && $request->taccion_id == '0' ){   
                        //*********** 2 ***********************//
                        $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                                      'SIEVAD_DPA.UMED_ID')
                                                     ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=',
                                                                                      'SIEVAD_DPA.EPPROY_ID')      
                                                     ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                                      'SIEVAD_DPA.DEPEN_ID2')
                                                     ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                      'SIEVAD_DPA.FOLIO')
                                  ->select(
                                           'SIEVAD_DPA.PERIODO_ID',
                                           'SIEVAD_DPA.DEPEN_ID2',
                                           'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                           'SIEVAD_DPA.FOLIO',
                                           'SIEVAD_DPA.PARTIDA',
                                           'SIEVAD_DPA.ACTIVIDAD_DESC',
                                           'SIEVAD_DPA.UMED_ID',  
                                           'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                           'SIEVAD_DPA.EPPROY_ID',
                                           'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',
                                           'SIEVAD_DPA.MESP_01',
                                           'SIEVAD_DPA.MESP_02',
                                           'SIEVAD_DPA.MESP_03',
                                           'SIEVAD_DPA.MESP_04',
                                           'SIEVAD_DPA.MESP_05',
                                           'SIEVAD_DPA.MESP_06',
                                           'SIEVAD_DPA.MESP_07',
                                           'SIEVAD_DPA.MESP_08',
                                           'SIEVAD_DPA.MESP_09',
                                           'SIEVAD_DPA.MESP_10',
                                           'SIEVAD_DPA.MESP_11',
                                           'SIEVAD_DPA.MESP_12',

                                           'SIEVAD_DPA.MESC_01',
                                           'SIEVAD_DPA.MESC_02',
                                           'SIEVAD_DPA.MESC_03',
                                           'SIEVAD_DPA.MESC_04',
                                           'SIEVAD_DPA.MESC_05',
                                           'SIEVAD_DPA.MESC_06',
                                           'SIEVAD_DPA.MESC_07',
                                           'SIEVAD_DPA.MESC_08',
                                           'SIEVAD_DPA.MESC_09',
                                           'SIEVAD_DPA.MESC_10',
                                           'SIEVAD_DPA.MESC_11',
                                           'SIEVAD_DPA.MESC_12',

                                           'SIEVAD_DPA.MES_P01',
                                           'SIEVAD_DPA.MES_P02',
                                           'SIEVAD_DPA.MES_P03',
                                           'SIEVAD_DPA.MES_P04',
                                           'SIEVAD_DPA.MES_P05',
                                           'SIEVAD_DPA.MES_P06',
                                           'SIEVAD_DPA.MES_P07',
                                           'SIEVAD_DPA.MES_P08',
                                           'SIEVAD_DPA.MES_P09',
                                           'SIEVAD_DPA.MES_P10',
                                           'SIEVAD_DPA.MES_P11',
                                           'SIEVAD_DPA.MES_P12',

                                           'SIEVAD_DPA.SEMAF_01',     
                                           'SIEVAD_DPA.SEMAF_02', 
                                           'SIEVAD_DPA.SEMAF_03', 
                                           'SIEVAD_DPA.SEMAF_04', 
                                           'SIEVAD_DPA.SEMAF_05', 
                                           'SIEVAD_DPA.SEMAF_06', 
                                           'SIEVAD_DPA.SEMAF_07', 
                                           'SIEVAD_DPA.SEMAF_08', 
                                           'SIEVAD_DPA.SEMAF_08', 
                                           'SIEVAD_DPA.SEMAF_10', 
                                           'SIEVAD_DPA.SEMAF_11', 
                                           'SIEVAD_DPA.SEMAF_12', 

                                           'SIEVAD_DPA.TRIMP_01',
                                           'SIEVAD_DPA.TRIMP_02',
                                           'SIEVAD_DPA.TRIMP_03',
                                           'SIEVAD_DPA.TRIMP_04',

                                           'SIEVAD_DPA.TRIMC_01',
                                           'SIEVAD_DPA.TRIMC_02',
                                           'SIEVAD_DPA.TRIMC_03',
                                           'SIEVAD_DPA.TRIMC_04',

                                           'SIEVAD_DPA.TSEMP_01',
                                           'SIEVAD_DPA.TSEMP_02',
                                           'SIEVAD_DPA.TSEMC_01',
                                           'SIEVAD_DPA.TSEMC_02',

                                           'SIEVAD_DPA.TOTP_01',
                                           'SIEVAD_DPA.TOTP_02',
                                           'SIEVAD_DPA.TOTC_01',
                                           'SIEVAD_DPA.TOTC_02', 
                                           'SIEVAD_DPA.TOT_P01', 

                                           'SIEVAD_DPA.SEMAFA_01',

                                           'SIEVAD_DPA.ACUMP_01',
                                           'SIEVAD_DPA.ACUMP_02',
                                           'SIEVAD_DPA.ACUMP_03',
                                           'SIEVAD_DPA.ACUMP_04',
                                           'SIEVAD_DPA.ACUMP_05',
                                           'SIEVAD_DPA.ACUMP_06',
                                           'SIEVAD_DPA.ACUMP_07',
                                           'SIEVAD_DPA.ACUMP_08',
                                           'SIEVAD_DPA.ACUMP_09',
                                           'SIEVAD_DPA.ACUMP_10',
                                           'SIEVAD_DPA.ACUMP_11',
                                           'SIEVAD_DPA.ACUMP_12',

                                           'SIEVAD_DPA.ACUMC_01',
                                           'SIEVAD_DPA.ACUMC_02',
                                           'SIEVAD_DPA.ACUMC_03',
                                           'SIEVAD_DPA.ACUMC_04',
                                           'SIEVAD_DPA.ACUMC_05',
                                           'SIEVAD_DPA.ACUMC_06',
                                           'SIEVAD_DPA.ACUMC_07',
                                           'SIEVAD_DPA.ACUMC_08',
                                           'SIEVAD_DPA.ACUMC_09',
                                           'SIEVAD_DPA.ACUMC_10',
                                           'SIEVAD_DPA.ACUMC_11',
                                           'SIEVAD_DPA.ACUMC_12',                                           

                                           'SIEVAD_DPA.ACUM_P01',
                                           'SIEVAD_DPA.ACUM_P02',
                                           'SIEVAD_DPA.ACUM_P03',
                                           'SIEVAD_DPA.ACUM_P04',
                                           'SIEVAD_DPA.ACUM_P05',
                                           'SIEVAD_DPA.ACUM_P06',
                                           'SIEVAD_DPA.ACUM_P07',
                                           'SIEVAD_DPA.ACUM_P08',
                                           'SIEVAD_DPA.ACUM_P09',
                                           'SIEVAD_DPA.ACUM_P10',
                                           'SIEVAD_DPA.ACUM_P11',
                                           'SIEVAD_DPA.ACUM_P12',

                                           'SIEVAD_DPA.ACUM_S01',
                                           'SIEVAD_DPA.ACUM_S02',
                                           'SIEVAD_DPA.ACUM_S03',
                                           'SIEVAD_DPA.ACUM_S04',
                                           'SIEVAD_DPA.ACUM_S05',
                                           'SIEVAD_DPA.ACUM_S06',
                                           'SIEVAD_DPA.ACUM_S07',
                                           'SIEVAD_DPA.ACUM_S08',
                                           'SIEVAD_DPA.ACUM_S09',
                                           'SIEVAD_DPA.ACUM_S10',
                                           'SIEVAD_DPA.ACUM_S11',
                                           'SIEVAD_DPA.ACUM_S12')


                               ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                               ->Where(    'SIEVAD_DPA.DEPEN_ID2' ,'=',$request->depen_id)
                               ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')                   
                               ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                               ->orderBy(  'SIEVAD_DPA.FOLIO'     ,'ASC')
                               ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')
                               ->get();                       
                        if($regprogdanual->count() <= 0)
                            toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);
                    }else{
                        if($request->depen_id == '0' && $request->taccion_id <> '0' ){   
                            //*********** 2 ***********************//
                            $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA',     'SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                                          'SIEVAD_DPA.UMED_ID')
                                                         ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=',
                                                                                          'SIEVAD_DPA.EPPROY_ID')      
                                                         ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                                          'SIEVAD_DPA.DEPEN_ID2')
                                                         ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                          'SIEVAD_DPA.FOLIO')
                                      ->select(
                                               'SIEVAD_DPA.PERIODO_ID',
                                               'SIEVAD_DPA.DEPEN_ID2',
                                               'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                               'SIEVAD_DPA.FOLIO',
                                               'SIEVAD_DPA.PARTIDA',
                                               'SIEVAD_DPA.ACTIVIDAD_DESC',
                                               'SIEVAD_DPA.UMED_ID',  
                                               'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                               'SIEVAD_DPA.EPPROY_ID',
                                               'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',
                                               'SIEVAD_DPA.MESP_01',
                                               'SIEVAD_DPA.MESP_02',
                                               'SIEVAD_DPA.MESP_03',
                                               'SIEVAD_DPA.MESP_04',
                                               'SIEVAD_DPA.MESP_05',
                                               'SIEVAD_DPA.MESP_06',
                                               'SIEVAD_DPA.MESP_07',
                                               'SIEVAD_DPA.MESP_08',
                                               'SIEVAD_DPA.MESP_09',
                                               'SIEVAD_DPA.MESP_10',
                                               'SIEVAD_DPA.MESP_11',
                                               'SIEVAD_DPA.MESP_12',

                                               'SIEVAD_DPA.MESC_01',
                                               'SIEVAD_DPA.MESC_02',
                                               'SIEVAD_DPA.MESC_03',
                                               'SIEVAD_DPA.MESC_04',
                                               'SIEVAD_DPA.MESC_05',
                                               'SIEVAD_DPA.MESC_06',
                                               'SIEVAD_DPA.MESC_07',
                                               'SIEVAD_DPA.MESC_08',
                                               'SIEVAD_DPA.MESC_09',
                                               'SIEVAD_DPA.MESC_10',
                                               'SIEVAD_DPA.MESC_11',
                                               'SIEVAD_DPA.MESC_12',

                                               'SIEVAD_DPA.MES_P01',
                                               'SIEVAD_DPA.MES_P02',
                                               'SIEVAD_DPA.MES_P03',
                                               'SIEVAD_DPA.MES_P04',
                                               'SIEVAD_DPA.MES_P05',
                                               'SIEVAD_DPA.MES_P06',
                                               'SIEVAD_DPA.MES_P07',
                                               'SIEVAD_DPA.MES_P08',
                                               'SIEVAD_DPA.MES_P09',
                                               'SIEVAD_DPA.MES_P10',
                                               'SIEVAD_DPA.MES_P11',
                                               'SIEVAD_DPA.MES_P12',

                                               'SIEVAD_DPA.SEMAF_01',     
                                               'SIEVAD_DPA.SEMAF_02', 
                                               'SIEVAD_DPA.SEMAF_03', 
                                               'SIEVAD_DPA.SEMAF_04', 
                                               'SIEVAD_DPA.SEMAF_05', 
                                               'SIEVAD_DPA.SEMAF_06', 
                                               'SIEVAD_DPA.SEMAF_07', 
                                               'SIEVAD_DPA.SEMAF_08', 
                                               'SIEVAD_DPA.SEMAF_08', 
                                               'SIEVAD_DPA.SEMAF_10', 
                                               'SIEVAD_DPA.SEMAF_11', 
                                               'SIEVAD_DPA.SEMAF_12', 

                                               'SIEVAD_DPA.TRIMP_01',
                                               'SIEVAD_DPA.TRIMP_02',
                                               'SIEVAD_DPA.TRIMP_03',
                                               'SIEVAD_DPA.TRIMP_04',

                                               'SIEVAD_DPA.TRIMC_01',
                                               'SIEVAD_DPA.TRIMC_02',
                                               'SIEVAD_DPA.TRIMC_03',
                                               'SIEVAD_DPA.TRIMC_04',

                                               'SIEVAD_DPA.TSEMP_01',
                                               'SIEVAD_DPA.TSEMP_02',
                                               'SIEVAD_DPA.TSEMC_01',
                                               'SIEVAD_DPA.TSEMC_02',

                                               'SIEVAD_DPA.TOTP_01',
                                               'SIEVAD_DPA.TOTP_02',
                                               'SIEVAD_DPA.TOTC_01',
                                               'SIEVAD_DPA.TOTC_02', 
                                               'SIEVAD_DPA.TOT_P01', 

                                               'SIEVAD_DPA.SEMAFA_01',

                                               'SIEVAD_DPA.ACUMP_01',
                                               'SIEVAD_DPA.ACUMP_02',
                                               'SIEVAD_DPA.ACUMP_03',
                                               'SIEVAD_DPA.ACUMP_04',
                                               'SIEVAD_DPA.ACUMP_05',
                                               'SIEVAD_DPA.ACUMP_06',
                                               'SIEVAD_DPA.ACUMP_07',
                                               'SIEVAD_DPA.ACUMP_08',
                                               'SIEVAD_DPA.ACUMP_09',
                                               'SIEVAD_DPA.ACUMP_10',
                                               'SIEVAD_DPA.ACUMP_11',
                                               'SIEVAD_DPA.ACUMP_12',

                                               'SIEVAD_DPA.ACUMC_01',
                                               'SIEVAD_DPA.ACUMC_02',
                                               'SIEVAD_DPA.ACUMC_03',
                                               'SIEVAD_DPA.ACUMC_04',
                                               'SIEVAD_DPA.ACUMC_05',
                                               'SIEVAD_DPA.ACUMC_06',
                                               'SIEVAD_DPA.ACUMC_07',
                                               'SIEVAD_DPA.ACUMC_08',
                                               'SIEVAD_DPA.ACUMC_09',
                                               'SIEVAD_DPA.ACUMC_10',
                                               'SIEVAD_DPA.ACUMC_11',
                                               'SIEVAD_DPA.ACUMC_12',                                           

                                               'SIEVAD_DPA.ACUM_P01',
                                               'SIEVAD_DPA.ACUM_P02',
                                               'SIEVAD_DPA.ACUM_P03',
                                               'SIEVAD_DPA.ACUM_P04',
                                               'SIEVAD_DPA.ACUM_P05',
                                               'SIEVAD_DPA.ACUM_P06',
                                               'SIEVAD_DPA.ACUM_P07',
                                               'SIEVAD_DPA.ACUM_P08',
                                               'SIEVAD_DPA.ACUM_P09',
                                               'SIEVAD_DPA.ACUM_P10',
                                               'SIEVAD_DPA.ACUM_P11',
                                               'SIEVAD_DPA.ACUM_P12',

                                               'SIEVAD_DPA.ACUM_S01',
                                               'SIEVAD_DPA.ACUM_S02',
                                               'SIEVAD_DPA.ACUM_S03',
                                               'SIEVAD_DPA.ACUM_S04',
                                               'SIEVAD_DPA.ACUM_S05',
                                               'SIEVAD_DPA.ACUM_S06',
                                               'SIEVAD_DPA.ACUM_S07',
                                               'SIEVAD_DPA.ACUM_S08',
                                               'SIEVAD_DPA.ACUM_S09',
                                               'SIEVAD_DPA.ACUM_S10',
                                               'SIEVAD_DPA.ACUM_S11',
                                               'SIEVAD_DPA.ACUM_S12')


                                   ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                                   ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                   ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')                   
                                   ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                                   ->orderBy(  'SIEVAD_DPA.FOLIO'     ,'ASC')
                                   ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')
                                   ->get();                       
                                if($regprogdanual->count() <= 0)
                                    toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);                          
                            }else{
                                if($request->depen_id <> '0' && $request->taccion_id <> '0' ){   
                                    //*********** 2 ***********************//
                                    $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA','SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                                                  'SIEVAD_DPA.UMED_ID')
                                                                 ->join('SIEVAD_CAT_EP_PROYECTO', 'SIEVAD_CAT_EP_PROYECTO.EPPROY_ID','=',
                                                                                                  'SIEVAD_DPA.EPPROY_ID')      
                                                                 ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                                                  'SIEVAD_DPA.DEPEN_ID2')
                                                                 ->join('SIEVAD_EPA',             'SIEVAD_EPA.FOLIO','=',
                                                                                                  'SIEVAD_DPA.FOLIO')
                                              ->select(
                                                       'SIEVAD_DPA.PERIODO_ID',
                                                       'SIEVAD_DPA.DEPEN_ID2',
                                                       'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC',
                                                       'SIEVAD_DPA.FOLIO',
                                                       'SIEVAD_DPA.PARTIDA',
                                                       'SIEVAD_DPA.ACTIVIDAD_DESC',
                                                       'SIEVAD_DPA.UMED_ID',  
                                                       'SIEVAD_CAT_UMEDIDA.UMED_DESC',
                                                       'SIEVAD_DPA.EPPROY_ID',
                                                       'SIEVAD_CAT_EP_PROYECTO.EPPROY_DESC',
                                                       'SIEVAD_DPA.MESP_01',
                                                       'SIEVAD_DPA.MESP_02',
                                                       'SIEVAD_DPA.MESP_03',
                                                       'SIEVAD_DPA.MESP_04',
                                                       'SIEVAD_DPA.MESP_05',
                                                       'SIEVAD_DPA.MESP_06',
                                                       'SIEVAD_DPA.MESP_07',
                                                       'SIEVAD_DPA.MESP_08',
                                                       'SIEVAD_DPA.MESP_09',
                                                       'SIEVAD_DPA.MESP_10',
                                                       'SIEVAD_DPA.MESP_11',
                                                       'SIEVAD_DPA.MESP_12',

                                                       'SIEVAD_DPA.MESC_01',
                                                       'SIEVAD_DPA.MESC_02',
                                                       'SIEVAD_DPA.MESC_03',
                                                       'SIEVAD_DPA.MESC_04',
                                                       'SIEVAD_DPA.MESC_05',
                                                       'SIEVAD_DPA.MESC_06',
                                                       'SIEVAD_DPA.MESC_07',
                                                       'SIEVAD_DPA.MESC_08',
                                                       'SIEVAD_DPA.MESC_09',
                                                       'SIEVAD_DPA.MESC_10',
                                                       'SIEVAD_DPA.MESC_11',
                                                       'SIEVAD_DPA.MESC_12',

                                                       'SIEVAD_DPA.MES_P01',
                                                       'SIEVAD_DPA.MES_P02',
                                                       'SIEVAD_DPA.MES_P03',
                                                       'SIEVAD_DPA.MES_P04',
                                                       'SIEVAD_DPA.MES_P05',
                                                       'SIEVAD_DPA.MES_P06',
                                                       'SIEVAD_DPA.MES_P07',
                                                       'SIEVAD_DPA.MES_P08',
                                                       'SIEVAD_DPA.MES_P09',
                                                       'SIEVAD_DPA.MES_P10',
                                                       'SIEVAD_DPA.MES_P11',
                                                       'SIEVAD_DPA.MES_P12',

                                                       'SIEVAD_DPA.SEMAF_01',     
                                                       'SIEVAD_DPA.SEMAF_02', 
                                                       'SIEVAD_DPA.SEMAF_03', 
                                                       'SIEVAD_DPA.SEMAF_04', 
                                                       'SIEVAD_DPA.SEMAF_05', 
                                                       'SIEVAD_DPA.SEMAF_06', 
                                                       'SIEVAD_DPA.SEMAF_07', 
                                                       'SIEVAD_DPA.SEMAF_08', 
                                                       'SIEVAD_DPA.SEMAF_08', 
                                                       'SIEVAD_DPA.SEMAF_10', 
                                                       'SIEVAD_DPA.SEMAF_11', 
                                                       'SIEVAD_DPA.SEMAF_12', 

                                                       'SIEVAD_DPA.TRIMP_01',
                                                       'SIEVAD_DPA.TRIMP_02',
                                                       'SIEVAD_DPA.TRIMP_03',
                                                       'SIEVAD_DPA.TRIMP_04',

                                                       'SIEVAD_DPA.TRIMC_01',
                                                       'SIEVAD_DPA.TRIMC_02',
                                                       'SIEVAD_DPA.TRIMC_03',
                                                       'SIEVAD_DPA.TRIMC_04',

                                                       'SIEVAD_DPA.TSEMP_01',
                                                       'SIEVAD_DPA.TSEMP_02',
                                                       'SIEVAD_DPA.TSEMC_01',
                                                       'SIEVAD_DPA.TSEMC_02',

                                                       'SIEVAD_DPA.TOTP_01',
                                                       'SIEVAD_DPA.TOTP_02',
                                                       'SIEVAD_DPA.TOTC_01',
                                                       'SIEVAD_DPA.TOTC_02', 
                                                       'SIEVAD_DPA.TOT_P01', 

                                                       'SIEVAD_DPA.SEMAFA_01',

                                                       'SIEVAD_DPA.ACUMP_01',
                                                       'SIEVAD_DPA.ACUMP_02',
                                                       'SIEVAD_DPA.ACUMP_03',
                                                       'SIEVAD_DPA.ACUMP_04',
                                                       'SIEVAD_DPA.ACUMP_05',
                                                       'SIEVAD_DPA.ACUMP_06',
                                                       'SIEVAD_DPA.ACUMP_07',
                                                       'SIEVAD_DPA.ACUMP_08',
                                                       'SIEVAD_DPA.ACUMP_09',
                                                       'SIEVAD_DPA.ACUMP_10',
                                                       'SIEVAD_DPA.ACUMP_11',
                                                       'SIEVAD_DPA.ACUMP_12',

                                                       'SIEVAD_DPA.ACUMC_01',
                                                       'SIEVAD_DPA.ACUMC_02',
                                                       'SIEVAD_DPA.ACUMC_03',
                                                       'SIEVAD_DPA.ACUMC_04',
                                                       'SIEVAD_DPA.ACUMC_05',
                                                       'SIEVAD_DPA.ACUMC_06',
                                                       'SIEVAD_DPA.ACUMC_07',
                                                       'SIEVAD_DPA.ACUMC_08',
                                                       'SIEVAD_DPA.ACUMC_09',
                                                       'SIEVAD_DPA.ACUMC_10',
                                                       'SIEVAD_DPA.ACUMC_11',
                                                       'SIEVAD_DPA.ACUMC_12',                                           

                                                       'SIEVAD_DPA.ACUM_P01',
                                                       'SIEVAD_DPA.ACUM_P02',
                                                       'SIEVAD_DPA.ACUM_P03',
                                                       'SIEVAD_DPA.ACUM_P04',
                                                       'SIEVAD_DPA.ACUM_P05',
                                                       'SIEVAD_DPA.ACUM_P06',
                                                       'SIEVAD_DPA.ACUM_P07',
                                                       'SIEVAD_DPA.ACUM_P08',
                                                       'SIEVAD_DPA.ACUM_P09',
                                                       'SIEVAD_DPA.ACUM_P10',
                                                       'SIEVAD_DPA.ACUM_P11',
                                                       'SIEVAD_DPA.ACUM_P12',

                                                       'SIEVAD_DPA.ACUM_S01',
                                                       'SIEVAD_DPA.ACUM_S02',
                                                       'SIEVAD_DPA.ACUM_S03',
                                                       'SIEVAD_DPA.ACUM_S04',
                                                       'SIEVAD_DPA.ACUM_S05',
                                                       'SIEVAD_DPA.ACUM_S06',
                                                       'SIEVAD_DPA.ACUM_S07',
                                                       'SIEVAD_DPA.ACUM_S08',
                                                       'SIEVAD_DPA.ACUM_S09',
                                                       'SIEVAD_DPA.ACUM_S10',
                                                       'SIEVAD_DPA.ACUM_S11',
                                                       'SIEVAD_DPA.ACUM_S12')


                                           ->Where(    'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id)
                                           ->Where(    'SIEVAD_EPA.TACCION_ID','=',$request->taccion_id)
                                           ->Where(    'SIEVAD_DPA.DEPEN_ID2' ,'=',$request->depen_id)
                                           ->orderBy(  'SIEVAD_DPA.PERIODO_ID','ASC')                   
                                           ->orderBy(  'SIEVAD_DPA.DEPEN_ID2' ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.FOLIO'     ,'ASC')
                                           ->orderBy(  'SIEVAD_DPA.PARTIDA'   ,'ASC')
                                           ->get();                       
                                        if($regprogdanual->count() <= 0)
                                            toastr()->error('No existen registros de PA.','Lo siento!',['positionClass' => 'toast-bottom-right']);                                                        
                            }   // depen_id                                   
                        }   // depen_id                                   
                    }   // depen_id                          
                }   // depen_id
                //************** Genera reporte pdf ******************/
                //Parámetro 0 significa que no se impondrá límite de tiempo 
                //(según el manual), el script puede ejecutarse hasta su finalización        
                ///set_time_limit(0);
                ini_set("memory_limit",-1);
                ini_set('max_execution_time', 0);            
                $pdf = PDF::loadView('sicinar.pdf.reporteMensualdetPDF',compact('nombre','usuario','regprogdanual','regtotal','regmeses','periodo_id','mes_id','depen_id'));
                //$options = new Options();
                //$options->set('defaultFont', 'Courier');
                //$pdf->set_option('defaultFont', 'Courier');
                //$pdf->set('defaultFont', 'Courier');
                //$pdf->set_options('isPhpEnabled', true);
                //$pdf->setOptions(['isPhpEnabled' => true]);                
                //******** Horizontal ***********************//
                $pdf->setPaper('A4', 'landscape');      
                //******** vertical *************************//
                //$pdf->setPaper('A4','portrait');
                //*** Output the generated PDF to Browser ***//
                return $pdf->stream('Reporte_Mensual_detallado');
                //return redirect()->route('reportemensualfiltro');
                break;                              
            }   // switch ($request->tipo) --- Termina tipo de reporte pantalla, excel o PDF 
            break;                             

        //*******************************************************************************//
        //******** Reportes sabana  *****************************************************//
        //*******************************************************************************//
        case 'S':    //Sabana
            switch ($request->tipo) {
            case 'P':    //Por pantalla sabana
                return back()->withErrors([' Por la cantidad de datos. Reporte diponible sólo en excel.']);
                break;
            case 'E':    //Formato excel sabana
                /************ Bitacora inicia *************************************/ 
                setlocale(LC_TIME, "spanish");        
                $xip          = session()->get('ip');
                $xperiodo_id  = (int)date('Y');
                $xprograma_id = 1;
                $xmes_id      = (int)date('m');
                $xproceso_id  =         3;
                $xfuncion_id  =      3001;
                $xtrx_id      =         2;    //Reportes        
                $id           =         0;
                $regbitacora = regBitacoraModel::select('PERIODO_ID', 'PROGRAMA_ID', 'MES_ID', 'PROCESO_ID', 'FUNCION_ID', 'TRX_ID', 'FOLIO', 'NO_VECES', 'FECHA_REG', 'IP', 'LOGIN', 'FECHA_M', 'IP_M', 'LOGIN_M')
                               ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                        'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO'      => $id])
                               ->get();
                if($regbitacora->count() <= 0){              // Alta
                        $nuevoregBitacora = new regBitacoraModel();              
                        $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                        $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                        $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                        $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                        $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                        $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                        $nuevoregBitacora->FOLIO      = $id;             // Folio    
                        $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                        $nuevoregBitacora->IP         = $ip;             // IP
                        $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                        $nuevoregBitacora->save();
                        if($nuevoregBitacora->save() == true)
                            toastr()->success('Trx de reporte Excel registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                        else
                            toastr()->error('Error de trx de reporte Excel. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                }else{                   
                    //*********** Obtine el no. de veces *****************************
                    $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id, 'PROGRAMA_ID' => $xprograma_id, 
                                                      'MES_ID' => $xmes_id, 'PROCESO_ID' => $xproceso_id, 
                                                      'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id,'FOLIO' => $id])
                                 ->max('NO_VECES');
                    $xno_veces = $xno_veces+1;                        
                    //*********** Termina de obtener el no de veces *****************************         
                    $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id,
                                            'PROCESO_ID' => $xproceso_id,'FUNCION_ID'  => $xfuncion_id, 'TRX_ID' => $xtrx_id,
                                            'FOLIO'      => $id])
                                   ->update([
                                             'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                             'IP_M'     => $regbitacora->IP       = $ip,
                                             'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                             'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]);
                    toastr()->success('Trx de reporte Excel actualizada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                }   /************ Bitacora termina *************************************/         
                
                //*********** Genera reporte a formato excel con parámetros ***********/
                return Excel::download(new ExcelExportMensualbddet($request->periodo_id,$request->mes_id,$request->depen_id,$request->taccion_id),'Reporte_Base_de_Datos'.date('d-m-Y').'.xlsx');            
                break;

            case 'D':    //Formato PDF sabana
                return back()->withErrors([' Por la cantidad de datos. Reporte diponible sólo en excel.']);
                break;                              
            }   // switch ($request->tipo) --- Termina tipo de reporte pantalla, excel o PDF          
            break;                              

        }   // switch .... Clase de reportes C-concentrados, D-detallados  S-Sabana          
    }

    // exportar a formato PDF
    public function actionReportePAPDF(filtropaRequest $request){
        //dd('tipo 2:',$request->visita_tipo2);
        //if($request->visita_tipo2 == 'E'){
            //dd('hola ya entre......');  
            //return redirect()->route('programavisitasExcel',[$request->periodo_id, $request->mes_id, $request->visita_tipo1]);
            //return view('programavisitasExcel',[$request->periodo_id, $request->mes_id, $request->visita_tipo1]);
        //}else{
        $nombre       = session()->get('userlog');
        $pass         = session()->get('passlog');
        if($nombre == NULL AND $pass == NULL){
            return view('sicinar.login.expirada');
        }
        $usuario      = session()->get('usuario');
        $rango        = session()->get('rango');
        $ip           = session()->get('ip');

        $regentidades = regEntidadesModel::select('ENTIDADFEDERATIVA_ID','ENTIDADFEDERATIVA_DESC')
                        ->orderBy('ENTIDADFEDERATIVA_ID','asc')
                        ->get();
        $regmunicipio = regMunicipioModel::join('PE_CAT_ENTIDADES_FED','PE_CAT_ENTIDADES_FED.ENTIDADFEDERATIVA_ID', '=', 'PE_CAT_MUNICIPIOS_SEDESEM.ENTIDADFEDERATIVAID')
                        ->select('PE_CAT_MUNICIPIOS_SEDESEM.ENTIDADFEDERATIVAID','PE_CAT_ENTIDADES_FED.ENTIDADFEDERATIVA_DESC','PE_CAT_MUNICIPIOS_SEDESEM.MUNICIPIOID','PE_CAT_MUNICIPIOS_SEDESEM.MUNICIPIONOMBRE')
                        ->wherein('PE_CAT_MUNICIPIOS_SEDESEM.ENTIDADFEDERATIVAID',[9, 11, 15, 22])
                        ->orderBy('PE_CAT_MUNICIPIOS_SEDESEM.ENTIDADFEDERATIVAID','DESC')
                        ->orderBy('PE_CAT_MUNICIPIOS_SEDESEM.MUNICIPIONOMBRE','DESC')
                        ->get();        
        $regmeses     = regMesesModel::select('MES_ID','MES_DESC')->get();   
        $reghoras     = regHorasModel::select('HORA_ID','HORA_DESC')->get();   
        $regdias      = regDiasModel::select('DIA_ID','DIA_DESC')->get();   
        $regperiodos  = regPfiscalesModel::select('PERIODO_ID', 'PERIODO_DESC')->get();        
        $regosc       = regOscModel::select('OSC_ID','OSC_DESC','OSC_REGCONS','OSC_RFC','OSC_STATUS')->get();       
        $regprogdil   = regAgendaModel::join('PE_OSC','PE_OSC.OSC_ID','=','PE_AGENDA.OSC_ID')
                        ->select('PE_OSC.OSC_DESC','PE_OSC.OSC_REGCONS',
                        'PE_AGENDA.VISITA_FOLIO',
                        'PE_AGENDA.PERIODO_ID','PE_AGENDA.MES_ID','PE_AGENDA.DIA_ID','PE_AGENDA.HORA_ID',
                        'PE_AGENDA.OSC_ID','PE_AGENDA.MUNICIPIO_ID','PE_AGENDA.VISITA_CONTACTO',
                        'PE_AGENDA.VISITA_TEL','PE_AGENDA.VISITA_EMAIL','PE_AGENDA.VISITA_DOM',
                        'PE_AGENDA.VISITA_OBJ','PE_AGENDA.VISITA_SPUB','PE_AGENDA.VISITA_SPUB2',
                        'PE_AGENDA.VISITA_AUDITOR2','PE_AGENDA.VISITA_AUDITOR4','PE_AGENDA.VISITA_TIPO1',
                        'PE_AGENDA.VISITA_FECREGP','PE_AGENDA.VISITA_FECREGP2','PE_AGENDA.VISITA_EDO',
                        'PE_AGENDA.VISITA_OBS2','PE_AGENDA.VISITA_OBS3')
                        ->where( ['PE_AGENDA.PERIODO_ID'   => $request->periodo_id, 
                                  'PE_AGENDA.MES_ID'       => $request->mes_id
                                 ])
                        ->orderBy('PE_AGENDA.PERIODO_ID'  ,'ASC')
                        ->orderBy('PE_AGENDA.VISITA_FOLIO','ASC')
                        ->get();
        if($regprogdil->count() <= 0){
            toastr()->error('No existe visitas proramadas en la agenda.','Uppss!',['positionClass' => 'toast-bottom-right']);
        }else{
            /************ Bitacora inicia *************************************/ 
            $id           =        1;
            setlocale(LC_TIME, "spanish");        
            $xip          = session()->get('ip');
            $xperiodo_id  = (int)date('Y');
            $xprograma_id = 1;
            $xmes_id      = (int)date('m');
            $xproceso_id  =         3;
            $xfuncion_id  =      3006;
            $xtrx_id      =       184;     // pdf
            $id           =       $id;
            $regbitacora = regBitacoraModel::select('PERIODO_ID', 'PROGRAMA_ID', 'MES_ID', 'PROCESO_ID', 
                                                    'FUNCION_ID', 'TRX_ID', 'FOLIO', 'NO_VECES', 'FECHA_REG', 'IP', 
                                                    'LOGIN', 'FECHA_M', 'IP_M', 'LOGIN_M')
                           ->where(['PERIODO_ID' => $xperiodo_id, 'PROGRAMA_ID' => $xprograma_id,'MES_ID' => $xmes_id, 
                                    'PROCESO_ID' => $xproceso_id, 'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                    'FOLIO' => $id])
                           ->get();
            if($regbitacora->count() <= 0){              // Alta
                $nuevoregBitacora = new regBitacoraModel();              
                $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                $nuevoregBitacora->FOLIO      = $id;             // Folio    
                $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                $nuevoregBitacora->IP         = $ip;             // IP
                $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 
                $nuevoregBitacora->save();
                if($nuevoregBitacora->save() == true)
                    toastr()->success('Bitacora dada de alta correctamente.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                else
                    toastr()->error('Error inesperado al dar de alta la bitacora. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
            }else{                   
                //*********** Obtine el no. de veces *****************************
                $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id, 'PROGRAMA_ID' => $xprograma_id, 
                                                      'MES_ID' => $xmes_id, 'PROCESO_ID' => $xproceso_id, 
                                                      'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id, 'FOLIO' => $id])
                             ->max('NO_VECES');
                $xno_veces = $xno_veces+1;                        
                //*********** Termina de obtener el no de veces *****************************         
                $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                               ->where(['PERIODO_ID' => $xperiodo_id, 'PROGRAMA_ID' => $xprograma_id, 'MES_ID' => $xmes_id,
                                        'PROCESO_ID' => $xproceso_id, 'FUNCION_ID' => $xfuncion_id, 'TRX_ID' => $xtrx_id, 
                                        'FOLIO' => $id])
                               ->update([
                                        'NO_VECES'=> $regbitacora->NO_VECES = $xno_veces,
                                        'IP_M'    => $regbitacora->IP       = $ip,
                                        'LOGIN_M' => $regbitacora->LOGIN_M  = $nombre,
                                        'FECHA_M' => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                        ]);
                toastr()->success('Bitacora actualizada.','¡Ok!',['positionClass' => 'toast-bottom-right']);
            }   /************ Bitacora termina *************************************/ 

            /**************** Genera reporte pdf **********************/            
            //Parámetro 0 significa que no se impondrá límite de tiempo 
            //(según el manual), el script puede ejecutarse hasta su finalización
            set_time_limit(0);
            ini_set("memory_limit",-1);
            ini_set('max_execution_time', 0);

            $pdf = PDF::loadView('sicinar.pdf.programavisitasPdf', compact('nombre','usuario','regmeses','reghoras','regdias','regperiodos','regosc','regprogdil','regentidades','regmunicipio'));
            //$options = new Options();
            //$options->set('defaultFont', 'Courier');
            //$pdf->set_option('defaultFont', 'Courier');
            //******** Horizontal ***************
            $pdf->setPaper('A4', 'landscape');      
            //$pdf->set('defaultFont', 'Courier');
            //$pdf->set_options('isPhpEnabled', true);
            //$pdf->setOptions(['isPhpEnabled' => true]);
            //******** vertical ***************          
            //$pdf->setPaper('A4','portrait');

            // Output the generated PDF to Browser
            return $pdf->stream('ProgramaDeVisitas');
        }   //*************** Genera reporte en formato PDF **************************//

        //}   //******** Termina la selección del tipo de reporte *********************//
    }

    //************************* Reporte excel **********************//
    public function actionRepExcelq01(){
        $nombre        = session()->get('userlog');
        $pass          = session()->get('passlog');
        if($nombre == NULL AND $pass == NULL){
            return view('sicinar.login.expirada');
        }
        $usuario       = session()->get('usuario');
        $rango         = session()->get('rango');

        $regmeses     = regMesesModel::select('MES_ID','MES_DESC')
                        ->get();   
        //$regdias    = regDiasModel::select('DIA_ID','DIA_DESC')
        //              ->get();   
        $regperiodos  = regPeriodosModel::select('PERIODO_ID', 'PERIODO_DESC')
                        ->orderBy('PERIODO_ID','ASC')
                        ->get();        
        $regdepen     = regdepenModel::select('DEPEN_ID', 'DEPEN_DESC')
                        ->where(  'DEPEN_STATUS','1')
                        ->orderBy('DEPEN_DESC'  ,'ASC')
                        ->get();                    
        $regprogeanual= regProgeAnualModel::select('FOLIO','PERIODO_ID','DEPEN_ID1','DEPEN_ID2','DEPEN_ID3',
                        'EPPROG_ID','EPPROY_ID','FECHA_ENTREGA','FECHA_ENTREGA2','FECHA_ENTREGA3',
                        'PERIODO_ID1','MES_ID1','DIA_ID1','MES_ID2','PROGRAMA_ID','PROGRAMA_DESC',
                        'RESPONSABLE','ELABORO','AUTORIZO','OBS_1','OBS_2','STATUS_1','STATUS_2',
                        'FECREG','FECREG2','IP','LOGIN','FECHA_M','FECHA_M2','IP_M','LOGIN_M')
                        ->orderBy('PERIODO_ID','ASC')
                        ->orderBy('FOLIO'     ,'ASC')
                        ->get();                                    
        $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA' ,'SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                      'SIEVAD_DPA.UMED_ID')
                                         ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                          'SIEVAD_DPA.DEPEN_ID2')
                       ->select(    'SIEVAD_DPA.FOLIO', 
                                    'SIEVAD_DPA.PARTIDA', 
                                    'SIEVAD_DPA.CIPREP_ID',
                                    'SIEVAD_DPA.LGOB_COD',
                                    'SIEVAD_DPA.DEPEN_ID1',
                                    'SIEVAD_DPA.DEPEN_ID2',
                                    'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC', 
                                    'SIEVAD_DPA.MES_ID2', 
                                    'SIEVAD_DPA.FECHA_ENTREGA', 
                                    'SIEVAD_DPA.FECHA_ENTREGA2', 
                                    'SIEVAD_DPA.FECHA_ENTREGA3', 
                                    'SIEVAD_DPA.ACTIVIDAD_DESC', 
                                    'SIEVAD_DPA.OBJETIVO_DESC', 
                                    'SIEVAD_DPA.OPERACIONAL_DESC', 
                                    'SIEVAD_DPA.SOPORTE_01',
                                    'SIEVAD_DPA.OBS_01',
                                    
                                    'SIEVAD_DPA.UMED_ID', 
                                    'SIEVAD_CAT_UMEDIDA.UMED_DESC', 
                                    'SIEVAD_DPA.MESP_01', 'SIEVAD_DPA.MESP_02', 'SIEVAD_DPA.MESP_03', 
                                    'SIEVAD_DPA.MESP_04', 'SIEVAD_DPA.MESP_05', 'SIEVAD_DPA.MESP_06', 
                                    'SIEVAD_DPA.MESP_07', 'SIEVAD_DPA.MESP_08', 'SIEVAD_DPA.MESP_09', 
                                    'SIEVAD_DPA.MESP_10', 'SIEVAD_DPA.MESP_11', 'SIEVAD_DPA.MESP_12',
                                    'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMP_03',
                                    'SIEVAD_DPA.TRIMP_04',
                                    'SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIMC_03',
                                    'SIEVAD_DPA.TRIMC_04',
                                    'SIEVAD_DPA.TSEMP_01','SIEVAD_DPA.TSEMP_02','SIEVAD_DPA.TSEMC_01',
                                    'SIEVAD_DPA.TSEMC_02',
                                    'SIEVAD_DPA.TOTP_01' ,'SIEVAD_DPA.TOTP_02' ,'SIEVAD_DPA.TOTC_01' ,
                                    'SIEVAD_DPA.TOTC_02',
                                    'SIEVAD_DPA.MES_P01','SIEVAD_DPA.MES_P02','SIEVAD_DPA.MES_P03','SIEVAD_DPA.MES_P04','SIEVAD_DPA.MES_P05','SIEVAD_DPA.MES_P06',
                                    'SIEVAD_DPA.MES_P07','SIEVAD_DPA.MES_P08','SIEVAD_DPA.MES_P09','SIEVAD_DPA.MES_P10','SIEVAD_DPA.MES_P11','SIEVAD_DPA.MES_P12',
                                    'SIEVAD_DPA.TRIM_P01','SIEVAD_DPA.TRIM_P02','SIEVAD_DPA.TRIM_P03','SIEVAD_DPA.TRIM_P04','SIEVAD_DPA.SEM_P01','SIEVAD_DPA.SEM_P02','SIEVAD_DPA.TOT_P01',
                                    'SIEVAD_DPA.SEMAF_01','SIEVAD_DPA.SEMAF_02','SIEVAD_DPA.SEMAF_03','SIEVAD_DPA.SEMAF_04','SIEVAD_DPA.SEMAF_05','SIEVAD_DPA.SEMAF_06',
                                    'SIEVAD_DPA.SEMAF_07','SIEVAD_DPA.SEMAF_08','SIEVAD_DPA.SEMAF_09','SIEVAD_DPA.SEMAF_10','SIEVAD_DPA.SEMAF_11','SIEVAD_DPA.SEMAF_12',
                                    'SIEVAD_DPA.SEMAFT_01','SIEVAD_DPA.SEMAFT_02','SIEVAD_DPA.SEMAFT_03','SIEVAD_DPA.SEMAFT_04','SIEVAD_DPA.SEMAFS_01','SIEVAD_DPA.SEMAFS_02','SIEVAD_DPA.SEMAFA_01'
                               )
                       ->selectRaw('(SIEVAD_DPA.MESP_01+SIEVAD_DPA.MESP_02+SIEVAD_DPA.MESP_03+
                                     SIEVAD_DPA.MESP_04+SIEVAD_DPA.MESP_05+SIEVAD_DPA.MESP_06+
                                     SIEVAD_DPA.MESP_07+SIEVAD_DPA.MESP_08+SIEVAD_DPA.MESP_09+
                                     SIEVAD_DPA.MESP_10+SIEVAD_DPA.MESP_11+SIEVAD_DPA.MESP_12)
                                     META_PROGRAMADA')
                       ->selectRaw('(SIEVAD_DPA.MESC_01+SIEVAD_DPA.MESC_02+SIEVAD_DPA.MESC_03+
                                     SIEVAD_DPA.MESC_04+SIEVAD_DPA.MESC_05+SIEVAD_DPA.MESC_06+
                                     SIEVAD_DPA.MESC_07+SIEVAD_DPA.MESC_08+SIEVAD_DPA.MESC_09+
                                     SIEVAD_DPA.MESC_10+SIEVAD_DPA.MESC_11+SIEVAD_DPA.MESC_12)
                                     META_REALIZADA')                       
                       ->orderBy(   'SIEVAD_DPA.PERIODO_ID','ASC')                   
                       ->orderBy(   'SIEVAD_DPA.FOLIO'     ,'ASC')
                       ->orderBy(   'SIEVAD_DPA.PARTIDA'   ,'ASC')
                       ->get(); 
                       //->toArray();
                       //->first();
        if($regprogdanual->count() <= 0){
            toastr()->error('No existen registros del programa anual.','Lo siento!',['positionClass' => 'toast-bottom-right']);
        }
        return view('sicinar.reportes.reporteExcel01',compact('nombre','usuario','regmeses','regdepen','regperiodos','regprogdanual'));
    }

     //Exportar a formato excel
    public function actionRepExcel01(filtro01Request $request){
        //dd('id..............',$id,'-id1:',$id1,'-id2:',$id2);
        $nombre       = session()->get('userlog');
        $pass         = session()->get('passlog');
        if($nombre == NULL AND $pass == NULL){
            return view('sicinar.login.expirada');
        }
        $usuario      = session()->get('usuario');
        $rango        = session()->get('rango');
        $ip           = session()->get('ip');

        $regmeses     = regMesesModel::select('MES_ID','MES_DESC')
                        ->get();   
        //$regdias    = regDiasModel::select('DIA_ID','DIA_DESC')
        //              ->get();   
        $regperiodos  = regPeriodosModel::select('PERIODO_ID', 'PERIODO_DESC')
                        ->orderBy('PERIODO_ID','ASC')
                        ->get();        
        $regdepen     = regdepenModel::select('DEPEN_ID', 'DEPEN_DESC')
                        ->where(  'DEPEN_STATUS','1')
                        ->orderBy('DEPEN_DESC'  ,'ASC')
                        ->get();                    
        $regprogeanual= regProgeAnualModel::select('FOLIO','PERIODO_ID','DEPEN_ID1','DEPEN_ID2','DEPEN_ID3',
                        'EPPROG_ID','EPPROY_ID','FECHA_ENTREGA','FECHA_ENTREGA2','FECHA_ENTREGA3',
                        'PERIODO_ID1','MES_ID1','DIA_ID1','MES_ID2','PROGRAMA_ID','PROGRAMA_DESC',
                        'RESPONSABLE','ELABORO','AUTORIZO','OBS_1','OBS_2','STATUS_1','STATUS_2',
                        'FECREG','FECREG2','IP','LOGIN','FECHA_M','FECHA_M2','IP_M','LOGIN_M')
                        ->orderBy('PERIODO_ID','ASC')
                        ->orderBy('FOLIO'     ,'ASC')
                        ->get();                                    
        $regprogdanual=regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA' ,'SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                      'SIEVAD_DPA.UMED_ID')
                                         ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                          'SIEVAD_DPA.DEPEN_ID2')
                       ->select(    'SIEVAD_DPA.FOLIO', 
                                    'SIEVAD_DPA.PARTIDA', 
                                    'SIEVAD_DPA.CIPREP_ID',
                                    'SIEVAD_DPA.LGOB_COD',
                                    'SIEVAD_DPA.DEPEN_ID1',
                                    'SIEVAD_DPA.DEPEN_ID2',
                                    'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC', 
                                    'SIEVAD_DPA.MES_ID2', 
                                    'SIEVAD_DPA.FECHA_ENTREGA', 
                                    'SIEVAD_DPA.FECHA_ENTREGA2', 
                                    'SIEVAD_DPA.FECHA_ENTREGA3', 
                                    'SIEVAD_DPA.ACTIVIDAD_DESC', 
                                    'SIEVAD_DPA.OBJETIVO_DESC', 
                                    'SIEVAD_DPA.OPERACIONAL_DESC', 
                                    'SIEVAD_DPA.SOPORTE_01',
                                    'SIEVAD_DPA.OBS_01',
                                    
                                    'SIEVAD_DPA.UMED_ID', 
                                    'SIEVAD_CAT_UMEDIDA.UMED_DESC', 
                                    'SIEVAD_DPA.MESP_01', 'SIEVAD_DPA.MESP_02', 'SIEVAD_DPA.MESP_03', 
                                    'SIEVAD_DPA.MESP_04', 'SIEVAD_DPA.MESP_05', 'SIEVAD_DPA.MESP_06', 
                                    'SIEVAD_DPA.MESP_07', 'SIEVAD_DPA.MESP_08', 'SIEVAD_DPA.MESP_09', 
                                    'SIEVAD_DPA.MESP_10', 'SIEVAD_DPA.MESP_11', 'SIEVAD_DPA.MESP_12',
                                    'SIEVAD_DPA.TRIMP_01','SIEVAD_DPA.TRIMP_02','SIEVAD_DPA.TRIMP_03',
                                    'SIEVAD_DPA.TRIMP_04',
                                    'SIEVAD_DPA.TRIMC_01','SIEVAD_DPA.TRIMC_02','SIEVAD_DPA.TRIMC_03',
                                    'SIEVAD_DPA.TRIMC_04',
                                    'SIEVAD_DPA.TSEMP_01','SIEVAD_DPA.TSEMP_02','SIEVAD_DPA.TSEMC_01',
                                    'SIEVAD_DPA.TSEMC_02',
                                    'SIEVAD_DPA.TOTP_01' ,'SIEVAD_DPA.TOTP_02' ,'SIEVAD_DPA.TOTC_01' ,
                                    'SIEVAD_DPA.TOTC_02',
                                    'SIEVAD_DPA.MES_P01','SIEVAD_DPA.MES_P02','SIEVAD_DPA.MES_P03','SIEVAD_DPA.MES_P04','SIEVAD_DPA.MES_P05','SIEVAD_DPA.MES_P06',
                                    'SIEVAD_DPA.MES_P07','SIEVAD_DPA.MES_P08','SIEVAD_DPA.MES_P09','SIEVAD_DPA.MES_P10','SIEVAD_DPA.MES_P11','SIEVAD_DPA.MES_P12',
                                    'SIEVAD_DPA.TRIM_P01','SIEVAD_DPA.TRIM_P02','SIEVAD_DPA.TRIM_P03','SIEVAD_DPA.TRIM_P04','SIEVAD_DPA.SEM_P01','SIEVAD_DPA.SEM_P02','SIEVAD_DPA.TOT_P01',
                                    'SIEVAD_DPA.SEMAF_01','SIEVAD_DPA.SEMAF_02','SIEVAD_DPA.SEMAF_03','SIEVAD_DPA.SEMAF_04','SIEVAD_DPA.SEMAF_05','SIEVAD_DPA.SEMAF_06',
                                    'SIEVAD_DPA.SEMAF_07','SIEVAD_DPA.SEMAF_08','SIEVAD_DPA.SEMAF_09','SIEVAD_DPA.SEMAF_10','SIEVAD_DPA.SEMAF_11','SIEVAD_DPA.SEMAF_12',
                                    'SIEVAD_DPA.SEMAFT_01','SIEVAD_DPA.SEMAFT_02','SIEVAD_DPA.SEMAFT_03','SIEVAD_DPA.SEMAFT_04','SIEVAD_DPA.SEMAFS_01','SIEVAD_DPA.SEMAFS_02','SIEVAD_DPA.SEMAFA_01'
                               )
                       ->selectRaw('(SIEVAD_DPA.MESP_01+SIEVAD_DPA.MESP_02+SIEVAD_DPA.MESP_03+
                                     SIEVAD_DPA.MESP_04+SIEVAD_DPA.MESP_05+SIEVAD_DPA.MESP_06+
                                     SIEVAD_DPA.MESP_07+SIEVAD_DPA.MESP_08+SIEVAD_DPA.MESP_09+
                                     SIEVAD_DPA.MESP_10+SIEVAD_DPA.MESP_11+SIEVAD_DPA.MESP_12)
                                     META_PROGRAMADA')
                       ->selectRaw('(SIEVAD_DPA.MESC_01+SIEVAD_DPA.MESC_02+SIEVAD_DPA.MESC_03+
                                     SIEVAD_DPA.MESC_04+SIEVAD_DPA.MESC_05+SIEVAD_DPA.MESC_06+
                                     SIEVAD_DPA.MESC_07+SIEVAD_DPA.MESC_08+SIEVAD_DPA.MESC_09+
                                     SIEVAD_DPA.MESC_10+SIEVAD_DPA.MESC_11+SIEVAD_DPA.MESC_12)
                                     META_REALIZADA')                       
                       ->orderBy(   'SIEVAD_DPA.PERIODO_ID','ASC')                   
                       ->orderBy(   'SIEVAD_DPA.FOLIO'     ,'ASC')
                       ->orderBy(   'SIEVAD_DPA.PARTIDA'   ,'ASC')
                       ->get(); 
        //**************************************************************//
        // ***** busqueda https://github.com/rimorsoft/Search-simple ***//
        // ***** video https://www.youtube.com/watch?v=bmtD9GUaszw   ***//                            
        //**************************************************************//
        $periodo_id = $request->get('periodo_id');   
        $mes_id     = $request->get('mes_id');  
        $tipo       = $request->get('tipo');      //  tipo P-Pantalla, E-Excel, D-PDF
        $depen_id   = $request->get('depen_id');     
        $clase      = $request->get('clase');     // clase de reporte C-concentrado, D-Detallado

        //*************************************************************************//
        // Generar reportes concentrados C-Concentrado, D-Detallado          ******//
        //*************************************************************************//        
        if($request->clase == 'C'){
            //*************************************************************************//
            // Enviar reporte a pantalla, excel o PDF                            ******//
            //*************************************************************************//             
            switch ($request->tipo) {               
            case 'P':    //Por pantalla concentrado
            break;
            case 'E':    //Formato excel concentrado  
            break;
            }            //Switch ($request->tipo) - Fin tipo de reporte pantalla, excel o PDF   
        }else{           // Generar reportes D-detallados                            ****//
            //*************************************************************************//
            // Enviar reporte a pantalla, excel o PDF                            ******//
            //*************************************************************************//                 
            switch ($request->tipo) {
            case 'P':    //Por pantalla detallado
                 break;
            case 'E':    //Formato excel detallado
                //dd('periodo:'.$request->periodo_id,' Mes:'.$request->mes_id,' Tipo:'.$request->clase,' reporte a:'.$request->tipo,' depen:'.$request->depen_id);
                if( !empty($request->depen_id) ){
                //if( is_null($request->depen_id) ){   
                    //if($request->semaforo == 3 ){                                                              
                    $totregs=regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA'     ,'SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                                'SIEVAD_DPA.UMED_ID')
                                               ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                                'SIEVAD_DPA.DEPEN_ID2')                   
                          ->selectRaw('COUNT(*) AS REGISTROS')
                          ->Where(  'SIEVAD_DPA.PERIODO_ID'    ,'=',$request->periodo_id) 
                          //->Where('SIEVAD_DPA.MES_ID'        ,'=',$request->mess)
                          ->Where(  'SIEVAD_DPA.DEPEN_ID2'     ,'=',$request->depen_id)
                          //->Where(  'SIEVAD_DPA.RECIBO_STATUS2','=',$request->semaforo)    
                          ->orderBy('SIEVAD_DPA.PERIODO_ID','ASC')                   
                          ->orderBy('SIEVAD_DPA.FOLIO'     ,'ASC')
                          ->orderBy('SIEVAD_DPA.PARTIDA'   ,'ASC')                          
                          ->get();    
                    //}
                    //dd('1........'.$totregs->count(), $totregs);
                }else{ 
                    //if($request->semaforo == 3 ){                                                              
                    $totregs=regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA'     ,'SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                                'SIEVAD_DPA.UMED_ID')
                                               ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                                'SIEVAD_DPA.DEPEN_ID2')                   
                          ->selectRaw('COUNT(*) AS REGISTROS')
                          ->Where(  'SIEVAD_DPA.PERIODO_ID'    ,'=',$request->periodo_id) 
                          //->Where('SIEVAD_DPA.MES_ID'        ,'=',$request->mess)
                          //->Where(  'SIEVAD_DPA.DEPEN_ID2'   ,'=',$request->depen_id)
                          //->Where(  'SIEVAD_DPA.RECIBO_STATUS2','=',$request->semaforo)    
                          ->orderBy('SIEVAD_DPA.PERIODO_ID','ASC')                   
                          ->orderBy('SIEVAD_DPA.FOLIO'     ,'ASC')
                          ->orderBy('SIEVAD_DPA.PARTIDA'   ,'ASC')                          
                          ->get();    
                    //}                           
                    //dd('2........'.$totregs->count(), $totregs);
                }   // Depen_id
                //dd($totregs->count(), $totregs);
                //$registros =  $totregs[0]->registros;
                //if($registros <=0)
                if ($totregs->count() <=0)
                     return back()->withErrors(['FOLIO' => 'No existen registros de programa anual.']);
                    //toastr()->error('No existen registros de recibos de bitacora. ','Lo siento!',['positionClass' => 'toast-bottom-right']);  
                else{             
                    //if((!is_null($request->diaa))&&(is_null($request->cliee)) ){
                    if( !empty($request->depen_id) ){ 
                        //if($request->semaforo == 3 ){                  
                        $regprogdanual= regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA','SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                 'SIEVAD_DPA.UMED_ID')
                                  ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                   'SIEVAD_DPA.DEPEN_ID2')
                        ->select(    
                                    'SIEVAD_DPA.DEPEN_ID1',
                                    'SIEVAD_DPA.DEPEN_ID2',
                                    'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC', 
                                    'SIEVAD_DPA.FOLIO', 
                                    'SIEVAD_DPA.PARTIDA', 
                                    'SIEVAD_DPA.CIPREP_ID',
                                    'SIEVAD_DPA.LGOB_COD',
                                    //'SIEVAD_DPA.MES_ID2', 
                                    //'SIEVAD_DPA.FECHA_ENTREGA', 
                                    'SIEVAD_DPA.FECHA_ENTREGA2', 
                                    //'SIEVAD_DPA.FECHA_ENTREGA3', 
                                    'SIEVAD_DPA.ACTIVIDAD_DESC', 
                                    
                                    'SIEVAD_DPA.UMED_ID', 
                                    'SIEVAD_CAT_UMEDIDA.UMED_DESC', 
                                    'SIEVAD_DPA.TOTP_01' ,'SIEVAD_DPA.TOTC_01' ,
                                    'SIEVAD_DPA.TOT_P01',
                                    'SIEVAD_DPA.SEMAFA_01',

                                    'SIEVAD_DPA.MESP_01', 'SIEVAD_DPA.MESC_01',
                                    'SIEVAD_DPA.MES_P01',
                                    'SIEVAD_DPA.SEMAF_01',
                                    'SIEVAD_DPA.MESP_02', 'SIEVAD_DPA.MESC_02',  
                                    'SIEVAD_DPA.MES_P02',
                                    'SIEVAD_DPA.SEMAF_02',
                                    'SIEVAD_DPA.MESP_03', 'SIEVAD_DPA.MESC_03',
                                    'SIEVAD_DPA.MES_P03',
                                    'SIEVAD_DPA.SEMAF_03',
                                    'SIEVAD_DPA.TRIMP_01', 'SIEVAD_DPA.TRIMC_01',
                                    'SIEVAD_DPA.TRIM_P01',
                                    'SIEVAD_DPA.SEMAFT_01',

                                    'SIEVAD_DPA.MESP_04', 'SIEVAD_DPA.MESC_04',
                                    'SIEVAD_DPA.MES_P04',
                                    'SIEVAD_DPA.SEMAF_04',
                                    'SIEVAD_DPA.MESP_05', 'SIEVAD_DPA.MESC_05',  
                                    'SIEVAD_DPA.MES_P05',
                                    'SIEVAD_DPA.SEMAF_05',
                                    'SIEVAD_DPA.MESP_06', 'SIEVAD_DPA.MESC_06',
                                    'SIEVAD_DPA.MES_P06',
                                    'SIEVAD_DPA.SEMAF_06',
                                    'SIEVAD_DPA.TRIMP_02', 'SIEVAD_DPA.TRIMC_02',
                                    'SIEVAD_DPA.TRIM_P02',
                                    'SIEVAD_DPA.SEMAFT_02',
                                    'SIEVAD_DPA.TSEMP_01', 'SIEVAD_DPA.TSEMC_01',
                                    'SIEVAD_DPA.SEM_P01',
                                    'SIEVAD_DPA.SEMAFS_01',

                                    'SIEVAD_DPA.MESP_07', 'SIEVAD_DPA.MESC_07',   
                                    'SIEVAD_DPA.MES_P07',
                                    'SIEVAD_DPA.SEMAF_07',
                                    'SIEVAD_DPA.MESP_08', 'SIEVAD_DPA.MESC_08',
                                    'SIEVAD_DPA.MES_P08',
                                    'SIEVAD_DPA.SEMAF_08',
                                    'SIEVAD_DPA.MESP_09', 'SIEVAD_DPA.MESC_09',
                                    'SIEVAD_DPA.MES_P09',
                                    'SIEVAD_DPA.SEMAF_09',
                                    'SIEVAD_DPA.TRIMP_03', 'SIEVAD_DPA.TRIMC_03',
                                    'SIEVAD_DPA.TRIM_P03',
                                    'SIEVAD_DPA.SEMAFT_03',

                                    'SIEVAD_DPA.MESP_10', 'SIEVAD_DPA.MESC_10', 
                                    'SIEVAD_DPA.MES_P10',
                                    'SIEVAD_DPA.SEMAF_10',
                                    'SIEVAD_DPA.MESP_11', 'SIEVAD_DPA.MESC_11', 
                                    'SIEVAD_DPA.MES_P11',
                                    'SIEVAD_DPA.SEMAF_11',
                                    'SIEVAD_DPA.MESP_12', 'SIEVAD_DPA.MESC_12', 
                                    'SIEVAD_DPA.MES_P12',
                                    'SIEVAD_DPA.SEMAF_12',
                                    'SIEVAD_DPA.TRIMP_04','SIEVAD_DPA.TRIMC_04',
                                    'SIEVAD_DPA.TRIM_P04',
                                    'SIEVAD_DPA.SEMAFT_04',
                                    'SIEVAD_DPA.TSEMP_02','SIEVAD_DPA.TSEMC_02',
                                    'SIEVAD_DPA.SEM_P02',
                                    'SIEVAD_DPA.SEMAFS_02',

                                    'SIEVAD_DPA.OBJETIVO_DESC', 
                                    'SIEVAD_DPA.OPERACIONAL_DESC', 
                                    'SIEVAD_DPA.SOPORTE_01' 
                               )
                          ->Where(  'SIEVAD_DPA.PERIODO_ID','=',$request->periodo_id) 
                          //->Where('SIEVAD_DPA.MES_ID'    ,'=',$request->mess)
                          ->Where('SIEVAD_DPA.DEPEN_ID2'   ,'=',$request->depen_id)
                          //->Where('SIEVAD_DPA.RECIBO_STATUS2','=',$request->semaforo)    
                          ->orderBy('SIEVAD_DPA.PERIODO_ID','ASC')                   
                          ->orderBy('SIEVAD_DPA.FOLIO'     ,'ASC')
                          ->orderBy('SIEVAD_DPA.PARTIDA'   ,'ASC')                          
                          ->get();                          
                        //}
                    }else{ 
                        $regprogdanual= regProgdAnualModel::join('SIEVAD_CAT_UMEDIDA'     ,'SIEVAD_CAT_UMEDIDA.UMED_ID','=',
                                                                 'SIEVAD_DPA.UMED_ID')
                                  ->join('SIEVAD_CAT_DEPENDENCIAS','SIEVAD_CAT_DEPENDENCIAS.DEPEN_ID','=',
                                                                   'SIEVAD_DPA.DEPEN_ID2')
                        ->select(    
                                    'SIEVAD_DPA.DEPEN_ID1',
                                    'SIEVAD_DPA.DEPEN_ID2',
                                    'SIEVAD_CAT_DEPENDENCIAS.DEPEN_DESC', 
                                    'SIEVAD_DPA.FOLIO', 
                                    'SIEVAD_DPA.PARTIDA', 
                                    'SIEVAD_DPA.CIPREP_ID',
                                    'SIEVAD_DPA.LGOB_COD',
                                    //'SIEVAD_DPA.MES_ID2', 
                                    //'SIEVAD_DPA.FECHA_ENTREGA', 
                                    'SIEVAD_DPA.FECHA_ENTREGA2', 
                                    //'SIEVAD_DPA.FECHA_ENTREGA3', 
                                    'SIEVAD_DPA.ACTIVIDAD_DESC', 
                                    
                                    'SIEVAD_DPA.UMED_ID', 
                                    'SIEVAD_CAT_UMEDIDA.UMED_DESC', 
                                    'SIEVAD_DPA.TOTP_01' ,'SIEVAD_DPA.TOTC_01' ,
                                    'SIEVAD_DPA.TOT_P01',
                                    'SIEVAD_DPA.SEMAFA_01',

                                    'SIEVAD_DPA.MESP_01', 'SIEVAD_DPA.MESC_01',
                                    'SIEVAD_DPA.MES_P01',
                                    'SIEVAD_DPA.SEMAF_01',
                                    'SIEVAD_DPA.MESP_02', 'SIEVAD_DPA.MESC_02',  
                                    'SIEVAD_DPA.MES_P02',
                                    'SIEVAD_DPA.SEMAF_02',
                                    'SIEVAD_DPA.MESP_03', 'SIEVAD_DPA.MESC_03',
                                    'SIEVAD_DPA.MES_P03',
                                    'SIEVAD_DPA.SEMAF_03',
                                    'SIEVAD_DPA.TRIMP_01', 'SIEVAD_DPA.TRIMC_01',
                                    'SIEVAD_DPA.TRIM_P01',
                                    'SIEVAD_DPA.SEMAFT_01',

                                    'SIEVAD_DPA.MESP_04', 'SIEVAD_DPA.MESC_04',
                                    'SIEVAD_DPA.MES_P04',
                                    'SIEVAD_DPA.SEMAF_04',
                                    'SIEVAD_DPA.MESP_05', 'SIEVAD_DPA.MESC_05',  
                                    'SIEVAD_DPA.MES_P05',
                                    'SIEVAD_DPA.SEMAF_05',
                                    'SIEVAD_DPA.MESP_06', 'SIEVAD_DPA.MESC_06',
                                    'SIEVAD_DPA.MES_P06',
                                    'SIEVAD_DPA.SEMAF_06',
                                    'SIEVAD_DPA.TRIMP_02', 'SIEVAD_DPA.TRIMC_02',
                                    'SIEVAD_DPA.TRIM_P02',
                                    'SIEVAD_DPA.SEMAFT_02',
                                    'SIEVAD_DPA.TSEMP_01', 'SIEVAD_DPA.TSEMC_01',
                                    'SIEVAD_DPA.SEM_P01',
                                    'SIEVAD_DPA.SEMAFS_01',

                                    'SIEVAD_DPA.MESP_07', 'SIEVAD_DPA.MESC_07',   
                                    'SIEVAD_DPA.MES_P07',
                                    'SIEVAD_DPA.SEMAF_07',
                                    'SIEVAD_DPA.MESP_08', 'SIEVAD_DPA.MESC_08',
                                    'SIEVAD_DPA.MES_P08',
                                    'SIEVAD_DPA.SEMAF_08',
                                    'SIEVAD_DPA.MESP_09', 'SIEVAD_DPA.MESC_09',
                                    'SIEVAD_DPA.MES_P09',
                                    'SIEVAD_DPA.SEMAF_09',
                                    'SIEVAD_DPA.TRIMP_03', 'SIEVAD_DPA.TRIMC_03',
                                    'SIEVAD_DPA.TRIM_P03',
                                    'SIEVAD_DPA.SEMAFT_03',

                                    'SIEVAD_DPA.MESP_10', 'SIEVAD_DPA.MESC_10', 
                                    'SIEVAD_DPA.MES_P10',
                                    'SIEVAD_DPA.SEMAF_10',
                                    'SIEVAD_DPA.MESP_11', 'SIEVAD_DPA.MESC_11', 
                                    'SIEVAD_DPA.MES_P11',
                                    'SIEVAD_DPA.SEMAF_11',
                                    'SIEVAD_DPA.MESP_12', 'SIEVAD_DPA.MESC_12', 
                                    'SIEVAD_DPA.MES_P12',
                                    'SIEVAD_DPA.SEMAF_12',
                                    'SIEVAD_DPA.TRIMP_04','SIEVAD_DPA.TRIMC_04',
                                    'SIEVAD_DPA.TRIM_P04',
                                    'SIEVAD_DPA.SEMAFT_04',
                                    'SIEVAD_DPA.TSEMP_02','SIEVAD_DPA.TSEMC_02',
                                    'SIEVAD_DPA.SEM_P02',
                                    'SIEVAD_DPA.SEMAFS_02',

                                    'SIEVAD_DPA.OBJETIVO_DESC', 
                                    'SIEVAD_DPA.OPERACIONAL_DESC', 
                                    'SIEVAD_DPA.SOPORTE_01'
                               )
                          ->Where(  'SIEVAD_DPA.PERIODO_ID'    ,'=',$request->periodo_id) 
                          //->Where('SIEVAD_DPA.MES_ID'        ,'=',$request->mess)
                          //->Where('SIEVAD_DPA.DEPEN_ID2'     ,'=',$request->depen_id)
                          //->Where('SIEVAD_DPA.RECIBO_STATUS2','=',$request->semaforo)    
                          ->orderBy('SIEVAD_DPA.PERIODO_ID','ASC')                   
                          ->orderBy('SIEVAD_DPA.FOLIO'     ,'ASC')
                          ->orderBy('SIEVAD_DPA.PARTIDA'   ,'ASC')                          
                          ->get();                                       
                    }   // depen_id

                    /************ Bitacora inicia *************************************/ 
                    setlocale(LC_TIME, "spanish");        
                    $xip          = session()->get('ip');
                    $xperiodo_id  = (int)date('Y');
                    $xprograma_id = 1;
                    $xmes_id      = (int)date('m');
                    $xproceso_id  =         3;
                    $xfuncion_id  =      3001;
                    $xtrx_id      =         3;    //Reportes        
                    $id           =         0;
                    $regbitacora = regBitacoraModel::select('PERIODO_ID','MES_ID','PROCESO_ID','FUNCION_ID','TRX_ID', 
                                   'FOLIO', 'NO_VECES', 'FECHA_REG', 'IP', 'LOGIN', 'FECHA_M', 'IP_M', 'LOGIN_M')
                                   ->where(['PERIODO_ID' => $xperiodo_id,'MES_ID' => $xmes_id,'PROCESO_ID' => $xproceso_id, 
                                            'FUNCION_ID' => $xfuncion_id,'TRX_ID' => $xtrx_id,'FOLIO'      => $id])
                                   ->get();
                    if($regbitacora->count() <= 0){              // Alta
                        $nuevoregBitacora = new regBitacoraModel();              
                        $nuevoregBitacora->PERIODO_ID = $xperiodo_id;    // Año de transaccion 
                        $nuevoregBitacora->PROGRAMA_ID= $xprograma_id;   // Proyecto JAPEM 
                        $nuevoregBitacora->MES_ID     = $xmes_id;        // Mes de transaccion
                        $nuevoregBitacora->PROCESO_ID = $xproceso_id;    // Proceso de apoyo
                        $nuevoregBitacora->FUNCION_ID = $xfuncion_id;    // Funcion del modelado de procesos 
                        $nuevoregBitacora->TRX_ID     = $xtrx_id;        // Actividad del modelado de procesos
                        $nuevoregBitacora->FOLIO      = $id;             // Folio    
                        $nuevoregBitacora->NO_VECES   = 1;               // Numero de veces            
                        $nuevoregBitacora->IP         = $ip;             // IP
                        $nuevoregBitacora->LOGIN      = $nombre;         // Usuario 

                        $nuevoregBitacora->save();
                        if($nuevoregBitacora->save() == true) 
                            toastr()->success('Trx de exportar a excel registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                        else
                            toastr()->error('Error de trx de exportar a excel. Por favor volver a interlo.','Ups!',['positionClass' => 'toast-bottom-right']);
                    }else{                   
                        //*********** Obtine el no. de veces *****************************
                        $xno_veces = regBitacoraModel::where(['PERIODO_ID' => $xperiodo_id,'MES_ID'     => $xmes_id, 
                                                              'PROCESO_ID' => $xproceso_id,'FUNCION_ID' => $xfuncion_id, 
                                                              'TRX_ID'     => $xtrx_id,'FOLIO'          => $id])
                                     ->max('NO_VECES');
                        $xno_veces = $xno_veces+1;                        
                        //*********** Termina de obtener el no de veces *****************************         
                        $regbitacora = regBitacoraModel::select('NO_VECES','IP_M','LOGIN_M','FECHA_M')
                                       ->where(['PERIODO_ID' => $xperiodo_id,'MES_ID'     => $xmes_id,
                                                'PROCESO_ID' => $xproceso_id,'FUNCION_ID' => $xfuncion_id, 
                                                'TRX_ID'     => $xtrx_id,'FOLIO'          => $id])
                                       ->update([
                                                 'NO_VECES' => $regbitacora->NO_VECES = $xno_veces,
                                                 'IP_M'     => $regbitacora->IP       = $ip,
                                                 'LOGIN_M'  => $regbitacora->LOGIN_M  = $nombre,
                                                 'FECHA_M'  => $regbitacora->FECHA_M  = date('Y/m/d')  //date('d/m/Y')
                                                ]);
                        toastr()->success('Trx de exportar a excel registrada en Bitacora.','¡Ok!',['positionClass' => 'toast-bottom-right']);
                    }   //************ Bitacora termina ****************************************//         
                    //*************** Genera reporte a excel, las tablas estan en el reporte ***//
                    //return Excel::download(new ExcelExportAvancespa01v2($request->periodo_id,$request->mes_id,$request->depen_id,$request->tipo),'Detallado_AvancePA_'.date('d-m-Y').'.xlsx');
                    //*************** Genera reporte a excel, se define tablas antes ***//
                    return Excel::download(new ExcelExportAvancespa01($regprogdanual,$request->periodo_id,$request->mes_id,$request->depen_id,$request->tipo),'Detallado_AvancePA_'.date('d-m-Y').'.xlsx');
                    //return Excel::download(new ExcelExportReporteConsumoDet($regrecibos,$request->perr, $request->mess, $request->tipog_id),'ReporteDeConsumoDetallado_'.date('d-m-Y').'.xlsx');
                }       // si hay registros
                break;
            }   //Switch ($request->tipo) - Fin tipo de reporte pantalla, excel o PDF   
        }   // fin clase

    }    


}
